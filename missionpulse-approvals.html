<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Approval Workflow</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['CEO','COO','CAP','PM'];

    const DEMO_DECISIONS=[
      {id:1,opp:'DHA EHR Modernization',type:'Bid/No-Bid',date:'2025-10-01',decision:'BID',decidedBy:'Mary W.',role:'CEO',rationale:'Strong alignment with DHA health IT strategy. SDVOSB set-aside. Teaming partner identified for incumbency gap.',conditions:['Secure teaming agreement with TechPartner Alpha by Oct 15','Confirm key personnel availability','Budget $50K for capture investment'],riskLevel:'MEDIUM',pwin:45,
        sigChain:[
          {name:'Tom P.',role:'COO',action:'RECOMMEND BID',date:'2025-09-28',notes:'Competitive landscape favorable. 3 viable team members identified.'},
          {name:'Sarah K.',role:'CAP',action:'RECOMMEND BID',date:'2025-09-29',notes:'Technical requirements align with our Azure Gov capabilities.'},
          {name:'Finance Team',role:'FIN',action:'APPROVE',date:'2025-09-30',notes:'B&P budget available. Capture investment within threshold.'},
          {name:'Mary W.',role:'CEO',action:'APPROVED — BID',date:'2025-10-01',notes:'Go. Assign full capture team. Weekly cadence starts Oct 7.'},
        ]},
      {id:2,opp:'DHA EHR Modernization',type:'Go/No-Go',date:'2025-11-15',decision:'GO',decidedBy:'Mary W.',role:'CEO',rationale:'RFP released. Requirements match capture plan. Win probability increased to 65% with teaming agreement signed.',conditions:['Complete Vol II draft by Dec 1','Schedule Blue Team for Dec 10','Finalize pricing strategy with PTW analysis'],riskLevel:'LOW',pwin:65,
        sigChain:[
          {name:'Sarah K.',role:'SA',action:'RECOMMEND GO',date:'2025-11-12',notes:'Technical approach validated. Architecture aligns with MHS GENESIS roadmap.'},
          {name:'Tom P.',role:'PM',action:'RECOMMEND GO',date:'2025-11-13',notes:'Schedule feasible. All key personnel confirmed available.'},
          {name:'Finance Team',role:'FIN',action:'APPROVE',date:'2025-11-14',notes:'BOE within competitive range. GSA rates applicable.'},
          {name:'Angela F.',role:'CON',action:'APPROVE',date:'2025-11-14',notes:'No OCI issues. FAR/DFARS clauses reviewed.'},
          {name:'Mary W.',role:'CEO',action:'APPROVED — GO',date:'2025-11-15',notes:'Full commitment. All hands proposal. Submission target: Mar 10.'},
        ]},
      {id:3,opp:'VA Claims Processing AI',type:'Bid/No-Bid',date:'2025-11-15',decision:'BID',decidedBy:'Mary W.',role:'CEO',rationale:'VA AI modernization aligns with our AskSage partnership. SDVOSB eligible. James R. available as AI lead.',conditions:['Validate FedRAMP compliance path with AskSage','Identify VA-specific PP within 2 weeks'],riskLevel:'MEDIUM',pwin:35,
        sigChain:[
          {name:'James R.',role:'SA',action:'RECOMMEND BID',date:'2025-11-13',notes:'AI/ML requirements well-matched. AskSage covers 80% of technical needs.'},
          {name:'Tom P.',role:'COO',action:'RECOMMEND BID',date:'2025-11-14',notes:'Resource availability confirmed. Minimal conflict with DHA pursuit.'},
          {name:'Mary W.',role:'CEO',action:'APPROVED — BID',date:'2025-11-15',notes:'Pursue. Lower capture investment — leverage DHA work products where applicable.'},
        ]},
      {id:4,opp:'VA Claims Processing AI',type:'Go/No-Go',date:'2026-01-10',decision:'GO',decidedBy:'Mary W.',role:'CEO',rationale:'SDVOSB set-aside confirmed. Win probability up to 45%. AI approach is strong discriminator.',conditions:['Complete Vol II by Feb 1','Blue Team Feb 15','Coordinate with AskSage on joint demo'],riskLevel:'MEDIUM',pwin:45,
        sigChain:[
          {name:'James R.',role:'SA',action:'RECOMMEND GO',date:'2026-01-08',notes:'Technical approach finalized. AskSage demo environment ready.'},
          {name:'Finance Team',role:'FIN',action:'APPROVE',date:'2026-01-09',notes:'Pricing competitive. T&M structure favorable for our rate card.'},
          {name:'Mary W.',role:'CEO',action:'APPROVED — GO',date:'2026-01-10',notes:'Go. Leverage templates from DHA proposal. Submission target: Apr 1.'},
        ]},
      {id:5,opp:'IHS Telehealth Expansion',type:'Bid/No-Bid',date:'2025-09-01',decision:'NO BID',decidedBy:'Mary W.',role:'CEO',rationale:'Insufficient past performance in telehealth. Resource conflict with DHA EHR pursuit. Win probability below threshold.',conditions:[],riskLevel:'HIGH',pwin:15,
        sigChain:[
          {name:'Tom P.',role:'COO',action:'RECOMMEND NO BID',date:'2025-08-28',notes:'Key personnel unavailable. Would need to hire.'},
          {name:'Sarah K.',role:'SA',action:'NEUTRAL',date:'2025-08-29',notes:'Technically feasible but no differentiation vs established telehealth vendors.'},
          {name:'Mary W.',role:'CEO',action:'NO BID',date:'2025-09-01',notes:'Pass. Revisit if IHS recompetes in FY27 with expanded team.'},
        ]},
    ];

    const DEMO_AUDIT=[
      {id:1,timestamp:'2026-02-18T14:32:00Z',user:'Mary W.',action:'Viewed Go/No-Go for DHA EHR Modernization',ip:'10.0.1.42'},
      {id:2,timestamp:'2026-02-18T13:15:00Z',user:'Tom P.',action:'Added condition to VA Claims AI Bid/No-Bid',ip:'10.0.1.38'},
      {id:3,timestamp:'2026-02-17T16:45:00Z',user:'Mary W.',action:'Approved Go/No-Go for VA Claims AI',ip:'10.0.1.42'},
      {id:4,timestamp:'2026-02-17T10:22:00Z',user:'Finance Team',action:'Signed pricing approval for VA Claims AI',ip:'10.0.1.55'},
      {id:5,timestamp:'2026-02-15T09:00:00Z',user:'Sarah K.',action:'Submitted technical recommendation for DHA EHR Red Team',ip:'10.0.1.33'},
      {id:6,timestamp:'2026-02-14T11:30:00Z',user:'Mary W.',action:'Created submission approval workflow for CMS Data Analytics',ip:'10.0.1.42'},
    ];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[decisions]=useState(DEMO_DECISIONS);
      const[tab,setTab]=useState('decisions');
      const[oppFilter,setOppFilter]=useState('All');
      const[expanded,setExpanded]=useState(null);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('audit_logs').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const opps=[...new Set(decisions.map(d=>d.opp))];
      const filtered=useMemo(()=>oppFilter==='All'?decisions:decisions.filter(d=>d.opp===oppFilter),[decisions,oppFilter]);

      const decColor={GO:'#00ff88',BID:'#00ff88','NO BID':'#ef4444','NO GO':'#ef4444'};
      const riskColor={LOW:'#00ff88',MEDIUM:'#f59e0b',HIGH:'#ef4444'};
      const actionColor={'APPROVED — BID':'#00ff88','APPROVED — GO':'#00ff88','RECOMMEND BID':'#00E5FA','RECOMMEND GO':'#00E5FA',APPROVE:'#00ff88',NEUTRAL:'#f59e0b','RECOMMEND NO BID':'#ef4444','NO BID':'#ef4444'};

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>GOVERNANCE</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Approval Workflow</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Go/No-Go decisions • Signature chains • Audit trail</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          {/* Stats */}
          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Decisions',value:decisions.length,color:'#00E5FA'},
              {label:'Go / Bid',value:decisions.filter(d=>['GO','BID'].includes(d.decision)).length,color:'#00ff88'},
              {label:'No Bid / No Go',value:decisions.filter(d=>['NO BID','NO GO'].includes(d.decision)).length,color:'#ef4444'},
              {label:'Total Signatures',value:decisions.reduce((s,d)=>s+d.sigChain.length,0),color:'#a78bfa'},
              {label:'Avg pWin at Decision',value:`${Math.round(decisions.reduce((s,d)=>s+d.pwin,0)/decisions.length)}%`,color:'#00E5FA'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'130px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Tabs + Filters */}
          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'decisions',l:'Decision Log'},{k:'audit',l:'Audit Trail'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{marginLeft:'auto',display:'flex',gap:'3px'}}>
              {['All',...opps].map(o=>(
                <button key={o} onClick={()=>setOppFilter(o)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',whiteSpace:'nowrap',background:oppFilter===o?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:oppFilter===o?'#00E5FA':'#5a7a9a'}}>{o==='All'?'All':o.split(' ').slice(0,3).join(' ')}</button>
              ))}
            </div>
          </div>

          {/* DECISIONS TAB */}
          {tab==='decisions'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
              {filtered.map(d=>(
                <div key={d.id} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'hidden',transition:'all 0.15s'}} onMouseOver={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.2)'} onMouseOut={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                  <div onClick={()=>setExpanded(expanded===d.id?null:d.id)} style={{padding:'14px 18px',cursor:'pointer'}}>
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'6px'}}>
                      <div style={{display:'flex',alignItems:'center',gap:'8px',flexWrap:'wrap'}}>
                        <span style={{fontSize:'15px',fontWeight:700,color:'white'}}>{d.opp}</span>
                        <span style={{fontSize:'10px',fontWeight:700,padding:'2px 8px',borderRadius:'4px',background:'rgba(0,229,250,0.08)',color:'#00E5FA'}}>{d.type}</span>
                        <span style={{fontSize:'10px',fontWeight:700,padding:'2px 8px',borderRadius:'4px',background:`${decColor[d.decision]}12`,color:decColor[d.decision]}}>{d.decision}</span>
                        <span style={{fontSize:'9px',fontWeight:600,padding:'1px 5px',borderRadius:'3px',background:`${riskColor[d.riskLevel]}10`,color:riskColor[d.riskLevel]}}>Risk: {d.riskLevel}</span>
                      </div>
                      <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
                        <span style={{fontSize:'11px',color:'#5a7a9a'}}>{d.date}</span>
                        <span style={{fontSize:'11px',fontWeight:600,color:'#00E5FA'}}>pWin: {d.pwin}%</span>
                        <span style={{color:'#5a7a9a',fontSize:'16px',transform:expanded===d.id?'rotate(180deg)':'rotate(0)',transition:'transform 0.2s'}}>▾</span>
                      </div>
                    </div>
                    <div style={{fontSize:'12px',color:'#94a3b8',lineHeight:'1.4'}}>{d.rationale}</div>
                  </div>
                  {expanded===d.id&&(
                    <div style={{padding:'0 18px 16px',borderTop:'1px solid rgba(0,229,250,0.06)'}}>
                      {/* Conditions */}
                      {d.conditions.length>0&&(
                        <div style={{padding:'10px 0'}}>
                          <div style={{fontSize:'10px',fontWeight:700,color:'#f59e0b',marginBottom:'6px'}}>CONDITIONS</div>
                          {d.conditions.map((c,i)=><div key={i} style={{fontSize:'11px',color:'#fbbf24',padding:'2px 0'}}>▸ {c}</div>)}
                        </div>
                      )}
                      {/* Signature Chain */}
                      <div style={{padding:'10px 0'}}>
                        <div style={{fontSize:'10px',fontWeight:700,color:'#00E5FA',marginBottom:'8px'}}>SIGNATURE CHAIN</div>
                        <div style={{display:'flex',flexDirection:'column',gap:'0'}}>
                          {d.sigChain.map((sig,i)=>(
                            <div key={i} style={{display:'flex',gap:'12px',alignItems:'flex-start',position:'relative',paddingLeft:'20px',paddingBottom:'12px'}}>
                              {/* Vertical line */}
                              {i<d.sigChain.length-1&&<div style={{position:'absolute',left:'8px',top:'14px',bottom:'0',width:'2px',background:'rgba(0,229,250,0.1)'}}/>}
                              {/* Dot */}
                              <div style={{position:'absolute',left:'3px',top:'4px',width:'12px',height:'12px',borderRadius:'50%',background:(actionColor[sig.action]||'#5a7a9a')+'30',border:`2px solid ${actionColor[sig.action]||'#5a7a9a'}`,zIndex:1}}/>
                              <div style={{flex:1}}>
                                <div style={{display:'flex',gap:'8px',alignItems:'center',flexWrap:'wrap'}}>
                                  <span style={{fontSize:'12px',fontWeight:600,color:'white'}}>{sig.name}</span>
                                  <span style={{fontSize:'9px',fontWeight:600,padding:'1px 5px',borderRadius:'3px',background:'rgba(0,229,250,0.06)',color:'#5a7a9a'}}>{sig.role}</span>
                                  <span style={{fontSize:'10px',fontWeight:700,padding:'1px 6px',borderRadius:'3px',background:`${actionColor[sig.action]||'#5a7a9a'}12`,color:actionColor[sig.action]||'#5a7a9a'}}>{sig.action}</span>
                                  <span style={{fontSize:'10px',color:'#3e4f63'}}>{sig.date}</span>
                                </div>
                                <div style={{fontSize:'11px',color:'#94a3b8',marginTop:'2px'}}>{sig.notes}</div>
                              </div>
                            </div>
                          ))}
                        </div>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {/* AUDIT TRAIL TAB */}
          {tab==='audit'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'hidden'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  {['Timestamp','User','Action','IP'].map(h=>(
                    <th key={h} style={{padding:'10px 12px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px',letterSpacing:'0.5px',textTransform:'uppercase'}}>{h}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {DEMO_AUDIT.map(a=>(
                    <tr key={a.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}} onMouseOver={e=>e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
                      <td style={{padding:'9px 12px',fontFamily:'monospace',fontSize:'10px',color:'#5a7a9a',whiteSpace:'nowrap'}}>{new Date(a.timestamp).toLocaleString()}</td>
                      <td style={{padding:'9px 12px',color:'white',fontWeight:500}}>{a.user}</td>
                      <td style={{padding:'9px 12px',color:'#94a3b8'}}>{a.action}</td>
                      <td style={{padding:'9px 12px',fontFamily:'monospace',fontSize:'10px',color:'#3e4f63'}}>{a.ip}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
