<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MissionPulse — Shipley Playbook</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:fadeIn .3s ease-out forwards}::-webkit-scrollbar{width:4px}::-webkit-scrollbar-thumb{background:rgba(0,229,250,.2);border-radius:2px}</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const SB_URL='https://djuviwarqdvlbgcfuupa.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MzUyMjQsImV4cCI6MjA1MzQxMTIyNH0.pBPL9l2zL7LLd_A5I--hPBzw5YwG3ajPMtbYsqsxIgQ';
var sbClient=null;let connected=false;
try{sbClient=supabase.createClient(SB_URL,SB_KEY);connected=true}catch(e){}

const PHASES=[
  {id:'lrp',name:'Long-Range Positioning',color:'#8B5CF6',tasks:[
    {title:'Market Research & NAICS Analysis',owner:'CAP',priority:'high',status:'complete',due:'2026-01-15',output:'Market Assessment Report',ai:true},
    {title:'Agency Relationship Mapping',owner:'CEO',priority:'high',status:'complete',due:'2026-01-20',output:'Stakeholder Contact List',ai:false},
    {title:'Capability Gap Analysis',owner:'SA',priority:'medium',status:'complete',due:'2026-01-25',output:'Gap Report & Investment Plan',ai:true},
    {title:'Competitive Landscape Review',owner:'CAP',priority:'high',status:'complete',due:'2026-01-30',output:'Competitor Profiles',ai:true},
  ]},
  {id:'oa',name:'Opportunity Assessment',color:'#FBBF24',tasks:[
    {title:'Opportunity Qualification (DAFE)',owner:'CAP',priority:'critical',status:'complete',due:'2026-02-05',output:'Go/No-Go Recommendation',ai:true},
    {title:'Win Probability Assessment',owner:'CEO',priority:'critical',status:'complete',due:'2026-02-06',output:'pWin Score & Rationale',ai:true},
    {title:'Budget & Funding Verification',owner:'FIN',priority:'high',status:'in_progress',due:'2026-02-10',output:'Funding Confirmation',ai:false},
    {title:'Teaming Partner Identification',owner:'CAP',priority:'high',status:'in_progress',due:'2026-02-12',output:'Teaming Strategy',ai:true},
    {title:'Preliminary Pricing Estimate',owner:'FIN',priority:'medium',status:'not_started',due:'2026-02-15',output:'ROM Pricing',ai:true},
  ]},
  {id:'cp',name:'Capture Planning',color:'#00E5FA',tasks:[
    {title:'Capture Plan Development',owner:'CAP',priority:'critical',status:'in_progress',due:'2026-02-18',output:'Capture Plan v1',ai:true},
    {title:'Win Theme Development',owner:'CAP',priority:'critical',status:'in_progress',due:'2026-02-20',output:'Win Themes & Discriminators',ai:true},
    {title:'Black Hat Review',owner:'COO',priority:'high',status:'not_started',due:'2026-02-25',output:'Competitor Ghost Strategies',ai:true},
    {title:'Customer Engagement Plan',owner:'CEO',priority:'high',status:'not_started',due:'2026-02-22',output:'Call Plan & Meeting Schedule',ai:false},
    {title:'Teaming Agreements',owner:'CON',priority:'high',status:'not_started',due:'2026-02-28',output:'Executed TAs/NDAs',ai:false},
  ]},
  {id:'pd',name:'Proposal Development',color:'#00D29F',tasks:[
    {title:'Proposal Outline & Compliance Matrix',owner:'PM',priority:'critical',status:'not_started',due:'2026-03-01',output:'Annotated Outline',ai:true},
    {title:'Technical Volume Draft',owner:'SA',priority:'critical',status:'not_started',due:'2026-03-10',output:'Technical Approach',ai:true},
    {title:'Management Volume Draft',owner:'PM',priority:'high',status:'not_started',due:'2026-03-12',output:'Management Plan',ai:true},
    {title:'Past Performance Narratives',owner:'CAP',priority:'high',status:'not_started',due:'2026-03-08',output:'PP Write-ups & CPARS',ai:true},
    {title:'Pricing Volume Build',owner:'FIN',priority:'critical',status:'not_started',due:'2026-03-15',output:'Cost/Price Volume',ai:true},
    {title:'Staffing Plan & Org Chart',owner:'DEL',priority:'medium',status:'not_started',due:'2026-03-10',output:'Staffing Matrix',ai:false},
  ]},
  {id:'so',name:'Submission & Orals',color:'#EF4444',tasks:[
    {title:'Color Team Reviews (Blue/Pink/Red/Gold)',owner:'QA',priority:'critical',status:'not_started',due:'2026-03-18',output:'Review Findings & Fixes',ai:false},
    {title:'Final Compliance Check',owner:'PM',priority:'critical',status:'not_started',due:'2026-03-20',output:'Compliance Verification',ai:true},
    {title:'Orals Preparation',owner:'CEO',priority:'high',status:'not_started',due:'2026-03-22',output:'Orals Deck & Q&A Prep',ai:true},
    {title:'Submission Package Assembly',owner:'PM',priority:'critical',status:'not_started',due:'2026-03-25',output:'Final Submission',ai:false},
  ]},
  {id:'pa',name:'Post-Award Transition',color:'#F472B6',tasks:[
    {title:'Debrief Request & Analysis',owner:'CAP',priority:'high',status:'not_started',due:'2026-04-05',output:'Debrief Report',ai:true},
    {title:'Transition Plan Execution',owner:'DEL',priority:'critical',status:'not_started',due:'2026-04-10',output:'30-60-90 Day Plan',ai:true},
    {title:'Lessons Learned Capture',owner:'QA',priority:'medium',status:'not_started',due:'2026-04-15',output:'Lessons Database Entry',ai:true},
  ]},
];

const STATUS_CYCLE=['not_started','in_progress','complete','blocked'];
const STATUS_LABELS={not_started:'Not Started',in_progress:'In Progress',complete:'Complete',blocked:'Blocked'};
const STATUS_COLORS={not_started:'bg-gray-500/10 text-gray-400',in_progress:'bg-amber-500/10 text-amber-400',complete:'bg-green-500/10 text-green-400',blocked:'bg-red-500/10 text-red-400'};
const PRIORITY_COLORS={critical:'text-red-400',high:'text-amber-400',medium:'text-cyan-400',low:'text-gray-400'};

function App(){
  const[phases,setPhases]=React.useState(PHASES);
  const[search,setSearch]=React.useState('');
  const[expandedPhase,setExpandedPhase]=React.useState('oa');

  React.useEffect(()=>{
    if(connected){sbClient.from('playbook_items').select('*').then(({data})=>{if(data?.length){/* merge with demo */}});}
  },[]);

  const allTasks=phases.flatMap(p=>p.tasks);
  const done=allTasks.filter(t=>t.status==='complete').length;
  const active=allTasks.filter(t=>t.status==='in_progress').length;
  const pct=Math.round((done/allTasks.length)*100);

  const cycleStatus=(phaseId,taskIdx)=>{
    setPhases(prev=>prev.map(p=>{
      if(p.id!==phaseId)return p;
      const tasks=[...p.tasks];
      const cur=STATUS_CYCLE.indexOf(tasks[taskIdx].status);
      tasks[taskIdx]={...tasks[taskIdx],status:STATUS_CYCLE[(cur+1)%STATUS_CYCLE.length]};
      return{...p,tasks};
    }));
  };

  const filtered=search?phases.map(p=>({...p,tasks:p.tasks.filter(t=>t.title.toLowerCase().includes(search.toLowerCase())||t.owner.toLowerCase().includes(search.toLowerCase()))})).filter(p=>p.tasks.length>0):phases;

  return(
    <div className="min-h-screen p-6 max-w-6xl mx-auto">
      <div className="flex items-center justify-between mb-6">
        <div><a href="index.html" className="text-cyan-400 text-xs hover:underline mb-1 inline-block">← Dashboard</a><h1 className="text-2xl font-extrabold text-white">Shipley Playbook</h1><p className="text-sm text-gray-500">6-phase capture lifecycle</p></div>
        <span className={`px-3 py-1 rounded-full text-xs font-mono font-semibold ${connected?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`}>{connected?'LIVE':'DEMO'}</span>
      </div>

      {/* Progress */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-cyan-400">{pct}%</div><div className="text-xs text-gray-500">Overall</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-green-400">{done}</div><div className="text-xs text-gray-500">Done</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-amber-400">{active}</div><div className="text-xs text-gray-500">Active</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-gray-400">{allTasks.length-done-active}</div><div className="text-xs text-gray-500">Remaining</div></div>
      </div>

      {/* Phase timeline */}
      <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
        {phases.map(p=>{
          const pDone=p.tasks.filter(t=>t.status==='complete').length;
          const pPct=Math.round((pDone/p.tasks.length)*100);
          return(
            <button key={p.id} onClick={()=>setExpandedPhase(expandedPhase===p.id?null:p.id)} className={`flex-shrink-0 px-4 py-3 rounded-lg border text-left transition ${expandedPhase===p.id?'border-cyan-500/30 bg-cyan-500/5':'border-gray-800 bg-[#0a1628] hover:border-gray-600'}`} style={{minWidth:'160px'}}>
              <div className="text-xs font-bold text-white mb-1" style={{color:p.color}}>{p.name}</div>
              <div className="flex items-center gap-2"><div className="flex-1 h-1 bg-gray-800 rounded-full"><div className="h-1 rounded-full" style={{width:`${pPct}%`,background:p.color}}/></div><span className="text-[10px] font-mono text-gray-500">{pPct}%</span></div>
            </button>
          );
        })}
      </div>

      {/* Search */}
      <div className="mb-4"><input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search tasks or owners..." className="w-full bg-[#0a1628] border border-gray-800 rounded-lg px-4 py-2.5 text-white text-sm focus:border-cyan-500/50 focus:outline-none"/></div>

      {/* Tasks */}
      {filtered.map(phase=>(
        (expandedPhase===null||expandedPhase===phase.id)&&(
        <div key={phase.id} className="mb-6 fade-in">
          <h2 className="text-sm font-bold mb-3 flex items-center gap-2"><span className="w-3 h-3 rounded-full" style={{background:phase.color}}/><span className="text-white">{phase.name}</span><span className="text-gray-600 text-xs font-normal">({phase.tasks.length} tasks)</span></h2>
          <div className="space-y-2">
            {phase.tasks.map((task,i)=>(
              <div key={i} className="bg-[#0a1628] border border-gray-800 rounded-lg px-4 py-3 flex items-center gap-3">
                <button onClick={()=>cycleStatus(phase.id,i)} className={`px-2 py-0.5 rounded text-[10px] font-semibold font-mono ${STATUS_COLORS[task.status]}`} title="Click to cycle status">{STATUS_LABELS[task.status]}</button>
                <div className="flex-1"><div className="text-sm text-white font-medium">{task.title}</div><div className="text-xs text-gray-500 mt-0.5">Owner: <span className="text-purple-400">{task.owner}</span> · Due: {task.due} · Output: {task.output}</div></div>
                <span className={`text-[10px] font-mono font-bold uppercase ${PRIORITY_COLORS[task.priority]}`}>{task.priority}</span>
                {task.ai&&<span className="text-[10px] font-mono font-bold text-purple-400 bg-purple-500/10 px-1.5 py-0.5 rounded">AI</span>}
              </div>
            ))}
          </div>
        </div>
        )
      ))}

      <p className="text-center text-[10px] text-gray-600 mt-8 font-mono">⚠️ AI GENERATED — REQUIRES HUMAN REVIEW | MissionPulse v12.0 — Mission Meets Tech</p>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
