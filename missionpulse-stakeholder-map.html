<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S139 - Stakeholder Map</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Space Grotesk',sans-serif;background:#00050F;min-height:100vh}.font-mono{font-family:'JetBrains Mono',monospace}@keyframes slideIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.animate-slide-in{animation:slideIn .4s ease-out forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.glass-card{background:linear-gradient(135deg,rgba(15,23,42,.9) 0%,rgba(15,23,42,.7) 100%);backdrop-filter:blur(10px);border:1px solid rgba(0,229,250,.15)}.glass-card:hover{border-color:rgba(0,229,250,.3)}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const{useState,useEffect}=React;
    const SUPABASE_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;try{sbClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY)}catch(e){sbClient=null}

    const Icons={
      users:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>,
      shield:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
      star:()=><svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
      chat:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>,
      target:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><circle cx="12" cy="12" r="6" strokeWidth={2}/><circle cx="12" cy="12" r="2" strokeWidth={2}/></svg>,
    };
    const Icon=({name,className="w-4 h-4"})=>{const C=Icons[name];return C?<span className={`inline-block ${className}`}><C/></span>:null};

    const STAKEHOLDERS=[
      {id:1,name:'Col. David Martinez',title:'Program Manager',org:'DHA',influence:5,interest:5,disposition:'champion',relationship:'strong',opportunity:'DHA EHR Modernization',lastContact:'2026-02-17',engagementPlan:'Monthly sync calls, quarterly in-person reviews',reports_to:null,direct_reports:[2,3]},
      {id:2,name:'Karen Wells',title:'Contracting Officer Representative',org:'DHA',influence:4,interest:5,disposition:'supporter',relationship:'strong',opportunity:'DHA EHR Modernization',lastContact:'2026-02-17',engagementPlan:'Bi-weekly status emails, monthly 1:1',reports_to:1,direct_reports:[]},
      {id:3,name:'Lt. Col. Amy Park',title:'Deputy PM',org:'DHA',influence:3,interest:4,disposition:'neutral',relationship:'developing',opportunity:'DHA EHR Modernization',lastContact:'2026-01-28',engagementPlan:'Include in all technical reviews, schedule intro meeting',reports_to:1,direct_reports:[]},
      {id:4,name:'Dr. Rajesh Patel',title:'Chief Health Informatics Officer',org:'VA OINT',influence:5,interest:4,disposition:'supporter',relationship:'developing',opportunity:'VA Claims Processing AI',lastContact:'2026-02-14',engagementPlan:'Quarterly innovation briefings, AI demo sessions',reports_to:null,direct_reports:[5]},
      {id:5,name:'Tom Harris',title:'Program Manager',org:'VA',influence:4,interest:5,disposition:'neutral',relationship:'new',opportunity:'VA Claims Processing AI',lastContact:'2026-02-14',engagementPlan:'Monthly check-ins, provide white papers on AI claims use cases',reports_to:4,direct_reports:[]},
      {id:6,name:'Jennifer Lin',title:'COR',org:'CMS',influence:4,interest:4,disposition:'champion',relationship:'strong',opportunity:'CMS Data Analytics Platform',lastContact:'2026-02-10',engagementPlan:'Bi-weekly calls, QBR prep sessions',reports_to:null,direct_reports:[7]},
      {id:7,name:'Mike Rodriguez',title:'ISSO',org:'CMS',influence:3,interest:3,disposition:'supporter',relationship:'established',opportunity:'CMS Data Analytics Platform',lastContact:'2026-02-10',engagementPlan:'Include in all security reviews, provide ATO artifacts proactively',reports_to:6,direct_reports:[]},
      {id:8,name:'CAPT Sarah Nguyen',title:'Advana PMO Director',org:'DoD',influence:5,interest:3,disposition:'neutral',relationship:'new',opportunity:'DoD Advana Expansion',lastContact:'2026-01-16',engagementPlan:'Request capability brief, provide technical white paper',reports_to:null,direct_reports:[]},
      {id:9,name:'Gerald Thompson',title:'OSDBU Director',org:'VA',influence:3,interest:2,disposition:'supporter',relationship:'established',opportunity:'VA Claims Processing AI',lastContact:'2026-02-01',engagementPlan:'Quarterly SDVOSB outreach events, annual capability brief',reports_to:null,direct_reports:[]},
    ];

    const ConnectionIndicator=({connected})=>(
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{background:connected?'rgba(0,255,136,0.1)':'rgba(255,184,0,0.1)',border:`1px solid ${connected?'rgba(0,255,136,0.3)':'rgba(255,184,0,0.3)'}`}}>
        <div className={`w-2 h-2 rounded-full ${connected?'bg-green-400':'bg-amber-400 animate-pulse'}`}/>
        <span style={{color:connected?'#00ff88':'#ffb800'}}>{connected?'LIVE':'DEMO'}</span>
      </div>
    );

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[userRole]=useState('CEO');
      const[activeTab,setActiveTab]=useState('grid');
      const[selected,setSelected]=useState(null);
      const[filterOrg,setFilterOrg]=useState('all');

      useEffect(()=>{const a=['CEO','COO','CAP','PM','Admin'];if(!a.includes(userRole))return},[userRole]);
      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data}=await sbClient.from('opportunities').select('id').limit(1);if(data)setConnected(true)}catch(e){}})()},[]);

      const orgs=[...new Set(STAKEHOLDERS.map(s=>s.org))];
      const filtered=STAKEHOLDERS.filter(s=>filterOrg==='all'||s.org===filterOrg);

      const DispositionBadge=({d})=>{
        const m={champion:{c:'#00ff88',l:'CHAMPION'},supporter:{c:'#00E5FA',l:'SUPPORTER'},neutral:{c:'#ffb800',l:'NEUTRAL'},blocker:{c:'#ff4444',l:'BLOCKER'}};
        const s=m[d]||m.neutral;
        return <span className="px-2 py-0.5 rounded text-xs font-mono font-bold" style={{background:`${s.c}15`,color:s.c,border:`1px solid ${s.c}30`}}>{s.l}</span>;
      };

      const RelBadge=({r})=>{
        const m={strong:{c:'#00ff88'},established:{c:'#00E5FA'},developing:{c:'#ffb800'},new:{c:'#a78bfa'}};
        const s=m[r]||m.new;
        return <span className="text-xs font-mono capitalize" style={{color:s.c}}>{r}</span>;
      };

      // Influence/Interest Grid
      const GridView=()=>{
        const gridSize=200;
        return(
          <div className="glass-card rounded-xl p-6">
            <h3 className="text-sm font-mono font-bold text-cyan-400 mb-4">INFLUENCE / INTEREST MATRIX</h3>
            <div className="relative mx-auto" style={{width:gridSize*2+60,height:gridSize*2+60}}>
              {/* Quadrant labels */}
              <div className="absolute text-xs font-mono text-slate-600" style={{top:gridSize/2-10,left:gridSize/2}}>Keep Satisfied</div>
              <div className="absolute text-xs font-mono text-green-400/60" style={{top:gridSize/2-10,right:gridSize/2-40}}>Key Player</div>
              <div className="absolute text-xs font-mono text-slate-600" style={{bottom:gridSize/2-10,left:gridSize/2+10}}>Monitor</div>
              <div className="absolute text-xs font-mono text-slate-600" style={{bottom:gridSize/2-10,right:gridSize/2-20}}>Keep Informed</div>
              {/* Grid */}
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="relative border border-slate-700/40" style={{width:gridSize*2,height:gridSize*2}}>
                  <div className="absolute top-0 left-1/2 w-px h-full bg-slate-700/30"/>
                  <div className="absolute top-1/2 left-0 w-full h-px bg-slate-700/30"/>
                  {/* Axis labels */}
                  <div className="absolute -left-10 top-1/2 -translate-y-1/2 -rotate-90 text-xs font-mono text-slate-500">INFLUENCE →</div>
                  <div className="absolute bottom-[-24px] left-1/2 -translate-x-1/2 text-xs font-mono text-slate-500">INTEREST →</div>
                  {/* Dots */}
                  {filtered.map(s=>{
                    const x=((s.interest-1)/4)*gridSize*2;
                    const y=gridSize*2-((s.influence-1)/4)*gridSize*2;
                    const colors={champion:'#00ff88',supporter:'#00E5FA',neutral:'#ffb800',blocker:'#ff4444'};
                    return(
                      <div key={s.id} onClick={()=>setSelected(s)} className="absolute cursor-pointer group" style={{left:x-12,top:y-12}}>
                        <div className="w-6 h-6 rounded-full border-2 transition hover:scale-125" style={{background:`${colors[s.disposition]}30`,borderColor:colors[s.disposition]}}/>
                        <div className="hidden group-hover:block absolute left-8 top-0 z-10 px-2 py-1 rounded bg-slate-900 border border-slate-700 whitespace-nowrap">
                          <span className="text-xs text-white font-medium">{s.name}</span>
                          <span className="text-xs text-slate-500 ml-1">({s.org})</span>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>
            <div className="flex items-center justify-center gap-4 mt-8">
              {[{l:'Champion',c:'#00ff88'},{l:'Supporter',c:'#00E5FA'},{l:'Neutral',c:'#ffb800'},{l:'Blocker',c:'#ff4444'}].map((d,i)=>(
                <span key={i} className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded-full border-2" style={{background:`${d.c}30`,borderColor:d.c}}/>{d.l}</span>
              ))}
            </div>
          </div>
        );
      };

      // Detail
      if(selected){
        const s=selected;
        const reports=STAKEHOLDERS.filter(x=>x.reports_to===s.id);
        const boss=STAKEHOLDERS.find(x=>x.id===s.reports_to);
        return(
          <div className="min-h-screen" style={{background:'#00050F'}}>
            <div className="max-w-5xl mx-auto p-6">
              <button onClick={()=>setSelected(null)} className="text-sm text-slate-400 hover:text-cyan-400 transition mb-6">← Back to Stakeholder Map</button>
              <div className="glass-card rounded-xl p-6 mb-6">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">{s.name}</h1><DispositionBadge d={s.disposition}/></div>
                    <p className="text-sm text-slate-400">{s.title} · {s.org} · <span className="text-cyan-400">{s.opportunity}</span></p>
                  </div>
                  <div className="flex items-center gap-4">
                    <div className="text-center"><div className="text-lg font-mono font-bold text-amber-400">{s.influence}</div><div className="text-xs text-slate-500">Influence</div></div>
                    <div className="text-center"><div className="text-lg font-mono font-bold text-cyan-400">{s.interest}</div><div className="text-xs text-slate-500">Interest</div></div>
                  </div>
                </div>
              </div>
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">RELATIONSHIP</h3>
                  <div className="space-y-3">
                    <div className="flex justify-between"><span className="text-sm text-slate-400">Status</span><RelBadge r={s.relationship}/></div>
                    <div className="flex justify-between"><span className="text-sm text-slate-400">Last Contact</span><span className="text-sm font-mono text-slate-300">{s.lastContact}</span></div>
                    {boss&&<div className="flex justify-between"><span className="text-sm text-slate-400">Reports To</span><span className="text-sm text-cyan-400 cursor-pointer hover:underline" onClick={()=>setSelected(boss)}>{boss.name}</span></div>}
                  </div>
                </div>
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">ENGAGEMENT PLAN</h3>
                  <p className="text-sm text-slate-300 leading-relaxed">{s.engagementPlan}</p>
                </div>
                {reports.length>0&&(
                  <div className="glass-card rounded-xl p-6 lg:col-span-2">
                    <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">ORG CHART — DIRECT REPORTS ({reports.length})</h3>
                    <div className="flex flex-wrap gap-3">
                      {reports.map(r=>(
                        <div key={r.id} onClick={()=>setSelected(r)} className="flex items-center gap-3 p-3 rounded-lg bg-slate-800/30 border border-slate-700/20 cursor-pointer hover:border-cyan-500/30 transition">
                          <div className="w-8 h-8 rounded-full bg-cyan-500/10 flex items-center justify-center text-xs font-bold text-cyan-400">{r.name.split(' ').map(n=>n[0]).join('')}</div>
                          <div><div className="text-sm text-white">{r.name}</div><div className="text-xs text-slate-500">{r.title}</div></div>
                          <DispositionBadge d={r.disposition}/>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      const tabs=[{key:'grid',label:'Influence Grid'},{key:'list',label:'Stakeholder List'},{key:'org',label:'Org View'}];

      return(
        <div className="min-h-screen" style={{background:'#00050F'}}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div><div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Stakeholder Map</h1><ConnectionIndicator connected={connected}/></div>
              <p className="text-sm text-slate-400">Influence grid, relationship tracking, engagement plans & org chart</p></div>
              <div className="flex items-center gap-2">{['all',...orgs].map(o=><button key={o} onClick={()=>setFilterOrg(o)} className={`px-3 py-1 rounded-md text-xs font-mono font-bold transition ${filterOrg===o?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300 bg-slate-800/30'}`}>{o==='all'?'All':o}</button>)}</div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              {[{label:'Stakeholders',value:STAKEHOLDERS.length,color:'#00E5FA'},{label:'Champions',value:STAKEHOLDERS.filter(s=>s.disposition==='champion').length,color:'#00ff88'},{label:'Neutral',value:STAKEHOLDERS.filter(s=>s.disposition==='neutral').length,color:'#ffb800'},{label:'Orgs Tracked',value:orgs.length,color:'#a78bfa'}].map((k,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{color:k.color}}>{k.value}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-1 bg-slate-800/30 rounded-lg p-1 mb-6">
              {tabs.map(t=><button key={t.key} onClick={()=>setActiveTab(t.key)} className={`px-4 py-2 rounded-md text-sm font-mono font-bold transition flex-1 ${activeTab===t.key?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300'}`}>{t.label}</button>)}
            </div>

            {activeTab==='grid'&&<GridView/>}

            {activeTab==='list'&&(
              <div className="space-y-3 animate-slide-in">
                {filtered.map((s,i)=>(
                  <div key={s.id} onClick={()=>setSelected(s)} className="glass-card rounded-xl p-5 cursor-pointer hover:border-cyan-500/40 transition-all animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-4">
                        <div className="w-10 h-10 rounded-full bg-slate-700/40 flex items-center justify-center text-sm font-bold text-cyan-400">{s.name.split(' ').map(n=>n[0]).join('')}</div>
                        <div><div className="flex items-center gap-2"><span className="text-white font-semibold">{s.name}</span><DispositionBadge d={s.disposition}/></div>
                        <p className="text-xs text-slate-500 mt-0.5">{s.title} · {s.org} · <span className="text-cyan-400">{s.opportunity}</span></p></div>
                      </div>
                      <div className="flex items-center gap-6">
                        <div className="text-center"><span className="text-sm font-mono text-amber-400">{s.influence}</span><div className="text-xs text-slate-500">influence</div></div>
                        <div className="text-center"><span className="text-sm font-mono text-cyan-400">{s.interest}</span><div className="text-xs text-slate-500">interest</div></div>
                        <div className="text-center"><RelBadge r={s.relationship}/><div className="text-xs text-slate-500">relationship</div></div>
                        <span className="text-slate-600 text-lg">→</span>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {activeTab==='org'&&(
              <div className="space-y-6 animate-slide-in">
                {orgs.filter(o=>filterOrg==='all'||o===filterOrg).map(org=>{
                  const leaders=STAKEHOLDERS.filter(s=>s.org===org&&!s.reports_to);
                  return(
                    <div key={org} className="glass-card rounded-xl p-6">
                      <h3 className="text-sm font-mono font-bold text-cyan-400 mb-4">{org}</h3>
                      {leaders.map(leader=>(
                        <div key={leader.id}>
                          <div onClick={()=>setSelected(leader)} className="flex items-center gap-3 p-3 rounded-lg bg-slate-800/20 border border-slate-700/20 cursor-pointer hover:border-cyan-500/30 transition mb-2">
                            <div className="w-8 h-8 rounded-full bg-cyan-500/10 flex items-center justify-center text-xs font-bold text-cyan-400">{leader.name.split(' ').map(n=>n[0]).join('')}</div>
                            <div><span className="text-sm text-white font-medium">{leader.name}</span><span className="text-xs text-slate-500 ml-2">{leader.title}</span></div>
                            <DispositionBadge d={leader.disposition}/>
                          </div>
                          <div className="ml-12 space-y-2">
                            {STAKEHOLDERS.filter(s=>s.reports_to===leader.id).map(sub=>(
                              <div key={sub.id} onClick={()=>setSelected(sub)} className="flex items-center gap-3 p-2 rounded-lg bg-slate-900/30 border border-slate-700/10 cursor-pointer hover:border-cyan-500/20 transition">
                                <div className="w-1 h-6 bg-slate-700/40 rounded mr-1"/>
                                <div className="w-7 h-7 rounded-full bg-slate-700/30 flex items-center justify-center text-xs text-slate-400">{sub.name.split(' ').map(n=>n[0]).join('')}</div>
                                <div><span className="text-sm text-slate-300">{sub.name}</span><span className="text-xs text-slate-500 ml-2">{sub.title}</span></div>
                                <DispositionBadge d={sub.disposition}/>
                              </div>
                            ))}
                          </div>
                        </div>
                      ))}
                    </div>
                  );
                })}
              </div>
            )}

            <div className="mt-8 text-center"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20"><Icon name="shield" className="w-3.5 h-3.5 text-amber-500"/><span className="text-xs text-amber-500/80 font-mono">AI GENERATED — REQUIRES HUMAN REVIEW</span></div></div>
          </div>
        </div>
      );
    };
    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
