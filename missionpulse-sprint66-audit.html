<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MissionPulse | Audit Log</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-cyan-dark': '#00B8C8',
                        'mp-slate': '#0A1628',
                        'mp-card': '#111827',
                        'mp-border': '#1E3A5F'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glow-cyan { box-shadow: 0 0 20px rgba(0, 229, 250, 0.15); }
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #0A1628; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #1E3A5F; border-radius: 2px; }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy text-white min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;

        // Audit log data
        const AUDIT_LOGS = [
            { id: 1, timestamp: '2025-01-29 14:32:15', user: 'Mary Womack', action: 'LOGIN', resource: 'System', details: 'Successful login from 192.168.1.1', category: 'auth', severity: 'info' },
            { id: 2, timestamp: '2025-01-29 14:28:03', user: 'Daniel Torres', action: 'UPDATE', resource: 'Pricing BOE', details: 'Modified labor rates for VA EHR Modernization', category: 'data', severity: 'info' },
            { id: 3, timestamp: '2025-01-29 14:15:47', user: 'AI Agent', action: 'GENERATE', resource: 'Black Hat Analysis', details: 'Completed competitor analysis for IHS Cloud Migration', category: 'ai', severity: 'info' },
            { id: 4, timestamp: '2025-01-29 13:58:22', user: 'Sarah Chen', action: 'EXPORT', resource: 'Compliance Matrix', details: 'Exported CUI document to PDF', category: 'data', severity: 'warning' },
            { id: 5, timestamp: '2025-01-29 13:45:11', user: 'System', action: 'ALERT', resource: 'Iron Dome', details: 'Detected potential FAR 52.219-14 compliance issue', category: 'compliance', severity: 'warning' },
            { id: 6, timestamp: '2025-01-29 13:30:00', user: 'Mike Johnson', action: 'CREATE', resource: 'Technical Volume', details: 'Created new draft for DHA Telehealth proposal', category: 'data', severity: 'info' },
            { id: 7, timestamp: '2025-01-29 12:15:33', user: 'Mary Womack', action: 'APPROVE', resource: 'Go/No-Go Decision', details: 'Approved pursuit of CMS Data Analytics', category: 'workflow', severity: 'info' },
            { id: 8, timestamp: '2025-01-29 11:45:18', user: 'System', action: 'BACKUP', resource: 'Database', details: 'Automated daily backup completed successfully', category: 'system', severity: 'info' },
            { id: 9, timestamp: '2025-01-29 10:22:44', user: 'Daniel Torres', action: 'SHARE', resource: 'Pricing Template', details: 'Shared document with external partner (Teaming Agreement active)', category: 'access', severity: 'warning' },
            { id: 10, timestamp: '2025-01-29 09:15:00', user: 'System', action: 'MAINTENANCE', resource: 'API', details: 'Scheduled maintenance window completed', category: 'system', severity: 'info' },
            { id: 11, timestamp: '2025-01-28 17:45:22', user: 'Sarah Chen', action: 'DELETE', resource: 'Draft Document', details: 'Deleted obsolete compliance checklist v1', category: 'data', severity: 'warning' },
            { id: 12, timestamp: '2025-01-28 16:30:11', user: 'Unknown', action: 'LOGIN_FAILED', resource: 'System', details: 'Failed login attempt from 203.0.113.50', category: 'security', severity: 'error' },
            { id: 13, timestamp: '2025-01-28 15:20:00', user: 'AI Agent', action: 'ANALYZE', resource: 'RFP Shredder', details: 'Extracted 147 requirements from VA EHR RFP', category: 'ai', severity: 'info' },
            { id: 14, timestamp: '2025-01-28 14:00:33', user: 'Mary Womack', action: 'UPDATE_ROLE', resource: 'User Management', details: 'Changed Mike Johnson role to Technical Writer', category: 'admin', severity: 'info' },
            { id: 15, timestamp: '2025-01-28 11:30:45', user: 'System', action: 'CUI_ACCESS', resource: 'Pricing Data', details: 'CUI document accessed - audit trail recorded', category: 'compliance', severity: 'warning' },
        ];

        const CATEGORIES = [
            { id: 'all', label: 'All Events', count: 15 },
            { id: 'auth', label: 'Authentication', count: 1 },
            { id: 'data', label: 'Data Changes', count: 4 },
            { id: 'ai', label: 'AI Actions', count: 2 },
            { id: 'compliance', label: 'Compliance', count: 2 },
            { id: 'security', label: 'Security', count: 1 },
            { id: 'system', label: 'System', count: 2 },
            { id: 'workflow', label: 'Workflow', count: 1 },
            { id: 'access', label: 'Access Control', count: 1 },
            { id: 'admin', label: 'Administration', count: 1 }
        ];

        // Components
        const Header = () => (
            <header className="bg-mp-slate border-b border-mp-border px-6 py-4">
                <div className="max-w-7xl mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <a href="missionpulse-sprint62-dashboard.html" className="text-gray-400 hover:text-white transition-colors">
                            ‚Üê Back to Dashboard
                        </a>
                    </div>
                    <h1 className="text-xl font-bold text-white flex items-center gap-2">
                        üìã Audit Log
                        <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded-full">CMMC Compliant</span>
                    </h1>
                    <button className="text-sm bg-mp-cyan text-mp-navy px-4 py-2 rounded-lg font-medium hover:bg-mp-cyan-dark transition-colors flex items-center gap-2">
                        üì• Export Report
                    </button>
                </div>
            </header>
        );

        const Stats = ({ logs }) => {
            const today = logs.filter(l => l.timestamp.startsWith('2025-01-29')).length;
            const warnings = logs.filter(l => l.severity === 'warning').length;
            const errors = logs.filter(l => l.severity === 'error').length;
            const aiActions = logs.filter(l => l.user === 'AI Agent').length;

            return (
                <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                    <div className="bg-mp-card border border-mp-border rounded-xl p-4 text-center">
                        <p className="text-2xl font-bold text-white">{today}</p>
                        <p className="text-xs text-gray-400">Events Today</p>
                    </div>
                    <div className="bg-mp-card border border-yellow-500/30 rounded-xl p-4 text-center">
                        <p className="text-2xl font-bold text-yellow-400">{warnings}</p>
                        <p className="text-xs text-gray-400">Warnings</p>
                    </div>
                    <div className="bg-mp-card border border-red-500/30 rounded-xl p-4 text-center">
                        <p className="text-2xl font-bold text-red-400">{errors}</p>
                        <p className="text-xs text-gray-400">Errors</p>
                    </div>
                    <div className="bg-mp-card border border-purple-500/30 rounded-xl p-4 text-center">
                        <p className="text-2xl font-bold text-purple-400">{aiActions}</p>
                        <p className="text-xs text-gray-400">AI Actions</p>
                    </div>
                </div>
            );
        };

        const Filters = ({ activeCategory, setActiveCategory, searchQuery, setSearchQuery, severityFilter, setSeverityFilter }) => (
            <div className="bg-mp-card border border-mp-border rounded-xl p-4 mb-6">
                <div className="flex flex-wrap items-center gap-4">
                    <div className="flex-1 min-w-[200px]">
                        <div className="relative">
                            <span className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">üîç</span>
                            <input
                                type="text"
                                value={searchQuery}
                                onChange={(e) => setSearchQuery(e.target.value)}
                                placeholder="Search logs..."
                                className="w-full bg-mp-slate border border-mp-border rounded-lg pl-10 pr-4 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-mp-cyan"
                            />
                        </div>
                    </div>
                    
                    <select
                        value={activeCategory}
                        onChange={(e) => setActiveCategory(e.target.value)}
                        className="bg-mp-slate border border-mp-border rounded-lg px-4 py-2 text-sm text-white focus:outline-none focus:border-mp-cyan"
                    >
                        {CATEGORIES.map(cat => (
                            <option key={cat.id} value={cat.id}>{cat.label} ({cat.count})</option>
                        ))}
                    </select>

                    <select
                        value={severityFilter}
                        onChange={(e) => setSeverityFilter(e.target.value)}
                        className="bg-mp-slate border border-mp-border rounded-lg px-4 py-2 text-sm text-white focus:outline-none focus:border-mp-cyan"
                    >
                        <option value="all">All Severities</option>
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>

                    <div className="flex items-center gap-2">
                        <input type="date" className="bg-mp-slate border border-mp-border rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-mp-cyan" />
                        <span className="text-gray-400">to</span>
                        <input type="date" className="bg-mp-slate border border-mp-border rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-mp-cyan" />
                    </div>
                </div>
            </div>
        );

        const LogEntry = ({ log, expanded, onToggle }) => {
            const severityColors = {
                info: 'border-gray-500 bg-gray-500/10',
                warning: 'border-yellow-500 bg-yellow-500/10',
                error: 'border-red-500 bg-red-500/10'
            };

            const actionIcons = {
                LOGIN: 'üîì',
                LOGIN_FAILED: 'üö´',
                LOGOUT: 'üîí',
                CREATE: '‚ûï',
                UPDATE: '‚úèÔ∏è',
                DELETE: 'üóëÔ∏è',
                EXPORT: 'üì§',
                SHARE: 'üîó',
                APPROVE: '‚úÖ',
                GENERATE: 'ü§ñ',
                ANALYZE: 'üîç',
                ALERT: '‚ö†Ô∏è',
                BACKUP: 'üíæ',
                MAINTENANCE: 'üîß',
                UPDATE_ROLE: 'üë§',
                CUI_ACCESS: 'üîê'
            };

            const categoryBadges = {
                auth: 'bg-blue-500/20 text-blue-400',
                data: 'bg-green-500/20 text-green-400',
                ai: 'bg-purple-500/20 text-purple-400',
                compliance: 'bg-orange-500/20 text-orange-400',
                security: 'bg-red-500/20 text-red-400',
                system: 'bg-gray-500/20 text-gray-400',
                workflow: 'bg-cyan-500/20 text-cyan-400',
                access: 'bg-yellow-500/20 text-yellow-400',
                admin: 'bg-pink-500/20 text-pink-400'
            };

            return (
                <div 
                    className={`border-l-4 ${severityColors[log.severity]} bg-mp-card rounded-r-lg overflow-hidden cursor-pointer transition-all hover:bg-mp-slate`}
                    onClick={() => onToggle(log.id)}
                >
                    <div className="p-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <span className="text-xl">{actionIcons[log.action] || 'üìù'}</span>
                                <div>
                                    <div className="flex items-center gap-2">
                                        <span className="text-sm font-medium text-white">{log.action}</span>
                                        <span className={`text-xs px-2 py-0.5 rounded-full ${categoryBadges[log.category]}`}>
                                            {log.category}
                                        </span>
                                    </div>
                                    <p className="text-xs text-gray-400 mt-1">{log.resource}</p>
                                </div>
                            </div>
                            <div className="text-right">
                                <p className="text-xs text-gray-400">{log.timestamp}</p>
                                <p className="text-xs text-mp-cyan">{log.user}</p>
                            </div>
                        </div>
                        
                        {expanded && (
                            <div className="mt-4 pt-4 border-t border-mp-border">
                                <div className="grid grid-cols-2 gap-4 text-sm">
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Details</p>
                                        <p className="text-gray-300">{log.details}</p>
                                    </div>
                                    <div>
                                        <p className="text-xs text-gray-500 mb-1">Event ID</p>
                                        <code className="text-xs text-mp-cyan bg-mp-slate px-2 py-1 rounded">
                                            EVT-{log.id.toString().padStart(6, '0')}
                                        </code>
                                    </div>
                                </div>
                                <div className="flex items-center gap-2 mt-4">
                                    <button className="text-xs bg-mp-slate hover:bg-mp-cyan/20 text-mp-cyan px-3 py-1 rounded transition-colors">
                                        View Full Context
                                    </button>
                                    <button className="text-xs bg-mp-slate hover:bg-mp-cyan/20 text-gray-400 px-3 py-1 rounded transition-colors">
                                        Copy Event ID
                                    </button>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const ComplianceBanner = () => (
            <div className="bg-gradient-to-r from-green-500/10 to-transparent border border-green-500/30 rounded-xl p-4 mb-6">
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <span className="text-2xl">üõ°Ô∏è</span>
                        <div>
                            <p className="text-sm font-medium text-white">CMMC Level 2 Audit Logging Active</p>
                            <p className="text-xs text-gray-400">All CUI access and system events are being recorded per NIST 800-171</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="text-right">
                            <p className="text-xs text-gray-400">Retention Period</p>
                            <p className="text-sm text-white">3 Years</p>
                        </div>
                        <div className="text-right">
                            <p className="text-xs text-gray-400">Last Audit</p>
                            <p className="text-sm text-green-400">Jan 15, 2025 ‚úì</p>
                        </div>
                    </div>
                </div>
            </div>
        );

        // Main App
        const App = () => {
            const [activeCategory, setActiveCategory] = useState('all');
            const [searchQuery, setSearchQuery] = useState('');
            const [severityFilter, setSeverityFilter] = useState('all');
            const [expandedLog, setExpandedLog] = useState(null);

            const filteredLogs = AUDIT_LOGS.filter(log => {
                const matchesCategory = activeCategory === 'all' || log.category === activeCategory;
                const matchesSeverity = severityFilter === 'all' || log.severity === severityFilter;
                const matchesSearch = !searchQuery || 
                    log.action.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    log.user.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    log.resource.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    log.details.toLowerCase().includes(searchQuery.toLowerCase());
                return matchesCategory && matchesSeverity && matchesSearch;
            });

            return (
                <div className="min-h-screen bg-mp-navy">
                    <Header />
                    
                    <main className="max-w-7xl mx-auto px-6 py-6">
                        <ComplianceBanner />
                        <Stats logs={AUDIT_LOGS} />
                        <Filters 
                            activeCategory={activeCategory}
                            setActiveCategory={setActiveCategory}
                            searchQuery={searchQuery}
                            setSearchQuery={setSearchQuery}
                            severityFilter={severityFilter}
                            setSeverityFilter={setSeverityFilter}
                        />

                        <div className="space-y-2">
                            <div className="flex items-center justify-between mb-4">
                                <p className="text-sm text-gray-400">
                                    Showing {filteredLogs.length} of {AUDIT_LOGS.length} events
                                </p>
                                <div className="flex items-center gap-2">
                                    <button className="text-xs text-gray-400 hover:text-white">Oldest First</button>
                                    <span className="text-gray-600">|</span>
                                    <button className="text-xs text-mp-cyan">Newest First</button>
                                </div>
                            </div>

                            {filteredLogs.map(log => (
                                <LogEntry 
                                    key={log.id} 
                                    log={log} 
                                    expanded={expandedLog === log.id}
                                    onToggle={(id) => setExpandedLog(expandedLog === id ? null : id)}
                                />
                            ))}

                            {filteredLogs.length === 0 && (
                                <div className="text-center py-12">
                                    <p className="text-4xl mb-2">üìã</p>
                                    <p className="text-gray-400">No audit logs match your filters</p>
                                </div>
                            )}
                        </div>

                        <div className="flex items-center justify-center gap-2 mt-6">
                            <button className="px-4 py-2 bg-mp-slate text-gray-400 rounded-lg hover:text-white transition-colors">
                                ‚Üê Previous
                            </button>
                            <span className="px-4 py-2 text-sm text-gray-400">Page 1 of 1</span>
                            <button className="px-4 py-2 bg-mp-slate text-gray-400 rounded-lg hover:text-white transition-colors">
                                Next ‚Üí
                            </button>
                        </div>
                    </main>

                    <footer className="border-t border-mp-border py-4 mt-8">
                        <div className="max-w-7xl mx-auto px-6 flex items-center justify-between text-xs text-gray-500">
                            <p>AI GENERATED - REQUIRES HUMAN REVIEW</p>
                            <p>MissionPulse v12 ‚Ä¢ Sprint 66 ‚Ä¢ NIST 800-171 Compliant</p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
