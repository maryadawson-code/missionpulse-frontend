<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Staffing Plan</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const DEMO_LCATS=[
      {id:1,lcat:'Program Manager',abbr:'PM',fte:1.0,clearance:'Secret',education:"Master's",yrsExp:15,certReq:'PMP',pwsRef:'C.2.1',key:true,category:'Management',ramp:[0.5,1.0,1.0,1.0,1.0,1.0],proposed:'Mary Womack',partner:'MMT'},
      {id:2,lcat:'Deputy Program Manager',abbr:'DPM',fte:1.0,clearance:'Secret',education:"Bachelor's",yrsExp:10,certReq:'PMP or CSM',pwsRef:'C.2.2',key:true,category:'Management',ramp:[0.5,1.0,1.0,1.0,1.0,1.0],proposed:'Tom Patterson',partner:'MMT'},
      {id:3,lcat:'Solutions Architect',abbr:'SA',fte:1.0,clearance:'TS',education:"Master's",yrsExp:12,certReq:'AWS SA Pro or Azure SA',pwsRef:'C.3.1',key:true,category:'Technical',ramp:[0.25,0.75,1.0,1.0,1.0,1.0],proposed:'Sarah Kim',partner:'MMT'},
      {id:4,lcat:'Senior Software Developer',abbr:'Sr-Dev',fte:1.0,clearance:'Secret',education:"Bachelor's",yrsExp:8,certReq:null,pwsRef:'C.3.2',key:false,category:'Technical',ramp:[0,0.5,1.0,1.0,1.0,1.0],proposed:'David Chen',partner:'TPA'},
      {id:5,lcat:'DevSecOps Engineer',abbr:'DSO',fte:1.0,clearance:'Secret',education:"Bachelor's",yrsExp:5,certReq:'CKA or Terraform',pwsRef:'C.3.3',key:false,category:'Technical',ramp:[0,0.5,1.0,1.0,1.0,1.0],proposed:'Lisa Wang',partner:'MMT'},
      {id:6,lcat:'Data Engineer',abbr:'DE',fte:1.0,clearance:'Secret',education:"Bachelor's",yrsExp:5,certReq:null,pwsRef:'C.3.4',key:false,category:'Technical',ramp:[0,0.25,0.75,1.0,1.0,1.0],proposed:'Michelle Torres',partner:'DBL'},
      {id:7,lcat:'AI/ML Engineer',abbr:'AI',fte:1.0,clearance:'Secret',education:"Master's",yrsExp:7,certReq:'AWS ML or GCP ML',pwsRef:'C.3.5',key:true,category:'Technical',ramp:[0,0.5,1.0,1.0,1.0,1.0],proposed:'James Rodriguez',partner:'MMT'},
      {id:8,lcat:'Cybersecurity Analyst',abbr:'Cyber',fte:1.0,clearance:'TS',education:"Bachelor's",yrsExp:8,certReq:'CISSP',pwsRef:'C.4.1',key:true,category:'Security',ramp:[0.5,1.0,1.0,1.0,1.0,1.0],proposed:'Angela Foster',partner:'MMT'},
      {id:9,lcat:'ISSO',abbr:'ISSO',fte:0.5,clearance:'TS',education:"Bachelor's",yrsExp:10,certReq:'CISSP or CAP',pwsRef:'C.4.2',key:false,category:'Security',ramp:[0.25,0.5,0.5,0.5,0.5,0.5],proposed:'Robert Jackson',partner:'SFI'},
      {id:10,lcat:'Help Desk Lead',abbr:'HD-L',fte:1.0,clearance:'PT',education:'Associate',yrsExp:5,certReq:'ITIL v4',pwsRef:'C.5.1',key:false,category:'Support',ramp:[0,0.5,1.0,1.0,1.0,1.0],proposed:'Kevin Brown',partner:'MMT'},
      {id:11,lcat:'Help Desk Specialist',abbr:'HD-T1',fte:2.0,clearance:'PT',education:'Associate',yrsExp:2,certReq:null,pwsRef:'C.5.2',key:false,category:'Support',ramp:[0,1.0,2.0,2.0,2.0,2.0],proposed:'TBD (2 positions)',partner:'MMT'},
      {id:12,lcat:'QA Analyst',abbr:'QA',fte:1.0,clearance:'Secret',education:"Bachelor's",yrsExp:7,certReq:'ISTQB',pwsRef:'C.6.1',key:false,category:'Quality',ramp:[0,0.5,1.0,1.0,1.0,1.0],proposed:'Patricia Nguyen',partner:'MMT'},
      {id:13,lcat:'Technical Writer',abbr:'TW',fte:0.5,clearance:'PT',education:"Bachelor's",yrsExp:5,certReq:null,pwsRef:'C.6.2',key:false,category:'Quality',ramp:[0,0.25,0.5,0.5,0.5,0.5],proposed:'Mark Stevens',partner:'MMT'},
      {id:14,lcat:'Training Specialist',abbr:'TS',fte:0.5,clearance:'PT',education:"Bachelor's",yrsExp:3,certReq:null,pwsRef:'C.6.3',key:false,category:'Quality',ramp:[0,0,0.25,0.5,0.5,0.5],proposed:'TBD',partner:'MMT'},
    ];

    const MONTHS=['M1','M2','M3','M4','M5','M6'];
    const CAT_COLORS={Management:'#a78bfa',Technical:'#00E5FA',Security:'#ef4444',Support:'#f59e0b',Quality:'#00ff88'};
    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[lcats]=useState(DEMO_LCATS);
      const[tab,setTab]=useState('matrix');
      const[catFilter,setCatFilter]=useState('All');

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('team_assignments').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const filtered=useMemo(()=>catFilter==='All'?lcats:lcats.filter(l=>l.category===catFilter),[lcats,catFilter]);
      const totalFTE=lcats.reduce((s,l)=>s+l.fte,0);
      const keyCount=lcats.filter(l=>l.key).length;
      const categories=[...new Set(lcats.map(l=>l.category))];
      const partnerBreakdown=useMemo(()=>{
        const map={};lcats.forEach(l=>{if(!map[l.partner])map[l.partner]=0;map[l.partner]+=l.fte});return Object.entries(map).sort((a,b)=>b[1]-a[1]);
      },[lcats]);
      const rampByMonth=MONTHS.map((_,mi)=>lcats.reduce((s,l)=>s+(l.ramp[mi]||0),0));

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>WORKFORCE PLANNING</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Staffing Plan</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>DHA EHR Modernization • LCAT mix • Ramp schedule • FTE calculator</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total FTEs',value:totalFTE.toFixed(1),color:'#00E5FA'},
              {label:'LCATs',value:lcats.length,color:'#a78bfa'},
              {label:'Key Personnel',value:keyCount,color:'#f59e0b'},
              {label:'Partners',value:partnerBreakdown.length,color:'#00E5FA'},
              {label:'Steady State (M6)',value:rampByMonth[5].toFixed(1)+' FTE',color:'#00ff88'},
              {label:'Ramp Month',value:'M3',color:'#00ff88'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'120px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Ramp Chart */}
          <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'14px 18px',marginBottom:'20px'}}>
            <div style={{fontSize:'11px',fontWeight:700,color:'white',marginBottom:'10px'}}>FTE Ramp Schedule (Transition → Steady State)</div>
            <div style={{display:'flex',gap:'6px',alignItems:'flex-end',height:'100px'}}>
              {rampByMonth.map((v,i)=>{
                const maxV=Math.max(...rampByMonth);
                const pct=(v/maxV)*100;
                return(
                  <div key={i} style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'flex-end',height:'100%'}}>
                    <div style={{fontSize:'10px',fontWeight:700,color:'#00E5FA',marginBottom:'4px'}}>{v.toFixed(1)}</div>
                    <div style={{width:'100%',maxWidth:'50px',height:`${pct}%`,background:i<2?'linear-gradient(180deg,#f59e0b,#b45309)':'linear-gradient(180deg,#00E5FA,#0088cc)',borderRadius:'4px 4px 0 0',transition:'height 0.3s'}}/>
                    <div style={{fontSize:'10px',color:'#5a7a9a',marginTop:'4px'}}>{MONTHS[i]}</div>
                  </div>
                );
              })}
            </div>
            <div style={{display:'flex',gap:'12px',marginTop:'8px',fontSize:'10px'}}>
              <span style={{color:'#f59e0b'}}>■ Transition</span><span style={{color:'#00E5FA'}}>■ Steady State</span>
            </div>
          </div>

          {/* Tabs + Filter */}
          <div style={{display:'flex',gap:'4px',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'matrix',l:'LCAT Matrix'},{k:'ramp',l:'Ramp Detail'},{k:'partner',l:'Partner Mix'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{marginLeft:'auto',display:'flex',gap:'3px'}}>
              {['All',...categories].map(c=>(
                <button key={c} onClick={()=>setCatFilter(c)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',background:catFilter===c?`${CAT_COLORS[c]||'rgba(0,229,250,0.15)'}20`:'rgba(10,22,40,0.5)',color:catFilter===c?(CAT_COLORS[c]||'#00E5FA'):'#5a7a9a'}}>{c}</button>
              ))}
            </div>
          </div>

          {/* LCAT MATRIX */}
          {tab==='matrix'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'auto'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px',minWidth:'1000px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  {['LCAT','FTE','Category','Clearance','Education','Exp','Cert','PWS','Key','Proposed','Partner'].map(h=>(
                    <th key={h} style={{padding:'10px 8px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'9px',letterSpacing:'0.5px',textTransform:'uppercase',whiteSpace:'nowrap'}}>{h}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {filtered.map(l=>(
                    <tr key={l.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}} onMouseOver={e=>e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
                      <td style={{padding:'8px',color:'white',fontWeight:600,whiteSpace:'nowrap'}}>
                        {l.lcat}{l.key&&<span style={{marginLeft:'4px',fontSize:'8px',color:'#f59e0b'}}>⭐</span>}
                      </td>
                      <td style={{padding:'8px',fontWeight:700,color:'#00E5FA',textAlign:'center'}}>{l.fte}</td>
                      <td style={{padding:'8px'}}><span style={{fontSize:'9px',padding:'1px 5px',borderRadius:'3px',background:`${CAT_COLORS[l.category]}12`,color:CAT_COLORS[l.category]}}>{l.category}</span></td>
                      <td style={{padding:'8px',fontSize:'10px',color:l.clearance==='TS'?'#ef4444':l.clearance==='Secret'?'#00E5FA':'#94a3b8',fontWeight:600}}>{l.clearance}</td>
                      <td style={{padding:'8px',fontSize:'10px',color:'#94a3b8'}}>{l.education}</td>
                      <td style={{padding:'8px',fontSize:'10px',color:'#94a3b8',textAlign:'center'}}>{l.yrsExp}+</td>
                      <td style={{padding:'8px',fontSize:'9px',color:l.certReq?'#a78bfa':'#3e4f63'}}>{l.certReq||'—'}</td>
                      <td style={{padding:'8px',fontFamily:'monospace',fontSize:'10px',color:'#00E5FA'}}>{l.pwsRef}</td>
                      <td style={{padding:'8px',textAlign:'center'}}>{l.key?'⭐':''}</td>
                      <td style={{padding:'8px',fontSize:'11px',color:'white',fontWeight:500}}>{l.proposed}</td>
                      <td style={{padding:'8px',fontSize:'10px',color:'#5a7a9a'}}>{l.partner}</td>
                    </tr>
                  ))}
                </tbody>
                <tfoot><tr style={{borderTop:'2px solid rgba(0,229,250,0.1)'}}>
                  <td style={{padding:'10px 8px',fontWeight:700,color:'white'}}>TOTAL</td>
                  <td style={{padding:'10px 8px',fontWeight:800,color:'#00E5FA',textAlign:'center'}}>{filtered.reduce((s,l)=>s+l.fte,0).toFixed(1)}</td>
                  <td colSpan={9}></td>
                </tr></tfoot>
              </table>
            </div>
          )}

          {/* RAMP DETAIL */}
          {tab==='ramp'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'auto'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  <th style={{padding:'10px 10px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>LCAT</th>
                  <th style={{padding:'10px 8px',textAlign:'center',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>SS FTE</th>
                  {MONTHS.map(m=><th key={m} style={{padding:'10px 8px',textAlign:'center',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>{m}</th>)}
                </tr></thead>
                <tbody>
                  {filtered.map(l=>(
                    <tr key={l.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}}>
                      <td style={{padding:'8px 10px',color:'white',fontWeight:500}}>{l.abbr} — {l.lcat}</td>
                      <td style={{padding:'8px',textAlign:'center',fontWeight:700,color:'#00E5FA'}}>{l.fte}</td>
                      {l.ramp.map((r,i)=>(
                        <td key={i} style={{padding:'4px 8px',textAlign:'center'}}>
                          <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:'4px'}}>
                            <div style={{width:'28px',height:'12px',borderRadius:'3px',background:r===0?'rgba(255,255,255,0.03)':r>=l.fte?'rgba(0,229,250,0.2)':'rgba(245,158,11,0.2)',display:'flex',alignItems:'center',justifyContent:'center'}}>
                              <span style={{fontSize:'9px',fontWeight:700,color:r===0?'#3e4f63':r>=l.fte?'#00E5FA':'#f59e0b'}}>{r}</span>
                            </div>
                          </div>
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
                <tfoot><tr style={{borderTop:'2px solid rgba(0,229,250,0.1)'}}>
                  <td style={{padding:'10px',fontWeight:700,color:'white'}}>TOTAL FTE</td>
                  <td style={{padding:'10px 8px',textAlign:'center',fontWeight:800,color:'#00E5FA'}}>{totalFTE.toFixed(1)}</td>
                  {rampByMonth.map((v,i)=><td key={i} style={{padding:'10px 8px',textAlign:'center',fontWeight:800,color:v>=totalFTE?'#00ff88':'#f59e0b'}}>{v.toFixed(1)}</td>)}
                </tr></tfoot>
              </table>
            </div>
          )}

          {/* PARTNER MIX */}
          {tab==='partner'&&(
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(260px,1fr))',gap:'10px'}}>
              {partnerBreakdown.map(([name,fte])=>{
                const pLcats=lcats.filter(l=>l.partner===name);
                const pColors={MMT:'#00E5FA',TPA:'#a78bfa',SFI:'#f59e0b',DBL:'#00ff88'};
                return(
                  <div key={name} style={{background:'rgba(10,22,40,0.5)',border:`1px solid ${(pColors[name]||'#5a7a9a')}20`,borderRadius:'12px',padding:'16px'}}>
                    <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'10px'}}>
                      <div style={{width:'10px',height:'10px',borderRadius:'3px',background:pColors[name]||'#5a7a9a'}}/>
                      <span style={{fontSize:'14px',fontWeight:700,color:'white'}}>{name}</span>
                      <span style={{fontSize:'10px',fontWeight:600,color:pColors[name]||'#5a7a9a'}}>{fte.toFixed(1)} FTE</span>
                      <span style={{fontSize:'10px',color:'#5a7a9a',marginLeft:'auto'}}>{((fte/totalFTE)*100).toFixed(0)}%</span>
                    </div>
                    <div style={{display:'flex',flexDirection:'column',gap:'4px'}}>
                      {pLcats.map(l=>(
                        <div key={l.id} style={{display:'flex',justifyContent:'space-between',fontSize:'11px'}}>
                          <span style={{color:'#94a3b8'}}>{l.lcat}{l.key?<span style={{marginLeft:'4px',fontSize:'8px',color:'#f59e0b'}}>⭐</span>:''}</span>
                          <span style={{fontWeight:600,color:'#e2e8f0'}}>{l.fte} FTE</span>
                        </div>
                      ))}
                    </div>
                  </div>
                );
              })}
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
