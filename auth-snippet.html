<!-- 
  MissionPulse Auth Integration
  Add these lines to any HTML page to enable authentication:
  
  1. Add BEFORE other scripts in <head>:
-->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<!-- 
  2. Add AFTER the body tag opens (before your main content):
-->
<div id="mp-auth-loading" style="position:fixed;inset:0;background:#00050F;display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="text-align:center;">
    <div style="width:48px;height:48px;margin:0 auto 16px;border:3px solid rgba(0,229,250,0.2);border-top-color:#00E5FA;border-radius:50%;animation:spin 1s linear infinite;"></div>
    <p style="color:#64748b;font-family:Inter,sans-serif;">Loading MissionPulse...</p>
  </div>
  <style>@keyframes spin{to{transform:rotate(360deg)}}</style>
</div>

<script>
// MissionPulse Auth Check
(async function() {
  const SUPABASE_URL = 'https://djuviwarqdvlbgcfuupa.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk0NDQ0NjUsImV4cCI6MjA4NTAyMDQ2NX0.3s8ufDDN2aWfkW0RBsAyJyacb2tjB7M550WSFIohHcA';
  
  const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  const { data: { session } } = await supabase.auth.getSession();
  
  if (!session) {
    window.location.href = 'login.html';
    return;
  }
  
  // Get user profile
  const { data: profile } = await supabase
    .from('users')
    .select('*, companies(*)')
    .eq('id', session.user.id)
    .single();
  
  // Store globally
  window.mpUser = profile || { email: session.user.email };
  window.mpCompany = profile?.companies;
  window.mpSupabase = supabase;
  
  // Hide loading screen
  document.getElementById('mp-auth-loading').style.display = 'none';
  
  // Dispatch ready event
  document.dispatchEvent(new CustomEvent('mp:ready', { detail: { user: window.mpUser, company: window.mpCompany } }));
})();
</script>
