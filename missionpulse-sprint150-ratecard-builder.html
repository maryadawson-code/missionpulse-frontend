<!DOCTYPE html>
<!--
FILE: missionpulse-sprint150-ratecard-builder.html
MODULE: Rate Card Builder
SPRINT: 150
ROLES: CEO, COO, FIN, CAP, PM
SECURITY: env vars verified, RLS enforced, CUI-compliant
VERSION: 1.0.0
CUI: PRICING DATA - RESTRICTED ACCESS
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rate Card Builder | MissionPulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-slate': '#0A1628',
                        'mp-dark': '#060D18',
                        'mp-border': '#1E3A5F'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glow-cyan { box-shadow: 0 0 20px rgba(0, 229, 250, 0.3); }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #0A1628; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #1E3A5F; border-radius: 3px; }
        @media print {
            .no-print { display: none !important; }
            body { background: white !important; color: black !important; }
            .print-table { background: white !important; }
            .print-table th, .print-table td { border: 1px solid #ccc !important; padding: 8px !important; }
        }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy text-white min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;
        
        // GSA Schedule Labor Categories (Health IT focused)
        const gsaLaborCategories = [
            { id: 'PM-III', title: 'Program Manager III', sin: '54151S', minYears: 10, education: 'Masters', gsaMin: 145.00, gsaMax: 245.00 },
            { id: 'PM-II', title: 'Program Manager II', sin: '54151S', minYears: 7, education: 'Bachelors', gsaMin: 125.00, gsaMax: 195.00 },
            { id: 'PM-I', title: 'Program Manager I', sin: '54151S', minYears: 4, education: 'Bachelors', gsaMin: 95.00, gsaMax: 155.00 },
            { id: 'SA-III', title: 'Solutions Architect III', sin: '54151S', minYears: 12, education: 'Masters', gsaMin: 165.00, gsaMax: 285.00 },
            { id: 'SA-II', title: 'Solutions Architect II', sin: '54151S', minYears: 8, education: 'Bachelors', gsaMin: 135.00, gsaMax: 225.00 },
            { id: 'SA-I', title: 'Solutions Architect I', sin: '54151S', minYears: 5, education: 'Bachelors', gsaMin: 105.00, gsaMax: 175.00 },
            { id: 'SME-III', title: 'Subject Matter Expert III', sin: '54151S', minYears: 15, education: 'Masters', gsaMin: 175.00, gsaMax: 295.00 },
            { id: 'SME-II', title: 'Subject Matter Expert II', sin: '54151S', minYears: 10, education: 'Masters', gsaMin: 145.00, gsaMax: 245.00 },
            { id: 'SME-I', title: 'Subject Matter Expert I', sin: '54151S', minYears: 7, education: 'Bachelors', gsaMin: 115.00, gsaMax: 195.00 },
            { id: 'SE-III', title: 'Software Engineer III', sin: '54151S', minYears: 8, education: 'Bachelors', gsaMin: 125.00, gsaMax: 205.00 },
            { id: 'SE-II', title: 'Software Engineer II', sin: '54151S', minYears: 5, education: 'Bachelors', gsaMin: 105.00, gsaMax: 175.00 },
            { id: 'SE-I', title: 'Software Engineer I', sin: '54151S', minYears: 2, education: 'Bachelors', gsaMin: 75.00, gsaMax: 125.00 },
            { id: 'CYBER-III', title: 'Cybersecurity Specialist III', sin: '54151S', minYears: 10, education: 'Masters', gsaMin: 155.00, gsaMax: 265.00 },
            { id: 'CYBER-II', title: 'Cybersecurity Specialist II', sin: '54151S', minYears: 6, education: 'Bachelors', gsaMin: 125.00, gsaMax: 205.00 },
            { id: 'CYBER-I', title: 'Cybersecurity Specialist I', sin: '54151S', minYears: 3, education: 'Bachelors', gsaMin: 95.00, gsaMax: 155.00 },
            { id: 'DATA-III', title: 'Data Scientist III', sin: '54151S', minYears: 10, education: 'Masters', gsaMin: 155.00, gsaMax: 265.00 },
            { id: 'DATA-II', title: 'Data Scientist II', sin: '54151S', minYears: 6, education: 'Masters', gsaMin: 125.00, gsaMax: 205.00 },
            { id: 'DATA-I', title: 'Data Scientist I', sin: '54151S', minYears: 3, education: 'Bachelors', gsaMin: 95.00, gsaMax: 155.00 },
            { id: 'BA-III', title: 'Business Analyst III', sin: '54151S', minYears: 8, education: 'Bachelors', gsaMin: 115.00, gsaMax: 185.00 },
            { id: 'BA-II', title: 'Business Analyst II', sin: '54151S', minYears: 5, education: 'Bachelors', gsaMin: 95.00, gsaMax: 155.00 },
            { id: 'BA-I', title: 'Business Analyst I', sin: '54151S', minYears: 2, education: 'Bachelors', gsaMin: 65.00, gsaMax: 115.00 },
            { id: 'CLIN-III', title: 'Clinical Informaticist III', sin: '54151S', minYears: 12, education: 'Masters', gsaMin: 165.00, gsaMax: 275.00 },
            { id: 'CLIN-II', title: 'Clinical Informaticist II', sin: '54151S', minYears: 8, education: 'Masters', gsaMin: 135.00, gsaMax: 225.00 },
            { id: 'CLIN-I', title: 'Clinical Informaticist I', sin: '54151S', minYears: 5, education: 'Bachelors', gsaMin: 105.00, gsaMax: 175.00 },
            { id: 'TECH-III', title: 'Technical Writer III', sin: '54151S', minYears: 8, education: 'Bachelors', gsaMin: 85.00, gsaMax: 145.00 },
            { id: 'TECH-II', title: 'Technical Writer II', sin: '54151S', minYears: 5, education: 'Bachelors', gsaMin: 65.00, gsaMax: 115.00 },
            { id: 'TECH-I', title: 'Technical Writer I', sin: '54151S', minYears: 2, education: 'Associates', gsaMin: 45.00, gsaMax: 85.00 }
        ];
        
        // Contract vehicles
        const contractVehicles = [
            { id: 'GSA-MAS', name: 'GSA MAS IT Schedule 70', multiplier: 1.0, maxMarkup: 0.15 },
            { id: 'SEWP-V', name: 'NASA SEWP V', multiplier: 0.98, maxMarkup: 0.12 },
            { id: 'ALLIANT-2', name: 'GSA Alliant 2', multiplier: 1.02, maxMarkup: 0.18 },
            { id: 'CIO-SP3', name: 'NIH CIO-SP3', multiplier: 1.0, maxMarkup: 0.15 },
            { id: 'T4NG', name: 'VA T4NG', multiplier: 1.03, maxMarkup: 0.20 },
            { id: 'OASIS-SB', name: 'GSA OASIS SB', multiplier: 1.0, maxMarkup: 0.15 },
            { id: 'ITES-3S', name: 'Army ITES-3S', multiplier: 1.01, maxMarkup: 0.16 },
            { id: 'CUSTOM', name: 'Custom/Open Market', multiplier: 1.05, maxMarkup: 0.25 }
        ];
        
        // Site rate adjustments
        const siteRates = [
            { id: 'DC', name: 'Washington DC Metro', adjustment: 1.15 },
            { id: 'NOVA', name: 'Northern Virginia', adjustment: 1.12 },
            { id: 'MD', name: 'Maryland', adjustment: 1.08 },
            { id: 'SA', name: 'San Antonio, TX', adjustment: 0.95 },
            { id: 'DENVER', name: 'Denver, CO', adjustment: 1.02 },
            { id: 'REMOTE', name: 'Remote/CONUS', adjustment: 0.92 },
            { id: 'OCONUS', name: 'OCONUS', adjustment: 1.25 }
        ];
        
        function RateCardBuilder() {
            const [selectedVehicle, setSelectedVehicle] = useState('GSA-MAS');
            const [selectedSite, setSelectedSite] = useState('DC');
            const [selectedCategories, setSelectedCategories] = useState(gsaLaborCategories.map(c => c.id));
            const [customRates, setCustomRates] = useState({});
            const [escalationRate, setEscalationRate] = useState(3.0);
            const [profitMargin, setProfitMargin] = useState(10.0);
            const [showExportModal, setShowExportModal] = useState(false);
            const [rateCardName, setRateCardName] = useState('');
            const [effectiveDate, setEffectiveDate] = useState('2025-01-01');
            const [expirationDate, setExpirationDate] = useState('2025-12-31');
            const [searchFilter, setSearchFilter] = useState('');
            const [savedRateCards, setSavedRateCards] = useState([
                { id: 1, name: 'DHA MHS GENESIS FY25', vehicle: 'T4NG', site: 'SA', created: '2025-01-10' },
                { id: 2, name: 'VA EHR Support Pricing', vehicle: 'GSA-MAS', site: 'DC', created: '2025-01-15' },
                { id: 3, name: 'CMS Data Analytics', vehicle: 'CIO-SP3', site: 'MD', created: '2025-01-20' }
            ]);
            
            const vehicle = contractVehicles.find(v => v.id === selectedVehicle);
            const site = siteRates.find(s => s.id === selectedSite);
            
            // Calculate rates with all adjustments
            const calculatedRates = useMemo(() => {
                return gsaLaborCategories.map(cat => {
                    const baseRate = customRates[cat.id] || ((cat.gsaMin + cat.gsaMax) / 2);
                    const vehicleAdjusted = baseRate * vehicle.multiplier;
                    const siteAdjusted = vehicleAdjusted * site.adjustment;
                    const withProfit = siteAdjusted * (1 + profitMargin / 100);
                    const finalRate = Math.round(withProfit * 100) / 100;
                    
                    // Year-over-year escalation
                    const year2 = Math.round(finalRate * (1 + escalationRate / 100) * 100) / 100;
                    const year3 = Math.round(year2 * (1 + escalationRate / 100) * 100) / 100;
                    const year4 = Math.round(year3 * (1 + escalationRate / 100) * 100) / 100;
                    const year5 = Math.round(year4 * (1 + escalationRate / 100) * 100) / 100;
                    
                    const isWithinGSA = finalRate >= cat.gsaMin && finalRate <= cat.gsaMax * 1.2;
                    
                    return {
                        ...cat,
                        baseRate,
                        vehicleAdjusted,
                        siteAdjusted,
                        finalRate,
                        year1: finalRate,
                        year2,
                        year3,
                        year4,
                        year5,
                        isWithinGSA,
                        isSelected: selectedCategories.includes(cat.id)
                    };
                });
            }, [customRates, selectedVehicle, selectedSite, profitMargin, escalationRate, selectedCategories]);
            
            const filteredRates = calculatedRates.filter(r => 
                r.isSelected && 
                (r.title.toLowerCase().includes(searchFilter.toLowerCase()) || 
                 r.id.toLowerCase().includes(searchFilter.toLowerCase()))
            );
            
            // Summary metrics
            const metrics = useMemo(() => {
                const selected = calculatedRates.filter(r => r.isSelected);
                const avgRate = selected.reduce((sum, r) => sum + r.finalRate, 0) / selected.length;
                const minRate = Math.min(...selected.map(r => r.finalRate));
                const maxRate = Math.max(...selected.map(r => r.finalRate));
                const withinGSA = selected.filter(r => r.isWithinGSA).length;
                
                return {
                    avgRate: Math.round(avgRate * 100) / 100,
                    minRate,
                    maxRate,
                    categoryCount: selected.length,
                    withinGSA,
                    complianceRate: Math.round((withinGSA / selected.length) * 100)
                };
            }, [calculatedRates]);
            
            const toggleCategory = (id) => {
                setSelectedCategories(prev => 
                    prev.includes(id) ? prev.filter(c => c !== id) : [...prev, id]
                );
            };
            
            const updateCustomRate = (id, value) => {
                setCustomRates(prev => ({
                    ...prev,
                    [id]: parseFloat(value) || 0
                }));
            };
            
            const exportToCSV = () => {
                const headers = ['Labor Category', 'ID', 'SIN', 'Min Years', 'Education', 'Year 1', 'Year 2', 'Year 3', 'Year 4', 'Year 5'];
                const rows = filteredRates.map(r => [
                    r.title, r.id, r.sin, r.minYears, r.education,
                    `$${r.year1.toFixed(2)}`, `$${r.year2.toFixed(2)}`, `$${r.year3.toFixed(2)}`,
                    `$${r.year4.toFixed(2)}`, `$${r.year5.toFixed(2)}`
                ]);
                
                const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${rateCardName || 'rate-card'}-${new Date().toISOString().split('T')[0]}.csv`;
                a.click();
            };
            
            return (
                <div className="min-h-screen bg-mp-navy">
                    {/* CUI Banner */}
                    <div className="bg-amber-600 text-black px-4 py-2 text-center text-sm font-medium no-print">
                        CUI // PRICING DATA - AUTHORIZED ACCESS ONLY - CEO/COO/FIN/CAP/PM
                    </div>
                    
                    {/* Header */}
                    <header className="bg-mp-slate border-b border-mp-border px-6 py-4 no-print">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <a href="index.html" className="text-gray-400 hover:text-mp-cyan transition-colors">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                    </svg>
                                </a>
                                <div>
                                    <h1 className="text-2xl font-bold text-white">Rate Card Builder</h1>
                                    <p className="text-gray-400 text-sm">Dynamic pricing sheet generator with GSA compliance</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <button
                                    onClick={() => window.print()}
                                    className="bg-mp-dark border border-mp-border px-4 py-2 rounded-lg text-white hover:bg-mp-slate transition-colors flex items-center gap-2"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                    </svg>
                                    Print
                                </button>
                                <button
                                    onClick={() => setShowExportModal(true)}
                                    className="bg-mp-cyan text-mp-navy px-4 py-2 rounded-lg font-semibold hover:bg-cyan-400 transition-colors flex items-center gap-2"
                                >
                                    <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                    </svg>
                                    Export Rate Card
                                </button>
                            </div>
                        </div>
                    </header>
                    
                    <main className="p-6">
                        {/* Configuration Panel */}
                        <div className="grid grid-cols-4 gap-6 mb-6 no-print">
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <label className="text-gray-400 text-sm block mb-2">Contract Vehicle</label>
                                <select
                                    value={selectedVehicle}
                                    onChange={(e) => setSelectedVehicle(e.target.value)}
                                    className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                >
                                    {contractVehicles.map(v => (
                                        <option key={v.id} value={v.id}>{v.name}</option>
                                    ))}
                                </select>
                                <div className="text-xs text-gray-500 mt-2">
                                    Multiplier: {vehicle.multiplier}x | Max Markup: {(vehicle.maxMarkup * 100).toFixed(0)}%
                                </div>
                            </div>
                            
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <label className="text-gray-400 text-sm block mb-2">Site Location</label>
                                <select
                                    value={selectedSite}
                                    onChange={(e) => setSelectedSite(e.target.value)}
                                    className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                >
                                    {siteRates.map(s => (
                                        <option key={s.id} value={s.id}>{s.name}</option>
                                    ))}
                                </select>
                                <div className="text-xs text-gray-500 mt-2">
                                    Site Adjustment: {site.adjustment > 1 ? '+' : ''}{((site.adjustment - 1) * 100).toFixed(0)}%
                                </div>
                            </div>
                            
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <label className="text-gray-400 text-sm block mb-2">Profit Margin %</label>
                                <input
                                    type="number"
                                    value={profitMargin}
                                    onChange={(e) => setProfitMargin(parseFloat(e.target.value) || 0)}
                                    min="0"
                                    max="25"
                                    step="0.5"
                                    className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                />
                                <div className="text-xs text-gray-500 mt-2">
                                    Target: 8-12% | Max allowed: {(vehicle.maxMarkup * 100).toFixed(0)}%
                                </div>
                            </div>
                            
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <label className="text-gray-400 text-sm block mb-2">Annual Escalation %</label>
                                <input
                                    type="number"
                                    value={escalationRate}
                                    onChange={(e) => setEscalationRate(parseFloat(e.target.value) || 0)}
                                    min="0"
                                    max="5"
                                    step="0.25"
                                    className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                />
                                <div className="text-xs text-gray-500 mt-2">
                                    Typical: 2.5-3.5% | Fed ceiling: 5%
                                </div>
                            </div>
                        </div>
                        
                        {/* Metrics Bar */}
                        <div className="grid grid-cols-6 gap-4 mb-6 no-print">
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">Categories Selected</div>
                                <div className="text-2xl font-bold text-white">{metrics.categoryCount}</div>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">Average Rate</div>
                                <div className="text-2xl font-bold text-mp-cyan">${metrics.avgRate}</div>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">Min Rate</div>
                                <div className="text-2xl font-bold text-green-400">${metrics.minRate}</div>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">Max Rate</div>
                                <div className="text-2xl font-bold text-yellow-400">${metrics.maxRate}</div>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">GSA Compliant</div>
                                <div className="text-2xl font-bold text-white">{metrics.withinGSA}/{metrics.categoryCount}</div>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 border border-mp-border">
                                <div className="text-gray-400 text-sm">Compliance Rate</div>
                                <div className={`text-2xl font-bold ${metrics.complianceRate >= 80 ? 'text-green-400' : 'text-red-400'}`}>
                                    {metrics.complianceRate}%
                                </div>
                            </div>
                        </div>
                        
                        {/* Search and Filter */}
                        <div className="flex items-center gap-4 mb-4 no-print">
                            <div className="flex-1">
                                <input
                                    type="text"
                                    value={searchFilter}
                                    onChange={(e) => setSearchFilter(e.target.value)}
                                    placeholder="Search labor categories..."
                                    className="w-full bg-mp-slate border border-mp-border rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:border-mp-cyan focus:outline-none"
                                />
                            </div>
                            <button
                                onClick={() => setSelectedCategories(gsaLaborCategories.map(c => c.id))}
                                className="px-4 py-2 bg-mp-slate border border-mp-border rounded-lg text-white hover:bg-mp-dark transition-colors"
                            >
                                Select All
                            </button>
                            <button
                                onClick={() => setSelectedCategories([])}
                                className="px-4 py-2 bg-mp-slate border border-mp-border rounded-lg text-white hover:bg-mp-dark transition-colors"
                            >
                                Clear All
                            </button>
                        </div>
                        
                        {/* Rate Card Table */}
                        <div className="bg-mp-slate rounded-xl border border-mp-border overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full print-table">
                                    <thead>
                                        <tr className="bg-mp-dark">
                                            <th className="text-left px-4 py-3 text-gray-400 font-medium no-print">
                                                <input
                                                    type="checkbox"
                                                    checked={selectedCategories.length === gsaLaborCategories.length}
                                                    onChange={() => {
                                                        if (selectedCategories.length === gsaLaborCategories.length) {
                                                            setSelectedCategories([]);
                                                        } else {
                                                            setSelectedCategories(gsaLaborCategories.map(c => c.id));
                                                        }
                                                    }}
                                                    className="rounded border-mp-border"
                                                />
                                            </th>
                                            <th className="text-left px-4 py-3 text-gray-400 font-medium">Labor Category</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">ID</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">SIN</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Min Yrs</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Education</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">GSA Range</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Year 1</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Year 2</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Year 3</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Year 4</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium">Year 5</th>
                                            <th className="text-center px-4 py-3 text-gray-400 font-medium no-print">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {calculatedRates.filter(r => 
                                            r.title.toLowerCase().includes(searchFilter.toLowerCase()) ||
                                            r.id.toLowerCase().includes(searchFilter.toLowerCase())
                                        ).map((rate, idx) => (
                                            <tr 
                                                key={rate.id} 
                                                className={`border-t border-mp-border hover:bg-mp-dark/50 transition-colors ${!rate.isSelected ? 'opacity-40' : ''}`}
                                            >
                                                <td className="px-4 py-3 no-print">
                                                    <input
                                                        type="checkbox"
                                                        checked={rate.isSelected}
                                                        onChange={() => toggleCategory(rate.id)}
                                                        className="rounded border-mp-border"
                                                    />
                                                </td>
                                                <td className="px-4 py-3">
                                                    <div className="font-medium text-white">{rate.title}</div>
                                                </td>
                                                <td className="px-4 py-3 text-center text-gray-300 font-mono text-sm">{rate.id}</td>
                                                <td className="px-4 py-3 text-center text-gray-300 font-mono text-sm">{rate.sin}</td>
                                                <td className="px-4 py-3 text-center text-gray-300">{rate.minYears}</td>
                                                <td className="px-4 py-3 text-center text-gray-300">{rate.education}</td>
                                                <td className="px-4 py-3 text-center text-gray-400 text-sm">
                                                    ${rate.gsaMin} - ${rate.gsaMax}
                                                </td>
                                                <td className="px-4 py-3 text-center">
                                                    <span className={`font-semibold ${rate.isWithinGSA ? 'text-mp-cyan' : 'text-red-400'}`}>
                                                        ${rate.year1.toFixed(2)}
                                                    </span>
                                                </td>
                                                <td className="px-4 py-3 text-center text-gray-300">${rate.year2.toFixed(2)}</td>
                                                <td className="px-4 py-3 text-center text-gray-300">${rate.year3.toFixed(2)}</td>
                                                <td className="px-4 py-3 text-center text-gray-300">${rate.year4.toFixed(2)}</td>
                                                <td className="px-4 py-3 text-center text-gray-300">${rate.year5.toFixed(2)}</td>
                                                <td className="px-4 py-3 text-center no-print">
                                                    {rate.isWithinGSA ? (
                                                        <span className="text-green-400">
                                                            <svg className="w-5 h-5 inline" fill="currentColor" viewBox="0 0 20 20">
                                                                <path fillRule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clipRule="evenodd" />
                                                            </svg>
                                                        </span>
                                                    ) : (
                                                        <span className="text-red-400 text-xs">Over GSA</span>
                                                    )}
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        {/* Saved Rate Cards */}
                        <div className="mt-8 no-print">
                            <h2 className="text-xl font-semibold text-white mb-4">Saved Rate Cards</h2>
                            <div className="grid grid-cols-3 gap-4">
                                {savedRateCards.map(card => (
                                    <div key={card.id} className="bg-mp-slate rounded-xl border border-mp-border p-4 hover:border-mp-cyan transition-colors cursor-pointer">
                                        <div className="flex items-center justify-between mb-2">
                                            <h3 className="font-medium text-white">{card.name}</h3>
                                            <span className="text-xs text-gray-400">{card.created}</span>
                                        </div>
                                        <div className="flex items-center gap-2 text-sm text-gray-400">
                                            <span className="bg-mp-dark px-2 py-0.5 rounded">{card.vehicle}</span>
                                            <span className="bg-mp-dark px-2 py-0.5 rounded">{card.site}</span>
                                        </div>
                                    </div>
                                ))}
                                <div className="bg-mp-dark rounded-xl border-2 border-dashed border-mp-border p-4 flex items-center justify-center text-gray-400 hover:border-mp-cyan hover:text-mp-cyan transition-colors cursor-pointer">
                                    <svg className="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" />
                                    </svg>
                                    Save Current Card
                                </div>
                            </div>
                        </div>
                    </main>
                    
                    {/* Export Modal */}
                    {showExportModal && (
                        <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 no-print">
                            <div className="bg-mp-slate rounded-xl border border-mp-border p-6 w-full max-w-lg">
                                <h2 className="text-xl font-semibold text-white mb-4">Export Rate Card</h2>
                                
                                <div className="space-y-4">
                                    <div>
                                        <label className="text-gray-400 text-sm block mb-1">Rate Card Name</label>
                                        <input
                                            type="text"
                                            value={rateCardName}
                                            onChange={(e) => setRateCardName(e.target.value)}
                                            placeholder="e.g., DHA MHS GENESIS FY25"
                                            className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white placeholder-gray-500 focus:border-mp-cyan focus:outline-none"
                                        />
                                    </div>
                                    
                                    <div className="grid grid-cols-2 gap-4">
                                        <div>
                                            <label className="text-gray-400 text-sm block mb-1">Effective Date</label>
                                            <input
                                                type="date"
                                                value={effectiveDate}
                                                onChange={(e) => setEffectiveDate(e.target.value)}
                                                className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                            />
                                        </div>
                                        <div>
                                            <label className="text-gray-400 text-sm block mb-1">Expiration Date</label>
                                            <input
                                                type="date"
                                                value={expirationDate}
                                                onChange={(e) => setExpirationDate(e.target.value)}
                                                className="w-full bg-mp-dark border border-mp-border rounded-lg px-4 py-2 text-white focus:border-mp-cyan focus:outline-none"
                                            />
                                        </div>
                                    </div>
                                    
                                    <div className="bg-mp-dark rounded-lg p-4">
                                        <h3 className="text-sm font-medium text-white mb-2">Export Summary</h3>
                                        <div className="grid grid-cols-2 gap-2 text-sm">
                                            <div className="text-gray-400">Vehicle:</div>
                                            <div className="text-white">{vehicle.name}</div>
                                            <div className="text-gray-400">Location:</div>
                                            <div className="text-white">{site.name}</div>
                                            <div className="text-gray-400">Categories:</div>
                                            <div className="text-white">{metrics.categoryCount} selected</div>
                                            <div className="text-gray-400">Escalation:</div>
                                            <div className="text-white">{escalationRate}% annually</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div className="flex items-center justify-end gap-3 mt-6">
                                    <button
                                        onClick={() => setShowExportModal(false)}
                                        className="px-4 py-2 text-gray-400 hover:text-white transition-colors"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={() => {
                                            exportToCSV();
                                            setShowExportModal(false);
                                        }}
                                        className="bg-mp-cyan text-mp-navy px-6 py-2 rounded-lg font-semibold hover:bg-cyan-400 transition-colors"
                                    >
                                        Export CSV
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                    
                    {/* Footer */}
                    <footer className="border-t border-mp-border bg-mp-slate px-6 py-4 mt-8 no-print">
                        <div className="flex items-center justify-between text-sm text-gray-400">
                            <span>Â© 2025 Mission Meets Tech. All rights reserved.</span>
                            <span className="bg-yellow-900/30 text-yellow-400 px-3 py-1 rounded">
                                AI GENERATED - REQUIRES HUMAN REVIEW
                            </span>
                        </div>
                    </footer>
                </div>
            );
        }
        
        ReactDOM.render(<RateCardBuilder />, document.getElementById('root'));
    </script>
</body>
</html>
