<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MissionPulse | Command Center</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mmt-cyan': '#00E5FA',
                        'mmt-navy': '#00050F',
                        'mmt-dark': '#0a0a1a',
                        'mmt-card': '#0d1025',
                        'mmt-border': '#1a1a3a',
                        'pulse-green': '#10B981',
                        'pulse-amber': '#F59E0B',
                        'pulse-red': '#EF4444',
                        'pulse-blue': '#3B82F6',
                        'pulse-purple': '#8B5CF6'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glow-cyan { box-shadow: 0 0 20px rgba(0, 229, 250, 0.3); }
        .glow-text { text-shadow: 0 0 10px rgba(0, 229, 250, 0.5); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 229, 250, 0.15); }
        .pulse-ring { animation: pulse-ring 2s infinite; }
        @keyframes pulse-ring {
            0% { box-shadow: 0 0 0 0 rgba(0, 229, 250, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(0, 229, 250, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 229, 250, 0); }
        }
        .activity-line::before {
            content: '';
            position: absolute;
            left: 16px;
            top: 40px;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #1a1a3a, transparent);
        }
        .scroll-fade {
            mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
            -webkit-mask-image: linear-gradient(to bottom, black 85%, transparent 100%);
        }
        .sparkline { stroke-linecap: round; stroke-linejoin: round; }
        .pipeline-bar { transition: width 0.8s ease-out; }
    </style>
</head>
<body class="bg-mmt-navy min-h-screen text-white">
    <div id="root"></div>
    <script src="missionpulse-nav.js"></script>
    
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // ============================================================
        // DEMO DATA - Baked in for standalone operation
        // ============================================================
        const DEMO_OPPORTUNITIES = [
            {
                id: 'OPP-001',
                name: 'DHA Electronic Health Records Modernization',
                agency: 'DHA',
                value: 45000000,
                priority: 'P-0',
                pWin: 72,
                pWinTrend: [55, 58, 62, 65, 68, 72],
                stage: 'Red Team',
                stagePercent: 70,
                deadline: '2026-02-15',
                daysToDeadline: 21,
                pm: 'Sarah Chen',
                status: 'on-track',
                lastActivity: '2 hours ago',
                naics: '541512'
            },
            {
                id: 'OPP-002',
                name: 'VA Claims Processing AI Platform',
                agency: 'VA',
                value: 28000000,
                priority: 'P-0',
                pWin: 65,
                pWinTrend: [45, 52, 58, 60, 63, 65],
                stage: 'Pink Team',
                stagePercent: 30,
                deadline: '2026-03-01',
                daysToDeadline: 35,
                pm: 'Marcus Johnson',
                status: 'on-track',
                lastActivity: '4 hours ago',
                naics: '541511'
            },
            {
                id: 'OPP-003',
                name: 'CMS Data Analytics Infrastructure',
                agency: 'CMS',
                value: 52000000,
                priority: 'P-1',
                pWin: 48,
                pWinTrend: [40, 42, 44, 45, 46, 48],
                stage: 'Blue Team',
                stagePercent: 15,
                deadline: '2026-04-10',
                daysToDeadline: 75,
                pm: 'Jennifer Park',
                status: 'needs-attention',
                lastActivity: '1 day ago',
                naics: '518210'
            },
            {
                id: 'OPP-004',
                name: 'IHS Telehealth Expansion Program',
                agency: 'IHS',
                value: 18500000,
                priority: 'P-1',
                pWin: 58,
                pWinTrend: [50, 52, 54, 55, 57, 58],
                stage: 'Gold Team',
                stagePercent: 90,
                deadline: '2026-02-05',
                daysToDeadline: 11,
                pm: 'David Reyes',
                status: 'on-track',
                lastActivity: '30 minutes ago',
                naics: '541519'
            },
            {
                id: 'OPP-005',
                name: 'CDC Surveillance System Upgrade',
                agency: 'CDC',
                value: 35000000,
                priority: 'P-1',
                pWin: 42,
                pWinTrend: [38, 39, 40, 41, 41, 42],
                stage: 'Gate 1',
                stagePercent: 5,
                deadline: '2026-05-20',
                daysToDeadline: 115,
                pm: 'Lisa Thompson',
                status: 'on-track',
                lastActivity: '3 hours ago',
                naics: '541512'
            },
            {
                id: 'OPP-006',
                name: 'FDA Drug Safety Database',
                agency: 'FDA',
                value: 22000000,
                priority: 'P-2',
                pWin: 35,
                pWinTrend: [30, 32, 33, 34, 34, 35],
                stage: 'Kickoff',
                stagePercent: 10,
                deadline: '2026-06-15',
                daysToDeadline: 141,
                pm: 'Robert Kim',
                status: 'on-track',
                lastActivity: '5 hours ago',
                naics: '541511'
            }
        ];

        const DEMO_ACTIVITIES = [
            { id: 1, type: 'compliance', icon: 'üõ°Ô∏è', user: 'Compliance Guardian', action: 'Flagged 3 compliance gaps', target: 'DHA EHR Mod', module: 'M6', time: '12 min ago', priority: 'high' },
            { id: 2, type: 'strategy', icon: 'üéØ', user: 'Sarah Chen', action: 'Updated win themes', target: 'VA Claims AI', module: 'M1', time: '28 min ago', priority: 'medium' },
            { id: 3, type: 'pricing', icon: 'üí∞', user: 'Pricing Intel', action: 'Generated BOE analysis', target: 'CMS Analytics', module: 'M8', time: '45 min ago', priority: 'medium' },
            { id: 4, type: 'blackhat', icon: 'üïµÔ∏è', user: 'Black Hat Intel', action: 'Competitor alert: Leidos bid', target: 'IHS Telehealth', module: 'M7', time: '1 hr ago', priority: 'high' },
            { id: 5, type: 'review', icon: 'üìù', user: 'Marcus Johnson', action: 'Completed Pink Team review', target: 'VA Claims AI', module: 'M9', time: '2 hrs ago', priority: 'medium' },
            { id: 6, type: 'orals', icon: 'üé§', user: 'Orals Coach', action: 'Scheduled practice session', target: 'DHA EHR Mod', module: 'M10', time: '3 hrs ago', priority: 'low' },
            { id: 7, type: 'contracts', icon: 'üìã', user: 'Contracts Analyst', action: 'Reviewed CLIN structure', target: 'CDC Surveillance', module: 'M5', time: '4 hrs ago', priority: 'medium' },
            { id: 8, type: 'teaming', icon: 'ü§ù', user: 'Jennifer Park', action: 'Added teaming partner', target: 'CMS Analytics', module: 'M11', time: '5 hrs ago', priority: 'low' },
            { id: 9, type: 'deadline', icon: '‚è∞', user: 'System', action: 'Deadline reminder: 11 days', target: 'IHS Telehealth', module: 'Hub', time: '6 hrs ago', priority: 'high' },
            { id: 10, type: 'roi', icon: 'üìä', user: 'ROI Calculator', action: 'Updated pursuit cost estimate', target: 'FDA Drug Safety', module: 'M13', time: '8 hrs ago', priority: 'low' }
        ];

        const DEMO_TEAM = [
            { name: 'Sarah Chen', role: 'PM', avatar: 'SC', assignments: 2, workload: 85, opportunities: ['OPP-001', 'OPP-003'] },
            { name: 'Marcus Johnson', role: 'PM', avatar: 'MJ', assignments: 1, workload: 60, opportunities: ['OPP-002'] },
            { name: 'Jennifer Park', role: 'PM', avatar: 'JP', assignments: 1, workload: 45, opportunities: ['OPP-003'] },
            { name: 'David Reyes', role: 'PM', avatar: 'DR', assignments: 1, workload: 90, opportunities: ['OPP-004'] },
            { name: 'Lisa Thompson', role: 'CAP', avatar: 'LT', assignments: 2, workload: 70, opportunities: ['OPP-005', 'OPP-006'] },
            { name: 'Robert Kim', role: 'SA', avatar: 'RK', assignments: 3, workload: 95, opportunities: ['OPP-001', 'OPP-002', 'OPP-006'] }
        ];

        const SHIPLEY_STAGES = [
            { name: 'Gate 1', percent: 5, color: 'bg-gray-500' },
            { name: 'Blue Team', percent: 15, color: 'bg-blue-500' },
            { name: 'Kickoff', percent: 20, color: 'bg-purple-500' },
            { name: 'Pink Team', percent: 30, color: 'bg-pink-500' },
            { name: 'Red Team', percent: 70, color: 'bg-red-500' },
            { name: 'Gold Team', percent: 90, color: 'bg-yellow-500' },
            { name: 'White Glove', percent: 95, color: 'bg-white' },
            { name: 'Submitted', percent: 100, color: 'bg-pulse-green' }
        ];

        const MODULES = [
            { id: 'M1', name: 'Capture Intel', icon: 'üîç', href: 'missionpulse-m1-enhanced.html', color: 'from-blue-600 to-blue-800' },
            { id: 'M2', name: 'War Room', icon: 'üéØ', href: 'missionpulse-m2-warroom-enhanced.html', color: 'from-red-600 to-red-800' },
            { id: 'M3', name: 'Swimlane', icon: 'üìã', href: 'missionpulse-m3-swimlane-board.html', color: 'from-purple-600 to-purple-800' },
            { id: 'M5', name: 'Contracts', icon: 'üìë', href: 'missionpulse-m5-contracts-enhanced.html', color: 'from-amber-600 to-amber-800' },
            { id: 'M6', name: 'Iron Dome', icon: 'üõ°Ô∏è', href: 'missionpulse-m6-iron-dome.html', color: 'from-green-600 to-green-800' },
            { id: 'M7', name: 'Black Hat', icon: 'üïµÔ∏è', href: 'missionpulse-m7-blackhat-enhanced.html', color: 'from-gray-700 to-gray-900' },
            { id: 'M8', name: 'Pricing', icon: 'üí∞', href: 'missionpulse-m8-pricing.html', color: 'from-emerald-600 to-emerald-800' },
            { id: 'M9', name: 'HITL Review', icon: 'üëÅÔ∏è', href: 'missionpulse-m9-hitl-enhanced.html', color: 'from-cyan-600 to-cyan-800' },
            { id: 'M10', name: 'Orals Coach', icon: 'üé§', href: 'missionpulse-m10-orals.html', color: 'from-indigo-600 to-indigo-800' },
            { id: 'M11', name: 'Frenemy', icon: 'ü§ù', href: 'missionpulse-m11-frenemy-protocol.html', color: 'from-pink-600 to-pink-800' },
            { id: 'M13', name: 'ROI', icon: 'üìä', href: 'missionpulse-m13-launch-roi.html', color: 'from-teal-600 to-teal-800' },
            { id: 'M14', name: 'Post-Award', icon: 'üèÜ', href: 'missionpulse-m14-post-award.html', color: 'from-yellow-600 to-yellow-800' }
        ];

        const RBAC_ROLES = [
            { id: 'CEO', label: 'CEO', access: 'full' },
            { id: 'COO', label: 'COO', access: 'full' },
            { id: 'CAP', label: 'Capture Manager', access: 'strategy' },
            { id: 'PM', label: 'Proposal Manager', access: 'execution' },
            { id: 'SA', label: 'Solution Architect', access: 'technical' },
            { id: 'FIN', label: 'Finance', access: 'pricing' },
            { id: 'CON', label: 'Contracts', access: 'compliance' },
            { id: 'SME', label: 'Subject Matter Expert', access: 'limited' },
            { id: 'VIEWER', label: 'Viewer', access: 'readonly' }
        ];

        // ============================================================
        // UTILITY FUNCTIONS
        // ============================================================
        const formatCurrency = (value) => {
            if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
            if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
            return `$${value}`;
        };

        const getPriorityColor = (priority) => {
            const colors = {
                'P-0': 'bg-red-500/20 text-red-400 border-red-500/30',
                'P-1': 'bg-amber-500/20 text-amber-400 border-amber-500/30',
                'P-2': 'bg-blue-500/20 text-blue-400 border-blue-500/30'
            };
            return colors[priority] || colors['P-2'];
        };

        const getStatusColor = (status) => {
            const colors = {
                'on-track': 'text-pulse-green',
                'needs-attention': 'text-pulse-amber',
                'at-risk': 'text-pulse-red'
            };
            return colors[status] || 'text-gray-400';
        };

        const getWorkloadColor = (workload) => {
            if (workload >= 90) return 'bg-pulse-red';
            if (workload >= 70) return 'bg-pulse-amber';
            return 'bg-pulse-green';
        };

        // ============================================================
        // COMPONENTS
        // ============================================================
        
        // Sparkline Chart Component
        const Sparkline = ({ data, color = '#00E5FA', width = 80, height = 24 }) => {
            const max = Math.max(...data);
            const min = Math.min(...data);
            const range = max - min || 1;
            
            const points = data.map((val, i) => {
                const x = (i / (data.length - 1)) * width;
                const y = height - ((val - min) / range) * height;
                return `${x},${y}`;
            }).join(' ');

            const trend = data[data.length - 1] - data[0];
            const trendColor = trend > 0 ? '#10B981' : trend < 0 ? '#EF4444' : color;

            return (
                <svg width={width} height={height} className="sparkline">
                    <polyline
                        fill="none"
                        stroke={trendColor}
                        strokeWidth="2"
                        points={points}
                    />
                    <circle cx={width} cy={height - ((data[data.length - 1] - min) / range) * height} r="3" fill={trendColor} />
                </svg>
            );
        };

        // KPI Card Component
        const KPICard = ({ icon, label, value, subValue, trend, trendUp }) => (
            <div className="bg-mmt-card border border-mmt-border rounded-xl p-4 card-hover">
                <div className="flex items-start justify-between">
                    <div>
                        <div className="text-2xl mb-1">{icon}</div>
                        <div className="text-gray-400 text-xs uppercase tracking-wider mb-1">{label}</div>
                        <div className="text-2xl font-bold text-white">{value}</div>
                        {subValue && <div className="text-sm text-gray-500 mt-1">{subValue}</div>}
                    </div>
                    {trend !== undefined && (
                        <div className={`flex items-center gap-1 text-sm ${trendUp ? 'text-pulse-green' : 'text-pulse-red'}`}>
                            <span>{trendUp ? '‚Üë' : '‚Üì'}</span>
                            <span>{trend}%</span>
                        </div>
                    )}
                </div>
            </div>
        );

        // Opportunity Row Component
        const OpportunityRow = ({ opp, isExpanded, onToggle }) => (
            <div className="bg-mmt-card/50 border border-mmt-border rounded-lg p-4 card-hover">
                <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4 flex-1">
                        <div className={`px-2 py-1 rounded text-xs font-semibold border ${getPriorityColor(opp.priority)}`}>
                            {opp.priority}
                        </div>
                        <div className="flex-1 min-w-0">
                            <div className="flex items-center gap-2">
                                <h4 className="font-semibold text-white truncate">{opp.name}</h4>
                                <span className="text-xs text-gray-500">({opp.agency})</span>
                            </div>
                            <div className="flex items-center gap-4 mt-1 text-sm">
                                <span className="text-gray-400">{opp.stage}</span>
                                <span className="text-mmt-cyan font-medium">{formatCurrency(opp.value)}</span>
                                <span className={getStatusColor(opp.status)}>‚óè {opp.status.replace('-', ' ')}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div className="flex items-center gap-6">
                        {/* pWin with Sparkline */}
                        <div className="text-center">
                            <div className="flex items-center gap-2">
                                <Sparkline data={opp.pWinTrend} width={60} height={20} />
                                <span className="text-xl font-bold text-white">{opp.pWin}%</span>
                            </div>
                            <div className="text-xs text-gray-500">Win Probability</div>
                        </div>
                        
                        {/* Deadline */}
                        <div className="text-center">
                            <div className={`text-lg font-semibold ${opp.daysToDeadline <= 14 ? 'text-pulse-red' : opp.daysToDeadline <= 30 ? 'text-pulse-amber' : 'text-white'}`}>
                                {opp.daysToDeadline}d
                            </div>
                            <div className="text-xs text-gray-500">To Deadline</div>
                        </div>
                        
                        {/* PM Avatar */}
                        <div className="text-center">
                            <div className="w-8 h-8 rounded-full bg-gradient-to-br from-mmt-cyan to-blue-600 flex items-center justify-center text-xs font-bold mx-auto">
                                {opp.pm.split(' ').map(n => n[0]).join('')}
                            </div>
                            <div className="text-xs text-gray-500 mt-1">{opp.pm.split(' ')[0]}</div>
                        </div>
                        
                        {/* Quick Actions */}
                        <div className="flex gap-2">
                            <button className="p-2 rounded-lg bg-mmt-border/50 hover:bg-mmt-cyan/20 transition-colors" title="View Details">
                                <span className="text-sm">üìä</span>
                            </button>
                            <button className="p-2 rounded-lg bg-mmt-border/50 hover:bg-mmt-cyan/20 transition-colors" title="Open War Room">
                                <span className="text-sm">üéØ</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                {/* Progress Bar */}
                <div className="mt-3">
                    <div className="h-1.5 bg-mmt-border rounded-full overflow-hidden">
                        <div 
                            className="h-full bg-gradient-to-r from-mmt-cyan to-blue-500 pipeline-bar rounded-full"
                            style={{ width: `${opp.stagePercent}%` }}
                        />
                    </div>
                    <div className="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Gate 1</span>
                        <span>{opp.stagePercent}% Complete</span>
                        <span>Submitted</span>
                    </div>
                </div>
            </div>
        );

        // Activity Item Component
        const ActivityItem = ({ activity }) => {
            const priorityColors = {
                high: 'border-l-pulse-red',
                medium: 'border-l-pulse-amber',
                low: 'border-l-mmt-cyan'
            };

            return (
                <div className={`relative pl-8 pb-4 border-l-2 ${priorityColors[activity.priority]} ml-4`}>
                    <div className="absolute -left-3 top-0 w-6 h-6 rounded-full bg-mmt-card border-2 border-mmt-border flex items-center justify-center text-sm">
                        {activity.icon}
                    </div>
                    <div className="bg-mmt-card/30 rounded-lg p-3 ml-2">
                        <div className="flex items-center justify-between">
                            <div>
                                <span className="text-white font-medium">{activity.user}</span>
                                <span className="text-gray-400 mx-2">{activity.action}</span>
                                <span className="text-mmt-cyan">{activity.target}</span>
                            </div>
                            <span className="text-xs text-gray-500">{activity.time}</span>
                        </div>
                        <div className="text-xs text-gray-500 mt-1">
                            Module: <span className="text-mmt-cyan">{activity.module}</span>
                        </div>
                    </div>
                </div>
            );
        };

        // Team Member Card Component
        const TeamMemberCard = ({ member }) => (
            <div className="flex items-center gap-3 p-3 bg-mmt-card/30 rounded-lg">
                <div className="w-10 h-10 rounded-full bg-gradient-to-br from-mmt-cyan to-purple-600 flex items-center justify-center text-sm font-bold">
                    {member.avatar}
                </div>
                <div className="flex-1 min-w-0">
                    <div className="font-medium text-white truncate">{member.name}</div>
                    <div className="text-xs text-gray-500">{member.role} ‚Ä¢ {member.assignments} active</div>
                </div>
                <div className="w-16">
                    <div className="h-2 bg-mmt-border rounded-full overflow-hidden">
                        <div className={`h-full ${getWorkloadColor(member.workload)} rounded-full`} style={{ width: `${member.workload}%` }} />
                    </div>
                    <div className="text-xs text-gray-500 text-center mt-1">{member.workload}%</div>
                </div>
            </div>
        );

        // Module Card Component
        const ModuleCard = ({ module }) => (
            <a 
                href={module.href}
                className={`block p-4 rounded-xl bg-gradient-to-br ${module.color} border border-white/10 card-hover group`}
            >
                <div className="text-2xl mb-2 group-hover:scale-110 transition-transform">{module.icon}</div>
                <div className="text-xs text-white/60 uppercase tracking-wider">{module.id}</div>
                <div className="text-sm font-semibold text-white">{module.name}</div>
            </a>
        );

        // Pipeline Stage Card
        const PipelineStageCard = ({ stage, count, value }) => (
            <div className="text-center p-3 bg-mmt-card/30 rounded-lg border border-mmt-border/50">
                <div className={`w-3 h-3 rounded-full ${stage.color} mx-auto mb-2`} />
                <div className="text-lg font-bold text-white">{count}</div>
                <div className="text-xs text-gray-500 truncate">{stage.name}</div>
                {value > 0 && <div className="text-xs text-mmt-cyan mt-1">{formatCurrency(value)}</div>}
            </div>
        );

        // Deadline Alert Component
        const DeadlineAlert = ({ opp }) => {
            const isUrgent = opp.daysToDeadline <= 14;
            const isWarning = opp.daysToDeadline <= 30 && opp.daysToDeadline > 14;

            return (
                <div className={`flex items-center justify-between p-3 rounded-lg border ${
                    isUrgent ? 'bg-red-500/10 border-red-500/30' : 
                    isWarning ? 'bg-amber-500/10 border-amber-500/30' : 
                    'bg-mmt-card/30 border-mmt-border'
                }`}>
                    <div className="flex items-center gap-3">
                        <div className={`text-xl ${isUrgent ? 'animate-pulse' : ''}`}>
                            {isUrgent ? 'üö®' : isWarning ? '‚ö†Ô∏è' : 'üìÖ'}
                        </div>
                        <div>
                            <div className="font-medium text-white text-sm">{opp.name}</div>
                            <div className="text-xs text-gray-500">{opp.stage} ‚Ä¢ {opp.agency}</div>
                        </div>
                    </div>
                    <div className={`text-right ${isUrgent ? 'text-pulse-red' : isWarning ? 'text-pulse-amber' : 'text-gray-400'}`}>
                        <div className="font-bold">{opp.daysToDeadline}d</div>
                        <div className="text-xs">{new Date(opp.deadline).toLocaleDateString()}</div>
                    </div>
                </div>
            );
        };

        // RBAC Role Switcher Component
        const RoleSwitcher = ({ currentRole, onRoleChange }) => {
            const [isOpen, setIsOpen] = useState(false);
            const currentRoleData = RBAC_ROLES.find(r => r.id === currentRole) || RBAC_ROLES[0];

            return (
                <div className="relative">
                    <button
                        onClick={() => setIsOpen(!isOpen)}
                        className="flex items-center gap-2 px-3 py-1.5 bg-mmt-card border border-mmt-border rounded-lg hover:border-mmt-cyan/50 transition-colors"
                    >
                        <span className="text-xs text-gray-400">Role:</span>
                        <span className="text-sm font-medium text-mmt-cyan">{currentRoleData.label}</span>
                        <svg className={`w-4 h-4 text-gray-400 transition-transform ${isOpen ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                        </svg>
                    </button>
                    
                    {isOpen && (
                        <div className="absolute right-0 top-full mt-1 w-48 bg-mmt-card border border-mmt-border rounded-lg shadow-xl z-50 py-1">
                            {RBAC_ROLES.map(role => (
                                <button
                                    key={role.id}
                                    onClick={() => { onRoleChange(role.id); setIsOpen(false); }}
                                    className={`w-full px-3 py-2 text-left text-sm hover:bg-mmt-cyan/10 transition-colors ${
                                        role.id === currentRole ? 'text-mmt-cyan bg-mmt-cyan/5' : 'text-gray-300'
                                    }`}
                                >
                                    {role.label}
                                    <span className="text-xs text-gray-500 ml-2">({role.access})</span>
                                </button>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // ============================================================
        // MAIN DASHBOARD COMPONENT
        // ============================================================
        const Dashboard = () => {
            const [currentRole, setCurrentRole] = useState(() => {
                return localStorage.getItem('missionpulse_role') || 'CEO';
            });
            const [activeTab, setActiveTab] = useState('all');

            useEffect(() => {
                localStorage.setItem('missionpulse_role', currentRole);
            }, [currentRole]);

            // Calculate KPIs
            const kpis = useMemo(() => {
                const totalValue = DEMO_OPPORTUNITIES.reduce((sum, o) => sum + o.value, 0);
                const avgPWin = Math.round(DEMO_OPPORTUNITIES.reduce((sum, o) => sum + o.pWin, 0) / DEMO_OPPORTUNITIES.length);
                const urgentDeadlines = DEMO_OPPORTUNITIES.filter(o => o.daysToDeadline <= 30).length;
                const p0Count = DEMO_OPPORTUNITIES.filter(o => o.priority === 'P-0').length;
                
                return { totalValue, avgPWin, urgentDeadlines, p0Count, total: DEMO_OPPORTUNITIES.length };
            }, []);

            // Calculate pipeline by stage
            const pipelineByStage = useMemo(() => {
                const stages = {};
                SHIPLEY_STAGES.forEach(s => { stages[s.name] = { count: 0, value: 0 }; });
                DEMO_OPPORTUNITIES.forEach(o => {
                    if (stages[o.stage]) {
                        stages[o.stage].count++;
                        stages[o.stage].value += o.value;
                    }
                });
                return stages;
            }, []);

            // Filter opportunities by tab
            const filteredOpportunities = useMemo(() => {
                if (activeTab === 'all') return DEMO_OPPORTUNITIES;
                if (activeTab === 'p0') return DEMO_OPPORTUNITIES.filter(o => o.priority === 'P-0');
                if (activeTab === 'urgent') return DEMO_OPPORTUNITIES.filter(o => o.daysToDeadline <= 30);
                return DEMO_OPPORTUNITIES;
            }, [activeTab]);

            // Sorted deadlines
            const sortedDeadlines = useMemo(() => {
                return [...DEMO_OPPORTUNITIES].sort((a, b) => a.daysToDeadline - b.daysToDeadline).slice(0, 5);
            }, []);

            return (
                <div className="min-h-screen bg-mmt-navy">
                    {/* Header */}
                    <header className="bg-mmt-dark/80 backdrop-blur-sm border-b border-mmt-border sticky top-0 z-40">
                        <div className="max-w-[1800px] mx-auto px-6 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <a href="missionpulse-hub.html" className="flex items-center gap-3 hover:opacity-80 transition-opacity">
                                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-mmt-cyan to-blue-600 flex items-center justify-center glow-cyan">
                                            <span className="text-xl">üõ°Ô∏è</span>
                                        </div>
                                        <div>
                                            <h1 className="text-xl font-bold text-white">MissionPulse</h1>
                                            <p className="text-xs text-gray-400">Command Center</p>
                                        </div>
                                    </a>
                                </div>
                                
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2 px-3 py-1.5 bg-pulse-green/20 border border-pulse-green/30 rounded-lg">
                                        <div className="w-2 h-2 rounded-full bg-pulse-green animate-pulse" />
                                        <span className="text-sm text-pulse-green font-medium">System Online</span>
                                    </div>
                                    <RoleSwitcher currentRole={currentRole} onRoleChange={setCurrentRole} />
                                </div>
                            </div>
                        </div>
                    </header>

                    <main className="max-w-[1800px] mx-auto px-6 py-6">
                        {/* KPI Cards Row */}
                        <section className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                            <KPICard
                                icon="üìä"
                                label="Active Pipeline"
                                value={kpis.total}
                                subValue={`${kpis.p0Count} Must-Wins`}
                                trend={12}
                                trendUp={true}
                            />
                            <KPICard
                                icon="üí∞"
                                label="Pipeline Value"
                                value={formatCurrency(kpis.totalValue)}
                                subValue="Weighted: $89.2M"
                                trend={8}
                                trendUp={true}
                            />
                            <KPICard
                                icon="üéØ"
                                label="Avg Win Probability"
                                value={`${kpis.avgPWin}%`}
                                subValue="Target: 60%"
                                trend={5}
                                trendUp={true}
                            />
                            <KPICard
                                icon="‚è∞"
                                label="Deadlines <30d"
                                value={kpis.urgentDeadlines}
                                subValue="Next: IHS Telehealth"
                                trend={2}
                                trendUp={false}
                            />
                        </section>

                        {/* Main Content Grid */}
                        <div className="grid grid-cols-12 gap-6">
                            {/* Left Column - Pipeline & Opportunities */}
                            <div className="col-span-12 lg:col-span-8 space-y-6">
                                {/* Pipeline Overview */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>üìà</span> Pipeline by Stage
                                        </h2>
                                        <a href="missionpulse-m3-swimlane-board.html" className="text-sm text-mmt-cyan hover:underline">
                                            Open Swimlane ‚Üí
                                        </a>
                                    </div>
                                    <div className="grid grid-cols-4 md:grid-cols-8 gap-2">
                                        {SHIPLEY_STAGES.map(stage => (
                                            <PipelineStageCard
                                                key={stage.name}
                                                stage={stage}
                                                count={pipelineByStage[stage.name]?.count || 0}
                                                value={pipelineByStage[stage.name]?.value || 0}
                                            />
                                        ))}
                                    </div>
                                </section>

                                {/* Opportunities List */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>üéØ</span> Active Opportunities
                                        </h2>
                                        <div className="flex gap-2">
                                            {['all', 'p0', 'urgent'].map(tab => (
                                                <button
                                                    key={tab}
                                                    onClick={() => setActiveTab(tab)}
                                                    className={`px-3 py-1 text-sm rounded-lg transition-colors ${
                                                        activeTab === tab
                                                            ? 'bg-mmt-cyan/20 text-mmt-cyan border border-mmt-cyan/30'
                                                            : 'text-gray-400 hover:text-white hover:bg-mmt-border/50'
                                                    }`}
                                                >
                                                    {tab === 'all' ? 'All' : tab === 'p0' ? 'Must-Win' : 'Urgent'}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        {filteredOpportunities.map(opp => (
                                            <OpportunityRow key={opp.id} opp={opp} />
                                        ))}
                                    </div>
                                </section>

                                {/* Module Quick Launch */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>üöÄ</span> Quick Launch
                                        </h2>
                                        <a href="missionpulse-hub.html" className="text-sm text-mmt-cyan hover:underline">
                                            View All Modules ‚Üí
                                        </a>
                                    </div>
                                    <div className="grid grid-cols-3 md:grid-cols-6 gap-3">
                                        {MODULES.map(module => (
                                            <ModuleCard key={module.id} module={module} />
                                        ))}
                                    </div>
                                </section>
                            </div>

                            {/* Right Column - Activity, Team, Deadlines */}
                            <div className="col-span-12 lg:col-span-4 space-y-6">
                                {/* Activity Feed */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>‚ö°</span> Activity Feed
                                        </h2>
                                        <button className="text-xs text-gray-400 hover:text-mmt-cyan transition-colors">
                                            View All
                                        </button>
                                    </div>
                                    <div className="scroll-fade max-h-80 overflow-y-auto pr-2">
                                        {DEMO_ACTIVITIES.slice(0, 7).map(activity => (
                                            <ActivityItem key={activity.id} activity={activity} />
                                        ))}
                                    </div>
                                </section>

                                {/* Upcoming Deadlines */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>üìÖ</span> Upcoming Deadlines
                                        </h2>
                                    </div>
                                    <div className="space-y-2">
                                        {sortedDeadlines.map(opp => (
                                            <DeadlineAlert key={opp.id} opp={opp} />
                                        ))}
                                    </div>
                                </section>

                                {/* Team Workload */}
                                <section className="bg-mmt-card border border-mmt-border rounded-xl p-5">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-white flex items-center gap-2">
                                            <span>üë•</span> Team Workload
                                        </h2>
                                    </div>
                                    <div className="space-y-2">
                                        {DEMO_TEAM.map(member => (
                                            <TeamMemberCard key={member.name} member={member} />
                                        ))}
                                    </div>
                                    <div className="mt-4 pt-4 border-t border-mmt-border">
                                        <div className="flex items-center justify-between text-sm">
                                            <span className="text-gray-400">Capacity Warning</span>
                                            <span className="text-pulse-amber font-medium">2 at 90%+</span>
                                        </div>
                                    </div>
                                </section>
                            </div>
                        </div>
                    </main>

                    {/* Footer */}
                    <footer className="bg-mmt-dark/50 border-t border-mmt-border mt-8">
                        <div className="max-w-[1800px] mx-auto px-6 py-4">
                            <div className="flex items-center justify-between text-sm">
                                <div className="flex items-center gap-4">
                                    <span className="text-gray-500">MissionPulse v1.2</span>
                                    <span className="text-mmt-cyan">Mission Meets Tech</span>
                                </div>
                                <div className="flex items-center gap-4">
                                    <span className="px-2 py-1 bg-amber-500/20 text-amber-400 rounded text-xs font-medium">
                                        AI GENERATED - REQUIRES HUMAN REVIEW
                                    </span>
                                    <span className="text-gray-500">{new Date().toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        // Render Application
        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>
