<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Templates Library</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}
  </style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const SB_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;
    try { sbClient = supabase.createClient(SB_URL, SB_KEY); } catch(e) { sbClient = null; }

    const ROLES_ALLOWED = ['*'];

    const DEMO_TEMPLATES = [
      // Technical Approach
      { id:1, name:'Technical Approach — Overview', category:'Technical Volume', section:'Vol II', version:'3.2', status:'Approved', lastEditor:'Mary W.', updated:'2026-02-10', usageCount:14, wordCount:2800, tags:['Shipley','Vol II','DHA'], preview:'Our technical approach leverages a DevSecOps-first methodology aligned with DHA modernization objectives. The solution architecture employs a microservices pattern deployed on Azure Government (IL5)...' },
      { id:2, name:'Staffing Plan Template', category:'Technical Volume', section:'Vol II', version:'2.1', status:'Approved', lastEditor:'Sarah K.', updated:'2026-02-08', usageCount:11, wordCount:1500, tags:['Staffing','LCAT','Labor'], preview:'Our staffing strategy ensures continuity through a phased transition plan. Key personnel are identified by LCAT with minimum qualifications exceeding PWS requirements...' },
      { id:3, name:'Quality Control Plan', category:'Technical Volume', section:'Vol II', version:'1.4', status:'Draft', lastEditor:'Mike R.', updated:'2026-02-05', usageCount:8, wordCount:2200, tags:['QCP','ISO','CMMI'], preview:'Quality is embedded at every stage of our delivery lifecycle. Our QCP follows ISO 9001:2015 and CMMI Level 3 processes adapted for federal health IT...' },
      { id:4, name:'Transition-In Plan', category:'Technical Volume', section:'Vol II', version:'2.0', status:'Approved', lastEditor:'Mary W.', updated:'2026-01-28', usageCount:9, wordCount:1800, tags:['Transition','Phase-In','Continuity'], preview:'Our 90-day transition plan minimizes risk through a four-phase approach: Knowledge Transfer, Shadow Operations, Parallel Run, and Full Assumption...' },

      // Management
      { id:5, name:'Management Approach', category:'Management Volume', section:'Vol III', version:'2.3', status:'Approved', lastEditor:'Mary W.', updated:'2026-02-12', usageCount:12, wordCount:3100, tags:['PM','Agile','Governance'], preview:'Our management philosophy centers on Agile governance with Earned Value Management (EVM) adapted for CPFF and T&M contract types...' },
      { id:6, name:'Risk Management Plan', category:'Management Volume', section:'Vol III', version:'1.8', status:'Approved', lastEditor:'Tom P.', updated:'2026-02-01', usageCount:7, wordCount:1600, tags:['Risk','Mitigation','Register'], preview:'Risk identification begins at capture and continues through performance. Our risk register uses a 5x5 probability-impact matrix with weekly PMO reviews...' },
      { id:7, name:'Communication Plan', category:'Management Volume', section:'Vol III', version:'1.2', status:'Draft', lastEditor:'Sarah K.', updated:'2026-01-25', usageCount:5, wordCount:900, tags:['Comms','Stakeholder','Reporting'], preview:'Stakeholder communication follows a tiered cadence: Daily standups (team), Weekly status (COR), Monthly reviews (CO/ACOR), Quarterly business reviews (leadership)...' },

      // Past Performance
      { id:8, name:'Past Performance — DHA Template', category:'Past Performance', section:'Vol IV', version:'3.0', status:'Approved', lastEditor:'Mary W.', updated:'2026-02-14', usageCount:16, wordCount:2000, tags:['PP','CPARS','DHA'], preview:'Contract: [Contract Number] | Agency: DHA | Value: $XXM | Period: [Dates]. Relevance: This effort directly mirrors the requirements of the instant solicitation...' },
      { id:9, name:'Past Performance — VA Template', category:'Past Performance', section:'Vol IV', version:'2.1', status:'Approved', lastEditor:'Mary W.', updated:'2026-02-06', usageCount:10, wordCount:1800, tags:['PP','CPARS','VA'], preview:'Our VA past performance demonstrates sustained Exceptional/Very Good CPARS ratings across [X] consecutive evaluation periods...' },

      // Pricing
      { id:10, name:'BOE Narrative Template', category:'Pricing Volume', section:'Vol V', version:'2.4', status:'Approved', lastEditor:'Finance Team', updated:'2026-02-11', usageCount:13, wordCount:1200, tags:['BOE','Pricing','Rates'], preview:'Basis of Estimate: Labor hours are derived from a bottom-up analysis of each PWS task using historical actuals from [contract]. Rates reflect our GSA MAS Schedule pricing...' },
      { id:11, name:'Price-to-Win Analysis', category:'Pricing Volume', section:'Vol V', version:'1.6', status:'Draft', lastEditor:'Finance Team', updated:'2026-01-30', usageCount:6, wordCount:800, tags:['PTW','Competitive','Analysis'], preview:'Competitive price range analysis based on incumbent contract values, GSA schedule rates, and market intelligence from [sources]...' },

      // Boilerplate
      { id:12, name:'Company Overview', category:'Boilerplate', section:'General', version:'4.1', status:'Approved', lastEditor:'Mary W.', updated:'2026-02-15', usageCount:22, wordCount:600, tags:['About','Company','SDVOSB'], preview:'Mission Meets Tech (MMT) is a Service-Disabled Veteran-Owned Small Business (SDVOSB) delivering AI-powered health IT solutions to federal agencies...' },
      { id:13, name:'Organizational Conflict of Interest', category:'Boilerplate', section:'General', version:'2.0', status:'Approved', lastEditor:'Legal', updated:'2026-01-20', usageCount:9, wordCount:400, tags:['OCI','Compliance','Legal'], preview:'MMT certifies that no organizational conflict of interest exists with respect to this solicitation. Our OCI mitigation plan...' },
      { id:14, name:'Section 508 Compliance Statement', category:'Boilerplate', section:'General', version:'1.3', status:'Approved', lastEditor:'Tech Lead', updated:'2026-01-15', usageCount:11, wordCount:350, tags:['508','Accessibility','VPAT'], preview:'All deliverables will conform to Section 508 of the Rehabilitation Act and WCAG 2.1 AA standards. Our development process includes automated accessibility testing...' },
      { id:15, name:'Cybersecurity Approach', category:'Boilerplate', section:'General', version:'2.2', status:'Approved', lastEditor:'ISSO', updated:'2026-02-03', usageCount:15, wordCount:1100, tags:['Cyber','CMMC','NIST','RMF'], preview:'Our cybersecurity posture aligns with NIST 800-171 Rev 2 and CMMC 2.0 Level 2 requirements. All systems operate within an Azure Government (GCC High) boundary...' },
    ];

    const CATEGORIES = ['All','Technical Volume','Management Volume','Past Performance','Pricing Volume','Boilerplate'];

    const ConnectionDot = ({ c }) => (
      <div style={{ display:'flex', alignItems:'center', gap:'6px', fontSize:'11px', color:c?'#00ff88':'#f59e0b' }}>
        <div style={{ width:'8px', height:'8px', borderRadius:'50%', background:c?'#00ff88':'#f59e0b', boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}` }} />{c?'LIVE':'DEMO'}
      </div>
    );

    const App = () => {
      const [connected, setConnected] = useState(false);
      const [templates, setTemplates] = useState(DEMO_TEMPLATES);
      const [filter, setFilter] = useState('All');
      const [search, setSearch] = useState('');
      const [expanded, setExpanded] = useState(null);
      const [statusFilter, setStatusFilter] = useState('All');

      useEffect(() => {
        if (!sbClient) return;
        (async () => {
          try {
            const { data, error } = await sbClient.from('proposal_sections').select('*');
            if (!error && data && data.length > 0) setConnected(true);
          } catch {}
        })();
      }, []);

      const filtered = useMemo(() => {
        return templates.filter(t => {
          if (filter !== 'All' && t.category !== filter) return false;
          if (statusFilter !== 'All' && t.status !== statusFilter) return false;
          if (search) {
            const q = search.toLowerCase();
            return t.name.toLowerCase().includes(q) || t.tags.some(tag => tag.toLowerCase().includes(q)) || t.preview.toLowerCase().includes(q);
          }
          return true;
        });
      }, [filter, search, statusFilter, templates]);

      const catColor = { 'Technical Volume':'#00E5FA', 'Management Volume':'#a78bfa', 'Past Performance':'#00ff88', 'Pricing Volume':'#f59e0b', 'Boilerplate':'#94a3b8' };

      return (
        <div style={{ padding:'24px 32px', maxWidth:'1400px' }}>
          {/* Header */}
          <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:'24px' }}>
            <div>
              <div style={{ fontSize:'10px', fontWeight:700, color:'rgba(0,229,250,0.5)', letterSpacing:'2px', textTransform:'uppercase', marginBottom:'4px' }}>PROPOSAL ASSETS</div>
              <h1 style={{ fontSize:'26px', fontWeight:800, color:'white', letterSpacing:'-0.5px', margin:0 }}>Templates Library</h1>
              <div style={{ fontSize:'12px', color:'#5a7a9a', marginTop:'4px' }}>{templates.length} templates • Version controlled • Reusable boilerplate</div>
            </div>
            <ConnectionDot c={connected} />
          </div>

          {/* Stats */}
          <div style={{ display:'flex', gap:'10px', flexWrap:'wrap', marginBottom:'20px' }}>
            {[
              { label:'Total Templates', value:templates.length, color:'#00E5FA' },
              { label:'Approved', value:templates.filter(t=>t.status==='Approved').length, color:'#00ff88' },
              { label:'Drafts', value:templates.filter(t=>t.status==='Draft').length, color:'#f59e0b' },
              { label:'Total Uses', value:templates.reduce((s,t)=>s+t.usageCount,0), color:'#a78bfa' },
              { label:'Word Bank', value:`${(templates.reduce((s,t)=>s+t.wordCount,0)/1000).toFixed(1)}K`, color:'#00E5FA' },
            ].map(s => (
              <div key={s.label} style={{ background:'rgba(10,22,40,0.7)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'10px', padding:'10px 16px', minWidth:'130px' }}>
                <div style={{ fontSize:'9px', fontWeight:700, color:'#5a7a9a', letterSpacing:'0.5px', textTransform:'uppercase' }}>{s.label}</div>
                <div style={{ fontSize:'22px', fontWeight:800, color:s.color, letterSpacing:'-0.5px' }}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Filters */}
          <div style={{ display:'flex', gap:'8px', flexWrap:'wrap', marginBottom:'16px', alignItems:'center' }}>
            <input type="text" placeholder="Search templates, tags…" value={search} onChange={e => setSearch(e.target.value)}
              style={{ background:'rgba(10,22,40,0.7)', border:'1px solid rgba(0,229,250,0.15)', borderRadius:'8px', padding:'7px 14px', fontSize:'12px', color:'#e2e8f0', outline:'none', width:'220px' }} />
            <div style={{ display:'flex', gap:'4px' }}>
              {['All','Approved','Draft'].map(s => (
                <button key={s} onClick={() => setStatusFilter(s)} style={{ padding:'5px 12px', fontSize:'11px', fontWeight:600, borderRadius:'6px', border:'none', cursor:'pointer', background:statusFilter===s?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)', color:statusFilter===s?'#00E5FA':'#5a7a9a' }}>{s}</button>
              ))}
            </div>
            <div style={{ display:'flex', gap:'4px', flexWrap:'wrap' }}>
              {CATEGORIES.map(c => (
                <button key={c} onClick={() => setFilter(c)} style={{ padding:'5px 10px', fontSize:'10px', fontWeight:600, borderRadius:'6px', border:'none', cursor:'pointer', whiteSpace:'nowrap', background:filter===c?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)', color:filter===c?'#00E5FA':'#5a7a9a' }}>{c}</button>
              ))}
            </div>
          </div>

          {/* Template Cards */}
          <div style={{ display:'flex', flexDirection:'column', gap:'8px' }}>
            {filtered.map(t => (
              <div key={t.id} style={{ background:'rgba(10,22,40,0.5)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'10px', overflow:'hidden', transition:'all 0.2s' }}
                onMouseOver={e => e.currentTarget.style.borderColor='rgba(0,229,250,0.2)'} onMouseOut={e => e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                <div onClick={() => setExpanded(expanded===t.id?null:t.id)} style={{ padding:'14px 18px', cursor:'pointer', display:'flex', alignItems:'center', gap:'14px' }}>
                  <div style={{ width:'4px', height:'36px', borderRadius:'2px', background:catColor[t.category]||'#5a7a9a', flexShrink:0 }} />
                  <div style={{ flex:1, minWidth:0 }}>
                    <div style={{ display:'flex', alignItems:'center', gap:'8px', flexWrap:'wrap' }}>
                      <span style={{ fontSize:'14px', fontWeight:700, color:'white' }}>{t.name}</span>
                      <span style={{ fontSize:'9px', fontWeight:600, padding:'1px 6px', borderRadius:'4px', background:t.status==='Approved'?'rgba(0,255,136,0.1)':'rgba(245,158,11,0.1)', color:t.status==='Approved'?'#00ff88':'#f59e0b' }}>{t.status}</span>
                      <span style={{ fontSize:'9px', fontWeight:600, padding:'1px 6px', borderRadius:'4px', background:'rgba(0,229,250,0.08)', color:'#00E5FA' }}>v{t.version}</span>
                    </div>
                    <div style={{ display:'flex', gap:'12px', marginTop:'4px', fontSize:'11px', color:'#5a7a9a' }}>
                      <span>{t.section}</span>
                      <span>{t.wordCount.toLocaleString()} words</span>
                      <span>Used {t.usageCount}×</span>
                      <span>Updated {t.updated}</span>
                      <span>by {t.lastEditor}</span>
                    </div>
                  </div>
                  <span style={{ color:'#5a7a9a', fontSize:'18px', transform:expanded===t.id?'rotate(180deg)':'rotate(0)', transition:'transform 0.2s' }}>▾</span>
                </div>
                {expanded === t.id && (
                  <div style={{ padding:'0 18px 16px 36px', borderTop:'1px solid rgba(0,229,250,0.06)' }}>
                    <div style={{ padding:'12px 0' }}>
                      <div style={{ fontSize:'10px', fontWeight:700, color:'#5a7a9a', marginBottom:'6px', textTransform:'uppercase' }}>Preview</div>
                      <div style={{ fontSize:'12px', color:'#94a3b8', lineHeight:'1.7', background:'rgba(0,0,0,0.2)', padding:'12px 14px', borderRadius:'8px', borderLeft:'3px solid '+catColor[t.category] }}>
                        {t.preview}
                      </div>
                      <div style={{ display:'flex', gap:'4px', marginTop:'10px', flexWrap:'wrap' }}>
                        {t.tags.map(tag => <span key={tag} style={{ fontSize:'9px', fontWeight:600, padding:'2px 6px', borderRadius:'4px', background:'rgba(167,139,250,0.08)', color:'#a78bfa' }}>{tag}</span>)}
                      </div>
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>

          <div style={{ marginTop:'10px', fontSize:'11px', color:'#3e4f63', textAlign:'right' }}>{filtered.length} of {templates.length} templates shown</div>

          {/* Footer */}
          <div style={{ textAlign:'center', padding:'20px 0', marginTop:'20px', borderTop:'1px solid rgba(0,229,250,0.06)', fontSize:'10px', color:'rgba(148,163,184,0.4)', lineHeight:'1.8' }}>
            ⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
