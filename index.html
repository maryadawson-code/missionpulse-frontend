<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MissionPulse | Federal Proposal Intelligence</title>
    <link rel="icon" type="image/png" href="MMT_icon_64px.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --mmt-cyan: #00E5FA; --mmt-navy: #00050F; --mmt-card: #0d1f3c; }
        * { font-family: 'Inter', sans-serif; margin: 0; padding: 0; box-sizing: border-box; }
        body { background: var(--mmt-navy); color: #e2e8f0; min-height: 100vh; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #0a1628; }
        ::-webkit-scrollbar-thumb { background: var(--mmt-cyan); border-radius: 3px; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .status-pulse { animation: pulse 2s infinite; }
        .spinner { animation: spin 1s linear infinite; }
        .fade-in { animation: fadeIn 0.3s ease-out; }
        .nav-item { transition: all 0.2s; }
        .nav-item:hover { background: rgba(0, 229, 250, 0.1); }
        .nav-item.active { background: rgba(0, 229, 250, 0.2); border-left: 3px solid var(--mmt-cyan); }
        .module-card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 229, 250, 0.15); }
        .glass { background: rgba(13, 31, 60, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(0, 229, 250, 0.15); }
        iframe { border: none; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONFIGURATION - PRODUCTION CREDENTIALS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const CONFIG = {
            SUPABASE_URL: 'https://qdrtpnpnhkxvfmvfziop.supabase.co',
            SUPABASE_ANON: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzY3MTcyNjUsImV4cCI6MjA1MjI5MzI2NX0.DACT1xnVtJeHx5tL7_K8y1hOx9NyJE7B6UBhPqwHHx8',
            API_URL: 'https://missionpulse-api.onrender.com',
            VERSION: '2.0.0'
        };
        
        const supabase = window.supabase.createClient(CONFIG.SUPABASE_URL, CONFIG.SUPABASE_ANON);

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // 11 SHIPLEY ROLES WITH RBAC
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const ROLES = {
            CEO: { name: 'CEO', icon: 'ğŸ‘‘', color: '#fbbf24', access: 'all' },
            COO: { name: 'COO', icon: 'ğŸ’¼', color: '#f97316', access: ['dashboard', 'pipeline', 'warroom', 'swimlane', 'rfpshredder', 'contracts', 'irondome', 'pricing', 'hitl', 'frenemy', 'launch', 'postaward', 'lessons', 'teaming'] },
            CAP: { name: 'Capture Manager', icon: 'ğŸ¯', color: '#f472b6', access: ['dashboard', 'pipeline', 'warroom', 'swimlane', 'blackhat', 'winthemes', 'frenemy', 'lessons'] },
            PM: { name: 'Proposal Manager', icon: 'ğŸ“‹', color: '#60a5fa', access: ['dashboard', 'pipeline', 'warroom', 'swimlane', 'rfpshredder', 'irondome', 'hitl', 'orals', 'launch', 'postaward', 'lessons'] },
            SA: { name: 'Solution Architect', icon: 'ğŸ’»', color: '#22d3ee', access: ['dashboard', 'rfpshredder', 'irondome', 'compliance', 'orals', 'lessons'] },
            FIN: { name: 'Pricing Manager', icon: 'ğŸ’°', color: '#34d399', access: ['dashboard', 'pricing', 'contracts', 'clauses', 'launch', 'lessons'] },
            CON: { name: 'Contracts Manager', icon: 'âš–ï¸', color: '#a78bfa', access: ['dashboard', 'contracts', 'clauses', 'compliance', 'hitl', 'lessons'] },
            DEL: { name: 'Delivery Manager', icon: 'ğŸ‘¥', color: '#fb7185', access: ['dashboard', 'teaming', 'pastperf', 'postaward', 'orals', 'lessons'] },
            QA: { name: 'QA Lead', icon: 'âœ…', color: '#2dd4bf', access: ['dashboard', 'hitl', 'compliance', 'rfpshredder', 'lessons'] },
            Partner: { name: 'Partner', icon: 'ğŸ¤', color: '#94a3b8', access: ['frenemy', 'teaming'], external: true },
            Admin: { name: 'System Admin', icon: 'âš™ï¸', color: '#cbd5e1', access: 'all' }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // COMPLETE MODULE REGISTRY - ALL V1 AND V2 MODULES
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const MODULE_REGISTRY = {
            command: {
                title: 'Command Center',
                icon: 'ğŸ¯',
                modules: [
                    { id: 'dashboard', name: 'Dashboard', icon: 'ğŸ“Š', file: null, embedded: true, status: 'production' },
                    { id: 'pipeline', name: 'Pipeline', icon: 'ğŸ”„', file: 'missionpulse-pipeline-v2.html', status: 'v2' },
                    { id: 'warroom', name: 'War Room', icon: 'âš”ï¸', file: 'missionpulse-warroom-v2.html', status: 'v2' },
                    { id: 'swimlane', name: 'Swimlane Board', icon: 'ğŸŠ', file: 'missionpulse-swimlane-v2.html', status: 'v2' },
                ]
            },
            capture: {
                title: 'Capture & Strategy',
                icon: 'ğŸª',
                modules: [
                    { id: 'rfpshredder', name: 'RFP Shredder', icon: 'ğŸ“„', file: 'missionpulse-rfpshredder-v2.html', status: 'v2' },
                    { id: 'winthemes', name: 'Win Themes', icon: 'ğŸ†', file: 'missionpulse-winthemes-v2.html', status: 'v2' },
                    { id: 'blackhat', name: 'Black Hat', icon: 'ğŸ©', file: 'missionpulse-blackhat-v2.html', status: 'v2', rbac: ['CEO', 'COO', 'CAP', 'Admin'] },
                    { id: 'frenemy', name: 'Frenemy Tracker', icon: 'ğŸ¤', file: 'missionpulse-frenemy-v2.html', status: 'v2' },
                ]
            },
            compliance: {
                title: 'Compliance & Contracts',
                icon: 'ğŸ›¡ï¸',
                modules: [
                    { id: 'irondome', name: 'Iron Dome', icon: 'ğŸ›¡ï¸', file: 'missionpulse-irondome-v2.html', status: 'v2' },
                    { id: 'contracts', name: 'Contract Scanner', icon: 'ğŸ“œ', file: 'missionpulse-m5-contracts-enhanced.html', status: 'v1' },
                    { id: 'clauses', name: 'Clause Library', icon: 'ğŸ“‹', file: 'missionpulse-clauses-v2.html', status: 'v2' },
                    { id: 'compliance', name: 'Compliance Matrix', icon: 'âœ…', file: 'missionpulse-compliance-v2.html', status: 'v2' },
                ]
            },
            pricing: {
                title: 'Pricing & Resources',
                icon: 'ğŸ’°',
                modules: [
                    { id: 'pricing', name: 'Pricing Engine', icon: 'ğŸ’µ', file: 'missionpulse-pricing-v2.html', status: 'v2', rbac: ['CEO', 'COO', 'CAP', 'FIN', 'Admin'], badge: 'CUI' },
                    { id: 'teaming', name: 'Teaming Partners', icon: 'ğŸ¤', file: 'missionpulse-teaming-v2.html', status: 'v2' },
                    { id: 'pastperf', name: 'Past Performance', icon: 'ğŸ“ˆ', file: 'missionpulse-pastperf-v2.html', status: 'v2' },
                ]
            },
            execution: {
                title: 'Proposal Execution',
                icon: 'âœï¸',
                modules: [
                    { id: 'orals', name: 'Orals Studio', icon: 'ğŸ¤', file: 'missionpulse-orals-v2.html', status: 'v2' },
                    { id: 'hitl', name: 'HITL Queue', icon: 'ğŸ‘ï¸', file: 'missionpulse-hitl-v2.html', status: 'v2' },
                    { id: 'launch', name: 'Launch & ROI', icon: 'ğŸš€', file: 'missionpulse-launchroi-v2.html', status: 'v2' },
                    { id: 'postaward', name: 'Post-Award', icon: 'ğŸ', file: 'missionpulse-postaward-v2.html', status: 'v2' },
                ]
            },
            intelligence: {
                title: 'Intelligence & AI',
                icon: 'ğŸ§ ',
                modules: [
                    { id: 'lessons', name: 'Lessons Learned', icon: 'ğŸ“š', file: 'missionpulse-lessons-v2.html', status: 'v2' },
                    { id: 'reports', name: 'Reports', icon: 'ğŸ“Š', file: 'missionpulse-reports-v2.html', status: 'v2' },
                    { id: 'agenthub', name: 'AI Agent Hub', icon: 'ğŸ¤–', file: 'missionpulse-agent-hub.html', status: 'production' },
                ]
            },
            admin: {
                title: 'Administration',
                icon: 'âš™ï¸',
                modules: [
                    { id: 'users', name: 'User Management', icon: 'ğŸ‘¥', file: 'admin-users.html', status: 'production', rbac: ['CEO', 'COO', 'Admin'] },
                    { id: 'audit', name: 'Audit Log', icon: 'ğŸ“', file: 'missionpulse-audit-v2.html', status: 'v2', rbac: ['CEO', 'COO', 'Admin'] },
                    { id: 'health', name: 'System Health', icon: 'ğŸ¥', file: 'missionpulse-health-check.html', status: 'production', rbac: ['CEO', 'Admin'] },
                ]
            }
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // ICONS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const Icons = {
            menu: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>,
            chevronDown: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
            chevronRight: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>,
            bell: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>,
            user: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
            logout: <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
            search: <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // CONNECTION STATUS
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const ConnectionStatus = ({ connected, stats }) => (
            <div className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-sm ${connected ? 'bg-emerald-500/20 text-emerald-400' : 'bg-red-500/20 text-red-400'}`}>
                <div className={`w-2 h-2 rounded-full ${connected ? 'bg-emerald-400' : 'bg-red-400'} status-pulse`}></div>
                <span>{connected ? 'Connected' : 'Offline'}</span>
                {connected && stats && (
                    <span className="text-white/50 text-xs ml-1">| {stats.opps} opps | ${(stats.pipeline/1000000).toFixed(0)}M</span>
                )}
            </div>
        );

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // SIDEBAR NAVIGATION
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const Sidebar = ({ collapsed, setCollapsed, currentModule, setCurrentModule, userRole }) => {
            const [expandedGroups, setExpandedGroups] = useState({ command: true, capture: true, compliance: true });
            
            const toggleGroup = (group) => setExpandedGroups(prev => ({ ...prev, [group]: !prev[group] }));

            const hasAccess = (module) => {
                if (!module.rbac) return true;
                if (ROLES[userRole]?.access === 'all') return true;
                return module.rbac.includes(userRole);
            };

            return (
                <div className={`${collapsed ? 'w-16' : 'w-64'} bg-[#0a1628] border-r border-white/10 flex flex-col transition-all duration-300 flex-shrink-0`}>
                    {/* Logo */}
                    <div className="h-16 p-4 border-b border-white/10 flex items-center justify-between">
                        {!collapsed && (
                            <div className="flex items-center gap-2">
                                <div className="w-8 h-8 bg-gradient-to-br from-[#00E5FA] to-[#0066FF] rounded-lg flex items-center justify-center text-lg">ğŸ›¡ï¸</div>
                                <span className="font-bold text-lg text-[#00E5FA]">MissionPulse</span>
                            </div>
                        )}
                        <button onClick={() => setCollapsed(!collapsed)} className="p-1.5 hover:bg-white/10 rounded">
                            {Icons.menu}
                        </button>
                    </div>

                    {/* Navigation */}
                    <nav className="flex-1 overflow-y-auto py-2">
                        {Object.entries(MODULE_REGISTRY).map(([groupKey, group]) => (
                            <div key={groupKey} className="mb-1">
                                {!collapsed && (
                                    <button 
                                        onClick={() => toggleGroup(groupKey)}
                                        className="w-full px-4 py-2 flex items-center justify-between text-white/50 hover:text-white text-xs font-semibold uppercase tracking-wider"
                                    >
                                        <span className="flex items-center gap-2">
                                            <span>{group.icon}</span>
                                            <span>{group.title}</span>
                                        </span>
                                        {expandedGroups[groupKey] ? Icons.chevronDown : Icons.chevronRight}
                                    </button>
                                )}
                                
                                {(collapsed || expandedGroups[groupKey]) && (
                                    <div className="space-y-0.5 px-2">
                                        {group.modules.filter(m => hasAccess(m)).map(module => (
                                            <button
                                                key={module.id}
                                                onClick={() => setCurrentModule(module)}
                                                className={`nav-item w-full px-3 py-2 rounded-lg flex items-center gap-3 text-left ${currentModule?.id === module.id ? 'active text-[#00E5FA]' : 'text-white/70 hover:text-white'}`}
                                            >
                                                <span className="text-lg">{module.icon}</span>
                                                {!collapsed && (
                                                    <>
                                                        <span className="flex-1 text-sm">{module.name}</span>
                                                        {module.badge && (
                                                            <span className={`text-[10px] px-1.5 py-0.5 rounded font-medium ${module.badge === 'CUI' ? 'bg-amber-500/20 text-amber-400' : 'bg-red-500/20 text-red-400'}`}>
                                                                {module.badge}
                                                            </span>
                                                        )}
                                                        <span className={`text-[10px] px-1.5 py-0.5 rounded ${module.status === 'v2' ? 'bg-[#00E5FA]/20 text-[#00E5FA]' : 'bg-emerald-500/20 text-emerald-400'}`}>
                                                            {module.status === 'v2' ? 'V2' : 'â—'}
                                                        </span>
                                                    </>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                )}
                            </div>
                        ))}
                    </nav>

                    {/* Footer */}
                    {!collapsed && (
                        <div className="p-4 border-t border-white/10">
                            <div className="text-xs text-white/30 text-center">
                                v{CONFIG.VERSION} | Â© 2026 MMT
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // HEADER
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const Header = ({ user, connected, stats, currentModule, onLogout }) => (
            <header className="h-16 bg-[#0a1628] border-b border-white/10 flex items-center justify-between px-6 flex-shrink-0">
                <div className="flex items-center gap-4">
                    {currentModule ? (
                        <div className="flex items-center gap-3">
                            <span className="text-2xl">{currentModule.icon}</span>
                            <div>
                                <h1 className="text-lg font-semibold">{currentModule.name}</h1>
                                <p className="text-xs text-white/50">Federal Proposal Intelligence</p>
                            </div>
                        </div>
                    ) : (
                        <h1 className="text-lg font-semibold">MissionPulse Command Center</h1>
                    )}
                </div>
                
                <div className="flex items-center gap-4">
                    <ConnectionStatus connected={connected} stats={stats} />
                    
                    <button className="p-2 hover:bg-white/10 rounded-lg relative">
                        {Icons.bell}
                        <span className="absolute -top-1 -right-1 w-4 h-4 bg-red-500 rounded-full text-[10px] flex items-center justify-center font-medium">3</span>
                    </button>
                    
                    <div className="flex items-center gap-3 pl-4 border-l border-white/10">
                        <div className="w-9 h-9 bg-gradient-to-br from-[#00E5FA]/30 to-[#0066FF]/30 rounded-full flex items-center justify-center text-[#00E5FA] border border-[#00E5FA]/30">
                            {Icons.user}
                        </div>
                        <div className="text-sm">
                            <div className="font-medium">{user?.name || 'Mary Womack'}</div>
                            <div className="text-white/50 text-xs flex items-center gap-1">
                                <span>{ROLES[user?.role]?.icon || 'ğŸ‘‘'}</span>
                                <span>{user?.role || 'CEO'}</span>
                            </div>
                        </div>
                        {onLogout && (
                            <button onClick={onLogout} className="p-2 hover:bg-white/10 rounded-lg text-white/50 hover:text-white" title="Logout">
                                {Icons.logout}
                            </button>
                        )}
                    </div>
                </div>
            </header>
        );

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MODULE LOADER (iframe)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const ModuleLoader = ({ module }) => {
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            if (!module.file) {
                return <DashboardHome />;
            }

            return (
                <div className="flex-1 relative bg-[#00050F]">
                    {loading && (
                        <div className="absolute inset-0 bg-[#00050F] flex items-center justify-center z-10">
                            <div className="text-center">
                                <div className="w-12 h-12 border-4 border-[#00E5FA]/20 border-t-[#00E5FA] rounded-full spinner mb-4 mx-auto"></div>
                                <div className="text-white/60">Loading {module.name}...</div>
                            </div>
                        </div>
                    )}
                    <iframe
                        src={module.file}
                        onLoad={() => setLoading(false)}
                        onError={() => { setLoading(false); setError(true); }}
                        title={module.name}
                        className="w-full h-full"
                    />
                    {error && (
                        <div className="absolute inset-0 bg-[#00050F] flex items-center justify-center">
                            <div className="text-center">
                                <div className="text-4xl mb-4">âš ï¸</div>
                                <div className="text-white/60 mb-4">Failed to load {module.name}</div>
                                <div className="text-sm text-white/40">File: {module.file}</div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // DASHBOARD HOME (embedded)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const DashboardHome = () => {
            const [opportunities, setOpportunities] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const loadData = async () => {
                    try {
                        const { data } = await supabase
                            .from('opportunities')
                            .select('*')
                            .order('proposal_due_date', { ascending: true })
                            .limit(10);
                        setOpportunities(data || []);
                    } catch (e) {
                        console.error('Load error:', e);
                    } finally {
                        setLoading(false);
                    }
                };
                loadData();
            }, []);

            const stats = useMemo(() => ({
                total: opportunities.length,
                pipeline: opportunities.reduce((sum, o) => sum + (parseFloat(o.contract_value) || 0), 0),
                active: opportunities.filter(o => !['Won', 'Lost'].includes(o.stage)).length,
                critical: opportunities.filter(o => {
                    const days = o.proposal_due_date ? Math.ceil((new Date(o.proposal_due_date) - new Date()) / (1000*60*60*24)) : 999;
                    return days <= 30 && days > 0;
                }).length
            }), [opportunities]);

            const formatCurrency = (val) => {
                const num = parseFloat(val) || 0;
                if (num >= 1000000) return `$${(num/1000000).toFixed(1)}M`;
                if (num >= 1000) return `$${(num/1000).toFixed(0)}K`;
                return `$${num.toFixed(0)}`;
            };

            const getDaysUntilDue = (date) => {
                if (!date) return null;
                return Math.ceil((new Date(date) - new Date()) / (1000*60*60*24));
            };

            return (
                <div className="flex-1 p-8 overflow-auto fade-in">
                    {/* Welcome Banner */}
                    <div className="bg-gradient-to-r from-[#00E5FA]/20 via-[#0066FF]/10 to-transparent rounded-2xl p-8 mb-8 border border-[#00E5FA]/20">
                        <div className="flex items-center justify-between">
                            <div>
                                <h1 className="text-3xl font-bold mb-2">Welcome back, Mary</h1>
                                <p className="text-white/60 text-lg">Your proposal command center is ready.</p>
                            </div>
                            <div className="text-right">
                                <div className="text-5xl font-bold text-[#00E5FA]">{formatCurrency(stats.pipeline)}</div>
                                <div className="text-white/50">Total Pipeline Value</div>
                            </div>
                        </div>
                    </div>

                    {/* Stats Grid */}
                    <div className="grid grid-cols-4 gap-6 mb-8">
                        <div className="bg-[#0d1f3c] rounded-xl p-6 border border-white/10">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-2xl">ğŸ“Š</span>
                                <span className="text-xs bg-white/10 px-2 py-1 rounded">Total</span>
                            </div>
                            <div className="text-3xl font-bold text-[#00E5FA]">{stats.total}</div>
                            <div className="text-white/50 text-sm mt-1">Opportunities</div>
                        </div>
                        <div className="bg-[#0d1f3c] rounded-xl p-6 border border-white/10">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-2xl">ğŸ¯</span>
                                <span className="text-xs bg-emerald-500/20 text-emerald-400 px-2 py-1 rounded">Active</span>
                            </div>
                            <div className="text-3xl font-bold text-emerald-400">{stats.active}</div>
                            <div className="text-white/50 text-sm mt-1">In Progress</div>
                        </div>
                        <div className="bg-[#0d1f3c] rounded-xl p-6 border border-white/10">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-2xl">âš¡</span>
                                <span className="text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded">Critical</span>
                            </div>
                            <div className="text-3xl font-bold text-red-400">{stats.critical}</div>
                            <div className="text-white/50 text-sm mt-1">Due in 30 days</div>
                        </div>
                        <div className="bg-[#0d1f3c] rounded-xl p-6 border border-white/10">
                            <div className="flex items-center justify-between mb-2">
                                <span className="text-2xl">ğŸ¤–</span>
                                <span className="text-xs bg-purple-500/20 text-purple-400 px-2 py-1 rounded">AI</span>
                            </div>
                            <div className="text-3xl font-bold text-purple-400">8</div>
                            <div className="text-white/50 text-sm mt-1">Active Agents</div>
                        </div>
                    </div>

                    {/* Recent Opportunities */}
                    <div className="bg-[#0d1f3c] rounded-xl border border-white/10 overflow-hidden mb-8">
                        <div className="p-4 border-b border-white/10 flex items-center justify-between">
                            <h2 className="font-semibold flex items-center gap-2">
                                <span>ğŸ“‹</span> Priority Opportunities
                            </h2>
                            <a href="#" className="text-sm text-[#00E5FA] hover:underline">View All â†’</a>
                        </div>
                        {loading ? (
                            <div className="p-8 text-center text-white/50">Loading...</div>
                        ) : (
                            <table className="w-full">
                                <thead className="bg-[#00050F]/50">
                                    <tr>
                                        <th className="text-left p-4 text-white/50 text-sm font-medium">Opportunity</th>
                                        <th className="text-left p-4 text-white/50 text-sm font-medium">Customer</th>
                                        <th className="text-center p-4 text-white/50 text-sm font-medium">Stage</th>
                                        <th className="text-right p-4 text-white/50 text-sm font-medium">Value</th>
                                        <th className="text-center p-4 text-white/50 text-sm font-medium">Due</th>
                                        <th className="text-center p-4 text-white/50 text-sm font-medium">pWin</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {opportunities.slice(0, 5).map(opp => {
                                        const days = getDaysUntilDue(opp.proposal_due_date);
                                        return (
                                            <tr key={opp.id} className="border-t border-white/5 hover:bg-white/5">
                                                <td className="p-4">
                                                    <div className="font-medium">{opp.title}</div>
                                                    <div className="text-xs text-white/40">{opp.solicitation_number || '-'}</div>
                                                </td>
                                                <td className="p-4 text-white/70">{opp.customer}</td>
                                                <td className="p-4 text-center">
                                                    <span className="px-2 py-1 rounded-full text-xs bg-white/10">{opp.stage}</span>
                                                </td>
                                                <td className="p-4 text-right font-medium text-[#00E5FA]">{formatCurrency(opp.contract_value)}</td>
                                                <td className="p-4 text-center">
                                                    <span className={`text-sm ${days !== null && days <= 14 ? 'text-red-400' : days !== null && days <= 30 ? 'text-amber-400' : 'text-white/60'}`}>
                                                        {days !== null ? (days <= 0 ? 'Overdue' : `${days}d`) : '-'}
                                                    </span>
                                                </td>
                                                <td className="p-4 text-center">
                                                    <span className={`font-medium ${opp.pwin >= 70 ? 'text-emerald-400' : opp.pwin >= 40 ? 'text-amber-400' : 'text-red-400'}`}>
                                                        {opp.pwin || 0}%
                                                    </span>
                                                </td>
                                            </tr>
                                        );
                                    })}
                                    {opportunities.length === 0 && (
                                        <tr><td colSpan="6" className="p-8 text-center text-white/50">No opportunities found</td></tr>
                                    )}
                                </tbody>
                            </table>
                        )}
                    </div>

                    {/* Quick Actions */}
                    <h2 className="font-semibold mb-4">Quick Actions</h2>
                    <div className="grid grid-cols-4 gap-4">
                        {[
                            { icon: 'ğŸ“„', name: 'RFP Shredder', desc: 'Extract requirements' },
                            { icon: 'ğŸ©', name: 'Black Hat', desc: 'Competitor analysis' },
                            { icon: 'ğŸ’µ', name: 'Pricing', desc: 'Build estimates' },
                            { icon: 'ğŸ¤–', name: 'AI Agents', desc: '8 specialized agents' },
                        ].map((action, i) => (
                            <div key={i} className="module-card bg-[#0d1f3c] rounded-xl p-4 border border-white/10 cursor-pointer transition-all hover:border-[#00E5FA]/30">
                                <div className="text-2xl mb-2">{action.icon}</div>
                                <div className="font-medium">{action.name}</div>
                                <div className="text-xs text-white/50">{action.desc}</div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // MAIN APP
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const App = () => {
            const [sidebarCollapsed, setSidebarCollapsed] = useState(false);
            const [currentModule, setCurrentModule] = useState(null);
            const [user, setUser] = useState({ name: 'Mary Womack', role: 'CEO', email: 'maryadawson@gmail.com' });
            const [connected, setConnected] = useState(false);
            const [stats, setStats] = useState(null);

            // Check connection
            useEffect(() => {
                const checkConnection = async () => {
                    try {
                        const { data, error } = await supabase
                            .from('opportunities')
                            .select('id, contract_value')
                            .limit(100);
                        
                        if (!error && data) {
                            const pipeline = data.reduce((sum, o) => sum + (parseFloat(o.contract_value) || 0), 0);
                            setStats({ opps: data.length, pipeline });
                            setConnected(true);
                        }
                    } catch (e) {
                        console.error('Connection failed:', e);
                        setConnected(false);
                    }
                };

                checkConnection();
                const interval = setInterval(checkConnection, 30000);
                return () => clearInterval(interval);
            }, []);

            const handleLogout = () => {
                window.location.href = 'login.html';
            };

            return (
                <div className="flex h-screen bg-[#00050F] overflow-hidden">
                    <Sidebar 
                        collapsed={sidebarCollapsed}
                        setCollapsed={setSidebarCollapsed}
                        currentModule={currentModule}
                        setCurrentModule={setCurrentModule}
                        userRole={user.role}
                    />
                    
                    <div className="flex-1 flex flex-col overflow-hidden">
                        <Header 
                            user={user}
                            connected={connected}
                            stats={stats}
                            currentModule={currentModule}
                            onLogout={handleLogout}
                        />
                        
                        {currentModule ? (
                            <ModuleLoader module={currentModule} />
                        ) : (
                            <DashboardHome />
                        )}
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
    
    <!-- Compliance Footer -->
    <div style="position: fixed; bottom: 0; left: 0; right: 0; background: rgba(0,5,15,0.95); border-top: 1px solid rgba(255,255,255,0.1); padding: 4px 16px; display: flex; justify-content: space-between; align-items: center; font-size: 10px; color: rgba(255,255,255,0.4); z-index: 9999;">
        <span>AI GENERATED - REQUIRES HUMAN REVIEW</span>
        <span>MissionPulse v2.0.0 | Â© 2026 Mission Meets Tech | CMMC 2.0 Compliant</span>
    </div>
</body>
</html>
