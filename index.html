<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse v12.0 - Production</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    .animate-fadeIn{animation:fadeIn 0.3s ease-out}
    .animate-pulse{animation:pulse 2s ease-in-out infinite}
    .glass{background:rgba(30,41,59,0.5);backdrop-filter:blur(8px);border:1px solid rgba(71,85,105,0.3);border-radius:12px}
    .hover-lift{transition:transform 0.2s,box-shadow 0.2s}
    .hover-lift:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,229,250,0.1)}
    .drag-over{background:rgba(0,229,250,0.1)!important;border-color:rgba(0,229,250,0.5)!important}
    ::-webkit-scrollbar{width:6px}
    ::-webkit-scrollbar-track{background:transparent}
    ::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}
    ::-webkit-scrollbar-thumb:hover{background:#475569}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef}=React;

// ============================================================
// ROLES (11 Shipley Roles)
// ============================================================
const ROLES=[
  {id:'CEO',name:'CEO',fullName:'Mary Womack',icon:'üëë',color:'#fbbf24',access:['dashboard','pipeline','warroom','swimlane','compliance','contracts','writer','blackhat','pricing','hitl','orals','frenemy','launch','post_award','playbook','admin','training','audit']},
  {id:'COO',name:'COO',fullName:'David Chen',icon:'üíº',color:'#f97316',access:['dashboard','pipeline','warroom','swimlane','compliance','contracts','writer','pricing','hitl','frenemy','launch','post_award','playbook','training']},
  {id:'CAP',name:'Capture',fullName:'Michael Torres',icon:'üéØ',color:'#f472b6',access:['dashboard','pipeline','warroom','swimlane','blackhat','frenemy','playbook']},
  {id:'PM',name:'Proposal Mgr',fullName:'Lisa Martinez',icon:'üìã',color:'#60a5fa',access:['dashboard','pipeline','warroom','swimlane','compliance','writer','hitl','orals','launch','post_award','playbook']},
  {id:'SA',name:'Solution Arch',fullName:'Sarah Chen',icon:'üíª',color:'#22d3ee',access:['dashboard','writer','compliance','contracts','orals','playbook']},
  {id:'FIN',name:'Pricing',fullName:'Jennifer Park',icon:'üí∞',color:'#34d399',access:['dashboard','pricing','contracts','launch','playbook']},
  {id:'CON',name:'Contracts',fullName:'Robert Williams',icon:'‚öñÔ∏è',color:'#a78bfa',access:['dashboard','compliance','contracts','hitl','playbook']},
  {id:'DEL',name:'Delivery',fullName:'Amanda Foster',icon:'üë•',color:'#fb7185',access:['dashboard','writer','post_award','orals','playbook']},
  {id:'QA',name:'QA Lead',fullName:'James Thompson',icon:'‚úÖ',color:'#2dd4bf',access:['dashboard','hitl','compliance','writer','playbook']},
  {id:'Partner',name:'Partner',fullName:'External',icon:'ü§ù',color:'#94a3b8',access:['frenemy','writer'],external:true},
  {id:'Admin',name:'Admin',fullName:'System Admin',icon:'‚öôÔ∏è',color:'#cbd5e1',access:['dashboard','pipeline','warroom','swimlane','compliance','contracts','writer','blackhat','pricing','hitl','orals','frenemy','launch','post_award','playbook','admin','training','audit']}
];

// ============================================================
// 18 MODULES
// ============================================================
const MODULES=[
  {id:'dashboard',name:'Mission Control',icon:'‚ö°',color:'#00E5FA',cat:'Command'},
  {id:'pipeline',name:'Pipeline Intel',icon:'üìä',color:'#22d3ee',cat:'Strategy'},
  {id:'warroom',name:'War Room',icon:'‚öîÔ∏è',color:'#f97316',cat:'Strategy'},
  {id:'swimlane',name:'Swimlane Board',icon:'üìã',color:'#8b5cf6',cat:'Strategy'},
  {id:'compliance',name:'RFP Shredder',icon:'üìÑ',color:'#ef4444',cat:'Intel'},
  {id:'contracts',name:'Contract Scanner',icon:'‚öñÔ∏è',color:'#a78bfa',cat:'Intel'},
  {id:'writer',name:'Iron Dome',icon:'‚úèÔ∏è',color:'#10b981',cat:'Intel'},
  {id:'blackhat',name:'Black Hat',icon:'üé≠',color:'#f59e0b',cat:'Intel',badge:'PRIVATE'},
  {id:'pricing',name:'Pricing Engine',icon:'üíµ',color:'#ec4899',cat:'Delivery',badge:'CUI'},
  {id:'hitl',name:'HITL Queue',icon:'üëÅÔ∏è',color:'#6366f1',cat:'Delivery'},
  {id:'orals',name:'Orals Studio',icon:'üé§',color:'#f472b6',cat:'Delivery'},
  {id:'frenemy',name:'Frenemy Protocol',icon:'üõ°Ô∏è',color:'#22d3ee',cat:'Delivery'},
  {id:'launch',name:'Launch & ROI',icon:'üöÄ',color:'#e879f9',cat:'Command'},
  {id:'post_award',name:'Post-Award',icon:'üì¶',color:'#a78bfa',cat:'Command'},
  {id:'playbook',name:'Playbook',icon:'‚≠ê',color:'#fbbf24',cat:'Admin'},
  {id:'admin',name:'Admin',icon:'‚öôÔ∏è',color:'#cbd5e1',cat:'Admin',badge:'ADMIN'},
  {id:'training',name:'Training Hub',icon:'üéì',color:'#10b981',cat:'Admin'},
  {id:'audit',name:'Audit Log',icon:'üìú',color:'#64748b',cat:'Admin',badge:'ADMIN'}
];

// ============================================================
// DEMO DATA
// ============================================================
const SHIPLEY_PHASES=['Qualify','Capture','Blue Team','Pink Team','Red Team','Gold Team','White Glove','Submit'];

const DEMO_OPPS=[
  {id:1,nickname:'DHA EHR Mod',title:'DHA MHS GENESIS Cloud Migration',agency:'DHA',ceiling:98450210,phase:'Pink Team',pWin:72,days:37,priority:'P-0',naics:'541512',setAside:'8(a)'},
  {id:2,nickname:'VA Claims AI',title:'VA Enterprise Cloud Hosting',agency:'VA',ceiling:45000000,phase:'Blue Team',pWin:58,days:82,priority:'P-1',naics:'541519',setAside:'SDVOSB'},
  {id:3,nickname:'CMS Analytics',title:'CMS Data Analytics Modernization',agency:'CMS',ceiling:125000000,phase:'Red Team',pWin:68,days:21,priority:'P-0',naics:'541512',setAside:'Full & Open'},
  {id:4,nickname:'IHS Telehealth',title:'IHS Telehealth Expansion',agency:'IHS',ceiling:32000000,phase:'Capture',pWin:55,days:156,priority:'P-1',naics:'541511',setAside:'ISBEE'},
  {id:5,nickname:'SSA Fraud ML',title:'SSA Fraud Detection ML Platform',agency:'SSA',ceiling:67500000,phase:'Gold Team',pWin:81,days:14,priority:'P-0',naics:'541512',setAside:'8(a)'},
  {id:6,nickname:'CDC Surveillance',title:'CDC Disease Surveillance System',agency:'CDC',ceiling:89000000,phase:'Qualify',pWin:42,days:120,priority:'P-2',naics:'541519',setAside:'Full & Open'}
];

const DEMO_TASKS=[
  {id:1,title:'Executive Summary',owner:'Lisa M.',phase:'Pink Team',section:'L.1'},
  {id:2,title:'Technical Approach',owner:'Sarah C.',phase:'Blue Team',section:'L.2'},
  {id:3,title:'Past Performance',owner:'Michael T.',phase:'Red Team',section:'L.3'},
  {id:4,title:'Price Volume',owner:'Jennifer P.',phase:'Gold Team',section:'M'},
  {id:5,title:'Oral Presentation',owner:'Mary W.',phase:'White Glove',section:'Orals'}
];

const DEMO_REQS=[
  {id:1,ref:'L.1.1',title:'Technical Approach',section:'L',status:'compliant',owner:'Sarah Chen',confidence:92},
  {id:2,ref:'L.1.2',title:'Management Approach',section:'L',status:'partial',owner:'Lisa Martinez',confidence:78},
  {id:3,ref:'L.2.1',title:'Past Performance',section:'L',status:'risk',owner:'Michael Torres',confidence:45},
  {id:4,ref:'M.1',title:'Price Proposal',section:'M',status:'compliant',owner:'Jennifer Park',confidence:88}
];

const DEMO_HITL=[
  {id:1,type:'Section Draft',title:'Technical Approach v2',agent:'Writer',confidence:78,status:'pending',created:'2h ago'},
  {id:2,type:'Compliance Check',title:'FAR 52.212-4 Analysis',agent:'Compliance',confidence:92,status:'pending',created:'4h ago'},
  {id:3,type:'Price Analysis',title:'LCAT Rate Validation',agent:'Pricing',confidence:65,status:'pending',created:'1d ago'},
  {id:4,type:'Win Theme',title:'Innovation Discriminator',agent:'Strategy',confidence:88,status:'approved',created:'2d ago'}
];

const DEMO_LCATS=[
  {id:1,title:'Program Manager',rate:185,hours:2080,wrap:1.85},
  {id:2,title:'Sr. Software Engineer',rate:165,hours:4160,wrap:1.85},
  {id:3,title:'Data Scientist',rate:155,hours:2080,wrap:1.85},
  {id:4,title:'Cloud Architect',rate:175,hours:1040,wrap:1.85},
  {id:5,title:'QA Analyst',rate:125,hours:2080,wrap:1.85}
];

const DEMO_AUDIT=[
  {id:1,action:'LOGIN',user:'Mary Womack',role:'CEO',ip:'192.168.1.100',ts:'2026-01-28 09:15:22'},
  {id:2,action:'VIEW_BLACKHAT',user:'Michael Torres',role:'Capture',ip:'192.168.1.105',ts:'2026-01-28 09:18:45'},
  {id:3,action:'EXPORT_PRICING',user:'Jennifer Park',role:'Pricing',ip:'192.168.1.110',ts:'2026-01-28 10:02:33'},
  {id:4,action:'APPROVE_SECTION',user:'Lisa Martinez',role:'PM',ip:'192.168.1.108',ts:'2026-01-28 10:45:12'}
];

const DEMO_PLAYBOOK=[
  {id:1,title:'Executive Summary - DHA Win',category:'Writing',score:95,uses:47},
  {id:2,title:'Technical Innovation Theme',category:'Strategy',score:92,uses:38},
  {id:3,title:'Past Performance Narrative',category:'Writing',score:88,uses:52}
];

const ORALS_SLIDES=['Opening Impact','Company Overview','Understanding the Mission','Technical Approach','Innovation & Technology','Management Plan','Past Performance','Key Personnel','Risk Mitigation','Closing & Q&A'];

const DEMO_COMPETITORS=[
  {id:1,name:'Booz Allen Hamilton',threat:'high',strengths:['Incumbent','Deep bench'],weaknesses:['Expensive','Slow'],ghostStrategy:'Emphasize agility and cost efficiency'},
  {id:2,name:'Deloitte',threat:'medium',strengths:['Brand recognition','Healthcare expertise'],weaknesses:['Bureaucratic','High turnover'],ghostStrategy:'Highlight continuity and dedicated teams'},
  {id:3,name:'GDIT',threat:'high',strengths:['Technical depth','Clearances'],weaknesses:['Integration issues','Communication'],ghostStrategy:'Focus on seamless delivery and transparency'}
];

const DEMO_PARTNERS=[
  {id:1,name:'CloudFirst Solutions',status:'Active',capabilities:['AWS','Azure','GCP'],trustScore:92,assigned:['DHA EHR Mod','VA Claims AI'],socio:'SDVOSB'},
  {id:2,name:'DataSecure Inc',status:'Active',capabilities:['Cybersecurity','FedRAMP','CMMC'],trustScore:88,assigned:['CMS Analytics'],socio:'8(a)'},
  {id:3,name:'HealthTech Partners',status:'Pending',capabilities:['EHR','Telehealth','HL7'],trustScore:75,assigned:[],socio:'WOSB'}
];

const DEMO_CONTRACTS=[
  {id:1,vehicle:'GSA MAS',type:'IDIQ',risk:'low',clauses:12,findings:0,expiry:'2028-09-30'},
  {id:2,vehicle:'CIO-SP3',type:'GWAC',risk:'medium',clauses:28,findings:2,expiry:'2027-05-15'},
  {id:3,vehicle:'SEWP V',type:'GWAC',risk:'low',clauses:15,findings:0,expiry:'2029-04-30'},
  {id:4,vehicle:'VA T4NG',type:'BPA',risk:'high',clauses:34,findings:5,expiry:'2026-12-31'}
];

const DEMO_SUBMISSIONS=[
  {id:1,name:'DHA MHS GENESIS Phase 2',status:'Won',value:45000000,submitted:'2025-11-15',result:'2026-01-10',roi:847},
  {id:2,name:'VA Claims Modernization',status:'Pending',value:67000000,submitted:'2026-01-05',result:null,roi:null},
  {id:3,name:'CMS Quality Platform',status:'Lost',value:23000000,submitted:'2025-09-20',result:'2025-12-01',roi:-125},
  {id:4,name:'IHS Patient Portal',status:'Won',value:18500000,submitted:'2025-08-01',result:'2025-10-15',roi:523}
];

// HELPERS
const fmt=v=>v>=1e9?`$${(v/1e9).toFixed(1)}B`:v>=1e6?`$${(v/1e6).toFixed(1)}M`:`$${(v||0).toLocaleString()}`;
const checkAuth=()=>{const s=localStorage.getItem('MP_SESSION'),u=localStorage.getItem('MP_USER');if(!s||!u){window.location.href='login.html';return null}try{return JSON.parse(u)}catch{return{email:'demo@mmt.com',name:'Demo User'}}};
const handleLogout=()=>{localStorage.clear();window.location.href='login.html'};

// ICON COMPONENT
const Icon=({name,className='w-5 h-5'})=>{
  const icons={
    chevronLeft:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 19l-7-7 7-7"/></svg>,
    chevronRight:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>,
    chevronDown:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7"/></svg>,
    x:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>,
    check:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>,
    upload:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>,
    download:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
    send:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>,
    logout:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>,
    plus:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>,
    edit:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>,
    trash:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>,
    search:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>,
    filter:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>,
    alert:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>,
    external:<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>,
  };
  return icons[name]||<span className={className}>‚óè</span>;
};

// ============================================================
// MODULE: DASHBOARD (Mission Control)
// ============================================================
function ModuleDashboard({opps,tokenUsage}){
  const total=opps.reduce((s,o)=>s+(o.ceiling||0),0);
  const avgPwin=Math.round(opps.reduce((s,o)=>s+(o.pWin||0),0)/opps.length);
  const dueThisWeek=opps.filter(o=>o.days<=7).length;
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="glass p-6 bg-gradient-to-r from-cyan-500/10 to-teal-500/10">
        <div className="flex justify-between items-center">
          <div><h2 className="text-2xl font-bold text-white">Mission Control</h2><p className="text-slate-400">AI-Powered Proposal Command Center</p><p className="text-cyan-400 text-sm mt-1">Mission. Technology. Transformation.</p></div>
          <div className="text-6xl">üéØ</div>
        </div>
      </div>
      <div className="grid grid-cols-4 gap-4">
        {[{l:'Pipeline Value',v:fmt(total),c:'text-emerald-400'},{l:'Active Pursuits',v:opps.length,c:'text-cyan-400'},{l:'Avg Win Prob',v:`${avgPwin}%`,c:'text-amber-400'},{l:'Due This Week',v:dueThisWeek,c:'text-red-400'}].map((s,i)=><div key={i} className="glass p-4 hover-lift"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>
      <div className="glass overflow-hidden">
        <div className="p-4 border-b border-slate-700/50"><h3 className="font-semibold text-white">Active Pipeline</h3></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Opportunity','Agency','Value','Phase','pWin','Days'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{opps.map(o=><tr key={o.id} className="hover:bg-slate-800/30"><td className="p-3"><div className="font-medium text-white text-sm">{o.nickname}</div><div className="text-xs text-slate-500">{o.title}</div></td><td className="p-3 text-sm text-slate-300">{o.agency}</td><td className="p-3 text-sm text-emerald-400 font-medium">{fmt(o.ceiling)}</td><td className="p-3"><span className="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400">{o.phase}</span></td><td className="p-3"><div className="flex items-center gap-2"><div className="w-16 h-1.5 bg-slate-700 rounded-full"><div className="h-full bg-gradient-to-r from-cyan-500 to-emerald-500 rounded-full" style={{width:`${o.pWin}%`}}/></div><span className="text-xs text-slate-300">{o.pWin}%</span></div></td><td className="p-3"><span className={`text-sm ${o.days<=7?'text-red-400 font-bold':o.days<=30?'text-amber-400':'text-slate-400'}`}>{o.days}d</span></td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: PIPELINE INTEL (M1)
// ============================================================
function ModulePipeline({opps}){
  const[search,setSearch]=useState('');
  const[filterPhase,setFilterPhase]=useState('All');
  const[sortBy,setSortBy]=useState('days');
  const phases=['All',...SHIPLEY_PHASES];
  
  const filtered=opps.filter(o=>{
    const matchSearch=o.nickname.toLowerCase().includes(search.toLowerCase())||o.agency.toLowerCase().includes(search.toLowerCase());
    const matchPhase=filterPhase==='All'||o.phase===filterPhase;
    return matchSearch&&matchPhase;
  }).sort((a,b)=>{
    if(sortBy==='days')return a.days-b.days;
    if(sortBy==='pWin')return b.pWin-a.pWin;
    if(sortBy==='value')return b.ceiling-a.ceiling;
    return 0;
  });
  
  const total=filtered.reduce((s,o)=>s+(o.ceiling||0),0);
  const avgPwin=filtered.length?Math.round(filtered.reduce((s,o)=>s+(o.pWin||0),0)/filtered.length):0;
  
  const exportCSV=()=>{
    const csv='Nickname,Title,Agency,Value,Phase,pWin,Days,NAICS,Set-Aside\n'+filtered.map(o=>`"${o.nickname}","${o.title}",${o.agency},${o.ceiling},${o.phase},${o.pWin},${o.days},${o.naics||''},${o.setAside||''}`).join('\n');
    const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='pipeline_export.csv';a.click();
  };

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Pipeline Intelligence</h2><p className="text-slate-400 text-sm">Track and analyze all opportunities</p></div>
        <button onClick={exportCSV} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="download" className="w-4 h-4"/>Export CSV</button>
      </div>
      
      <div className="grid grid-cols-4 gap-4">
        {[{l:'Total Pipeline',v:fmt(total),c:'text-emerald-400'},{l:'Opportunities',v:filtered.length,c:'text-cyan-400'},{l:'Avg pWin',v:`${avgPwin}%`,c:'text-amber-400'},{l:'Due <30 Days',v:filtered.filter(o=>o.days<30).length,c:'text-red-400'}].map((s,i)=><div key={i} className="glass p-4"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>
      
      <div className="glass p-4 flex gap-4 items-center">
        <div className="flex-1 relative">
          <Icon name="search" className="w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"/>
          <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search opportunities..." className="w-full bg-slate-800 border border-slate-700 rounded-lg pl-10 pr-4 py-2 text-sm text-white focus:outline-none focus:border-cyan-500"/>
        </div>
        <select value={filterPhase} onChange={e=>setFilterPhase(e.target.value)} className="bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white">
          {phases.map(p=><option key={p} value={p}>{p}</option>)}
        </select>
        <select value={sortBy} onChange={e=>setSortBy(e.target.value)} className="bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white">
          <option value="days">Sort: Due Date</option>
          <option value="pWin">Sort: Win Prob</option>
          <option value="value">Sort: Value</option>
        </select>
      </div>
      
      <div className="glass overflow-hidden">
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Opportunity','Agency','Value','Phase','pWin','Days','Set-Aside'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{filtered.map(o=>(
          <tr key={o.id} className="hover:bg-slate-800/30 cursor-pointer">
            <td className="p-3"><div className="font-medium text-white text-sm">{o.nickname}</div><div className="text-xs text-slate-500 truncate max-w-[200px]">{o.title}</div></td>
            <td className="p-3"><span className="px-2 py-1 bg-slate-700 rounded text-xs text-white">{o.agency}</span></td>
            <td className="p-3 text-sm text-emerald-400 font-medium">{fmt(o.ceiling)}</td>
            <td className="p-3"><span className="px-2 py-1 rounded text-xs bg-cyan-500/20 text-cyan-400">{o.phase}</span></td>
            <td className="p-3"><div className="flex items-center gap-2"><div className="w-16 h-1.5 bg-slate-700 rounded-full"><div className={`h-full rounded-full ${o.pWin>=70?'bg-emerald-500':o.pWin>=50?'bg-amber-500':'bg-red-500'}`} style={{width:`${o.pWin}%`}}/></div><span className="text-xs text-slate-300">{o.pWin}%</span></div></td>
            <td className="p-3"><span className={`text-sm font-medium ${o.days<=7?'text-red-400':o.days<=30?'text-amber-400':'text-slate-300'}`}>{o.days}d</span></td>
            <td className="p-3"><span className="px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs">{o.setAside}</span></td>
          </tr>
        ))}</tbody></table>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: WAR ROOM (M2)
// ============================================================
function ModuleWarRoom({opps}){
  const[selected,setSelected]=useState(opps.find(o=>o.priority==='P-0')||opps[0]);
  const priorityOpps=opps.filter(o=>o.priority==='P-0').sort((a,b)=>a.days-b.days);
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">War Room</h2><p className="text-slate-400 text-sm">Mission-critical opportunity focus</p></div>
        <span className="px-3 py-1 bg-red-500/20 text-red-400 rounded-lg text-sm font-bold animate-pulse">üî¥ LIVE</span>
      </div>
      
      <div className="grid grid-cols-3 gap-4">
        <div className="col-span-2">
          <div className="glass p-6 bg-gradient-to-br from-orange-500/10 to-red-500/10 border-orange-500/30">
            <div className="flex justify-between items-start mb-4">
              <div>
                <span className="px-2 py-1 bg-red-500 text-white rounded text-xs font-bold mb-2 inline-block">{selected.priority}</span>
                <h3 className="text-2xl font-bold text-white">{selected.nickname}</h3>
                <p className="text-slate-400">{selected.title}</p>
              </div>
              <div className="text-right">
                <div className="text-3xl font-bold text-emerald-400">{fmt(selected.ceiling)}</div>
                <div className="text-sm text-slate-400">Contract Value</div>
              </div>
            </div>
            
            <div className="grid grid-cols-4 gap-4 mt-6">
              <div className="bg-slate-800/50 p-3 rounded-lg"><p className="text-xs text-slate-400">Agency</p><p className="text-lg font-bold text-white">{selected.agency}</p></div>
              <div className="bg-slate-800/50 p-3 rounded-lg"><p className="text-xs text-slate-400">Phase</p><p className="text-lg font-bold text-cyan-400">{selected.phase}</p></div>
              <div className="bg-slate-800/50 p-3 rounded-lg"><p className="text-xs text-slate-400">Win Prob</p><p className="text-lg font-bold text-amber-400">{selected.pWin}%</p></div>
              <div className="bg-slate-800/50 p-3 rounded-lg"><p className="text-xs text-slate-400">Days Left</p><p className={`text-lg font-bold ${selected.days<=7?'text-red-400':selected.days<=30?'text-amber-400':'text-emerald-400'}`}>{selected.days}</p></div>
            </div>
            
            <div className="mt-6">
              <h4 className="text-sm font-semibold text-white mb-3">Shipley Progress</h4>
              <div className="flex gap-1">
                {SHIPLEY_PHASES.map((phase,i)=>{
                  const isActive=selected.phase===phase;
                  const isPast=SHIPLEY_PHASES.indexOf(selected.phase)>i;
                  return <div key={phase} className={`flex-1 h-2 rounded ${isActive?'bg-cyan-500':isPast?'bg-emerald-500':'bg-slate-700'}`} title={phase}/>;
                })}
              </div>
              <div className="flex justify-between mt-2 text-xs text-slate-500">
                <span>Qualify</span><span>Submit</span>
              </div>
            </div>
          </div>
        </div>
        
        <div>
          <div className="glass p-4">
            <h4 className="font-semibold text-white mb-3">Priority Queue</h4>
            <div className="space-y-2">
              {priorityOpps.map(o=>(
                <button key={o.id} onClick={()=>setSelected(o)} className={`w-full text-left p-3 rounded-lg transition ${selected.id===o.id?'bg-cyan-500/20 border border-cyan-500/30':'bg-slate-800/50 hover:bg-slate-700/50'}`}>
                  <div className="flex justify-between items-center">
                    <span className="font-medium text-white text-sm">{o.nickname}</span>
                    <span className={`text-xs font-bold ${o.days<=7?'text-red-400':o.days<=30?'text-amber-400':'text-slate-400'}`}>{o.days}d</span>
                  </div>
                  <div className="text-xs text-slate-400 mt-1">{o.agency} ‚Ä¢ {o.phase}</div>
                </button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: SWIMLANE KANBAN (M3)
// ============================================================
function ModuleSwimlane(){
  const[tasks,setTasks]=useState(DEMO_TASKS);
  const[dragging,setDragging]=useState(null);
  const phaseColors={'Qualify':'#64748b','Capture':'#8b5cf6','Blue Team':'#3b82f6','Pink Team':'#ec4899','Red Team':'#ef4444','Gold Team':'#f59e0b','White Glove':'#10b981','Submit':'#22d3ee'};

  const handleDragStart=(e,task)=>{setDragging(task);e.dataTransfer.effectAllowed='move'};
  const handleDragOver=(e)=>{e.preventDefault();e.currentTarget.classList.add('drag-over')};
  const handleDragLeave=(e)=>{e.currentTarget.classList.remove('drag-over')};
  const handleDrop=(e,phase)=>{e.preventDefault();e.currentTarget.classList.remove('drag-over');if(dragging){setTasks(tasks.map(t=>t.id===dragging.id?{...t,phase}:t));setDragging(null)}};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-xl font-bold text-white">Swimlane Board</h2><p className="text-slate-400 text-sm">Drag tasks through Shipley gate phases</p></div><button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add Task</button></div>
      <div className="flex gap-3 overflow-x-auto pb-4">
        {SHIPLEY_PHASES.map(phase=>(
          <div key={phase} className="flex-shrink-0 w-56" onDragOver={handleDragOver} onDragLeave={handleDragLeave} onDrop={(e)=>handleDrop(e,phase)}>
            <div className="flex items-center gap-2 mb-3 px-2"><div className="w-3 h-3 rounded-full" style={{backgroundColor:phaseColors[phase]}}/><span className="text-sm font-semibold text-white">{phase}</span><span className="text-xs text-slate-500 ml-auto">{tasks.filter(t=>t.phase===phase).length}</span></div>
            <div className="space-y-2 min-h-[300px] p-2 rounded-lg bg-slate-800/30 border border-slate-700/50">
              {tasks.filter(t=>t.phase===phase).map(task=>(
                <div key={task.id} draggable onDragStart={e=>handleDragStart(e,task)} className="glass p-3 cursor-move hover:border-cyan-500/50 transition">
                  <div className="font-medium text-white text-sm mb-1">{task.title}</div>
                  <div className="flex justify-between text-xs"><span className="text-slate-400">{task.owner}</span><span className="text-cyan-400">{task.section}</span></div>
                </div>
              ))}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ============================================================
// MODULE: RFP SHREDDER / COMPLIANCE (M4)
// ============================================================
function ModuleCompliance(){
  const[requirements,setRequirements]=useState(DEMO_REQS);
  const[uploading,setUploading]=useState(false);
  const[extracting,setExtracting]=useState(false);
  const[progress,setProgress]=useState(0);
  const fileRef=useRef();

  const handleUpload=(e)=>{
    const f=e.target?.files?.[0];if(!f)return;
    setUploading(true);setProgress(0);
    const interval=setInterval(()=>{setProgress(p=>{if(p>=100){clearInterval(interval);setUploading(false);setExtracting(true);setTimeout(()=>{setExtracting(false);setRequirements(prev=>[...prev,{id:5,ref:'L.3.1',title:'Transition Plan (AI Extracted)',section:'L',status:'draft',owner:'Unassigned',confidence:75},{id:6,ref:'M.2',title:'Cost Breakdown (AI Extracted)',section:'M',status:'draft',owner:'Unassigned',confidence:82}])},2000);return 100}return p+10})},200);
  };

  const exportMatrix=()=>{const csv='Ref,Title,Section,Status,Owner,Confidence\n'+requirements.map(r=>`${r.ref},${r.title},${r.section},${r.status},${r.owner},${r.confidence}`).join('\n');const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='compliance_matrix.csv';a.click()};

  const statusColors={compliant:'bg-emerald-500/20 text-emerald-400',partial:'bg-amber-500/20 text-amber-400',risk:'bg-red-500/20 text-red-400',draft:'bg-slate-500/20 text-slate-400'};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-xl font-bold text-white">RFP Shredder</h2><p className="text-slate-400 text-sm">Upload RFP to auto-extract requirements</p></div>
        <div className="flex gap-2"><button onClick={()=>fileRef.current?.click()} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="upload" className="w-4 h-4"/>Upload RFP</button><button onClick={exportMatrix} className="px-4 py-2 bg-slate-700 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="download" className="w-4 h-4"/>Export CSV</button></div>
        <input ref={fileRef} type="file" accept=".pdf,.docx" className="hidden" onChange={handleUpload}/>
      </div>

      {(uploading||extracting)&&<div className="glass p-6 text-center">{uploading?<><div className="w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"/><p className="text-white">Uploading RFP... {progress}%</p><div className="w-full max-w-xs mx-auto h-2 bg-slate-700 rounded-full mt-4 overflow-hidden"><div className="h-full bg-gradient-to-r from-cyan-500 to-teal-500 transition-all" style={{width:`${progress}%`}}/></div></>:
      <><div className="text-4xl mb-4">üîç</div><p className="text-white">AI Extracting Requirements...</p><p className="text-cyan-400 text-sm mt-2">Analyzing Sections L & M</p></>}</div>}

      <div className="glass overflow-hidden">
        <div className="p-4 border-b border-slate-700/50 flex justify-between items-center"><h3 className="font-semibold text-white">Compliance Matrix</h3>
          <div className="flex gap-2">{[{k:'compliant',l:'Compliant'},{k:'partial',l:'Partial'},{k:'risk',l:'Risk'}].map(s=><span key={s.k} className={`px-2 py-1 rounded text-xs ${statusColors[s.k]}`}>{requirements.filter(r=>r.status===s.k).length} {s.l}</span>)}</div>
        </div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Ref','Requirement','Section','Status','Owner','AI Conf'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{requirements.map(r=><tr key={r.id} className="hover:bg-slate-800/30"><td className="p-3 text-sm font-mono text-cyan-400">{r.ref}</td><td className="p-3 text-sm text-white">{r.title}</td><td className="p-3 text-sm text-slate-300">{r.section}</td><td className="p-3"><span className={`px-2 py-1 rounded text-xs ${statusColors[r.status]}`}>{r.status}</span></td><td className="p-3 text-sm text-slate-300">{r.owner}</td><td className="p-3"><div className="flex items-center gap-2"><div className="w-12 h-1.5 bg-slate-700 rounded-full"><div className={`h-full rounded-full ${r.confidence>=85?'bg-emerald-500':r.confidence>=70?'bg-amber-500':'bg-red-500'}`} style={{width:`${r.confidence}%`}}/></div><span className="text-xs text-slate-400">{r.confidence}%</span></div></td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: CONTRACT SCANNER (M5)
// ============================================================
function ModuleContracts(){
  const[contracts]=useState(DEMO_CONTRACTS);
  const[selected,setSelected]=useState(null);
  const riskColors={low:'bg-emerald-500/20 text-emerald-400',medium:'bg-amber-500/20 text-amber-400',high:'bg-red-500/20 text-red-400'};
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Contract Scanner</h2><p className="text-slate-400 text-sm">Vehicle analysis and clause risk assessment</p></div>
        <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="upload" className="w-4 h-4"/>Import Contract</button>
      </div>
      
      <div className="grid grid-cols-4 gap-4">
        {[{l:'Active Vehicles',v:contracts.length,c:'text-cyan-400'},{l:'Low Risk',v:contracts.filter(c=>c.risk==='low').length,c:'text-emerald-400'},{l:'Total Findings',v:contracts.reduce((s,c)=>s+c.findings,0),c:'text-amber-400'},{l:'Expiring Soon',v:contracts.filter(c=>new Date(c.expiry)<new Date('2027-01-01')).length,c:'text-red-400'}].map((s,i)=><div key={i} className="glass p-4"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>
      
      <div className="glass overflow-hidden">
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Vehicle','Type','Risk Level','Clauses','Findings','Expiry'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{contracts.map(c=>(
          <tr key={c.id} className="hover:bg-slate-800/30 cursor-pointer" onClick={()=>setSelected(c)}>
            <td className="p-3 text-sm font-medium text-white">{c.vehicle}</td>
            <td className="p-3"><span className="px-2 py-1 bg-slate-700 rounded text-xs text-white">{c.type}</span></td>
            <td className="p-3"><span className={`px-2 py-1 rounded text-xs font-medium ${riskColors[c.risk]}`}>{c.risk.toUpperCase()}</span></td>
            <td className="p-3 text-sm text-slate-300">{c.clauses}</td>
            <td className="p-3"><span className={`text-sm font-medium ${c.findings>0?'text-amber-400':'text-emerald-400'}`}>{c.findings}</span></td>
            <td className="p-3 text-sm text-slate-400">{c.expiry}</td>
          </tr>
        ))}</tbody></table>
      </div>
      
      {selected&&<div className="glass p-4 border-l-4 border-cyan-500">
        <div className="flex justify-between items-center mb-4">
          <h4 className="font-semibold text-white">{selected.vehicle} - Clause Analysis</h4>
          <button onClick={()=>setSelected(null)} className="text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5"/></button>
        </div>
        <div className="space-y-2 text-sm">
          <p className="text-slate-300">‚Ä¢ FAR 52.212-4: Commercial Terms ‚úì</p>
          <p className="text-slate-300">‚Ä¢ FAR 52.219-14: Limitations on Subcontracting ‚úì</p>
          {selected.findings>0&&<p className="text-amber-400">‚Ä¢ ‚ö†Ô∏è {selected.findings} clause(s) require legal review</p>}
          <p className="text-slate-400 mt-4">Contract expires: {selected.expiry}</p>
        </div>
      </div>}
    </div>
  );
}

// ============================================================
// MODULE: IRON DOME / WRITER (M6)
// ============================================================
function ModuleWriter(){
  const[prompt,setPrompt]=useState('');
  const[output,setOutput]=useState('');
  const[generating,setGenerating]=useState(false);
  const[sectionType,setSectionType]=useState('executive');
  
  const sections=[
    {id:'executive',name:'Executive Summary',icon:'üìã'},
    {id:'technical',name:'Technical Approach',icon:'üíª'},
    {id:'management',name:'Management Plan',icon:'üë•'},
    {id:'past_perf',name:'Past Performance',icon:'üìà'},
    {id:'staffing',name:'Staffing Plan',icon:'üßë‚Äçüíº'}
  ];
  
  const generate=()=>{
    if(!prompt.trim())return;
    setGenerating(true);
    setTimeout(()=>{
      setOutput(`**AI-Generated ${sections.find(s=>s.id===sectionType)?.name}**\n\nBased on your prompt: "${prompt}"\n\nMission Meets Tech brings unparalleled expertise in healthcare IT modernization to this critical initiative. Our team of cleared professionals has successfully delivered over 47 similar programs across DHA, VA, and CMS environments.\n\n**Key Differentiators:**\n‚Ä¢ Proven track record of 98% on-time delivery\n‚Ä¢ Deep bench of 150+ healthcare IT specialists\n‚Ä¢ Proprietary AI-assisted compliance monitoring\n‚Ä¢ FedRAMP High authorized infrastructure\n\n**Technical Approach:**\nOur solution leverages cutting-edge cloud-native architecture combined with proven interoperability frameworks to ensure seamless integration with existing agency systems.\n\n---\n‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW`);
      setGenerating(false);
    },2000);
  };
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Iron Dome Drafter</h2><p className="text-slate-400 text-sm">CUI-aware AI content generation</p></div>
        <span className="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-bold">CUI PROTECTED</span>
      </div>
      
      <div className="grid grid-cols-5 gap-2">
        {sections.map(s=>(
          <button key={s.id} onClick={()=>setSectionType(s.id)} className={`p-3 rounded-lg text-center transition ${sectionType===s.id?'bg-cyan-500/20 border border-cyan-500/30':'glass hover:bg-slate-700/50'}`}>
            <div className="text-2xl mb-1">{s.icon}</div>
            <div className="text-xs text-white">{s.name}</div>
          </button>
        ))}
      </div>
      
      <div className="glass p-4">
        <label className="text-sm text-slate-400 mb-2 block">Content Prompt</label>
        <textarea value={prompt} onChange={e=>setPrompt(e.target.value)} rows={3} placeholder="Describe what you need... e.g., 'Write an executive summary for a VA telehealth modernization proposal emphasizing our SDVOSB status and past performance with MHS GENESIS'" className="w-full bg-slate-800 border border-slate-700 rounded-lg p-3 text-white text-sm focus:outline-none focus:border-cyan-500 resize-none"/>
        <div className="flex justify-end mt-3">
          <button onClick={generate} disabled={generating||!prompt.trim()} className="px-4 py-2 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-lg text-sm font-medium disabled:opacity-50 flex items-center gap-2">
            {generating?<><div className="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"/>Generating...</>:<>‚ú® Generate Content</>}
          </button>
        </div>
      </div>
      
      {output&&<div className="glass p-4">
        <div className="flex justify-between items-center mb-3">
          <h4 className="font-semibold text-white">Generated Content</h4>
          <div className="flex gap-2">
            <button className="px-3 py-1 bg-slate-700 text-white rounded text-sm">Copy</button>
            <button className="px-3 py-1 bg-cyan-500 text-white rounded text-sm">Send to HITL</button>
          </div>
        </div>
        <div className="bg-slate-800/50 rounded-lg p-4 text-sm text-slate-300 whitespace-pre-wrap">{output}</div>
      </div>}
    </div>
  );
}

// ============================================================
// MODULE: BLACK HAT (M7) - PRIVATE
// ============================================================
function ModuleBlackHat(){
  const[competitors]=useState(DEMO_COMPETITORS);
  const[selected,setSelected]=useState(competitors[0]);
  const threatColors={high:'bg-red-500/20 text-red-400 border-red-500/30',medium:'bg-amber-500/20 text-amber-400 border-amber-500/30',low:'bg-emerald-500/20 text-emerald-400 border-emerald-500/30'};
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-3">
          <h2 className="text-xl font-bold text-white">Black Hat Analysis</h2>
          <span className="px-2 py-1 bg-amber-500/20 text-amber-400 rounded text-xs font-bold">üîí PRIVATE</span>
        </div>
        <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add Competitor</button>
      </div>
      
      <div className="glass p-4 bg-amber-500/5 border-amber-500/20">
        <div className="flex items-center gap-2 text-amber-400">
          <Icon name="alert" className="w-5 h-5"/>
          <span className="text-sm font-medium">Confidential competitive intelligence - Do not share with partners</span>
        </div>
      </div>
      
      <div className="grid grid-cols-3 gap-4">
        <div className="space-y-2">
          {competitors.map(c=>(
            <button key={c.id} onClick={()=>setSelected(c)} className={`w-full text-left p-4 rounded-lg transition ${selected.id===c.id?'bg-cyan-500/20 border border-cyan-500/30':'glass hover:bg-slate-700/50'}`}>
              <div className="flex justify-between items-center">
                <span className="font-medium text-white">{c.name}</span>
                <span className={`px-2 py-0.5 rounded text-xs font-bold border ${threatColors[c.threat]}`}>{c.threat.toUpperCase()}</span>
              </div>
            </button>
          ))}
        </div>
        
        <div className="col-span-2 glass p-6">
          <div className="flex justify-between items-center mb-6">
            <div>
              <h3 className="text-xl font-bold text-white">{selected.name}</h3>
              <span className={`px-2 py-1 rounded text-xs font-bold border ${threatColors[selected.threat]}`}>Threat Level: {selected.threat.toUpperCase()}</span>
            </div>
            <div className="text-5xl">üé≠</div>
          </div>
          
          <div className="grid grid-cols-2 gap-4">
            <div>
              <h4 className="text-sm font-semibold text-emerald-400 mb-2">üí™ Strengths</h4>
              <ul className="space-y-1">{selected.strengths.map((s,i)=><li key={i} className="text-sm text-slate-300">‚Ä¢ {s}</li>)}</ul>
            </div>
            <div>
              <h4 className="text-sm font-semibold text-red-400 mb-2">‚ö° Weaknesses</h4>
              <ul className="space-y-1">{selected.weaknesses.map((w,i)=><li key={i} className="text-sm text-slate-300">‚Ä¢ {w}</li>)}</ul>
            </div>
          </div>
          
          <div className="mt-6 p-4 bg-slate-800/50 rounded-lg">
            <h4 className="text-sm font-semibold text-cyan-400 mb-2">üëª Ghost Strategy</h4>
            <p className="text-sm text-slate-300">{selected.ghostStrategy}</p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: PRICING ENGINE (M8)
// ============================================================
function ModulePricing(){
  const[lcats,setLcats]=useState(DEMO_LCATS);
  const[wrapRate,setWrapRate]=useState(1.85);

  const totalDirect=lcats.reduce((s,l)=>s+(l.rate*l.hours),0);
  const totalWrapped=totalDirect*wrapRate;

  const updateLcat=(id,field,value)=>{setLcats(lcats.map(l=>l.id===id?{...l,[field]:parseFloat(value)||0}:l))};
  const addLcat=()=>{setLcats([...lcats,{id:Date.now(),title:'New LCAT',rate:100,hours:2080,wrap:wrapRate}])};
  const removeLcat=(id)=>{setLcats(lcats.filter(l=>l.id!==id))};

  const exportBOE=()=>{const csv='LCAT,Rate,Hours,Direct,Wrapped\n'+lcats.map(l=>`"${l.title}",${l.rate},${l.hours},${l.rate*l.hours},${l.rate*l.hours*wrapRate}`).join('\n')+`\nTOTAL,,,${totalDirect},${totalWrapped}`;const blob=new Blob([csv],{type:'text/csv'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='boe_export.csv';a.click()};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div className="flex items-center gap-3"><h2 className="text-xl font-bold text-white">Pricing Engine</h2><span className="px-2 py-1 bg-red-500/20 text-red-400 rounded text-xs font-bold">CUI</span></div>
        <div className="flex gap-2"><button onClick={addLcat} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add LCAT</button><button onClick={exportBOE} className="px-4 py-2 bg-slate-700 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="download" className="w-4 h-4"/>Export BOE</button></div>
      </div>

      <div className="grid grid-cols-4 gap-4">
        <div className="glass p-4"><p className="text-slate-400 text-xs">Direct Labor</p><p className="text-2xl font-bold text-white">{fmt(totalDirect)}</p></div>
        <div className="glass p-4"><p className="text-slate-400 text-xs">Wrapped Total</p><p className="text-2xl font-bold text-emerald-400">{fmt(totalWrapped)}</p></div>
        <div className="glass p-4"><p className="text-slate-400 text-xs">Wrap Rate</p><div className="flex items-center gap-2"><input type="number" step="0.01" value={wrapRate} onChange={e=>setWrapRate(parseFloat(e.target.value)||1)} className="w-20 bg-slate-800 text-white text-xl font-bold px-2 py-1 rounded focus:outline-none"/><span className="text-slate-400">x</span></div></div>
        <div className="glass p-4"><p className="text-slate-400 text-xs">LCATs</p><p className="text-2xl font-bold text-cyan-400">{lcats.length}</p></div>
      </div>

      <div className="glass overflow-hidden">
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['LCAT Title','Hourly Rate','Hours','Direct','Wrapped',''].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{lcats.map(l=>(
          <tr key={l.id} className="hover:bg-slate-800/30">
            <td className="p-3"><input type="text" value={l.title} onChange={e=>updateLcat(l.id,'title',e.target.value)} className="bg-transparent text-white text-sm w-full focus:outline-none border-b border-transparent focus:border-cyan-500"/></td>
            <td className="p-3"><input type="number" value={l.rate} onChange={e=>updateLcat(l.id,'rate',e.target.value)} className="bg-slate-800 text-white text-sm w-20 px-2 py-1 rounded focus:outline-none"/></td>
            <td className="p-3"><input type="number" value={l.hours} onChange={e=>updateLcat(l.id,'hours',e.target.value)} className="bg-slate-800 text-white text-sm w-24 px-2 py-1 rounded focus:outline-none"/></td>
            <td className="p-3 text-sm text-slate-300">{fmt(l.rate*l.hours)}</td>
            <td className="p-3 text-sm text-emerald-400 font-medium">{fmt(l.rate*l.hours*wrapRate)}</td>
            <td className="p-3"><button onClick={()=>removeLcat(l.id)} className="p-1 text-slate-500 hover:text-red-400"><Icon name="trash" className="w-4 h-4"/></button></td>
          </tr>
        ))}</tbody>
        <tfoot className="bg-slate-800/50"><tr><td className="p-3 font-bold text-white" colSpan="3">TOTAL</td><td className="p-3 font-bold text-white">{fmt(totalDirect)}</td><td className="p-3 font-bold text-emerald-400">{fmt(totalWrapped)}</td><td></td></tr></tfoot></table>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: HITL QUEUE (M9)
// ============================================================
function ModuleHITL(){
  const[items,setItems]=useState(DEMO_HITL);
  const[editing,setEditing]=useState(null);
  const[editContent,setEditContent]=useState('');

  const handleAction=(id,status)=>{setItems(items.map(i=>i.id===id?{...i,status}:i))};
  const handleEdit=(item)=>{setEditing(item);setEditContent(`AI-generated content for: ${item.title}\n\nThis is the draft content requiring human review.\n\nKey points:\n‚Ä¢ Point 1\n‚Ä¢ Point 2\n‚Ä¢ Point 3`)};
  const handleSave=()=>{handleAction(editing.id,'approved');setEditing(null)};

  const pending=items.filter(i=>i.status==='pending');
  const reviewed=items.filter(i=>i.status!=='pending');

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-xl font-bold text-white">HITL Review Queue</h2><p className="text-slate-400 text-sm">Human-in-the-Loop approval workflow</p></div>
        <div className="flex gap-2"><span className="px-3 py-1.5 bg-amber-500/20 text-amber-400 rounded-lg text-sm font-medium">{pending.length} Pending</span><span className="px-3 py-1.5 bg-emerald-500/20 text-emerald-400 rounded-lg text-sm font-medium">{items.filter(i=>i.status==='approved').length} Approved</span></div>
      </div>

      <div className="grid grid-cols-2 gap-4">
        <div><h3 className="font-semibold text-white mb-3">Pending Review</h3>
          <div className="space-y-3">{pending.map(item=>(
            <div key={item.id} className="glass p-4 hover-lift">
              <div className="flex justify-between items-start mb-2"><span className="px-2 py-0.5 bg-slate-700 rounded text-xs text-slate-300">{item.type}</span><span className="text-xs text-slate-500">{item.created}</span></div>
              <h4 className="font-medium text-white mb-1">{item.title}</h4>
              <p className="text-xs text-slate-400 mb-3">Agent: {item.agent}</p>
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-2"><div className="w-20 h-1.5 bg-slate-700 rounded-full"><div className={`h-full rounded-full ${item.confidence>=85?'bg-emerald-500':item.confidence>=70?'bg-amber-500':'bg-red-500'}`} style={{width:`${item.confidence}%`}}/></div><span className={`text-xs ${item.confidence>=85?'text-emerald-400':item.confidence>=70?'text-amber-400':'text-red-400'}`}>{item.confidence}%</span></div>
                <div className="flex gap-1">
                  <button onClick={()=>handleEdit(item)} className="p-1.5 bg-slate-700 rounded hover:bg-slate-600" title="Edit"><Icon name="edit" className="w-4 h-4 text-slate-300"/></button>
                  <button onClick={()=>handleAction(item.id,'approved')} className="p-1.5 bg-emerald-500/20 rounded hover:bg-emerald-500/30" title="Approve"><Icon name="check" className="w-4 h-4 text-emerald-400"/></button>
                  <button onClick={()=>handleAction(item.id,'rejected')} className="p-1.5 bg-red-500/20 rounded hover:bg-red-500/30" title="Reject"><Icon name="x" className="w-4 h-4 text-red-400"/></button>
                </div>
              </div>
            </div>
          ))}{pending.length===0&&<div className="glass p-8 text-center text-slate-500">No pending items</div>}</div>
        </div>
        <div><h3 className="font-semibold text-white mb-3">Reviewed</h3>
          <div className="space-y-3 max-h-96 overflow-y-auto">{reviewed.map(item=>(
            <div key={item.id} className={`glass p-4 opacity-70 border-l-2 ${item.status==='approved'?'border-emerald-500':'border-red-500'}`}>
              <div className="flex justify-between items-start"><div><h4 className="font-medium text-white text-sm">{item.title}</h4><p className="text-xs text-slate-400">{item.agent}</p></div><span className={`px-2 py-0.5 rounded text-xs font-medium ${item.status==='approved'?'bg-emerald-500/20 text-emerald-400':'bg-red-500/20 text-red-400'}`}>{item.status}</span></div>
            </div>
          ))}</div>
        </div>
      </div>

      {editing&&<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={()=>setEditing(null)}>
        <div className="glass p-6 w-full max-w-2xl mx-4" onClick={e=>e.stopPropagation()}>
          <div className="flex justify-between items-center mb-4"><h3 className="font-bold text-white">Edit: {editing.title}</h3><button onClick={()=>setEditing(null)} className="p-1 text-slate-400 hover:text-white"><Icon name="x"/></button></div>
          <textarea value={editContent} onChange={e=>setEditContent(e.target.value)} className="w-full h-64 bg-slate-800 border border-slate-700 rounded-lg p-4 text-white text-sm resize-none focus:outline-none focus:border-cyan-500"/>
          <div className="flex justify-end gap-2 mt-4"><button onClick={()=>setEditing(null)} className="px-4 py-2 bg-slate-700 text-white rounded-lg text-sm">Cancel</button><button onClick={handleSave} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm">Save & Approve</button></div>
        </div>
      </div>}
    </div>
  );
}

// ============================================================
// MODULE: ORALS STUDIO (M10)
// ============================================================
function ModuleOrals(){
  const[generating,setGenerating]=useState(false);
  const[slides,setSlides]=useState([]);
  const[current,setCurrent]=useState(0);
  const[timer,setTimer]=useState(0);
  const[practicing,setPracticing]=useState(false);

  const generateDeck=()=>{
    setGenerating(true);setSlides([]);
    let i=0;
    const interval=setInterval(()=>{
      if(i<ORALS_SLIDES.length){setSlides(prev=>[...prev,{id:i+1,title:ORALS_SLIDES[i],bullets:['Key point 1','Key point 2','Key point 3'],talkingPoints:['Emphasize value','Reference past performance','Address concerns']}]);i++}
      else{clearInterval(interval);setGenerating(false)}
    },400);
  };

  useEffect(()=>{let interval;if(practicing){interval=setInterval(()=>setTimer(t=>t+1),1000)}return()=>clearInterval(interval)},[practicing]);
  const formatTime=(s)=>`${Math.floor(s/60).toString().padStart(2,'0')}:${(s%60).toString().padStart(2,'0')}`;

  const exportDeck=()=>{alert('PowerPoint export would generate branded .pptx file')};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-xl font-bold text-white">Orals Studio</h2><p className="text-slate-400 text-sm">AI-powered presentation deck generator</p></div>
        {slides.length===0&&!generating&&<button onClick={generateDeck} className="px-4 py-2 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-lg font-medium">üé§ Generate 10-Slide Deck</button>}
        {slides.length>0&&<div className="flex gap-2"><button onClick={()=>{setPracticing(!practicing);if(practicing)setTimer(0)}} className={`px-4 py-2 rounded-lg font-medium ${practicing?'bg-red-500 text-white':'bg-emerald-500 text-white'}`}>{practicing?'‚èπ Stop':'‚ñ∂Ô∏è Practice'}</button><button onClick={exportDeck} className="px-4 py-2 bg-slate-700 text-white rounded-lg font-medium flex items-center gap-2"><Icon name="download" className="w-4 h-4"/>Export PPT</button></div>}
      </div>

      {generating&&<div className="glass p-8 text-center"><div className="w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"/><p className="text-white">Generating slides... {slides.length}/{ORALS_SLIDES.length}</p><div className="w-full max-w-xs mx-auto h-2 bg-slate-700 rounded-full mt-4 overflow-hidden"><div className="h-full bg-gradient-to-r from-cyan-500 to-teal-500 transition-all" style={{width:`${(slides.length/ORALS_SLIDES.length)*100}%`}}/></div></div>}

      {slides.length>0&&!generating&&(
        <div className="grid grid-cols-4 gap-4">
          <div className="col-span-1 space-y-2">
            <div className="text-sm font-semibold text-white mb-2">Slides ({slides.length})</div>
            <div className="space-y-1 max-h-96 overflow-y-auto">{slides.map((s,i)=><button key={s.id} onClick={()=>setCurrent(i)} className={`w-full text-left p-2 rounded-lg text-sm ${current===i?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'bg-slate-800 text-slate-300 hover:bg-slate-700'}`}>{i+1}. {s.title}</button>)}</div>
          </div>
          <div className="col-span-3">
            {practicing&&<div className="glass p-4 mb-4 flex items-center justify-between"><span className="text-white font-medium">Practice Timer</span><span className="text-2xl font-mono text-cyan-400">{formatTime(timer)}</span><span className="text-sm text-slate-400">Target: 02:00/slide</span></div>}
            <div className="glass p-6">
              <div className="aspect-video bg-gradient-to-br from-slate-800 to-slate-900 rounded-xl p-8 mb-4 border border-slate-700">
                <div className="h-1 w-24 bg-gradient-to-r from-cyan-500 to-teal-500 rounded mb-4"/>
                <h3 className="text-2xl font-bold text-white mb-4">{slides[current]?.title}</h3>
                <ul className="space-y-2">{slides[current]?.bullets.map((b,i)=><li key={i} className="text-slate-300 flex items-center gap-2"><span className="w-2 h-2 rounded-full bg-cyan-400"/>‚Ä¢ {b}</li>)}</ul>
              </div>
              <div><div className="text-sm font-semibold text-white mb-2">üí° Talking Points:</div><ul className="space-y-1">{slides[current]?.talkingPoints.map((t,i)=><li key={i} className="text-sm text-slate-400">‚Ä¢ {t}</li>)}</ul></div>
            </div>
            <div className="flex justify-between mt-4"><button disabled={current===0} onClick={()=>setCurrent(c=>c-1)} className="px-4 py-2 bg-slate-700 text-white rounded-lg disabled:opacity-50">‚Üê Previous</button><span className="text-slate-400 self-center">{current+1} / {slides.length}</span><button disabled={current===slides.length-1} onClick={()=>setCurrent(c=>c+1)} className="px-4 py-2 bg-cyan-500 text-white rounded-lg disabled:opacity-50">Next ‚Üí</button></div>
          </div>
        </div>
      )}

      {slides.length===0&&!generating&&<div className="glass p-12 text-center"><div className="text-6xl mb-4">üé§</div><p className="text-white text-lg mb-2">Ready to generate your presentation</p><p className="text-slate-400">AI will create 10 branded slides with talking points</p></div>}
    </div>
  );
}

// ============================================================
// MODULE: FRENEMY PROTOCOL (M11)
// ============================================================
function ModuleFrenemy(){
  const[partners,setPartners]=useState(DEMO_PARTNERS);
  const[selected,setSelected]=useState(partners[0]);
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Frenemy Protocol</h2><p className="text-slate-400 text-sm">Partner access control and trust management</p></div>
        <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add Partner</button>
      </div>
      
      <div className="grid grid-cols-3 gap-4">
        {[{l:'Active Partners',v:partners.filter(p=>p.status==='Active').length,c:'text-emerald-400'},{l:'Avg Trust Score',v:`${Math.round(partners.reduce((s,p)=>s+p.trustScore,0)/partners.length)}%`,c:'text-cyan-400'},{l:'Pending Approval',v:partners.filter(p=>p.status==='Pending').length,c:'text-amber-400'}].map((s,i)=><div key={i} className="glass p-4"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>
      
      <div className="grid grid-cols-3 gap-4">
        <div className="space-y-2">
          {partners.map(p=>(
            <button key={p.id} onClick={()=>setSelected(p)} className={`w-full text-left p-4 rounded-lg transition ${selected.id===p.id?'bg-cyan-500/20 border border-cyan-500/30':'glass hover:bg-slate-700/50'}`}>
              <div className="flex justify-between items-center">
                <span className="font-medium text-white">{p.name}</span>
                <span className={`px-2 py-0.5 rounded text-xs font-bold ${p.status==='Active'?'bg-emerald-500/20 text-emerald-400':'bg-amber-500/20 text-amber-400'}`}>{p.status}</span>
              </div>
              <div className="text-xs text-slate-400 mt-1">{p.socio} ‚Ä¢ Trust: {p.trustScore}%</div>
            </button>
          ))}
        </div>
        
        <div className="col-span-2 glass p-6">
          <div className="flex justify-between items-center mb-6">
            <div>
              <h3 className="text-xl font-bold text-white">{selected.name}</h3>
              <div className="flex gap-2 mt-2">
                <span className={`px-2 py-1 rounded text-xs font-bold ${selected.status==='Active'?'bg-emerald-500/20 text-emerald-400':'bg-amber-500/20 text-amber-400'}`}>{selected.status}</span>
                <span className="px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs">{selected.socio}</span>
              </div>
            </div>
            <div className="text-right">
              <div className="text-3xl font-bold text-cyan-400">{selected.trustScore}%</div>
              <div className="text-xs text-slate-400">Trust Score</div>
            </div>
          </div>
          
          <div className="mb-4">
            <h4 className="text-sm font-semibold text-white mb-2">Capabilities</h4>
            <div className="flex flex-wrap gap-2">{selected.capabilities.map((c,i)=><span key={i} className="px-2 py-1 bg-slate-700 rounded text-xs text-white">{c}</span>)}</div>
          </div>
          
          <div>
            <h4 className="text-sm font-semibold text-white mb-2">Assigned Opportunities</h4>
            {selected.assigned.length>0?<div className="space-y-2">{selected.assigned.map((a,i)=><div key={i} className="p-2 bg-slate-800/50 rounded flex justify-between items-center"><span className="text-sm text-white">{a}</span><button className="text-xs text-red-400 hover:text-red-300">Revoke</button></div>)}</div>:<p className="text-sm text-slate-500">No opportunities assigned</p>}
          </div>
          
          <div className="mt-6 p-3 bg-amber-500/10 border border-amber-500/20 rounded-lg">
            <p className="text-xs text-amber-400">‚ö†Ô∏è Partner access automatically revoked 24 hours after proposal submission</p>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: LAUNCH & ROI (M13)
// ============================================================
function ModuleLaunch(){
  const[submissions]=useState(DEMO_SUBMISSIONS);
  const wins=submissions.filter(s=>s.status==='Won');
  const totalWonValue=wins.reduce((s,sub)=>s+sub.value,0);
  const totalROI=wins.reduce((s,sub)=>s+(sub.roi||0),0);
  const winRate=Math.round((wins.length/submissions.filter(s=>s.status!=='Pending').length)*100);
  
  const statusColors={Won:'bg-emerald-500/20 text-emerald-400',Pending:'bg-amber-500/20 text-amber-400',Lost:'bg-red-500/20 text-red-400'};
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Launch & ROI Tracker</h2><p className="text-slate-400 text-sm">Submission tracking and return on investment</p></div>
        <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2">üöÄ New Submission</button>
      </div>
      
      <div className="grid grid-cols-4 gap-4">
        {[{l:'Total Submissions',v:submissions.length,c:'text-cyan-400'},{l:'Win Rate',v:`${winRate}%`,c:'text-emerald-400'},{l:'Won Value',v:fmt(totalWonValue),c:'text-amber-400'},{l:'Total ROI',v:`${totalROI}%`,c:'text-purple-400'}].map((s,i)=><div key={i} className="glass p-4"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>
      
      <div className="glass overflow-hidden">
        <div className="p-4 border-b border-slate-700/50"><h3 className="font-semibold text-white">Submission History</h3></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Proposal','Value','Submitted','Status','Result Date','ROI'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{submissions.map(s=>(
          <tr key={s.id} className="hover:bg-slate-800/30">
            <td className="p-3 text-sm text-white font-medium">{s.name}</td>
            <td className="p-3 text-sm text-emerald-400">{fmt(s.value)}</td>
            <td className="p-3 text-sm text-slate-300">{s.submitted}</td>
            <td className="p-3"><span className={`px-2 py-1 rounded text-xs font-medium ${statusColors[s.status]}`}>{s.status}</span></td>
            <td className="p-3 text-sm text-slate-400">{s.result||'‚Äî'}</td>
            <td className="p-3"><span className={`text-sm font-bold ${s.roi>0?'text-emerald-400':s.roi<0?'text-red-400':'text-slate-400'}`}>{s.roi!==null?`${s.roi>0?'+':''}${s.roi}%`:'‚Äî'}</span></td>
          </tr>
        ))}</tbody></table>
      </div>
      
      <div className="glass p-4">
        <h4 className="font-semibold text-white mb-4">ROI Calculation</h4>
        <div className="grid grid-cols-3 gap-4 text-center">
          <div><p className="text-2xl font-bold text-white">340</p><p className="text-xs text-slate-400">Avg Hours/Proposal</p></div>
          <div><p className="text-2xl font-bold text-emerald-400">180</p><p className="text-xs text-slate-400">Hours Saved w/ AI</p></div>
          <div><p className="text-2xl font-bold text-cyan-400">$27,000</p><p className="text-xs text-slate-400">Cost Savings/Proposal</p></div>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: POST-AWARD (M14)
// ============================================================
function ModulePostAward(){
  const[phase,setPhase]=useState('transition');
  const phases=[
    {id:'transition',name:'Transition Planning',icon:'üìã',items:['Kickoff meeting scheduled','Staff onboarding plan','Knowledge transfer docs']},
    {id:'staffing',name:'Staff Ramp',icon:'üë•',items:['Key personnel identified','Clearance processing','Badging requests']},
    {id:'systems',name:'System Access',icon:'üíª',items:['Network accounts','VPN setup','Collaboration tools']},
    {id:'delivery',name:'Delivery Start',icon:'üöÄ',items:['Sprint 0 planning','Quality baseline','SLA tracking']}
  ];
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Post-Award Management</h2><p className="text-slate-400 text-sm">Transition from proposal to program execution</p></div>
        <span className="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-bold">üéâ AWARD RECEIVED</span>
      </div>
      
      <div className="grid grid-cols-4 gap-2">
        {phases.map(p=>(
          <button key={p.id} onClick={()=>setPhase(p.id)} className={`p-4 rounded-lg text-center transition ${phase===p.id?'bg-cyan-500/20 border border-cyan-500/30':'glass hover:bg-slate-700/50'}`}>
            <div className="text-2xl mb-2">{p.icon}</div>
            <div className="text-sm text-white font-medium">{p.name}</div>
          </button>
        ))}
      </div>
      
      <div className="glass p-6">
        <h3 className="text-lg font-bold text-white mb-4">{phases.find(p=>p.id===phase)?.icon} {phases.find(p=>p.id===phase)?.name}</h3>
        <div className="space-y-3">
          {phases.find(p=>p.id===phase)?.items.map((item,i)=>(
            <div key={i} className="flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg">
              <input type="checkbox" className="w-5 h-5 rounded border-slate-600 bg-slate-700 text-cyan-500 focus:ring-cyan-500"/>
              <span className="text-white">{item}</span>
              <span className="ml-auto text-xs text-slate-500">Due: TBD</span>
            </div>
          ))}
        </div>
        <button className="mt-4 px-4 py-2 bg-slate-700 text-white rounded-lg text-sm flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add Task</button>
      </div>
      
      <div className="glass p-4 bg-gradient-to-r from-emerald-500/10 to-cyan-500/10">
        <div className="flex items-center justify-between">
          <div>
            <h4 className="font-semibold text-white">Transition Progress</h4>
            <p className="text-sm text-slate-400">25% complete ‚Ä¢ 45 days remaining</p>
          </div>
          <div className="w-48 h-3 bg-slate-700 rounded-full overflow-hidden">
            <div className="h-full w-1/4 bg-gradient-to-r from-emerald-500 to-cyan-500"/>
          </div>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: PLAYBOOK (M15)
// ============================================================
function ModulePlaybook(){
  const[examples,setExamples]=useState(DEMO_PLAYBOOK);
  const[showAdd,setShowAdd]=useState(false);
  const[newEx,setNewEx]=useState({title:'',category:'Writing'});

  const addExample=()=>{if(newEx.title){setExamples([...examples,{id:Date.now(),title:newEx.title,category:newEx.category,score:85,uses:0}]);setNewEx({title:'',category:'Writing'});setShowAdd(false)}};
  const deleteExample=(id)=>{setExamples(examples.filter(e=>e.id!==id))};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-xl font-bold text-white">Lessons Playbook</h2><p className="text-slate-400 text-sm">Golden examples for AI learning</p></div><button onClick={()=>setShowAdd(true)} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm font-medium flex items-center gap-2"><Icon name="plus" className="w-4 h-4"/>Add Example</button></div>

      <div className="grid grid-cols-4 gap-4">
        {[{l:'Total Examples',v:examples.length,c:'text-cyan-400'},{l:'Avg Quality',v:`${Math.round(examples.reduce((s,e)=>s+e.score,0)/examples.length)}%`,c:'text-emerald-400'},{l:'Total Uses',v:examples.reduce((s,e)=>s+e.uses,0),c:'text-purple-400'},{l:'Categories',v:new Set(examples.map(e=>e.category)).size,c:'text-amber-400'}].map((s,i)=><div key={i} className="glass p-4"><p className="text-slate-400 text-xs">{s.l}</p><p className={`text-2xl font-bold ${s.c}`}>{s.v}</p></div>)}
      </div>

      <div className="space-y-3">{examples.map(ex=>(
        <div key={ex.id} className="glass p-4 flex items-center justify-between hover-lift">
          <div className="flex items-center gap-4"><div className="w-12 h-12 rounded-lg bg-gradient-to-br from-amber-500/20 to-amber-600/20 flex items-center justify-center text-2xl">‚≠ê</div><div><h4 className="font-medium text-white">{ex.title}</h4><p className="text-sm text-slate-400">{ex.category} ‚Ä¢ {ex.uses} uses</p></div></div>
          <div className="flex items-center gap-4"><div className="text-right"><div className={`text-lg font-bold ${ex.score>=90?'text-emerald-400':ex.score>=80?'text-amber-400':'text-slate-400'}`}>{ex.score}%</div><div className="text-xs text-slate-500">Quality</div></div><button onClick={()=>deleteExample(ex.id)} className="p-2 text-slate-500 hover:text-red-400"><Icon name="trash" className="w-4 h-4"/></button></div>
        </div>
      ))}</div>

      {showAdd&&<div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50" onClick={()=>setShowAdd(false)}>
        <div className="glass p-6 w-full max-w-lg mx-4" onClick={e=>e.stopPropagation()}>
          <h3 className="font-bold text-white text-lg mb-4">Add Golden Example</h3>
          <div className="space-y-4">
            <div><label className="text-sm text-slate-400 block mb-1">Title</label><input value={newEx.title} onChange={e=>setNewEx({...newEx,title:e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-500" placeholder="Executive Summary Template"/></div>
            <div><label className="text-sm text-slate-400 block mb-1">Category</label><select value={newEx.category} onChange={e=>setNewEx({...newEx,category:e.target.value})} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-500"><option>Writing</option><option>Strategy</option><option>Pricing</option><option>Compliance</option></select></div>
          </div>
          <div className="flex justify-end gap-2 mt-4"><button onClick={()=>setShowAdd(false)} className="px-4 py-2 bg-slate-700 text-white rounded-lg text-sm">Cancel</button><button onClick={addExample} className="px-4 py-2 bg-cyan-500 text-white rounded-lg text-sm">Save to Playbook</button></div>
        </div>
      </div>}
    </div>
  );
}

// ============================================================
// MODULE: ADMIN (M16)
// ============================================================
function ModuleAdmin({tokenUsage,setTokenUsage}){
  const tokenLimit=100000;
  const usagePercent=(tokenUsage/tokenLimit)*100;

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex items-center gap-2"><h2 className="text-xl font-bold text-white">Admin Settings</h2><span className="px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs font-bold">ADMIN</span></div>

      <div className="grid grid-cols-2 gap-4">
        <div className="glass p-6">
          <h3 className="font-semibold text-white mb-4">üí∞ Token Cost Meter</h3>
          <div className="space-y-4">
            <div><div className="flex justify-between text-sm mb-2"><span className="text-slate-400">Usage</span><span className="text-white">{tokenUsage.toLocaleString()} / {tokenLimit.toLocaleString()}</span></div><div className="h-4 bg-slate-700 rounded-full overflow-hidden"><div className={`h-full transition-all ${usagePercent>80?'bg-red-500':usagePercent>50?'bg-amber-500':'bg-emerald-500'}`} style={{width:`${usagePercent}%`}}/></div></div>
            <div className="grid grid-cols-2 gap-4"><div className="p-3 bg-slate-800/50 rounded-lg"><p className="text-xs text-slate-400">This Month</p><p className="text-lg font-bold text-white">{tokenUsage.toLocaleString()}</p></div><div className="p-3 bg-slate-800/50 rounded-lg"><p className="text-xs text-slate-400">Est. Cost</p><p className="text-lg font-bold text-emerald-400">${((tokenUsage/1000)*0.003).toFixed(2)}</p></div></div>
          </div>
        </div>

        <div className="glass p-6">
          <h3 className="font-semibold text-white mb-4">‚öôÔ∏è System Settings</h3>
          <div className="space-y-3">{[{l:'RBAC Enforcement',v:true},{l:'CUI Watermarking',v:true},{l:'Partner Auto-Revoke',v:true},{l:'Audit Logging',v:true}].map((s,i)=><div key={i} className="flex items-center justify-between p-2 bg-slate-800/50 rounded-lg"><span className="text-sm text-white">{s.l}</span><div className={`w-10 h-6 rounded-full p-1 cursor-pointer ${s.v?'bg-emerald-500':'bg-slate-600'}`}><div className={`w-4 h-4 bg-white rounded-full transition-transform ${s.v?'translate-x-4':''}`}/></div></div>)}</div>
        </div>
      </div>

      <div className="glass p-6">
        <h3 className="font-semibold text-white mb-4">üë• User Management</h3>
        <div className="grid grid-cols-3 gap-3">{ROLES.slice(0,6).map(r=><div key={r.id} className="p-3 bg-slate-800/50 rounded-lg flex items-center gap-3"><span className="text-xl">{r.icon}</span><div><p className="text-sm text-white">{r.fullName}</p><p className="text-xs text-slate-400">{r.name}</p></div></div>)}</div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: TRAINING HUB (M17)
// ============================================================
function ModuleTraining(){
  const resources=[
    {id:1,title:'MissionPulse Quick Start Guide',type:'PDF',duration:'15 min',icon:'üìò'},
    {id:2,title:'Shipley Methodology Overview',type:'Video',duration:'45 min',icon:'üé¨'},
    {id:3,title:'AI Agent Best Practices',type:'Interactive',duration:'30 min',icon:'ü§ñ'},
    {id:4,title:'Compliance Matrix Tutorial',type:'Video',duration:'20 min',icon:'üìã'},
    {id:5,title:'RBAC & Security Guide',type:'PDF',duration:'10 min',icon:'üîí'},
    {id:6,title:'Pricing Engine Masterclass',type:'Video',duration:'60 min',icon:'üí∞'}
  ];
  
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center">
        <div><h2 className="text-xl font-bold text-white">Training Hub</h2><p className="text-slate-400 text-sm">Learn to maximize MissionPulse capabilities</p></div>
        <span className="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded text-xs font-bold">6 Resources</span>
      </div>
      
      <div className="glass p-6 bg-gradient-to-r from-cyan-500/10 to-purple-500/10">
        <div className="flex items-center gap-4">
          <div className="text-5xl">üéì</div>
          <div>
            <h3 className="text-lg font-bold text-white">Welcome to MissionPulse Training</h3>
            <p className="text-slate-400">Complete these modules to become a power user</p>
            <div className="mt-2 flex items-center gap-2">
              <div className="w-32 h-2 bg-slate-700 rounded-full"><div className="w-1/3 h-full bg-cyan-500 rounded-full"/></div>
              <span className="text-xs text-slate-400">2/6 Complete</span>
            </div>
          </div>
        </div>
      </div>
      
      <div className="grid grid-cols-2 gap-4">
        {resources.map(r=>(
          <div key={r.id} className="glass p-4 hover-lift cursor-pointer">
            <div className="flex items-start gap-4">
              <div className="text-3xl">{r.icon}</div>
              <div className="flex-1">
                <h4 className="font-medium text-white">{r.title}</h4>
                <div className="flex items-center gap-2 mt-1">
                  <span className="px-2 py-0.5 bg-slate-700 rounded text-xs text-slate-300">{r.type}</span>
                  <span className="text-xs text-slate-500">{r.duration}</span>
                </div>
              </div>
              <button className="px-3 py-1 bg-cyan-500/20 text-cyan-400 rounded text-sm hover:bg-cyan-500/30">Start</button>
            </div>
          </div>
        ))}
      </div>
      
      <div className="glass p-4">
        <h4 className="font-semibold text-white mb-3">üîó External Resources</h4>
        <div className="space-y-2">
          <a href="#" className="flex items-center gap-2 text-cyan-400 hover:text-cyan-300 text-sm"><Icon name="external" className="w-4 h-4"/>Shipley Associates Official Training</a>
          <a href="#" className="flex items-center gap-2 text-cyan-400 hover:text-cyan-300 text-sm"><Icon name="external" className="w-4 h-4"/>Federal Acquisition Regulation (FAR)</a>
          <a href="#" className="flex items-center gap-2 text-cyan-400 hover:text-cyan-300 text-sm"><Icon name="external" className="w-4 h-4"/>Mission Meets Tech Support Portal</a>
        </div>
      </div>
    </div>
  );
}

// ============================================================
// MODULE: AUDIT LOG (M18)
// ============================================================
function ModuleAudit(){
  const[filter,setFilter]=useState('ALL');
  const actions=['ALL','LOGIN','VIEW_BLACKHAT','EXPORT_PRICING','APPROVE_SECTION'];
  const filtered=filter==='ALL'?DEMO_AUDIT:DEMO_AUDIT.filter(a=>a.action===filter);
  const actionColors={LOGIN:'bg-emerald-500',VIEW_BLACKHAT:'bg-amber-500',EXPORT_PRICING:'bg-red-500',APPROVE_SECTION:'bg-cyan-500'};

  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex items-center gap-2"><h2 className="text-xl font-bold text-white">Audit Log</h2><span className="px-2 py-1 bg-purple-500/20 text-purple-400 rounded text-xs font-bold">ADMIN</span></div>
      <p className="text-slate-400 text-sm">Security and compliance audit trail</p>

      <div className="flex gap-2">{actions.map(a=><button key={a} onClick={()=>setFilter(a)} className={`px-3 py-1.5 rounded-lg text-sm font-medium transition ${filter===a?'bg-cyan-500 text-white':'bg-slate-800 text-slate-400 hover:text-white'}`}>{a==='ALL'?'All':a.replace(/_/g,' ')}</button>)}</div>

      <div className="glass overflow-hidden">
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Action','User','Role','IP Address','Timestamp'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{filtered.map(log=><tr key={log.id} className="hover:bg-slate-800/30"><td className="p-3"><span className={`px-2 py-1 rounded text-xs text-white ${actionColors[log.action]||'bg-slate-600'}`}>{log.action}</span></td><td className="p-3 text-sm text-white">{log.user}</td><td className="p-3 text-sm text-slate-300">{log.role}</td><td className="p-3 text-sm font-mono text-slate-400">{log.ip}</td><td className="p-3 text-sm text-slate-400">{log.ts}</td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// ============================================================
// GENERIC MODULE (Fallback)
// ============================================================
function ModuleGeneric({mod}){
  return(
    <div className="glass p-12 text-center animate-fadeIn">
      <div className="text-6xl mb-4">{mod.icon}</div>
      <h2 className="text-xl font-bold text-white mb-2">{mod.name}</h2>
      <p className="text-slate-400">{mod.cat} module</p>
      {mod.badge&&<span className={`inline-block mt-3 px-3 py-1 rounded text-xs font-bold ${mod.badge==='PRIVATE'?'bg-amber-500/20 text-amber-400':mod.badge==='CUI'?'bg-red-500/20 text-red-400':'bg-purple-500/20 text-purple-400'}`}>{mod.badge}</span>}
    </div>
  );
}

// ============================================================
// AI CHAT WIDGET
// ============================================================
function AIChatWidget(){
  const[open,setOpen]=useState(false);
  const[messages,setMessages]=useState([{role:'assistant',content:'Hello! I\'m your MissionPulse AI assistant. How can I help with your proposal?'}]);
  const[input,setInput]=useState('');
  const[loading,setLoading]=useState(false);

  const send=()=>{
    if(!input.trim()||loading)return;
    setMessages(m=>[...m,{role:'user',content:input}]);
    setInput('');setLoading(true);
    setTimeout(()=>{setMessages(m=>[...m,{role:'assistant',content:`Great question about "${input}". Based on Shipley methodology, I recommend focusing on compliance first, then developing strong win themes. Would you like me to elaborate on either?\n\n‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW`}]);setLoading(false)},1000);
  };

  if(!open)return<button onClick={()=>setOpen(true)} className="fixed bottom-10 right-4 w-14 h-14 bg-gradient-to-r from-cyan-500 to-teal-500 rounded-full shadow-lg flex items-center justify-center text-2xl hover:scale-105 transition z-50">ü§ñ</button>;

  return(
    <div className="fixed bottom-10 right-4 w-96 h-[500px] glass shadow-2xl flex flex-col z-50 animate-fadeIn">
      <div className="p-3 border-b border-slate-700/50 flex justify-between items-center"><span className="font-semibold text-white flex items-center gap-2">ü§ñ AI Assistant</span><button onClick={()=>setOpen(false)} className="p-1 text-slate-400 hover:text-white"><Icon name="x" className="w-5 h-5"/></button></div>
      <div className="flex-1 overflow-y-auto p-3 space-y-3">{messages.map((m,i)=><div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}><div className={`max-w-[85%] p-3 rounded-xl text-sm ${m.role==='user'?'bg-cyan-500 text-white':'bg-slate-700 text-slate-200'}`}>{m.content}</div></div>)}{loading&&<div className="flex justify-start"><div className="bg-slate-700 p-3 rounded-xl"><div className="flex gap-1">{[0,1,2].map(i=><div key={i} className="w-2 h-2 bg-slate-400 rounded-full animate-pulse" style={{animationDelay:`${i*0.2}s`}}/>)}</div></div></div>}</div>
      <div className="p-3 border-t border-slate-700/50 flex gap-2"><input value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} placeholder="Ask anything..." className="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-cyan-500"/><button onClick={send} disabled={!input.trim()||loading} className="p-2 bg-cyan-500 rounded-lg text-white disabled:opacity-50"><Icon name="send" className="w-5 h-5"/></button></div>
    </div>
  );
}

// ============================================================
// SIDEBAR
// ============================================================
function Sidebar({role,setRole,active,setActive,user}){
  const[collapsed,setCollapsed]=useState(false);
  const[showRoles,setShowRoles]=useState(false);
  const accessible=MODULES.filter(m=>role.access.includes(m.id));

  return(
    <aside className={`h-screen bg-slate-900/95 border-r border-slate-800 flex flex-col transition-all ${collapsed?'w-16':'w-64'}`}>
      <div className="p-4 border-b border-slate-800 flex items-center justify-between">
        {!collapsed&&<div className="flex items-center gap-2"><div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-400 flex items-center justify-center text-white font-bold">MP</div><div><div className="text-sm font-bold text-white">MissionPulse</div><div className="text-[10px] text-slate-500">v12 Production</div></div></div>}
        <button onClick={()=>setCollapsed(!collapsed)} className="p-1 text-slate-400 hover:text-white"><Icon name={collapsed?'chevronRight':'chevronLeft'} className="w-4 h-4"/></button>
      </div>

      <div className="p-3 border-b border-slate-800">
        <button onClick={()=>setShowRoles(!showRoles)} className="w-full flex items-center gap-2 p-2 rounded-lg hover:bg-slate-800"><span className="text-xl">{role.icon}</span>{!collapsed&&<><div className="flex-1 text-left"><div className="text-sm font-medium text-white">{role.fullName}</div><div className="text-xs text-slate-400">{role.name}</div></div><Icon name="chevronDown" className={`w-4 h-4 text-slate-400 transition ${showRoles?'rotate-180':''}`}/></>}</button>
        {showRoles&&!collapsed&&<div className="mt-2 p-2 bg-slate-800/50 rounded-lg max-h-48 overflow-y-auto">{ROLES.map(r=><button key={r.id} onClick={()=>{setRole(r);setShowRoles(false)}} className={`w-full flex items-center gap-2 p-2 rounded hover:bg-slate-700 ${role.id===r.id?'bg-cyan-500/20':''}`}><span>{r.icon}</span><span className="text-sm text-white">{r.name}</span></button>)}</div>}
      </div>

      <nav className="flex-1 overflow-y-auto p-2">
        {['Command','Strategy','Intel','Delivery','Admin'].map(cat=>{
          const mods=accessible.filter(m=>m.cat===cat);
          if(!mods.length)return null;
          return(<div key={cat} className="mb-3">{!collapsed&&<div className="text-[10px] uppercase text-slate-500 font-semibold px-2 mb-1">{cat}</div>}{mods.map(m=><button key={m.id} onClick={()=>setActive(m)} className={`w-full flex items-center gap-2 p-2 rounded-lg mb-0.5 transition ${active?.id===m.id?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'text-slate-400 hover:bg-slate-800 hover:text-white'}`} title={collapsed?m.name:''}><span>{m.icon}</span>{!collapsed&&<><span className="flex-1 text-left text-sm">{m.name}</span>{m.badge&&<span className={`px-1 py-0.5 text-[9px] font-bold rounded ${m.badge==='PRIVATE'?'bg-amber-500/20 text-amber-400':m.badge==='CUI'?'bg-red-500/20 text-red-400':'bg-purple-500/20 text-purple-400'}`}>{m.badge}</span>}</>}</button>)}</div>);
        })}
      </nav>

      {!collapsed&&user&&<div className="p-3 border-t border-slate-800"><div className="flex items-center justify-between"><div className="flex items-center gap-2"><div className="w-8 h-8 rounded-full bg-gradient-to-br from-cyan-500 to-teal-400 flex items-center justify-center text-white text-xs font-bold">{user.name?.[0]||'U'}</div><div className="text-xs text-white truncate max-w-[120px]">{user.name||user.email}</div></div><button onClick={handleLogout} className="p-1.5 rounded hover:bg-red-500/20 text-slate-400 hover:text-red-400"><Icon name="logout" className="w-4 h-4"/></button></div></div>}
    </aside>
  );
}

// ============================================================
// MAIN APP
// ============================================================
function App(){
  const[user,setUser]=useState(null);
  const[role,setRole]=useState(ROLES[0]);
  const[active,setActive]=useState(null);
  const[opps,setOpps]=useState(DEMO_OPPS);
  const[tokenUsage,setTokenUsage]=useState(45230);

  useEffect(()=>{const u=checkAuth();if(u)setUser(u)},[]);

  const renderModule=()=>{
    if(!active)return<div className="flex-1 flex items-center justify-center"><div className="text-center"><div className="text-6xl mb-4">üõ°Ô∏è</div><h2 className="text-xl font-bold text-white mb-2">Welcome to MissionPulse</h2><p className="text-slate-400">Select a module to begin</p><p className="text-cyan-400 text-sm mt-2">Mission. Technology. Transformation.</p></div></div>;
    switch(active.id){
      case 'dashboard':return<ModuleDashboard opps={opps} tokenUsage={tokenUsage}/>;
      case 'pipeline':return<ModulePipeline opps={opps}/>;
      case 'warroom':return<ModuleWarRoom opps={opps}/>;
      case 'swimlane':return<ModuleSwimlane/>;
      case 'compliance':return<ModuleCompliance/>;
      case 'contracts':return<ModuleContracts/>;
      case 'writer':return<ModuleWriter/>;
      case 'blackhat':return<ModuleBlackHat/>;
      case 'pricing':return<ModulePricing/>;
      case 'hitl':return<ModuleHITL/>;
      case 'orals':return<ModuleOrals/>;
      case 'frenemy':return<ModuleFrenemy/>;
      case 'launch':return<ModuleLaunch/>;
      case 'post_award':return<ModulePostAward/>;
      case 'playbook':return<ModulePlaybook/>;
      case 'admin':return<ModuleAdmin tokenUsage={tokenUsage} setTokenUsage={setTokenUsage}/>;
      case 'training':return<ModuleTraining/>;
      case 'audit':return<ModuleAudit/>;
      default:return<ModuleGeneric mod={active}/>;
    }
  };

  if(!user)return<div className="h-screen flex items-center justify-center bg-[#00050F]"><div className="w-12 h-12 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"/></div>;

  return(
    <div className="h-screen flex bg-[#00050F] overflow-hidden">
      <Sidebar role={role} setRole={setRole} active={active} setActive={setActive} user={user}/>
      <div className="flex-1 flex flex-col overflow-hidden">
        {active&&<header className="bg-slate-900/90 border-b border-slate-800 px-6 py-3"><div className="flex items-center gap-3"><span className="text-xl">{active.icon}</span><div><h1 className="font-semibold text-white">{active.name}</h1></div>{active.badge&&<span className={`px-2 py-0.5 rounded text-xs font-bold ${active.badge==='PRIVATE'?'bg-amber-500/20 text-amber-400':active.badge==='CUI'?'bg-red-500/20 text-red-400':'bg-purple-500/20 text-purple-400'}`}>{active.badge}</span>}</div></header>}
        <main className="flex-1 overflow-y-auto p-6">{renderModule()}</main>
      </div>
      <div className="fixed bottom-0 left-0 right-0 h-6 bg-slate-900/95 border-t border-slate-800 flex items-center justify-center z-40"><span className="text-[10px] text-slate-500">AI GENERATED - REQUIRES HUMAN REVIEW ‚Ä¢ MissionPulse v12 Production ‚Ä¢ ¬© 2026 Mission Meets Tech</span></div>
      <AIChatWidget/>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
