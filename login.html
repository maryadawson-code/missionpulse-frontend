<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Sign In</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body style="font-family:Inter,sans-serif;background:#00050F;min-height:100vh;display:flex;align-items:center;justify-content:center;margin:0;padding:16px">
  <div style="width:100%;max-width:400px">
    <div style="text-align:center;margin-bottom:32px">
      <h1 style="color:white;font-size:24px;font-weight:bold;margin:0">MissionPulse</h1>
      <p style="color:#94a3b8;font-size:14px;margin-top:4px">Mission. Technology. Transformation.</p>
    </div>
    <div style="background:rgba(30,41,59,0.5);border:1px solid rgba(51,65,85,0.5);border-radius:16px;padding:32px">
      <div id="errorAlert" style="display:none;margin-bottom:16px;padding:16px;background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:12px">
        <p style="color:#f87171;font-weight:500;font-size:14px;margin:0">Authentication Error</p>
        <p id="errorMessage" style="color:#fca5a5;font-size:14px;margin:4px 0 0 0"></p>
      </div>
      <div id="successAlert" style="display:none;margin-bottom:16px;padding:16px;background:rgba(16,185,129,0.1);border:1px solid rgba(16,185,129,0.3);border-radius:12px">
        <p id="successMessage" style="color:#34d399;font-weight:500;font-size:14px;margin:0">Success!</p>
      </div>
      <form id="loginForm">
        <div style="margin-bottom:20px">
          <label style="display:block;font-size:14px;font-weight:500;color:#cbd5e1;margin-bottom:8px">Email</label>
          <input type="email" id="email" required style="width:100%;padding:12px 16px;background:rgba(15,23,42,0.5);border:1px solid #475569;border-radius:12px;color:white;font-size:14px;box-sizing:border-box" placeholder="you@company.com">
        </div>
        <div style="margin-bottom:20px">
          <label style="display:block;font-size:14px;font-weight:500;color:#cbd5e1;margin-bottom:8px">Password</label>
          <input type="password" id="password" required style="width:100%;padding:12px 16px;background:rgba(15,23,42,0.5);border:1px solid #475569;border-radius:12px;color:white;font-size:14px;box-sizing:border-box" placeholder="********">
        </div>
        <button type="submit" id="submitBtn" style="width:100%;padding:12px;background:linear-gradient(to right,#06b6d4,#14b8a6);color:white;font-weight:600;border:none;border-radius:12px;cursor:pointer;font-size:14px">Sign In</button>
      </form>
      <div id="debugPanel" style="display:none;margin-top:16px;padding:12px;background:#0f172a;border-radius:8px">
        <p style="font-size:12px;color:#64748b;margin:0">Debug:</p>
        <pre id="debugOutput" style="font-size:12px;color:#4ade80;margin:4px 0 0 0;overflow:auto;max-height:128px"></pre>
      </div>
    </div>
  </div>
  <script>
    const SUPABASE_URL = 'https://djuviwarqdvlbgcfuupa.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MzUyMjQsImV4cCI6MjA1MzQxMTIyNH0.pBPL9l2zL7LLd_A5I--hPBzw5YwG3ajPMtbYsqsxIgQ';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const debug = new URLSearchParams(window.location.search).get('debug') === '1';
    if (debug) document.getElementById('debugPanel').style.display = 'block';
    function log(msg) { if (debug) document.getElementById('debugOutput').textContent += msg + '\n'; console.log(msg); }
    function showError(msg) { document.getElementById('errorMessage').textContent = msg; document.getElementById('errorAlert').style.display = 'block'; }
    function showSuccess(msg) { document.getElementById('successMessage').textContent = msg; document.getElementById('successAlert').style.display = 'block'; }
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      document.getElementById('errorAlert').style.display = 'none';
      document.getElementById('submitBtn').disabled = true;
      document.getElementById('submitBtn').textContent = 'Signing in...';
      const email = document.getElementById('email').value.trim().toLowerCase();
      const password = document.getElementById('password').value;
      log('Attempting login: ' + email);
      try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) { log('ERROR: ' + error.message); showError(error.message); document.getElementById('submitBtn').disabled = false; document.getElementById('submitBtn').textContent = 'Sign In'; return; }
        log('SUCCESS: ' + data.user.email);
        showSuccess('Login successful! Redirecting...');
        localStorage.setItem('mp_user', JSON.stringify({ id: data.user.id, email: data.user.email }));
        setTimeout(() => { window.location.href = 'missionpulse-v12-sprint16.html'; }, 1000);
      } catch (err) { log('EXCEPTION: ' + err.message); showError(err.message); document.getElementById('submitBtn').disabled = false; document.getElementById('submitBtn').textContent = 'Sign In'; }
    });
    (async () => { const { data: { session } } = await supabase.auth.getSession(); if (session) { log('Existing session'); window.location.href = 'missionpulse-v12-sprint16.html'; } })();
  </script>
</body>
</html>