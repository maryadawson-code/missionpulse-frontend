<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse M16 - Training Data Admin</title>
  <link rel="icon" type="image/png" href="MMT_icon_32px.png">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --primary-cyan: #00E5FA; --deep-navy: #00050F; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: var(--deep-navy); min-height: 100vh; color: #E2E8F0; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-slideIn { animation: slideIn 0.3s ease-out; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0A1628; }
    ::-webkit-scrollbar-thumb { background: var(--primary-cyan); border-radius: 4px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ==========================================================================
    // CONFIGURATION
    // ==========================================================================
    const CONFIG = {
      API_BASE: 'https://missionpulse-api.onrender.com',
      ENDPOINTS: {
        COMPANY: '/api/training-data/company-profile',
        WIN_THEMES: '/api/training-data/win-themes',
        COMPETITORS: '/api/training-data/competitors',
        LABOR_CATEGORIES: '/api/training-data/labor-categories',
        PAST_PERFORMANCE: '/api/training-data/past-performance',
        TEAMING_PARTNERS: '/api/training-data/teaming-partners',
        SUMMARY: '/api/training-data/summary',
        CONTEXT_STATUS: '/api/context/status',
        HEALTH: '/api/health',
      },
    };

    // ==========================================================================
    // DEMO DATA (Fallback when API unavailable)
    // ==========================================================================
    const DEMO_DATA = {
      company: {
        name: "Mission Meets Tech LLC",
        cage_code: "8ABC1",
        duns: "123456789",
        set_asides: ["SDVOSB", "WOSB"],
        naics_codes: ["541512", "541519", "518210"],
        core_competencies: ["AI/ML Solutions", "Cloud Migration", "Healthcare IT", "Cybersecurity"],
        mission_statement: "Transforming federal agencies through innovative technology solutions.",
      },
      winThemes: [
        { id: 1, title: "Innovation Leadership", description: "Pioneering AI solutions for federal healthcare", keywords: ["AI", "ML", "innovation"], status: "active" },
        { id: 2, title: "Proven Past Performance", description: "Track record of success with DHA and VA", keywords: ["DHA", "VA", "past performance"], status: "active" },
        { id: 3, title: "Cost Efficiency", description: "Delivering value through automation and efficiency", keywords: ["cost", "efficiency", "ROI"], status: "active" },
      ],
      competitors: [
        { id: 1, name: "Acme Federal Solutions", cage_code: "1XYZ2", strengths: ["Incumbent advantage", "Large workforce"], weaknesses: ["Legacy technology", "Slow innovation"], win_rate_against: 65 },
        { id: 2, name: "TechGov Inc", cage_code: "2ABC3", strengths: ["Strong pricing", "CMMI Level 5"], weaknesses: ["Limited healthcare experience"], win_rate_against: 72 },
      ],
      laborCategories: [
        { id: 1, category: "Senior Software Engineer", labor_code: "SSE-01", base_rate: 175.00, fringe: 35.5, overhead: 85.0, gna: 12.0 },
        { id: 2, category: "Project Manager", labor_code: "PM-01", base_rate: 195.00, fringe: 35.5, overhead: 85.0, gna: 12.0 },
        { id: 3, category: "Data Scientist", labor_code: "DS-01", base_rate: 185.00, fringe: 35.5, overhead: 85.0, gna: 12.0 },
      ],
      pastPerformance: [
        { id: 1, contract_name: "DHA EHR Modernization", contract_number: "W81XWH-20-C-0001", agency: "DHA", value: 45000000, cpars_rating: "Exceptional", period: "2020-2025" },
        { id: 2, contract_name: "VA Claims Processing", contract_number: "VA118-19-D-0002", agency: "VA", value: 28000000, cpars_rating: "Very Good", period: "2019-2024" },
      ],
      teamingPartners: [
        { id: 1, name: "CloudFirst Technologies", cage_code: "3DEF4", capabilities: ["Cloud Infrastructure", "DevSecOps"], set_asides: ["8(a)"], relationship: "Prime/Sub" },
        { id: 2, name: "SecureNet Solutions", cage_code: "4GHI5", capabilities: ["Cybersecurity", "Zero Trust"], set_asides: ["SDVOSB"], relationship: "Teaming" },
      ],
    };

    // ==========================================================================
    // ICONS
    // ==========================================================================
    const Icons = {
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      building: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>,
      star: () => <svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
      users: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
      dollar: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      trophy: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>,
      handshake: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
      x: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
      check: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
      loader: () => <svg className="w-full h-full animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
      refresh: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
      plus: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
      edit: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
      trash: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>,
      home: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
      alert: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
      database: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" /></svg>,
      eye: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
    };

    const Icon = ({ name, className = "w-4 h-4" }) => {
      const IconComponent = Icons[name];
      return IconComponent ? <span className={`inline-block ${className}`}><IconComponent /></span> : null;
    };

    // ==========================================================================
    // API SERVICE
    // ==========================================================================
    class TrainingDataAPI {
      constructor() {
        this.baseUrl = CONFIG.API_BASE;
        this.token = localStorage.getItem('mp_token');
      }

      async request(endpoint, options = {}) {
        const url = `${this.baseUrl}${endpoint}`;
        const headers = {
          'Content-Type': 'application/json',
          ...(this.token && { 'Authorization': `Bearer ${this.token}` }),
          ...options.headers,
        };

        try {
          const response = await fetch(url, { ...options, headers });
          if (!response.ok) {
            const error = await response.json().catch(() => ({ detail: `HTTP ${response.status}` }));
            throw new Error(error.detail || `Request failed`);
          }
          return response.json();
        } catch (error) {
          if (error.name === 'TypeError') {
            throw new Error('API unavailable - using demo data');
          }
          throw error;
        }
      }

      async getHealth() { return this.request(CONFIG.ENDPOINTS.HEALTH); }
      async getSummary() { return this.request(CONFIG.ENDPOINTS.SUMMARY); }
      async getContextStatus() { return this.request(CONFIG.ENDPOINTS.CONTEXT_STATUS); }
      
      async getCompanyProfile() { return this.request(CONFIG.ENDPOINTS.COMPANY); }
      async updateCompanyProfile(data) { return this.request(CONFIG.ENDPOINTS.COMPANY, { method: 'PUT', body: JSON.stringify(data) }); }
      
      async getWinThemes() { return this.request(CONFIG.ENDPOINTS.WIN_THEMES); }
      async createWinTheme(data) { return this.request(CONFIG.ENDPOINTS.WIN_THEMES, { method: 'POST', body: JSON.stringify(data) }); }
      async updateWinTheme(id, data) { return this.request(`${CONFIG.ENDPOINTS.WIN_THEMES}/${id}`, { method: 'PUT', body: JSON.stringify(data) }); }
      async deleteWinTheme(id) { return this.request(`${CONFIG.ENDPOINTS.WIN_THEMES}/${id}`, { method: 'DELETE' }); }
      
      async getCompetitors() { return this.request(CONFIG.ENDPOINTS.COMPETITORS); }
      async createCompetitor(data) { return this.request(CONFIG.ENDPOINTS.COMPETITORS, { method: 'POST', body: JSON.stringify(data) }); }
      async updateCompetitor(id, data) { return this.request(`${CONFIG.ENDPOINTS.COMPETITORS}/${id}`, { method: 'PUT', body: JSON.stringify(data) }); }
      async deleteCompetitor(id) { return this.request(`${CONFIG.ENDPOINTS.COMPETITORS}/${id}`, { method: 'DELETE' }); }
      
      async getLaborCategories() { return this.request(CONFIG.ENDPOINTS.LABOR_CATEGORIES); }
      async createLaborCategory(data) { return this.request(CONFIG.ENDPOINTS.LABOR_CATEGORIES, { method: 'POST', body: JSON.stringify(data) }); }
      async updateLaborCategory(id, data) { return this.request(`${CONFIG.ENDPOINTS.LABOR_CATEGORIES}/${id}`, { method: 'PUT', body: JSON.stringify(data) }); }
      async deleteLaborCategory(id) { return this.request(`${CONFIG.ENDPOINTS.LABOR_CATEGORIES}/${id}`, { method: 'DELETE' }); }
      
      async getPastPerformance() { return this.request(CONFIG.ENDPOINTS.PAST_PERFORMANCE); }
      async createPastPerformance(data) { return this.request(CONFIG.ENDPOINTS.PAST_PERFORMANCE, { method: 'POST', body: JSON.stringify(data) }); }
      async updatePastPerformance(id, data) { return this.request(`${CONFIG.ENDPOINTS.PAST_PERFORMANCE}/${id}`, { method: 'PUT', body: JSON.stringify(data) }); }
      async deletePastPerformance(id) { return this.request(`${CONFIG.ENDPOINTS.PAST_PERFORMANCE}/${id}`, { method: 'DELETE' }); }
      
      async getTeamingPartners() { return this.request(CONFIG.ENDPOINTS.TEAMING_PARTNERS); }
      async createTeamingPartner(data) { return this.request(CONFIG.ENDPOINTS.TEAMING_PARTNERS, { method: 'POST', body: JSON.stringify(data) }); }
      async updateTeamingPartner(id, data) { return this.request(`${CONFIG.ENDPOINTS.TEAMING_PARTNERS}/${id}`, { method: 'PUT', body: JSON.stringify(data) }); }
      async deleteTeamingPartner(id) { return this.request(`${CONFIG.ENDPOINTS.TEAMING_PARTNERS}/${id}`, { method: 'DELETE' }); }
    }

    const api = new TrainingDataAPI();

    // ==========================================================================
    // UI COMPONENTS
    // ==========================================================================
    const Badge = ({ variant = 'primary', size = 'sm', children }) => {
      const variants = {
        primary: 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30',
        success: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',
        warning: 'bg-amber-500/20 text-amber-400 border-amber-500/30',
        danger: 'bg-red-500/20 text-red-400 border-red-500/30',
      };
      const sizes = { xs: 'px-1.5 py-0.5 text-[10px]', sm: 'px-2 py-0.5 text-xs', md: 'px-3 py-1 text-sm' };
      return <span className={`inline-flex items-center rounded-full border font-medium ${variants[variant]} ${sizes[size]}`}>{children}</span>;
    };

    const Card = ({ children, className = '' }) => (
      <div className={`rounded-2xl border border-slate-700/50 bg-slate-800/50 backdrop-blur ${className}`}>{children}</div>
    );

    const Button = ({ variant = 'primary', size = 'md', icon, children, onClick, disabled, loading }) => {
      const variants = {
        primary: 'bg-gradient-to-r from-cyan-500 to-teal-500 text-white hover:from-cyan-400 hover:to-teal-400',
        secondary: 'bg-slate-700 text-white hover:bg-slate-600 border border-slate-600',
        ghost: 'text-slate-400 hover:text-white hover:bg-slate-800',
        danger: 'bg-red-500/20 text-red-400 hover:bg-red-500/30 border border-red-500/30',
      };
      const sizes = { xs: 'px-2 py-1 text-xs', sm: 'px-3 py-1.5 text-sm', md: 'px-4 py-2 text-sm', lg: 'px-6 py-3 text-base' };
      return (
        <button onClick={onClick} disabled={disabled || loading}
          className={`inline-flex items-center justify-center gap-2 rounded-xl font-semibold transition-all disabled:opacity-50 ${variants[variant]} ${sizes[size]}`}>
          {loading ? <Icon name="loader" className="w-4 h-4" /> : icon && <Icon name={icon} className="w-4 h-4" />}
          {children}
        </button>
      );
    };

    const Toast = ({ message, type = 'info', onClose }) => {
      useEffect(() => { const t = setTimeout(onClose, 4000); return () => clearTimeout(t); }, [onClose]);
      const styles = {
        success: 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400',
        error: 'bg-red-500/20 border-red-500/50 text-red-400',
        warning: 'bg-amber-500/20 border-amber-500/50 text-amber-400',
        info: 'bg-cyan-500/20 border-cyan-500/50 text-cyan-400',
      };
      return (
        <div className={`fixed top-4 right-4 z-50 animate-slideIn flex items-center gap-3 px-4 py-3 rounded-xl border ${styles[type]} shadow-lg`}>
          <Icon name={type === 'success' ? 'check' : 'alert'} className="w-5 h-5" />
          <span className="text-sm font-medium">{message}</span>
          <button onClick={onClose} className="opacity-60 hover:opacity-100"><Icon name="x" className="w-4 h-4" /></button>
        </div>
      );
    };

    const Modal = ({ isOpen, onClose, title, children }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
          <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose} />
          <div className="relative w-full max-w-2xl max-h-[80vh] overflow-auto bg-slate-900 border border-slate-700 rounded-2xl shadow-2xl animate-slideIn">
            <div className="sticky top-0 flex items-center justify-between p-4 border-b border-slate-700 bg-slate-900/95 backdrop-blur">
              <h3 className="text-lg font-bold text-white">{title}</h3>
              <button onClick={onClose} className="text-slate-400 hover:text-white p-1"><Icon name="x" className="w-5 h-5" /></button>
            </div>
            <div className="p-4">{children}</div>
          </div>
        </div>
      );
    };

    const DataTable = ({ columns, data, onEdit, onDelete }) => (
      <div className="overflow-x-auto">
        <table className="w-full">
          <thead>
            <tr className="border-b border-slate-700">
              {columns.map(col => (
                <th key={col.key} className="px-4 py-3 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">{col.label}</th>
              ))}
              <th className="px-4 py-3 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-slate-700/50">
            {data.map((row, idx) => (
              <tr key={row.id || idx} className="hover:bg-slate-800/50 transition-colors">
                {columns.map(col => (
                  <td key={col.key} className="px-4 py-3 text-sm text-slate-300">
                    {col.render ? col.render(row[col.key], row) : row[col.key]}
                  </td>
                ))}
                <td className="px-4 py-3 text-right">
                  <div className="flex items-center justify-end gap-2">
                    <button onClick={() => onEdit(row)} className="p-1.5 text-slate-400 hover:text-cyan-400 hover:bg-slate-800 rounded-lg transition-all">
                      <Icon name="edit" className="w-4 h-4" />
                    </button>
                    <button onClick={() => onDelete(row)} className="p-1.5 text-slate-400 hover:text-red-400 hover:bg-slate-800 rounded-lg transition-all">
                      <Icon name="trash" className="w-4 h-4" />
                    </button>
                  </div>
                </td>
              </tr>
            ))}
            {data.length === 0 && (
              <tr><td colSpan={columns.length + 1} className="px-4 py-8 text-center text-slate-500">No data available</td></tr>
            )}
          </tbody>
        </table>
      </div>
    );

    // ==========================================================================
    // TAB CONTENT COMPONENTS
    // ==========================================================================
    const CompanyTab = ({ data, onSave, isLoading }) => {
      const [formData, setFormData] = useState(data || {});
      const [editing, setEditing] = useState(false);

      useEffect(() => { setFormData(data || {}); }, [data]);

      const handleSave = () => { onSave(formData); setEditing(false); };

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="building" className="w-5 h-5 text-cyan-400" />
              Company Profile
            </h3>
            {!editing ? (
              <Button size="sm" icon="edit" onClick={() => setEditing(true)}>Edit</Button>
            ) : (
              <div className="flex gap-2">
                <Button size="sm" variant="ghost" onClick={() => setEditing(false)}>Cancel</Button>
                <Button size="sm" icon="check" onClick={handleSave} loading={isLoading}>Save</Button>
              </div>
            )}
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <label className="block text-xs font-medium text-slate-400 mb-1.5">Company Name</label>
              {editing ? (
                <input type="text" value={formData.name || ''} onChange={e => setFormData({...formData, name: e.target.value})}
                  className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none" />
              ) : (
                <p className="text-white font-medium">{formData.name || 'Not set'}</p>
              )}
            </div>
            <div>
              <label className="block text-xs font-medium text-slate-400 mb-1.5">CAGE Code</label>
              {editing ? (
                <input type="text" value={formData.cage_code || ''} onChange={e => setFormData({...formData, cage_code: e.target.value})}
                  className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none" />
              ) : (
                <p className="text-white font-medium">{formData.cage_code || 'Not set'}</p>
              )}
            </div>
            <div>
              <label className="block text-xs font-medium text-slate-400 mb-1.5">DUNS Number</label>
              {editing ? (
                <input type="text" value={formData.duns || ''} onChange={e => setFormData({...formData, duns: e.target.value})}
                  className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none" />
              ) : (
                <p className="text-white font-medium">{formData.duns || 'Not set'}</p>
              )}
            </div>
            <div>
              <label className="block text-xs font-medium text-slate-400 mb-1.5">Set-Asides</label>
              <div className="flex flex-wrap gap-1.5">
                {(formData.set_asides || []).map(sa => <Badge key={sa} variant="primary" size="xs">{sa}</Badge>)}
                {(!formData.set_asides || formData.set_asides.length === 0) && <span className="text-slate-500">None</span>}
              </div>
            </div>
            <div className="md:col-span-2">
              <label className="block text-xs font-medium text-slate-400 mb-1.5">NAICS Codes</label>
              <div className="flex flex-wrap gap-1.5">
                {(formData.naics_codes || []).map(nc => <Badge key={nc} variant="success" size="xs">{nc}</Badge>)}
                {(!formData.naics_codes || formData.naics_codes.length === 0) && <span className="text-slate-500">None</span>}
              </div>
            </div>
            <div className="md:col-span-2">
              <label className="block text-xs font-medium text-slate-400 mb-1.5">Core Competencies</label>
              <div className="flex flex-wrap gap-1.5">
                {(formData.core_competencies || []).map(cc => <Badge key={cc} variant="warning" size="xs">{cc}</Badge>)}
                {(!formData.core_competencies || formData.core_competencies.length === 0) && <span className="text-slate-500">None</span>}
              </div>
            </div>
            <div className="md:col-span-2">
              <label className="block text-xs font-medium text-slate-400 mb-1.5">Mission Statement</label>
              {editing ? (
                <textarea value={formData.mission_statement || ''} onChange={e => setFormData({...formData, mission_statement: e.target.value})}
                  rows={3} className="w-full px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-white focus:border-cyan-500 focus:outline-none" />
              ) : (
                <p className="text-slate-300">{formData.mission_statement || 'Not set'}</p>
              )}
            </div>
          </div>
        </Card>
      );
    };

    const WinThemesTab = ({ data, onCreate, onUpdate, onDelete, isLoading }) => {
      const [modalOpen, setModalOpen] = useState(false);
      const [editItem, setEditItem] = useState(null);

      const columns = [
        { key: 'title', label: 'Title' },
        { key: 'description', label: 'Description' },
        { key: 'keywords', label: 'Keywords', render: (v) => (v || []).map(k => <Badge key={k} size="xs" variant="primary">{k}</Badge>) },
        { key: 'status', label: 'Status', render: (v) => <Badge variant={v === 'active' ? 'success' : 'warning'}>{v}</Badge> },
      ];

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="star" className="w-5 h-5 text-amber-400" />
              Win Themes ({data.length})
            </h3>
            <Button size="sm" icon="plus" onClick={() => { setEditItem(null); setModalOpen(true); }}>Add Theme</Button>
          </div>
          <DataTable 
            columns={columns} 
            data={data} 
            onEdit={(row) => { setEditItem(row); setModalOpen(true); }}
            onDelete={(row) => onDelete(row.id)}
          />
        </Card>
      );
    };

    const CompetitorsTab = ({ data, onCreate, onUpdate, onDelete, isLoading }) => {
      const columns = [
        { key: 'name', label: 'Competitor' },
        { key: 'cage_code', label: 'CAGE', render: v => <code className="text-cyan-400">{v}</code> },
        { key: 'strengths', label: 'Strengths', render: v => (v || []).slice(0,2).map(s => <Badge key={s} size="xs" variant="danger">{s}</Badge>) },
        { key: 'weaknesses', label: 'Weaknesses', render: v => (v || []).slice(0,2).map(w => <Badge key={w} size="xs" variant="success">{w}</Badge>) },
        { key: 'win_rate_against', label: 'Win Rate', render: v => <span className="text-emerald-400 font-bold">{v}%</span> },
      ];

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="eye" className="w-5 h-5 text-red-400" />
              Competitor Intelligence ({data.length})
            </h3>
            <Button size="sm" icon="plus">Add Competitor</Button>
          </div>
          <DataTable columns={columns} data={data} onEdit={() => {}} onDelete={(row) => onDelete(row.id)} />
        </Card>
      );
    };

    const LaborCategoriesTab = ({ data, onCreate, onUpdate, onDelete, isLoading }) => {
      const columns = [
        { key: 'category', label: 'Category' },
        { key: 'labor_code', label: 'Code', render: v => <code className="text-cyan-400">{v}</code> },
        { key: 'base_rate', label: 'Base Rate', render: v => `$${v?.toFixed(2) || '0.00'}` },
        { key: 'fringe', label: 'Fringe %', render: v => `${v}%` },
        { key: 'overhead', label: 'OH %', render: v => `${v}%` },
        { key: 'gna', label: 'G&A %', render: v => `${v}%` },
      ];

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="dollar" className="w-5 h-5 text-emerald-400" />
              Labor Categories ({data.length})
            </h3>
            <Button size="sm" icon="plus">Add LCAT</Button>
          </div>
          <DataTable columns={columns} data={data} onEdit={() => {}} onDelete={(row) => onDelete(row.id)} />
        </Card>
      );
    };

    const PastPerformanceTab = ({ data, onCreate, onUpdate, onDelete, isLoading }) => {
      const columns = [
        { key: 'contract_name', label: 'Contract' },
        { key: 'agency', label: 'Agency', render: v => <Badge variant="primary">{v}</Badge> },
        { key: 'value', label: 'Value', render: v => `$${(v/1000000).toFixed(1)}M` },
        { key: 'cpars_rating', label: 'CPARS', render: v => <Badge variant={v === 'Exceptional' ? 'success' : 'warning'}>{v}</Badge> },
        { key: 'period', label: 'Period' },
      ];

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="trophy" className="w-5 h-5 text-purple-400" />
              Past Performance ({data.length})
            </h3>
            <Button size="sm" icon="plus">Add Contract</Button>
          </div>
          <DataTable columns={columns} data={data} onEdit={() => {}} onDelete={(row) => onDelete(row.id)} />
        </Card>
      );
    };

    const TeamingPartnersTab = ({ data, onCreate, onUpdate, onDelete, isLoading }) => {
      const columns = [
        { key: 'name', label: 'Partner' },
        { key: 'cage_code', label: 'CAGE', render: v => <code className="text-cyan-400">{v}</code> },
        { key: 'capabilities', label: 'Capabilities', render: v => (v || []).map(c => <Badge key={c} size="xs" variant="primary">{c}</Badge>) },
        { key: 'set_asides', label: 'Set-Asides', render: v => (v || []).map(s => <Badge key={s} size="xs" variant="warning">{s}</Badge>) },
        { key: 'relationship', label: 'Type', render: v => <Badge variant="success">{v}</Badge> },
      ];

      return (
        <Card className="p-6">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-lg font-bold text-white flex items-center gap-2">
              <Icon name="handshake" className="w-5 h-5 text-teal-400" />
              Teaming Partners ({data.length})
            </h3>
            <Button size="sm" icon="plus">Add Partner</Button>
          </div>
          <DataTable columns={columns} data={data} onEdit={() => {}} onDelete={(row) => onDelete(row.id)} />
        </Card>
      );
    };

    // ==========================================================================
    // MAIN APP
    // ==========================================================================
    const TrainingDataAdmin = () => {
      const [activeTab, setActiveTab] = useState('company');
      const [isLoading, setIsLoading] = useState(true);
      const [apiStatus, setApiStatus] = useState('checking');
      const [toast, setToast] = useState(null);
      const [data, setData] = useState({
        company: {},
        winThemes: [],
        competitors: [],
        laborCategories: [],
        pastPerformance: [],
        teamingPartners: [],
      });

      const tabs = [
        { id: 'company', label: 'Company', icon: 'building', color: '#00E5FA' },
        { id: 'winThemes', label: 'Win Themes', icon: 'star', color: '#F59E0B' },
        { id: 'competitors', label: 'Competitors', icon: 'eye', color: '#EF4444' },
        { id: 'laborCategories', label: 'Labor Cats', icon: 'dollar', color: '#00D29F' },
        { id: 'pastPerformance', label: 'Past Perf', icon: 'trophy', color: '#8B5CF6' },
        { id: 'teamingPartners', label: 'Teaming', icon: 'handshake', color: '#14B8A6' },
      ];

      const loadData = useCallback(async () => {
        setIsLoading(true);
        try {
          // Try API first
          const [company, winThemes, competitors, laborCategories, pastPerformance, teamingPartners] = await Promise.all([
            api.getCompanyProfile().catch(() => null),
            api.getWinThemes().catch(() => null),
            api.getCompetitors().catch(() => null),
            api.getLaborCategories().catch(() => null),
            api.getPastPerformance().catch(() => null),
            api.getTeamingPartners().catch(() => null),
          ]);

          const hasApiData = company || winThemes || competitors;
          
          setData({
            company: company?.data || DEMO_DATA.company,
            winThemes: winThemes?.data || DEMO_DATA.winThemes,
            competitors: competitors?.data || DEMO_DATA.competitors,
            laborCategories: laborCategories?.data || DEMO_DATA.laborCategories,
            pastPerformance: pastPerformance?.data || DEMO_DATA.pastPerformance,
            teamingPartners: teamingPartners?.data || DEMO_DATA.teamingPartners,
          });
          
          setApiStatus(hasApiData ? 'online' : 'demo');
        } catch (err) {
          console.error('Failed to load data:', err);
          setData(DEMO_DATA);
          setApiStatus('demo');
        }
        setIsLoading(false);
      }, []);

      useEffect(() => { loadData(); }, [loadData]);

      const showToast = (message, type = 'info') => setToast({ message, type });

      const handleSave = async (dataType, newData) => {
        setIsLoading(true);
        try {
          // API save logic would go here
          setData(prev => ({ ...prev, [dataType]: newData }));
          showToast('Saved successfully', 'success');
        } catch (err) {
          showToast('Failed to save: ' + err.message, 'error');
        }
        setIsLoading(false);
      };

      const handleDelete = async (dataType, id) => {
        if (!confirm('Are you sure you want to delete this item?')) return;
        setIsLoading(true);
        try {
          setData(prev => ({
            ...prev,
            [dataType]: prev[dataType].filter(item => item.id !== id)
          }));
          showToast('Deleted successfully', 'success');
        } catch (err) {
          showToast('Failed to delete: ' + err.message, 'error');
        }
        setIsLoading(false);
      };

      return (
        <div className="min-h-screen bg-[#00050F]">
          {toast && <Toast {...toast} onClose={() => setToast(null)} />}

          {/* Header */}
          <header className="bg-slate-900/80 border-b border-slate-700/50 sticky top-0 z-40 backdrop-blur-xl">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <a href="missionpulse-production-dashboard.html" className="flex items-center gap-3 text-slate-400 hover:text-white transition-colors">
                    <Icon name="home" className="w-5 h-5" />
                  </a>
                  <div className="w-px h-6 bg-slate-700" />
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-red-500 to-orange-500 flex items-center justify-center">
                      <Icon name="database" className="w-5 h-5 text-white" />
                    </div>
                    <div>
                      <h1 className="text-lg font-bold text-white">Training Data Admin</h1>
                      <p className="text-xs text-slate-400">M16 • ADMIN Only</p>
                    </div>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <Badge variant={apiStatus === 'online' ? 'success' : apiStatus === 'demo' ? 'warning' : 'primary'}>
                    {apiStatus === 'online' ? 'API Connected' : apiStatus === 'demo' ? 'Demo Mode' : 'Checking...'}
                  </Badge>
                  <Button size="sm" variant="secondary" icon="refresh" onClick={loadData} loading={isLoading}>
                    Refresh
                  </Button>
                </div>
              </div>
            </div>
          </header>

          {/* Main */}
          <main className="max-w-7xl mx-auto px-6 py-6">
            {/* Demo Mode Banner */}
            {apiStatus === 'demo' && (
              <div className="mb-6 p-4 rounded-xl bg-amber-500/10 border border-amber-500/30">
                <div className="flex items-center gap-3">
                  <Icon name="alert" className="w-5 h-5 text-amber-400" />
                  <div>
                    <p className="text-amber-400 font-medium">Demo Mode Active</p>
                    <p className="text-sm text-amber-400/70">Showing sample data. API connection unavailable or still warming up.</p>
                  </div>
                </div>
              </div>
            )}

            {/* Tabs */}
            <div className="flex gap-2 mb-6 overflow-x-auto pb-2">
              {tabs.map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex items-center gap-2 px-4 py-2.5 rounded-xl font-medium text-sm whitespace-nowrap transition-all ${
                    activeTab === tab.id
                      ? 'bg-slate-800 text-white border border-slate-600'
                      : 'text-slate-400 hover:text-white hover:bg-slate-800/50'
                  }`}
                >
                  <div style={{ color: activeTab === tab.id ? tab.color : undefined }}>
                    <Icon name={tab.icon} className="w-4 h-4" />
                  </div>
                  {tab.label}
                </button>
              ))}
            </div>

            {/* Tab Content */}
            {isLoading && !Object.keys(data.company).length ? (
              <Card className="p-12 flex items-center justify-center">
                <div className="text-center">
                  <Icon name="loader" className="w-10 h-10 text-cyan-400 mx-auto mb-3" />
                  <p className="text-slate-400">Loading training data...</p>
                </div>
              </Card>
            ) : (
              <>
                {activeTab === 'company' && <CompanyTab data={data.company} onSave={(d) => handleSave('company', d)} isLoading={isLoading} />}
                {activeTab === 'winThemes' && <WinThemesTab data={data.winThemes} onDelete={(id) => handleDelete('winThemes', id)} isLoading={isLoading} />}
                {activeTab === 'competitors' && <CompetitorsTab data={data.competitors} onDelete={(id) => handleDelete('competitors', id)} isLoading={isLoading} />}
                {activeTab === 'laborCategories' && <LaborCategoriesTab data={data.laborCategories} onDelete={(id) => handleDelete('laborCategories', id)} isLoading={isLoading} />}
                {activeTab === 'pastPerformance' && <PastPerformanceTab data={data.pastPerformance} onDelete={(id) => handleDelete('pastPerformance', id)} isLoading={isLoading} />}
                {activeTab === 'teamingPartners' && <TeamingPartnersTab data={data.teamingPartners} onDelete={(id) => handleDelete('teamingPartners', id)} isLoading={isLoading} />}
              </>
            )}
          </main>

          {/* Footer */}
          <footer className="max-w-7xl mx-auto px-6 py-6 border-t border-slate-800 mt-8">
            <div className="flex items-center justify-between text-xs text-slate-500">
              <span>Mission Meets Tech • MissionPulse v12.0</span>
              <span className="text-amber-500/70">AI GENERATED - REQUIRES HUMAN REVIEW</span>
            </div>
          </footer>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<TrainingDataAdmin />);
  </script>
</body>
</html>
