<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Subcontract Plan</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['CEO','COO','CAP','FIN','PM'];

    const DEMO_PARTNERS=[
      {id:1,name:'Mission Meets Tech',abbr:'MMT',role:'Prime',setAside:'SDVOSB',cage:'8ABC1',duns:'123456789',naics:'541512',value:26800000,workshare:59.6,color:'#00E5FA',
        lcats:['PM','DPM','SA','AI-Lead','Cyber','DSO','QA','HD-Lead','HD-T1 (x2)','TW','TS'],fteCount:11.5,
        deliverables:['Overall program management','Technical architecture & DevSecOps','AI/ML integration & AskSage','Cybersecurity & ATO','Quality assurance','Help desk operations','Documentation & training'],
        agreement:'N/A — Prime',agreementStatus:'N/A',agreementDate:null},
      {id:2,name:'TechPartner Alpha',abbr:'TPA',role:'Major Subcontractor',setAside:'SDB (8a)',cage:'9XYZ2',duns:'987654321',naics:'541511',value:8200000,workshare:18.2,color:'#a78bfa',
        lcats:['Sr-Dev'],fteCount:1.0,
        deliverables:['Full-stack software development','API development & integration','Frontend UI/UX implementation','Code review support'],
        agreement:'Teaming Agreement',agreementStatus:'EXECUTED',agreementDate:'2025-10-20'},
      {id:3,name:'SecureForce Inc.',abbr:'SFI',role:'Subcontractor',setAside:'HUBZone',cage:'5DEF3',duns:'456789012',naics:'541519',value:5400000,workshare:12.0,color:'#f59e0b',
        lcats:['ISSO'],fteCount:0.5,
        deliverables:['eMASS management & POA&M tracking','STIG/SCAP compliance scanning','Vulnerability management','Audit support & evidence collection'],
        agreement:'Teaming Agreement',agreementStatus:'EXECUTED',agreementDate:'2025-11-05'},
      {id:4,name:'DataBridge LLC',abbr:'DBL',role:'Subcontractor',setAside:'WOSB',cage:'7GHI4',duns:'789012345',naics:'541519',value:4600000,workshare:10.2,color:'#00ff88',
        lcats:['DE'],fteCount:1.0,
        deliverables:['Data migration & ETL pipeline development','Data lake architecture','Analytics dashboard development','Data quality & governance'],
        agreement:'Teaming Agreement',agreementStatus:'EXECUTED',agreementDate:'2025-11-12'},
    ];

    const SB_GOALS=[
      {category:'Small Disadvantaged Business (SDB)',goal:5.0,actual:18.2,source:'TechPartner Alpha',met:true},
      {category:'HUBZone Small Business',goal:3.0,actual:12.0,source:'SecureForce Inc.',met:true},
      {category:'Women-Owned Small Business (WOSB)',goal:5.0,actual:10.2,source:'DataBridge LLC',met:true},
      {category:'Service-Disabled Veteran-Owned (SDVOSB)',goal:3.0,actual:59.6,source:'Mission Meets Tech (Prime)',met:true},
      {category:'Small Business (Overall)',goal:23.0,actual:100.0,source:'All partners are small businesses',met:true},
    ];

    const DEMO_DELIVERABLE_MATRIX=[
      {clin:'0001',desc:'Program Management',prime:'MMT',subs:[]},
      {clin:'0002',desc:'Technical Approach & DevSecOps',prime:'MMT',subs:['TPA']},
      {clin:'0003',desc:'AI/ML Integration',prime:'MMT',subs:[]},
      {clin:'0004',desc:'Cybersecurity & ATO',prime:'MMT',subs:['SFI']},
      {clin:'0005',desc:'Data Migration & Analytics',prime:'MMT',subs:['DBL']},
      {clin:'0006',desc:'Help Desk Operations',prime:'MMT',subs:[]},
      {clin:'0007',desc:'Training & Documentation',prime:'MMT',subs:[]},
    ];

    const fmt=v=>v>=1000000?`$${(v/1000000).toFixed(1)}M`:v>=1000?`$${(v/1000).toFixed(0)}K`:`$${v.toFixed(0)}`;
    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[tab,setTab]=useState('overview');

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('teaming_partners').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const totalValue=DEMO_PARTNERS.reduce((s,p)=>s+p.value,0);
      const subValue=DEMO_PARTNERS.filter(p=>p.role!=='Prime').reduce((s,p)=>s+p.value,0);
      const primeShare=DEMO_PARTNERS.find(p=>p.role==='Prime')?.workshare||0;

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>TEAMING & SUBCONTRACTING</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Subcontract Plan</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>DHA EHR Modernization • Workshare • SB goals • Partner deliverables</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Value',value:fmt(totalValue),color:'#00E5FA'},
              {label:'Prime Share',value:`${primeShare.toFixed(1)}%`,color:primeShare>=51?'#00ff88':'#ef4444'},
              {label:'Sub Value',value:fmt(subValue),color:'#a78bfa'},
              {label:'Partners',value:DEMO_PARTNERS.length,color:'#00E5FA'},
              {label:'SB Goals Met',value:`${SB_GOALS.filter(g=>g.met).length}/${SB_GOALS.length}`,color:'#00ff88'},
              {label:'Agreements',value:`${DEMO_PARTNERS.filter(p=>p.agreementStatus==='EXECUTED').length} executed`,color:'#00ff88'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'125px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Workshare Bar */}
          <div style={{marginBottom:'20px'}}>
            <div style={{fontSize:'10px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase',marginBottom:'6px'}}>WORKSHARE DISTRIBUTION</div>
            <div style={{display:'flex',height:'28px',borderRadius:'8px',overflow:'hidden',background:'rgba(255,255,255,0.03)'}}>
              {DEMO_PARTNERS.map(p=>(
                <div key={p.id} style={{width:`${p.workshare}%`,background:p.color,display:'flex',alignItems:'center',justifyContent:'center',fontSize:'9px',fontWeight:700,color:'#000510',transition:'width 0.3s'}} title={`${p.abbr}: ${p.workshare}%`}>
                  {p.workshare>8&&`${p.abbr} ${p.workshare}%`}
                </div>
              ))}
            </div>
            <div style={{display:'flex',gap:'12px',marginTop:'6px'}}>
              {DEMO_PARTNERS.map(p=>(
                <span key={p.id} style={{display:'flex',alignItems:'center',gap:'4px',fontSize:'10px',color:'#5a7a9a'}}>
                  <div style={{width:'8px',height:'8px',borderRadius:'2px',background:p.color}}/>{p.name}: {p.workshare}%
                </span>
              ))}
            </div>
          </div>

          <div style={{display:'flex',gap:'4px',marginBottom:'16px'}}>
            {[{k:'overview',l:'Partner Overview'},{k:'sbgoals',l:'SB Goals'},{k:'deliverables',l:'CLIN Matrix'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
          </div>

          {/* OVERVIEW */}
          {tab==='overview'&&(
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(320px,1fr))',gap:'10px'}}>
              {DEMO_PARTNERS.map(p=>(
                <div key={p.id} style={{background:'rgba(10,22,40,0.5)',border:`1px solid ${p.color}20`,borderRadius:'12px',padding:'18px'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'10px'}}>
                    <div style={{width:'12px',height:'12px',borderRadius:'4px',background:p.color}}/>
                    <span style={{fontSize:'16px',fontWeight:800,color:'white'}}>{p.name}</span>
                  </div>
                  <div style={{display:'flex',gap:'6px',flexWrap:'wrap',marginBottom:'10px'}}>
                    <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${p.color}15`,color:p.color}}>{p.role}</span>
                    <span style={{fontSize:'9px',fontWeight:600,padding:'2px 6px',borderRadius:'3px',background:'rgba(0,255,136,0.08)',color:'#00ff88'}}>{p.setAside}</span>
                    {p.agreementStatus==='EXECUTED'&&<span style={{fontSize:'9px',fontWeight:600,padding:'2px 6px',borderRadius:'3px',background:'rgba(0,255,136,0.08)',color:'#00ff88'}}>TA ✓</span>}
                  </div>
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'8px',marginBottom:'12px'}}>
                    <div><div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a'}}>VALUE</div><div style={{fontSize:'16px',fontWeight:800,color:p.color}}>{fmt(p.value)}</div></div>
                    <div><div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a'}}>WORKSHARE</div><div style={{fontSize:'16px',fontWeight:800,color:'#e2e8f0'}}>{p.workshare}%</div></div>
                    <div><div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a'}}>FTEs</div><div style={{fontSize:'14px',fontWeight:700,color:'#e2e8f0'}}>{p.fteCount}</div></div>
                    <div><div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a'}}>NAICS</div><div style={{fontSize:'12px',fontWeight:600,color:'#94a3b8'}}>{p.naics}</div></div>
                  </div>
                  <div style={{fontSize:'10px',color:'#5a7a9a',marginBottom:'4px',fontWeight:700}}>DELIVERABLES</div>
                  {p.deliverables.map(d=><div key={d} style={{fontSize:'11px',color:'#94a3b8',padding:'1px 0'}}>▸ {d}</div>)}
                  <div style={{marginTop:'10px',display:'flex',gap:'4px',flexWrap:'wrap'}}>
                    {p.lcats.map(l=><span key={l} style={{fontSize:'9px',padding:'1px 5px',borderRadius:'3px',background:'rgba(0,229,250,0.06)',color:'#67e8f9'}}>{l}</span>)}
                  </div>
                  {p.agreementDate&&<div style={{marginTop:'8px',fontSize:'10px',color:'#3e4f63'}}>CAGE: {p.cage} | DUNS: {p.duns} | TA signed: {p.agreementDate}</div>}
                </div>
              ))}
            </div>
          )}

          {/* SB GOALS */}
          {tab==='sbgoals'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'18px'}}>
              <div style={{fontSize:'13px',fontWeight:700,color:'white',marginBottom:'14px'}}>Small Business Subcontracting Goals (FAR 52.219-9)</div>
              <div style={{display:'flex',flexDirection:'column',gap:'12px'}}>
                {SB_GOALS.map(g=>(
                  <div key={g.category} style={{display:'flex',alignItems:'center',gap:'14px'}}>
                    <div style={{minWidth:'240px'}}>
                      <div style={{fontSize:'12px',fontWeight:600,color:'white'}}>{g.category}</div>
                      <div style={{fontSize:'10px',color:'#5a7a9a'}}>{g.source}</div>
                    </div>
                    <div style={{flex:1}}>
                      <div style={{position:'relative',height:'16px',background:'rgba(255,255,255,0.04)',borderRadius:'8px',overflow:'hidden'}}>
                        {/* Goal marker */}
                        <div style={{position:'absolute',left:`${Math.min(g.goal,100)}%`,top:'0',bottom:'0',width:'2px',background:'#f59e0b',zIndex:2}}/>
                        {/* Actual bar */}
                        <div style={{width:`${Math.min(g.actual,100)}%`,height:'100%',background:g.met?'#00ff88':'#ef4444',borderRadius:'8px',transition:'width 0.3s'}}/>
                      </div>
                    </div>
                    <div style={{minWidth:'80px',textAlign:'right'}}>
                      <span style={{fontSize:'11px',fontWeight:700,color:'#f59e0b'}}>Goal: {g.goal}%</span>
                    </div>
                    <div style={{minWidth:'80px',textAlign:'right'}}>
                      <span style={{fontSize:'11px',fontWeight:700,color:g.met?'#00ff88':'#ef4444'}}>Actual: {g.actual}%</span>
                    </div>
                    <span style={{fontSize:'12px',minWidth:'20px'}}>{g.met?'✅':'❌'}</span>
                  </div>
                ))}
              </div>
              <div style={{marginTop:'14px',background:'rgba(0,255,136,0.04)',borderRadius:'8px',padding:'10px 14px',border:'1px solid rgba(0,255,136,0.1)',fontSize:'11px',color:'#86efac'}}>
                ✓ All small business subcontracting goals exceeded. 100% small business team (SDVOSB prime + SDB + HUBZone + WOSB subs).
              </div>
            </div>
          )}

          {/* CLIN MATRIX */}
          {tab==='deliverables'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'auto'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  <th style={{padding:'10px 12px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>CLIN</th>
                  <th style={{padding:'10px 12px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>DESCRIPTION</th>
                  <th style={{padding:'10px 12px',textAlign:'center',color:'#5a7a9a',fontWeight:700,fontSize:'10px'}}>PRIME</th>
                  {DEMO_PARTNERS.filter(p=>p.role!=='Prime').map(p=>(
                    <th key={p.id} style={{padding:'10px 8px',textAlign:'center',fontWeight:700,fontSize:'10px',color:p.color}}>{p.abbr}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {DEMO_DELIVERABLE_MATRIX.map(d=>(
                    <tr key={d.clin} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}}>
                      <td style={{padding:'10px 12px',fontFamily:'monospace',fontSize:'11px',color:'#00E5FA',fontWeight:600}}>{d.clin}</td>
                      <td style={{padding:'10px 12px',color:'white',fontWeight:500}}>{d.desc}</td>
                      <td style={{padding:'10px 12px',textAlign:'center'}}><span style={{fontSize:'14px'}}>●</span></td>
                      {DEMO_PARTNERS.filter(p=>p.role!=='Prime').map(p=>(
                        <td key={p.id} style={{padding:'10px 8px',textAlign:'center'}}>
                          {d.subs.includes(p.abbr)?<span style={{fontSize:'14px',color:p.color}}>●</span>:<span style={{color:'#1e293b'}}>—</span>}
                        </td>
                      ))}
                    </tr>
                  ))}
                </tbody>
              </table>
              <div style={{padding:'10px 14px',fontSize:'10px',color:'#5a7a9a'}}>● = Responsible party. Prime maintains oversight of all CLINs regardless of sub involvement.</div>
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
