<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Compliance Mapping</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const SECTIONS=['L','M','C','B','H','K','J'];
    const SECTION_NAMES={L:'Instructions',M:'Evaluation Criteria',C:'Statement of Work',B:'Pricing Schedule',H:'Special Contract Requirements',K:'Representations & Certifications',J:'Attachments'};

    const DEMO_MAPPINGS=[
      // Section L Instructions → Response
      {id:1,source:'L.4.1',sourceText:'Technical Approach',sourceSection:'L',target:'Vol II §2.1',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'Fully addressed with architecture, migration, integration.',evalFactor:'M.1',evalWeight:30},
      {id:2,source:'L.4.2',sourceText:'DevSecOps Pipeline',sourceSection:'L',target:'Vol II §2.2',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'CI/CD pipeline with security scanning.',evalFactor:'M.1',evalWeight:30},
      {id:3,source:'L.4.3',sourceText:'Security & ATO Approach',sourceSection:'L',target:'Vol II §2.3',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'PARTIAL',coverage:85,notes:'RMF steps complete. ConMon tool selection pending.',evalFactor:'M.3',evalWeight:15},
      {id:4,source:'L.4.4',sourceText:'Data Migration',sourceSection:'L',target:'Vol II §2.4',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'4-phase approach with rollback.',evalFactor:'M.1',evalWeight:30},
      {id:5,source:'L.4.5',sourceText:'AI/ML Capabilities',sourceSection:'L',target:'Vol II §2.5',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'Responsible AI framework with AskSage.',evalFactor:'M.2',evalWeight:15},
      {id:6,source:'L.5.1',sourceText:'Management Methodology',sourceSection:'L',target:'Vol III §3.1',targetDoc:'DHA_EHR_Vol_III_Mgmt.docx',status:'MAPPED',coverage:100,notes:'SAFe + EVM hybrid with RACI.',evalFactor:'M.4',evalWeight:20},
      {id:7,source:'L.5.2',sourceText:'Staffing Plan',sourceSection:'L',target:'Vol III §3.2',targetDoc:'DHA_EHR_Vol_III_Mgmt.docx',status:'MAPPED',coverage:100,notes:'14 FTEs with org chart.',evalFactor:'M.5',evalWeight:10},
      {id:8,source:'L.5.3',sourceText:'Risk Management',sourceSection:'L',target:'Vol III §3.3',targetDoc:'DHA_EHR_Vol_III_Mgmt.docx',status:'MAPPED',coverage:100,notes:'10 risks with 5x5 matrix.',evalFactor:'M.4',evalWeight:20},
      {id:9,source:'L.5.4',sourceText:'Transition Plan',sourceSection:'L',target:'Vol III §3.4',targetDoc:'DHA_EHR_Vol_III_Mgmt.docx',status:'PARTIAL',coverage:75,notes:'Phase 3 acceptance criteria needs KO input.',evalFactor:'M.5',evalWeight:10},
      {id:10,source:'L.5.5',sourceText:'Quality Control',sourceSection:'L',target:'Vol III §3.5',targetDoc:'DHA_EHR_Vol_III_Mgmt.docx',status:'MAPPED',coverage:100,notes:'ISO 9001:2015 aligned QCP.',evalFactor:'M.4',evalWeight:20},
      {id:11,source:'L.6.1',sourceText:'Past Performance — Contract 1',sourceSection:'L',target:'Vol IV §4.1',targetDoc:'DHA_EHR_Vol_IV_PP.docx',status:'MAPPED',coverage:100,notes:'DHA contract. Exceptional CPARS.',evalFactor:'M.6',evalWeight:10},
      {id:12,source:'L.6.2',sourceText:'Past Performance — Contract 2',sourceSection:'L',target:'Vol IV §4.2',targetDoc:'DHA_EHR_Vol_IV_PP.docx',status:'MAPPED',coverage:100,notes:'VA cloud migration.',evalFactor:'M.6',evalWeight:10},
      {id:13,source:'L.6.3',sourceText:'Past Performance — Contract 3 (AI)',sourceSection:'L',target:'Vol IV §4.3',targetDoc:'DHA_EHR_Vol_IV_PP.docx',status:'GAP',coverage:30,notes:'No direct federal healthcare AI PP. Using CMS analytics + sub PP.',evalFactor:'M.6',evalWeight:10},
      {id:14,source:'L.7.1',sourceText:'Basis of Estimate',sourceSection:'L',target:'Vol V §5.1',targetDoc:'DHA_EHR_Vol_V_Pricing.docx',status:'MAPPED',coverage:100,notes:'Bottom-up BOE with GSA rates.',evalFactor:null,evalWeight:0},
      // Section C PWS → Response
      {id:15,source:'C.3.1',sourceText:'EHR System Administration',sourceSection:'C',target:'Vol II §2.1.1',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'Covered in tech approach.',evalFactor:'M.1',evalWeight:30},
      {id:16,source:'C.3.2',sourceText:'Help Desk Operations (Tier 1-3)',sourceSection:'C',target:'Vol II §2.6',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'PARTIAL',coverage:60,notes:'Tier 1-2 covered. Tier 3 escalation procedures need detail.',evalFactor:'M.1',evalWeight:30},
      {id:17,source:'C.4.1',sourceText:'Data Analytics & Reporting',sourceSection:'C',target:'Vol II §2.5.2',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'Covered in AI/ML section.',evalFactor:'M.2',evalWeight:15},
      {id:18,source:'C.5.1',sourceText:'Cybersecurity Requirements',sourceSection:'C',target:'Vol II §2.3',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'PARTIAL',coverage:85,notes:'Maps to ATO section. ConMon gap.',evalFactor:'M.3',evalWeight:15},
      // Section H Special Requirements
      {id:19,source:'H.1',sourceText:'Organizational Conflict of Interest',sourceSection:'H',target:'Admin §6.2',targetDoc:'DHA_EHR_Admin.docx',status:'MAPPED',coverage:100,notes:'OCI mitigation plan included.',evalFactor:null,evalWeight:0},
      {id:20,source:'H.4',sourceText:'Section 508 Compliance',sourceSection:'H',target:'Vol II §2.7',targetDoc:'DHA_EHR_Vol_II_Tech.docx',status:'MAPPED',coverage:100,notes:'VPAT + automated testing.',evalFactor:null,evalWeight:0},
      {id:21,source:'H.6',sourceText:'Small Business Subcontracting Plan',sourceSection:'H',target:'Admin §6.1',targetDoc:'DHA_EHR_Admin.docx',status:'PARTIAL',coverage:50,notes:'Template drafted. Sub percentages pending teaming calc.',evalFactor:null,evalWeight:0},
    ];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const CoverageBar=({pct})=>{
      const c=pct===100?'#00ff88':pct>=75?'#00E5FA':pct>=50?'#f59e0b':'#ef4444';
      return(
        <div style={{display:'flex',alignItems:'center',gap:'6px'}}>
          <div style={{width:'60px',height:'6px',background:'rgba(255,255,255,0.04)',borderRadius:'3px',overflow:'hidden'}}>
            <div style={{width:`${pct}%`,height:'100%',background:c,borderRadius:'3px',transition:'width 0.3s'}}/>
          </div>
          <span style={{fontSize:'10px',fontWeight:700,color:c,minWidth:'32px'}}>{pct}%</span>
        </div>
      );
    };

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[mappings]=useState(DEMO_MAPPINGS);
      const[sectionFilter,setSectionFilter]=useState('All');
      const[statusFilter,setStatusFilter]=useState('All');
      const[tab,setTab]=useState('matrix');

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('compliance_items').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const filtered=useMemo(()=>mappings.filter(m=>{
        if(sectionFilter!=='All'&&m.sourceSection!==sectionFilter)return false;
        if(statusFilter!=='All'&&m.status!==statusFilter)return false;
        return true;
      }),[mappings,sectionFilter,statusFilter]);

      const overallCoverage=Math.round(mappings.reduce((s,m)=>s+m.coverage,0)/mappings.length);
      const mapped=mappings.filter(m=>m.status==='MAPPED').length;
      const partial=mappings.filter(m=>m.status==='PARTIAL').length;
      const gaps=mappings.filter(m=>m.status==='GAP').length;
      const statusColor={MAPPED:'#00ff88',PARTIAL:'#f59e0b',GAP:'#ef4444'};

      // Section summary
      const sectionSummary=useMemo(()=>{
        return SECTIONS.map(s=>{
          const items=mappings.filter(m=>m.sourceSection===s);
          if(items.length===0)return null;
          const avg=Math.round(items.reduce((sum,m)=>sum+m.coverage,0)/items.length);
          return{section:s,name:SECTION_NAMES[s],count:items.length,avgCoverage:avg,gaps:items.filter(m=>m.status==='GAP').length,partial:items.filter(m=>m.status==='PARTIAL').length};
        }).filter(Boolean);
      },[mappings]);

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>RFP CROSS-REFERENCE</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Compliance Mapping</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Section L/C/H → Response • Coverage tracking • Gap flagging</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Mappings',value:mappings.length,color:'#00E5FA'},
              {label:'Fully Mapped',value:mapped,color:'#00ff88'},
              {label:'Partial',value:partial,color:'#f59e0b'},
              {label:'Gaps',value:gaps,color:gaps>0?'#ef4444':'#00ff88'},
              {label:'Overall Coverage',value:`${overallCoverage}%`,color:overallCoverage>=90?'#00ff88':overallCoverage>=75?'#00E5FA':'#f59e0b'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'125px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Coverage by Section */}
          <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'14px 18px',marginBottom:'20px'}}>
            <div style={{fontSize:'11px',fontWeight:700,color:'white',marginBottom:'10px'}}>Coverage by RFP Section</div>
            <div style={{display:'flex',gap:'10px',flexWrap:'wrap'}}>
              {sectionSummary.map(s=>(
                <div key={s.section} style={{flex:'1',minWidth:'140px',background:'rgba(0,0,0,0.2)',borderRadius:'8px',padding:'10px 12px'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'6px',marginBottom:'6px'}}>
                    <span style={{fontFamily:'monospace',fontSize:'12px',fontWeight:700,color:'#00E5FA'}}>§{s.section}</span>
                    <span style={{fontSize:'10px',color:'#5a7a9a'}}>{s.name}</span>
                  </div>
                  <CoverageBar pct={s.avgCoverage}/>
                  <div style={{fontSize:'9px',color:'#5a7a9a',marginTop:'4px'}}>{s.count} items{s.gaps>0?` • ${s.gaps} gap${s.gaps>1?'s':''}`:''}{s.partial>0?` • ${s.partial} partial`:''}</div>
                </div>
              ))}
            </div>
          </div>

          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'matrix',l:'Mapping Table'},{k:'gaps',l:'Gaps Only'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{display:'flex',gap:'3px',marginLeft:'8px'}}>
              {['All',...SECTIONS.filter(s=>mappings.some(m=>m.sourceSection===s))].map(s=>(
                <button key={s} onClick={()=>setSectionFilter(s)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',background:sectionFilter===s?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:sectionFilter===s?'#00E5FA':'#5a7a9a'}}>§{s}</button>
              ))}
            </div>
            <div style={{display:'flex',gap:'3px'}}>
              {['All','MAPPED','PARTIAL','GAP'].map(s=>(
                <button key={s} onClick={()=>setStatusFilter(s)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',background:statusFilter===s?'rgba(0,229,250,0.12)':'transparent',color:statusFilter===s?'#00E5FA':'#5a7a9a'}}>{s}</button>
              ))}
            </div>
          </div>

          {/* MAPPING TABLE */}
          {tab==='matrix'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'auto'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px',minWidth:'900px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  {['RFP Ref','Requirement','→','Response Section','Status','Coverage','Eval Factor','Notes'].map(h=>(
                    <th key={h} style={{padding:'10px 10px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px',letterSpacing:'0.5px',textTransform:'uppercase',whiteSpace:'nowrap'}}>{h}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {filtered.map(m=>(
                    <tr key={m.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}} onMouseOver={e=>e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
                      <td style={{padding:'9px 10px',fontFamily:'monospace',fontSize:'11px',fontWeight:700,color:'#00E5FA',whiteSpace:'nowrap'}}>{m.source}</td>
                      <td style={{padding:'9px 10px',color:'white',fontWeight:500,maxWidth:'180px',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{m.sourceText}</td>
                      <td style={{padding:'9px 4px',color:'#3e4f63',textAlign:'center'}}>→</td>
                      <td style={{padding:'9px 10px',fontFamily:'monospace',fontSize:'11px',color:'#a78bfa',whiteSpace:'nowrap'}}>{m.target}</td>
                      <td style={{padding:'9px 10px'}}><span style={{fontSize:'10px',fontWeight:700,padding:'2px 7px',borderRadius:'4px',background:`${statusColor[m.status]}12`,color:statusColor[m.status]}}>{m.status}</span></td>
                      <td style={{padding:'9px 10px'}}><CoverageBar pct={m.coverage}/></td>
                      <td style={{padding:'9px 10px',fontSize:'10px',color:'#5a7a9a',whiteSpace:'nowrap'}}>{m.evalFactor?`${m.evalFactor} (${m.evalWeight}%)`:'-'}</td>
                      <td style={{padding:'9px 10px',fontSize:'11px',color:'#64748b',maxWidth:'200px',overflow:'hidden',textOverflow:'ellipsis',whiteSpace:'nowrap'}}>{m.notes}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          {/* GAPS ONLY */}
          {tab==='gaps'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
              {mappings.filter(m=>m.status!=='MAPPED').length===0?(
                <div style={{textAlign:'center',padding:'40px',color:'#00ff88',fontSize:'14px',fontWeight:600}}>✓ All requirements fully mapped</div>
              ):(
                mappings.filter(m=>m.status!=='MAPPED').sort((a,b)=>a.coverage-b.coverage).map(m=>(
                  <div key={m.id} style={{background:'rgba(10,22,40,0.5)',border:`1px solid ${statusColor[m.status]}20`,borderRadius:'10px',padding:'14px 18px',borderLeft:`3px solid ${statusColor[m.status]}`}}>
                    <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'6px'}}>
                      <span style={{fontFamily:'monospace',fontSize:'12px',fontWeight:700,color:'#00E5FA'}}>{m.source}</span>
                      <span style={{fontSize:'13px',fontWeight:600,color:'white'}}>{m.sourceText}</span>
                      <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${statusColor[m.status]}12`,color:statusColor[m.status]}}>{m.status}</span>
                      <CoverageBar pct={m.coverage}/>
                    </div>
                    <div style={{fontSize:'12px',color:'#94a3b8',lineHeight:'1.5'}}>→ {m.target} | {m.notes}</div>
                    {m.evalFactor&&<div style={{fontSize:'10px',color:'#f59e0b',marginTop:'4px'}}>Eval impact: {m.evalFactor} ({m.evalWeight}% weight)</div>}
                  </div>
                ))
              )}
            </div>
          )}

          <div style={{marginTop:'10px',fontSize:'11px',color:'#3e4f63',textAlign:'right'}}>{filtered.length} of {mappings.length} mappings shown</div>
          <div style={{textAlign:'center',padding:'20px 0',marginTop:'20px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
