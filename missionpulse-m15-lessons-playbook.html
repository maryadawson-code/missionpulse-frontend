<!DOCTYPE html>
<html lang="en">
<head>
  <!-- CORE: Must load first for RBAC and connection management -->
  <script src="missionpulse-core.js"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse M15 - Lessons Learned & Playbook Integration</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #00050F; min-height: 100vh; color: #fff; }
    
    /* Animations */
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(0,229,250,0.3); } 50% { box-shadow: 0 0 40px rgba(0,229,250,0.5); } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    @keyframes confetti { 0% { transform: translateY(0) rotate(0deg); opacity: 1; } 100% { transform: translateY(-100px) rotate(720deg); opacity: 0; } }
    
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-slideUp { animation: slideUp 0.5s ease-out forwards; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    .animate-scaleIn { animation: scaleIn 0.3s ease-out forwards; }
    .animate-glow { animation: glow 2s ease-in-out infinite; }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111C2E; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #243656; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #00E5FA; }
    
    /* Glass effect */
    .glass-card {
      background: rgba(17, 28, 46, 0.7);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    /* Gradient border */
    .gradient-border {
      position: relative;
      background: linear-gradient(135deg, #111C2E 0%, #0A1628 100%);
    }
    .gradient-border::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      padding: 1px;
      background: linear-gradient(135deg, #00E5FA 0%, #00BDAE 100%);
      -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
    }
    
    /* Trophy shimmer */
    .trophy-shimmer {
      background: linear-gradient(90deg, transparent, rgba(255,215,0,0.3), transparent);
      background-size: 200% 100%;
      animation: shimmer 2s infinite;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ============================================
    // HARDENING LAYER - RBAC + Error Boundary
    // ============================================
    const ALLOWED_ROLES = ["CEO", "COO", "CAP", "PM", "SA", "FIN", "CON", "DEL", "VIEWER"];
    const MODULE_NAME = "M15 Lessons";

    class ErrorBoundary extends React.Component {
      constructor(props) {
        super(props);
        this.state = { hasError: false, error: null };
      }
      static getDerivedStateFromError(error) {
        return { hasError: true, error };
      }
      componentDidCatch(error, errorInfo) {
        console.error(MODULE_NAME + ' Error:', error, errorInfo);
      }
      render() {
        if (this.state.hasError) {
          return (
            <div className="min-h-screen bg-[#00050F] flex items-center justify-center p-6">
              <div className="text-center max-w-md">
                <div className="w-16 h-16 mx-auto mb-4 rounded-2xl bg-red-500/20 flex items-center justify-center">
                  <svg className="w-8 h-8 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                </div>
                <h2 className="text-xl font-bold text-white mb-2">Module Error</h2>
                <p className="text-slate-400 mb-4">Something went wrong loading {MODULE_NAME}.</p>
                <button onClick={() => window.location.reload()} className="px-4 py-2 bg-cyan-500 text-white rounded-lg hover:bg-cyan-600">Reload</button>
              </div>
            </div>
          );
        }
        return this.props.children;
      }
    }

    const ConnectionBanner = ({ status }) => {
      if (status === 'connected') return null;
      const config = {
        connecting: { bg: 'bg-amber-500/20', border: 'border-amber-500/30', text: 'text-amber-400', msg: 'Connecting to server...' },
        disconnected: { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400', msg: 'Connection lost. Data may be stale.' },
        error: { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400', msg: 'Unable to connect to server.' }
      };
      const c = config[status] || config.error;
      return (
        <div className={`${c.bg} ${c.border} border-b px-4 py-2 flex items-center gap-2`}>
          <svg className={`w-4 h-4 ${c.text} ${status === 'connecting' ? 'animate-spin' : ''}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
            {status === 'connecting' ? (
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            ) : (
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            )}
          </svg>
          <span className={`text-sm ${c.text}`}>{c.msg}</span>
        </div>
      );
    };

    const AccessDenied = ({ userRole, requiredRoles }) => (
      <div className="min-h-screen bg-[#00050F] flex items-center justify-center p-6">
        <div className="text-center max-w-md">
          <div className="w-20 h-20 mx-auto mb-6 rounded-2xl bg-red-500/20 flex items-center justify-center">
            <svg className="w-10 h-10 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
          </div>
          <h2 className="text-2xl font-bold text-white mb-2">Access Restricted</h2>
          <p className="text-slate-400 mb-6">{MODULE_NAME} requires elevated permissions.</p>
          <div className="bg-slate-800/50 rounded-xl p-4 mb-6 border border-slate-700">
            <div className="flex items-center justify-between mb-3">
              <span className="text-slate-400 text-sm">Your Role</span>
              <span className="px-3 py-1 rounded-full bg-slate-700 text-slate-300 text-sm font-medium">{userRole || 'Unknown'}</span>
            </div>
            <div className="flex items-center justify-between">
              <span className="text-slate-400 text-sm">Required Roles</span>
              <div className="flex gap-1 flex-wrap justify-end">
                {requiredRoles.slice(0,3).map(role => (
                  <span key={role} className="px-2 py-1 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-medium">{role}</span>
                ))}
                {requiredRoles.length > 3 && <span className="px-2 py-1 text-slate-500 text-xs">+{requiredRoles.length - 3} more</span>}
              </div>
            </div>
          </div>
          <a href="index.html" className="inline-flex items-center gap-2 px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600">
            <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Return to Dashboard
          </a>
        </div>
      </div>
    );

    const LoadingSkeleton = () => (
      <div className="min-h-screen bg-[#00050F] p-6">
        <div className="mb-6">
          <div className="h-8 skeleton rounded w-1/3 mb-2" />
          <div className="h-4 skeleton rounded w-1/2" />
        </div>
        <div className="grid grid-cols-12 gap-4">
          <div className="col-span-8 space-y-4">
            <div className="h-64 skeleton rounded-xl" />
            <div className="h-48 skeleton rounded-xl" />
          </div>
          <div className="col-span-4 space-y-4">
            <div className="h-32 skeleton rounded-xl" />
            <div className="h-32 skeleton rounded-xl" />
            <div className="h-32 skeleton rounded-xl" />
          </div>
        </div>
      </div>
    );

    // RBAC Hook
    const useRBAC = () => {
      const [authState, setAuthState] = React.useState({ checking: true, userRole: null, hasAccess: false });
      
      React.useEffect(() => {
        const checkAccess = async () => {
          try {
            if (window.MissionPulseCore?.checkAccess) {
              const result = await window.MissionPulseCore.checkAccess(ALLOWED_ROLES);
              setAuthState({ checking: false, userRole: result.role, hasAccess: result.hasAccess });
            } else {
              const userRole = localStorage.getItem('missionpulse_role') || 'VIEWER';
              const hasAccess = ALLOWED_ROLES.includes(userRole);
              setAuthState({ checking: false, userRole, hasAccess });
            }
          } catch (error) {
            console.error('RBAC check failed:', error);
            setAuthState({ checking: false, userRole: 'UNKNOWN', hasAccess: false });
          }
        };
        setTimeout(checkAccess, 300);
      }, []);
      
      return authState;
    };

    // Connection Hook  
    const useConnection = () => {
      const [status, setStatus] = React.useState('connecting');
      React.useEffect(() => {
        const timer = setTimeout(() => setStatus('connected'), 800);
        return () => clearTimeout(timer);
      }, []);
      return status;
    };
    // ============================================
    // END HARDENING LAYER
    // ============================================



    // =====================================================
    // ICONS
    // =====================================================
    const Icons = {
      search: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" strokeWidth={2}/><path strokeLinecap="round" strokeWidth={2} d="M21 21l-4.35-4.35"/></svg>,
      filter: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>,
      star: () => <svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
      starOutline: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/></svg>,
      trophy: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>,
      book: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>,
      plus: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>,
      download: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
      upload: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/></svg>,
      check: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>,
      x: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>,
      trending: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>,
      clock: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6l4 2"/></svg>,
      tag: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/></svg>,
      eye: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>,
      archive: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/></svg>,
      sparkles: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/></svg>,
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
      lightbulb: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/></svg>,
      users: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>,
      award: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/></svg>,
      chevronDown: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7"/></svg>,
    };

    const Icon = ({ name, className = "w-4 h-4" }) => {
      const IconComponent = Icons[name];
      return IconComponent ? <span className={`inline-block ${className}`}><IconComponent /></span> : null;
    };

    // =====================================================
    // DATA
    // =====================================================
    const CATEGORIES = [
      { key: 'all', name: 'All Categories', icon: 'book' },
      { key: 'technical', name: 'Technical', icon: 'shield', color: '#00E5FA' },
      { key: 'pricing', name: 'Pricing & BOE', icon: 'trending', color: '#00D29F' },
      { key: 'strategy', name: 'Win Strategy', icon: 'trophy', color: '#F59E0B' },
      { key: 'compliance', name: 'Compliance', icon: 'check', color: '#8B5CF6' },
      { key: 'drafting', name: 'Drafting', icon: 'book', color: '#EC4899' },
      { key: 'orals', name: 'Orals Prep', icon: 'users', color: '#06B6D4' },
      { key: 'capture', name: 'Capture', icon: 'eye', color: '#EF4444' },
    ];

    const LIFECYCLE_PHASES = [
      'Gate 1', 'Blue Team', 'Kickoff', 'Pink Team', 'Red Team', 'Gold Team', 'White Glove', 'Final Submission', 'Orals', 'Post-Award'
    ];

    const MOCK_LESSONS = [
      {
        id: 'lesson_001',
        title: 'DHA Executive Summary Template',
        description: 'Proven template for DHA healthcare IT executive summaries with 95% acceptance rate at Pink Team review.',
        category: 'drafting',
        tags: ['dha', 'executive_summary', 'healthcare', 'pink_team'],
        lifecycle_phase: 'Pink Team',
        customer_agency: 'DHA',
        quality_score: 95,
        use_count: 47,
        contracts_won: 3,
        created_at: '2025-11-15T10:00:00Z',
        created_by: 'Mary Womack',
        is_starred: true,
      },
      {
        id: 'lesson_002',
        title: 'LCAT Rate Justification Formula',
        description: 'Step-by-step approach for justifying LCAT rates against GSA schedules. Includes variance analysis template.',
        category: 'pricing',
        tags: ['lcat', 'pricing', 'gsa', 'rate_justification', 'boe'],
        lifecycle_phase: 'Gold Team',
        customer_agency: 'VA',
        quality_score: 92,
        use_count: 38,
        contracts_won: 2,
        created_at: '2025-12-01T14:30:00Z',
        created_by: 'Sarah Chen',
        is_starred: true,
      },
      {
        id: 'lesson_003',
        title: 'Section L/M Compliance Matrix Generator',
        description: 'Automated approach to shredding Section L/M requirements and generating compliance matrices with traceability.',
        category: 'compliance',
        tags: ['section_l', 'section_m', 'compliance_matrix', 'traceability'],
        lifecycle_phase: 'Blue Team',
        customer_agency: null,
        quality_score: 88,
        use_count: 65,
        contracts_won: 5,
        created_at: '2025-10-20T09:15:00Z',
        created_by: 'Mike Johnson',
        is_starred: false,
      },
      {
        id: 'lesson_004',
        title: 'Ghost Competitor Analysis Framework',
        description: 'Framework for identifying and ghosting competitor weaknesses. Includes PWS cross-reference techniques.',
        category: 'strategy',
        tags: ['ghost', 'competitor', 'win_strategy', 'discriminators'],
        lifecycle_phase: 'Blue Team',
        customer_agency: 'DHA',
        quality_score: 97,
        use_count: 52,
        contracts_won: 4,
        created_at: '2025-09-10T11:00:00Z',
        created_by: 'Mary Womack',
        is_starred: true,
      },
      {
        id: 'lesson_005',
        title: 'FedRAMP Authorization Narrative',
        description: 'Boilerplate narrative for FedRAMP Moderate authorization claims with evidence mapping approach.',
        category: 'technical',
        tags: ['fedramp', 'security', 'authorization', 'cloud'],
        lifecycle_phase: 'Pink Team',
        customer_agency: 'VA',
        quality_score: 85,
        use_count: 29,
        contracts_won: 1,
        created_at: '2025-11-28T16:45:00Z',
        created_by: 'Tom Williams',
        is_starred: false,
      },
      {
        id: 'lesson_006',
        title: 'Orals Q&A Bank - Healthcare IT',
        description: 'Curated bank of 150+ Q&A pairs from successful DHA and VA orals presentations.',
        category: 'orals',
        tags: ['orals', 'qa', 'healthcare', 'dha', 'va'],
        lifecycle_phase: 'Orals',
        customer_agency: 'DHA',
        quality_score: 94,
        use_count: 23,
        contracts_won: 2,
        created_at: '2026-01-05T13:20:00Z',
        created_by: 'Sarah Chen',
        is_starred: true,
      },
      {
        id: 'lesson_007',
        title: 'Transition-In Risk Mitigation Playbook',
        description: 'Comprehensive playbook for addressing transition risk concerns in technical volumes. Includes timeline templates.',
        category: 'technical',
        tags: ['transition', 'risk', 'mitigation', 'technical_volume'],
        lifecycle_phase: 'Red Team',
        customer_agency: null,
        quality_score: 79,
        use_count: 17,
        contracts_won: 1,
        created_at: '2025-12-12T10:30:00Z',
        created_by: 'Mike Johnson',
        is_starred: false,
      },
      {
        id: 'lesson_008',
        title: 'SDVOSB Teaming Strategy Guide',
        description: 'Best practices for leveraging SDVOSB status in teaming arrangements. Includes JV considerations.',
        category: 'capture',
        tags: ['sdvosb', 'teaming', 'small_business', 'joint_venture'],
        lifecycle_phase: 'Gate 1',
        customer_agency: 'VA',
        quality_score: 91,
        use_count: 34,
        contracts_won: 3,
        created_at: '2025-10-05T08:00:00Z',
        created_by: 'Mary Womack',
        is_starred: true,
      },
    ];

    // =====================================================
    // COMPONENTS
    // =====================================================

    // Quality Score Badge
    const QualityBadge = ({ score }) => {
      let bgColor, textColor, label, icon;
      if (score >= 90) {
        bgColor = 'bg-emerald-500/20 border-emerald-500/30';
        textColor = 'text-emerald-400';
        label = 'Excellent';
        icon = 'award';
      } else if (score >= 80) {
        bgColor = 'bg-cyan-500/20 border-cyan-500/30';
        textColor = 'text-cyan-400';
        label = 'Good';
        icon = 'check';
      } else if (score >= 70) {
        bgColor = 'bg-amber-500/20 border-amber-500/30';
        textColor = 'text-amber-400';
        label = 'Average';
        icon = 'trending';
      } else {
        bgColor = 'bg-red-500/20 border-red-500/30';
        textColor = 'text-red-400';
        label = 'Needs Work';
        icon = 'lightbulb';
      }
      
      return (
        <div className={`flex items-center gap-2 px-3 py-1.5 rounded-full border ${bgColor}`}>
          <Icon name={icon} className={`w-4 h-4 ${textColor}`} />
          <span className={`text-sm font-bold ${textColor}`}>{score}</span>
          <span className={`text-xs ${textColor} hidden sm:inline`}>{label}</span>
        </div>
      );
    };

    // Usage Stats Badge
    const UsageStats = ({ count }) => {
      return (
        <div className="flex items-center gap-2 px-3 py-1.5 rounded-full bg-slate-700/50 border border-slate-600/50">
          <Icon name="trending" className="w-4 h-4 text-cyan-400" />
          <span className="text-sm font-medium text-white">Used {count} times</span>
        </div>
      );
    };

    // Contract Win Badge
    const ContractWinBadge = ({ count }) => {
      if (count === 0) return null;
      return (
        <div className="relative flex items-center gap-2 px-3 py-1.5 rounded-full bg-gradient-to-r from-amber-500/20 to-yellow-500/20 border border-amber-500/40 trophy-shimmer overflow-hidden">
          <Icon name="trophy" className="w-4 h-4 text-amber-400" />
          <span className="text-sm font-bold text-amber-300">Won {count} contract{count > 1 ? 's' : ''}</span>
        </div>
      );
    };

    // Category Badge
    const CategoryBadge = ({ category }) => {
      const cat = CATEGORIES.find(c => c.key === category);
      const color = cat?.color || '#00E5FA';
      return (
        <span 
          className="px-2.5 py-1 text-xs font-medium rounded-full border"
          style={{ 
            backgroundColor: `${color}20`,
            borderColor: `${color}40`,
            color: color 
          }}
        >
          {cat?.name || category}
        </span>
      );
    };

    // Lesson Card
    const LessonCard = ({ lesson, onView, onStar, delay = 0 }) => {
      return (
        <div 
          className="glass-card rounded-xl p-5 hover:border-cyan-500/30 transition-all duration-300 group cursor-pointer animate-slideUp"
          style={{ animationDelay: `${delay}ms` }}
          onClick={() => onView(lesson)}
        >
          {/* Header */}
          <div className="flex items-start justify-between gap-3 mb-3">
            <div className="flex-1">
              <div className="flex items-center gap-2 mb-1">
                <h3 className="text-lg font-semibold text-white group-hover:text-cyan-400 transition-colors line-clamp-1">
                  {lesson.title}
                </h3>
                {lesson.is_starred && (
                  <Icon name="star" className="w-4 h-4 text-amber-400 flex-shrink-0" />
                )}
              </div>
              <p className="text-sm text-slate-400 line-clamp-2">{lesson.description}</p>
            </div>
            <button 
              onClick={(e) => { e.stopPropagation(); onStar(lesson.id); }}
              className="p-2 hover:bg-slate-700/50 rounded-lg transition-colors"
            >
              <Icon 
                name={lesson.is_starred ? "star" : "starOutline"} 
                className={`w-5 h-5 ${lesson.is_starred ? 'text-amber-400' : 'text-slate-500 hover:text-amber-400'}`} 
              />
            </button>
          </div>

          {/* Badges Row */}
          <div className="flex flex-wrap items-center gap-2 mb-4">
            <CategoryBadge category={lesson.category} />
            {lesson.lifecycle_phase && (
              <span className="px-2.5 py-1 text-xs font-medium rounded-full bg-slate-700/50 text-slate-300 border border-slate-600/50">
                {lesson.lifecycle_phase}
              </span>
            )}
            {lesson.customer_agency && (
              <span className="px-2.5 py-1 text-xs font-medium rounded-full bg-purple-500/20 text-purple-300 border border-purple-500/30">
                {lesson.customer_agency}
              </span>
            )}
          </div>

          {/* Stats Row */}
          <div className="flex flex-wrap items-center gap-3">
            <QualityBadge score={lesson.quality_score} />
            <UsageStats count={lesson.use_count} />
            <ContractWinBadge count={lesson.contracts_won} />
          </div>

          {/* Tags */}
          <div className="flex flex-wrap gap-1.5 mt-4 pt-4 border-t border-slate-700/50">
            {lesson.tags.slice(0, 5).map(tag => (
              <span key={tag} className="px-2 py-0.5 text-xs rounded-full bg-slate-800 text-slate-400">
                #{tag}
              </span>
            ))}
            {lesson.tags.length > 5 && (
              <span className="px-2 py-0.5 text-xs rounded-full bg-slate-800 text-slate-500">
                +{lesson.tags.length - 5} more
              </span>
            )}
          </div>

          {/* Footer */}
          <div className="flex items-center justify-between mt-4 pt-3 border-t border-slate-700/30">
            <div className="flex items-center gap-2 text-xs text-slate-500">
              <Icon name="clock" className="w-3 h-3" />
              <span>{new Date(lesson.created_at).toLocaleDateString()}</span>
              <span>â€¢</span>
              <span>{lesson.created_by}</span>
            </div>
            <button className="text-xs text-cyan-400 hover:text-cyan-300 font-medium flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
              View Details
              <Icon name="eye" className="w-3 h-3" />
            </button>
          </div>
        </div>
      );
    };

    // Save to Playbook Form Modal
    const SaveToPlaybookModal = ({ isOpen, onClose, onSave }) => {
      const [formData, setFormData] = useState({
        title: '',
        description: '',
        category: 'technical',
        tags: '',
        lifecycle_phase: '',
        customer_agency: '',
        user_prompt: '',
        assistant_response: '',
      });
      const [saving, setSaving] = useState(false);

      const handleSubmit = async (e) => {
        e.preventDefault();
        setSaving(true);
        await new Promise(resolve => setTimeout(resolve, 1500));
        onSave({
          ...formData,
          tags: formData.tags.split(',').map(t => t.trim().toLowerCase()).filter(Boolean),
          quality_score: 80,
          use_count: 0,
          contracts_won: 0,
          created_at: new Date().toISOString(),
          created_by: 'Mary Womack',
          is_starred: false,
        });
        setSaving(false);
        setFormData({
          title: '',
          description: '',
          category: 'technical',
          tags: '',
          lifecycle_phase: '',
          customer_agency: '',
          user_prompt: '',
          assistant_response: '',
        });
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
          <div className="glass-card rounded-2xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto animate-scaleIn">
            <div className="flex items-center justify-between mb-6">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center">
                  <Icon name="plus" className="w-5 h-5 text-white" />
                </div>
                <div>
                  <h2 className="text-xl font-bold text-white">Save to Playbook</h2>
                  <p className="text-sm text-slate-400">Add a golden example for AI learning</p>
                </div>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg transition-colors">
                <Icon name="x" className="w-5 h-5 text-slate-400" />
              </button>
            </div>

            <form onSubmit={handleSubmit} className="space-y-5">
              {/* Title */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">Title *</label>
                <input
                  type="text"
                  required
                  value={formData.title}
                  onChange={(e) => setFormData({...formData, title: e.target.value})}
                  placeholder="e.g., DHA Executive Summary Template"
                  className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors"
                />
              </div>

              {/* Description */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">Description</label>
                <textarea
                  value={formData.description}
                  onChange={(e) => setFormData({...formData, description: e.target.value})}
                  placeholder="Brief description of what this lesson teaches..."
                  rows={2}
                  className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors resize-none"
                />
              </div>

              {/* Category & Phase Row */}
              <div className="grid grid-cols-2 gap-4">
                <div>
                  <label className="block text-sm font-medium text-slate-300 mb-2">Category *</label>
                  <div className="relative">
                    <select
                      required
                      value={formData.category}
                      onChange={(e) => setFormData({...formData, category: e.target.value})}
                      className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white appearance-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors cursor-pointer"
                    >
                      {CATEGORIES.filter(c => c.key !== 'all').map(cat => (
                        <option key={cat.key} value={cat.key}>{cat.name}</option>
                      ))}
                    </select>
                    <Icon name="chevronDown" className="w-5 h-5 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none" />
                  </div>
                </div>
                <div>
                  <label className="block text-sm font-medium text-slate-300 mb-2">Lifecycle Phase</label>
                  <div className="relative">
                    <select
                      value={formData.lifecycle_phase}
                      onChange={(e) => setFormData({...formData, lifecycle_phase: e.target.value})}
                      className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white appearance-none focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors cursor-pointer"
                    >
                      <option value="">Select phase...</option>
                      {LIFECYCLE_PHASES.map(phase => (
                        <option key={phase} value={phase}>{phase}</option>
                      ))}
                    </select>
                    <Icon name="chevronDown" className="w-5 h-5 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none" />
                  </div>
                </div>
              </div>

              {/* Tags */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">
                  Tags <span className="text-slate-500">(comma-separated)</span>
                </label>
                <div className="relative">
                  <Icon name="tag" className="w-5 h-5 text-slate-500 absolute left-4 top-1/2 -translate-y-1/2" />
                  <input
                    type="text"
                    value={formData.tags}
                    onChange={(e) => setFormData({...formData, tags: e.target.value})}
                    placeholder="dha, executive_summary, healthcare"
                    className="w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors"
                  />
                </div>
              </div>

              {/* Customer Agency */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">Customer Agency</label>
                <input
                  type="text"
                  value={formData.customer_agency}
                  onChange={(e) => setFormData({...formData, customer_agency: e.target.value})}
                  placeholder="e.g., DHA, VA, CMS"
                  className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors"
                />
              </div>

              {/* User Prompt */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">Example User Prompt</label>
                <textarea
                  value={formData.user_prompt}
                  onChange={(e) => setFormData({...formData, user_prompt: e.target.value})}
                  placeholder="The prompt that triggered this great response..."
                  rows={3}
                  className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors resize-none font-mono text-sm"
                />
              </div>

              {/* Assistant Response */}
              <div>
                <label className="block text-sm font-medium text-slate-300 mb-2">Example AI Response</label>
                <textarea
                  value={formData.assistant_response}
                  onChange={(e) => setFormData({...formData, assistant_response: e.target.value})}
                  placeholder="The golden response to learn from..."
                  rows={4}
                  className="w-full px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors resize-none font-mono text-sm"
                />
              </div>

              {/* Actions */}
              <div className="flex items-center justify-end gap-3 pt-4 border-t border-slate-700">
                <button
                  type="button"
                  onClick={onClose}
                  className="px-5 py-2.5 bg-slate-700 hover:bg-slate-600 rounded-xl font-medium transition-colors"
                >
                  Cancel
                </button>
                <button
                  type="submit"
                  disabled={saving || !formData.title}
                  className="px-5 py-2.5 bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-400 hover:to-teal-400 rounded-xl font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2"
                >
                  {saving ? (
                    <>
                      <div className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin" />
                      Saving...
                    </>
                  ) : (
                    <>
                      <Icon name="sparkles" className="w-4 h-4" />
                      Save to Playbook
                    </>
                  )}
                </button>
              </div>
            </form>
          </div>
        </div>
      );
    };

    // Lesson Detail Modal
    const LessonDetailModal = ({ lesson, isOpen, onClose }) => {
      if (!isOpen || !lesson) return null;

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
          <div className="glass-card rounded-2xl p-6 max-w-3xl w-full max-h-[90vh] overflow-y-auto animate-scaleIn">
            <div className="flex items-start justify-between gap-4 mb-6">
              <div className="flex-1">
                <div className="flex items-center gap-3 mb-2">
                  <CategoryBadge category={lesson.category} />
                  {lesson.lifecycle_phase && (
                    <span className="px-2.5 py-1 text-xs font-medium rounded-full bg-slate-700/50 text-slate-300">
                      {lesson.lifecycle_phase}
                    </span>
                  )}
                  {lesson.is_starred && (
                    <Icon name="star" className="w-5 h-5 text-amber-400" />
                  )}
                </div>
                <h2 className="text-2xl font-bold text-white mb-2">{lesson.title}</h2>
                <p className="text-slate-400">{lesson.description}</p>
              </div>
              <button onClick={onClose} className="p-2 hover:bg-slate-700 rounded-lg transition-colors">
                <Icon name="x" className="w-5 h-5 text-slate-400" />
              </button>
            </div>

            {/* Stats Grid */}
            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-slate-800/50 rounded-xl p-4 text-center">
                <div className="text-3xl font-bold text-white mb-1">{lesson.quality_score}</div>
                <div className="text-sm text-slate-400">Quality Score</div>
              </div>
              <div className="bg-slate-800/50 rounded-xl p-4 text-center">
                <div className="text-3xl font-bold text-cyan-400 mb-1">{lesson.use_count}</div>
                <div className="text-sm text-slate-400">Times Used</div>
              </div>
              <div className="bg-slate-800/50 rounded-xl p-4 text-center">
                <div className="text-3xl font-bold text-amber-400 mb-1">{lesson.contracts_won}</div>
                <div className="text-sm text-slate-400">Contracts Won</div>
              </div>
            </div>

            {/* Success Indicator */}
            {lesson.contracts_won > 0 && (
              <div className="bg-gradient-to-r from-amber-500/10 to-yellow-500/10 border border-amber-500/30 rounded-xl p-4 mb-6 flex items-center gap-3">
                <div className="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center">
                  <Icon name="trophy" className="w-6 h-6 text-amber-400" />
                </div>
                <div>
                  <div className="text-lg font-semibold text-amber-300">
                    ðŸ† This helped win {lesson.contracts_won} contract{lesson.contracts_won > 1 ? 's' : ''}!
                  </div>
                  <div className="text-sm text-amber-400/70">Proven approach with documented success</div>
                </div>
              </div>
            )}

            {/* Tags */}
            <div className="mb-6">
              <h3 className="text-sm font-medium text-slate-400 mb-3">Tags</h3>
              <div className="flex flex-wrap gap-2">
                {lesson.tags.map(tag => (
                  <span key={tag} className="px-3 py-1.5 text-sm rounded-full bg-slate-700/50 text-slate-300 border border-slate-600/50">
                    #{tag}
                  </span>
                ))}
              </div>
            </div>

            {/* Metadata */}
            <div className="grid grid-cols-2 gap-4 mb-6">
              <div className="bg-slate-800/30 rounded-lg p-3">
                <div className="text-xs text-slate-500 mb-1">Created By</div>
                <div className="text-sm text-white">{lesson.created_by}</div>
              </div>
              <div className="bg-slate-800/30 rounded-lg p-3">
                <div className="text-xs text-slate-500 mb-1">Created At</div>
                <div className="text-sm text-white">{new Date(lesson.created_at).toLocaleDateString()}</div>
              </div>
              <div className="bg-slate-800/30 rounded-lg p-3">
                <div className="text-xs text-slate-500 mb-1">Customer Agency</div>
                <div className="text-sm text-white">{lesson.customer_agency || 'General'}</div>
              </div>
              <div className="bg-slate-800/30 rounded-lg p-3">
                <div className="text-xs text-slate-500 mb-1">Lifecycle Phase</div>
                <div className="text-sm text-cyan-400">{lesson.lifecycle_phase || 'All Phases'}</div>
              </div>
            </div>

            {/* Actions */}
            <div className="flex items-center justify-end gap-3 pt-4 border-t border-slate-700">
              <button className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-xl text-sm font-medium transition-colors flex items-center gap-2">
                <Icon name="archive" className="w-4 h-4" />
                Archive
              </button>
              <button className="px-4 py-2 bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-400 hover:to-teal-400 rounded-xl text-sm font-medium transition-colors flex items-center gap-2">
                <Icon name="book" className="w-4 h-4" />
                Use in AI Prompt
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Import/Export Modal
    const ImportExportModal = ({ isOpen, onClose, mode }) => {
      const [status, setStatus] = useState('idle');
      
      const handleAction = async () => {
        setStatus('processing');
        await new Promise(resolve => setTimeout(resolve, 2000));
        setStatus('complete');
        setTimeout(() => {
          setStatus('idle');
          onClose();
        }, 1500);
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fadeIn">
          <div className="glass-card rounded-2xl p-6 max-w-md w-full animate-scaleIn">
            <div className="flex items-center gap-3 mb-6">
              <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${mode === 'import' ? 'bg-teal-500/20' : 'bg-cyan-500/20'}`}>
                <Icon name={mode === 'import' ? 'upload' : 'download'} className={`w-6 h-6 ${mode === 'import' ? 'text-teal-400' : 'text-cyan-400'}`} />
              </div>
              <div>
                <h2 className="text-xl font-bold text-white">{mode === 'import' ? 'Import Playbook' : 'Export Playbook'}</h2>
                <p className="text-sm text-slate-400">
                  {mode === 'import' ? 'Load lessons from a JSON file' : 'Download all lessons as JSON'}
                </p>
              </div>
            </div>

            {status === 'idle' && (
              <>
                {mode === 'import' ? (
                  <div className="border-2 border-dashed border-slate-600 rounded-xl p-8 text-center mb-6 hover:border-teal-500/50 transition-colors cursor-pointer">
                    <Icon name="upload" className="w-12 h-12 text-slate-500 mx-auto mb-3" />
                    <p className="text-sm text-slate-400">Drag & drop a JSON file or click to browse</p>
                  </div>
                ) : (
                  <div className="bg-slate-800/50 rounded-xl p-4 mb-6">
                    <div className="flex items-center justify-between mb-3">
                      <span className="text-sm text-slate-400">Total Lessons</span>
                      <span className="text-lg font-bold text-white">8</span>
                    </div>
                    <div className="flex items-center justify-between mb-3">
                      <span className="text-sm text-slate-400">File Format</span>
                      <span className="text-sm text-cyan-400">JSON</span>
                    </div>
                    <div className="flex items-center justify-between">
                      <span className="text-sm text-slate-400">Estimated Size</span>
                      <span className="text-sm text-slate-300">~24 KB</span>
                    </div>
                  </div>
                )}

                <div className="flex items-center justify-end gap-3">
                  <button
                    onClick={onClose}
                    className="px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-xl text-sm font-medium transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handleAction}
                    className={`px-4 py-2 rounded-xl text-sm font-medium transition-colors flex items-center gap-2 ${
                      mode === 'import' 
                        ? 'bg-gradient-to-r from-teal-500 to-emerald-500 hover:from-teal-400 hover:to-emerald-400'
                        : 'bg-gradient-to-r from-cyan-500 to-blue-500 hover:from-cyan-400 hover:to-blue-400'
                    }`}
                  >
                    <Icon name={mode === 'import' ? 'upload' : 'download'} className="w-4 h-4" />
                    {mode === 'import' ? 'Import' : 'Export'}
                  </button>
                </div>
              </>
            )}

            {status === 'processing' && (
              <div className="text-center py-8">
                <div className="w-12 h-12 border-3 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin mx-auto mb-4" />
                <p className="text-slate-400">{mode === 'import' ? 'Importing lessons...' : 'Preparing download...'}</p>
              </div>
            )}

            {status === 'complete' && (
              <div className="text-center py-8">
                <div className="w-16 h-16 rounded-full bg-emerald-500/20 flex items-center justify-center mx-auto mb-4">
                  <Icon name="check" className="w-8 h-8 text-emerald-400" />
                </div>
                <p className="text-lg font-semibold text-white mb-1">
                  {mode === 'import' ? 'Import Successful!' : 'Download Started!'}
                </p>
                <p className="text-sm text-slate-400">
                  {mode === 'import' ? '8 lessons added to playbook' : 'missionpulse_playbook.json'}
                </p>
              </div>
            )}
          </div>
        </div>
      );
    };

    // =====================================================
    // MAIN APP
    // =====================================================
    const LessonsLearnedModule = () => {
      const [lessons, setLessons] = useState(MOCK_LESSONS);
      const [searchQuery, setSearchQuery] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('all');
      const [phaseFilter, setPhaseFilter] = useState('');
      const [sortBy, setSortBy] = useState('quality');
      const [showSaveModal, setShowSaveModal] = useState(false);
      const [selectedLesson, setSelectedLesson] = useState(null);
      const [importExportModal, setImportExportModal] = useState({ open: false, mode: 'export' });

      // Stats
      const stats = {
        total: lessons.length,
        starred: lessons.filter(l => l.is_starred).length,
        totalUses: lessons.reduce((sum, l) => sum + l.use_count, 0),
        totalWins: lessons.reduce((sum, l) => sum + l.contracts_won, 0),
        avgQuality: Math.round(lessons.reduce((sum, l) => sum + l.quality_score, 0) / lessons.length),
      };

      // Filter and sort lessons
      const filteredLessons = lessons
        .filter(l => {
          if (searchQuery) {
            const q = searchQuery.toLowerCase();
            const matchesSearch = 
              l.title.toLowerCase().includes(q) ||
              l.description.toLowerCase().includes(q) ||
              l.tags.some(t => t.includes(q));
            if (!matchesSearch) return false;
          }
          if (categoryFilter !== 'all' && l.category !== categoryFilter) return false;
          if (phaseFilter && l.lifecycle_phase !== phaseFilter) return false;
          return true;
        })
        .sort((a, b) => {
          switch (sortBy) {
            case 'quality': return b.quality_score - a.quality_score;
            case 'usage': return b.use_count - a.use_count;
            case 'wins': return b.contracts_won - a.contracts_won;
            case 'recent': return new Date(b.created_at) - new Date(a.created_at);
            default: return 0;
          }
        });

      const handleStar = (id) => {
        setLessons(lessons.map(l => l.id === id ? { ...l, is_starred: !l.is_starred } : l));
      };

      const handleSave = (newLesson) => {
        setLessons([{ ...newLesson, id: `lesson_${Date.now()}` }, ...lessons]);
        setShowSaveModal(false);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-[#00050F] via-[#0A1628] to-[#00050F]">
          {/* Header */}
          <header className="border-b border-slate-800/50 bg-slate-900/30 backdrop-blur-xl sticky top-0 z-40">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <div className="flex items-center justify-between">
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center shadow-lg shadow-cyan-500/25">
                    <Icon name="book" className="w-6 h-6 text-white" />
                  </div>
                  <div>
                    <h1 className="text-2xl font-bold text-white">Lessons Learned</h1>
                    <p className="text-sm text-slate-400">Playbook Integration â€¢ Golden Examples for AI Learning</p>
                  </div>
                </div>
                <div className="flex items-center gap-3">
                  <button 
                    onClick={() => setImportExportModal({ open: true, mode: 'import' })}
                    className="px-4 py-2.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-xl text-sm font-medium transition-colors flex items-center gap-2"
                  >
                    <Icon name="upload" className="w-4 h-4 text-teal-400" />
                    Import
                  </button>
                  <button 
                    onClick={() => setImportExportModal({ open: true, mode: 'export' })}
                    className="px-4 py-2.5 bg-slate-800 hover:bg-slate-700 border border-slate-700 rounded-xl text-sm font-medium transition-colors flex items-center gap-2"
                  >
                    <Icon name="download" className="w-4 h-4 text-cyan-400" />
                    Export
                  </button>
                  <button 
                    onClick={() => setShowSaveModal(true)}
                    className="px-4 py-2.5 bg-gradient-to-r from-cyan-500 to-teal-500 hover:from-cyan-400 hover:to-teal-400 rounded-xl text-sm font-medium transition-all flex items-center gap-2 shadow-lg shadow-cyan-500/25"
                  >
                    <Icon name="plus" className="w-4 h-4" />
                    Save to Playbook
                  </button>
                </div>
              </div>
            </div>
          </header>

          <main className="max-w-7xl mx-auto px-6 py-8">
            {/* Stats Row */}
            <div className="grid grid-cols-5 gap-4 mb-8">
              <div className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: '0ms' }}>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
                    <Icon name="book" className="w-5 h-5 text-cyan-400" />
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-white">{stats.total}</div>
                    <div className="text-xs text-slate-400">Total Lessons</div>
                  </div>
                </div>
              </div>
              <div className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: '50ms' }}>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-amber-500/20 flex items-center justify-center">
                    <Icon name="star" className="w-5 h-5 text-amber-400" />
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-white">{stats.starred}</div>
                    <div className="text-xs text-slate-400">Starred</div>
                  </div>
                </div>
              </div>
              <div className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: '100ms' }}>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center">
                    <Icon name="trending" className="w-5 h-5 text-purple-400" />
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-white">{stats.totalUses}</div>
                    <div className="text-xs text-slate-400">Total Uses</div>
                  </div>
                </div>
              </div>
              <div className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: '150ms' }}>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-emerald-500/20 flex items-center justify-center">
                    <Icon name="trophy" className="w-5 h-5 text-emerald-400" />
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-white">{stats.totalWins}</div>
                    <div className="text-xs text-slate-400">Contracts Won</div>
                  </div>
                </div>
              </div>
              <div className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: '200ms' }}>
                <div className="flex items-center gap-3">
                  <div className="w-10 h-10 rounded-lg bg-teal-500/20 flex items-center justify-center">
                    <Icon name="award" className="w-5 h-5 text-teal-400" />
                  </div>
                  <div>
                    <div className="text-2xl font-bold text-white">{stats.avgQuality}</div>
                    <div className="text-xs text-slate-400">Avg Quality</div>
                  </div>
                </div>
              </div>
            </div>

            {/* Search & Filters */}
            <div className="glass-card rounded-xl p-4 mb-6 animate-slideUp" style={{ animationDelay: '250ms' }}>
              <div className="flex flex-wrap items-center gap-4">
                {/* Search */}
                <div className="flex-1 min-w-[300px] relative">
                  <Icon name="search" className="w-5 h-5 text-slate-500 absolute left-4 top-1/2 -translate-y-1/2" />
                  <input
                    type="text"
                    placeholder="Search lessons by title, description, or tags..."
                    value={searchQuery}
                    onChange={(e) => setSearchQuery(e.target.value)}
                    className="w-full pl-12 pr-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white placeholder-slate-500 focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-colors"
                  />
                </div>

                {/* Category Filter */}
                <div className="relative">
                  <select
                    value={categoryFilter}
                    onChange={(e) => setCategoryFilter(e.target.value)}
                    className="px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white appearance-none pr-10 focus:border-cyan-500 outline-none transition-colors cursor-pointer min-w-[180px]"
                  >
                    {CATEGORIES.map(cat => (
                      <option key={cat.key} value={cat.key}>{cat.name}</option>
                    ))}
                  </select>
                  <Icon name="chevronDown" className="w-5 h-5 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none" />
                </div>

                {/* Phase Filter */}
                <div className="relative">
                  <select
                    value={phaseFilter}
                    onChange={(e) => setPhaseFilter(e.target.value)}
                    className="px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white appearance-none pr-10 focus:border-cyan-500 outline-none transition-colors cursor-pointer min-w-[160px]"
                  >
                    <option value="">All Phases</option>
                    {LIFECYCLE_PHASES.map(phase => (
                      <option key={phase} value={phase}>{phase}</option>
                    ))}
                  </select>
                  <Icon name="chevronDown" className="w-5 h-5 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none" />
                </div>

                {/* Sort */}
                <div className="relative">
                  <select
                    value={sortBy}
                    onChange={(e) => setSortBy(e.target.value)}
                    className="px-4 py-3 bg-slate-800/50 border border-slate-700 rounded-xl text-white appearance-none pr-10 focus:border-cyan-500 outline-none transition-colors cursor-pointer min-w-[150px]"
                  >
                    <option value="quality">Sort: Quality</option>
                    <option value="usage">Sort: Usage</option>
                    <option value="wins">Sort: Wins</option>
                    <option value="recent">Sort: Recent</option>
                  </select>
                  <Icon name="chevronDown" className="w-5 h-5 text-slate-400 absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none" />
                </div>
              </div>
            </div>

            {/* Results Count */}
            <div className="flex items-center justify-between mb-4">
              <p className="text-sm text-slate-400">
                Showing <span className="text-white font-medium">{filteredLessons.length}</span> of {lessons.length} lessons
                {searchQuery && <span className="text-cyan-400"> matching "{searchQuery}"</span>}
              </p>
            </div>

            {/* Lessons Grid */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
              {filteredLessons.map((lesson, idx) => (
                <LessonCard 
                  key={lesson.id} 
                  lesson={lesson} 
                  onView={setSelectedLesson}
                  onStar={handleStar}
                  delay={300 + idx * 50}
                />
              ))}
            </div>

            {filteredLessons.length === 0 && (
              <div className="text-center py-16">
                <div className="w-20 h-20 rounded-full bg-slate-800/50 flex items-center justify-center mx-auto mb-4">
                  <Icon name="search" className="w-10 h-10 text-slate-600" />
                </div>
                <h3 className="text-xl font-semibold text-slate-400 mb-2">No lessons found</h3>
                <p className="text-slate-500">Try adjusting your search or filters</p>
              </div>
            )}
          </main>

          {/* Footer */}
          <footer className="border-t border-slate-800/50 mt-12">
            <div className="max-w-7xl mx-auto px-6 py-4">
              <p className="text-center text-xs text-slate-500">
                AI GENERATED - REQUIRES HUMAN REVIEW â€¢ MissionPulse v12.0 â€¢ Shield & Pulse UX
              </p>
            </div>
          </footer>

          {/* Modals */}
          <SaveToPlaybookModal 
            isOpen={showSaveModal} 
            onClose={() => setShowSaveModal(false)} 
            onSave={handleSave}
          />
          <LessonDetailModal 
            lesson={selectedLesson} 
            isOpen={!!selectedLesson} 
            onClose={() => setSelectedLesson(null)} 
          />
          <ImportExportModal 
            isOpen={importExportModal.open}
            mode={importExportModal.mode}
            onClose={() => setImportExportModal({ ...importExportModal, open: false })}
          />
        </div>
      );
    };

    // Render
    // Wrapped App with RBAC
    function App() {
      const { checking, userRole, hasAccess } = useRBAC();
      const connectionStatus = useConnection();
      
      if (checking) return <LoadingSkeleton />;
      if (!hasAccess) return <AccessDenied userRole={userRole} requiredRoles={ALLOWED_ROLES} />;
      
      return (
        <ErrorBoundary>
          <ConnectionBanner status={connectionStatus} />
          <LessonsLearnedModule />
        </ErrorBoundary>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
