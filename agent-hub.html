<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Agent Hub | MissionPulse v1.1</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Inter', sans-serif; }
    body { background: #00050F; }
    
    /* MMT Design System - Shield & Pulse UX v8.0 */
    .glass-card {
      background: rgba(0, 31, 52, 0.4);
      border: 1px solid rgba(0, 229, 250, 0.15);
      border-radius: 16px;
      backdrop-filter: blur(20px);
    }
    
    .cyan-glow { box-shadow: 0 0 30px rgba(0, 229, 250, 0.3); }
    .cyan-glow-sm { box-shadow: 0 0 15px rgba(0, 229, 250, 0.2); }
    
    .gradient-text {
      background: linear-gradient(135deg, #00E5FA 0%, #00BDAE 50%, #00D29F 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    /* Scrollbar Styling */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: rgba(0, 31, 52, 0.3); border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: rgba(0, 229, 250, 0.3); border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: rgba(0, 229, 250, 0.5); }
    
    /* Animations */
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .animate-fadeIn { animation: fadeIn 0.4s ease-out forwards; }
    .animate-pulse { animation: pulse 2s infinite; }
    
    /* Chat Streaming Effect */
    .typing-indicator span {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #00E5FA;
      border-radius: 50%;
      margin: 0 2px;
      animation: pulse 1s infinite;
    }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
    .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    
    /* Session Item Hover */
    .session-item:hover { background: rgba(0, 229, 250, 0.1); }
    .session-item.active { background: rgba(0, 229, 250, 0.2); border-color: rgba(0, 229, 250, 0.5); }
  </style>
</head>
<body class="min-h-screen text-white">
  
  <!-- Main Container: Sidebar + Content -->
  <div class="flex h-screen overflow-hidden">
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- LEFT SIDEBAR: Chat History (Phase 11) -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <aside id="history-sidebar" class="w-72 bg-slate-900/50 border-r border-slate-700/50 flex flex-col">
      
      <!-- Sidebar Header -->
      <div class="p-4 border-b border-slate-700/50">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-lg font-semibold text-white">Chat History</h2>
          <button onclick="createNewSession()" class="p-2 rounded-lg bg-cyan-500/20 hover:bg-cyan-500/30 transition-colors" title="New Chat">
            <svg class="w-5 h-5 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
          </button>
        </div>
        
        <!-- Filter by Agent -->
        <select id="agent-filter" onchange="loadSessions()" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-cyan-500/50">
          <option value="">All Agents</option>
          <option value="capture">ğŸ“¡ Capture</option>
          <option value="strategy">ğŸ¯ Strategy</option>
          <option value="compliance">âœ… Compliance</option>
          <option value="writer">âœï¸ Writer</option>
          <option value="pricing">ğŸ’° Pricing</option>
          <option value="blackhat">ğŸ•µï¸ Black Hat</option>
          <option value="contracts">ğŸ“‹ Contracts</option>
          <option value="orals">ğŸ¤ Orals Coach</option>
        </select>
      </div>
      
      <!-- Sessions List -->
      <div id="sessions-list" class="flex-1 overflow-y-auto p-3 space-y-2">
        <!-- Sessions loaded dynamically -->
        <div class="text-center py-8 text-slate-500 text-sm">
          <svg class="w-12 h-12 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
          </svg>
          <p>No saved conversations yet</p>
          <p class="text-xs mt-1">Start chatting to save sessions</p>
        </div>
      </div>
      
      <!-- Sidebar Footer: Stats -->
      <div id="sidebar-stats" class="p-4 border-t border-slate-700/50 text-xs text-slate-500">
        <div class="flex justify-between">
          <span>Sessions: <span id="stat-sessions">0</span></span>
          <span>Tokens: <span id="stat-tokens">0</span></span>
        </div>
      </div>
    </aside>
    
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- MAIN CONTENT AREA -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <main class="flex-1 flex flex-col overflow-hidden">
      
      <!-- Top Header -->
      <header class="bg-slate-900/30 border-b border-slate-700/50 px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <a href="index.html" class="flex items-center gap-2 hover:opacity-80 transition-opacity">
              <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                </svg>
              </div>
              <div>
                <span class="text-lg font-bold gradient-text">MissionPulse</span>
                <span class="text-xs text-slate-500 block">v1.1.0 â€¢ Agent Hub</span>
              </div>
            </a>
          </div>
          
          <div class="flex items-center gap-4">
            <!-- Token Cost Meter -->
            <div id="token-meter" class="flex items-center gap-2 bg-slate-800/50 rounded-lg px-3 py-2">
              <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                <path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
              </svg>
              <span class="text-sm text-white">$<span id="session-cost">0.00</span></span>
            </div>
            
            <!-- Role Selector -->
            <select id="role-selector" onchange="handleRoleChange()" class="bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-sm text-white focus:outline-none focus:border-cyan-500/50">
              <option value="CEO">ğŸ‘” CEO</option>
              <option value="COO">âš™ï¸ COO</option>
              <option value="CAP" selected>ğŸ¯ Capture Manager</option>
              <option value="PM">ğŸ“‹ Program Manager</option>
              <option value="VOL">ğŸ“ Volume Lead</option>
              <option value="SA">ğŸ”§ Solution Architect</option>
              <option value="FIN">ğŸ’° Finance</option>
              <option value="CON">âš–ï¸ Contracts</option>
              <option value="SME">ğŸ§  Subject Matter Expert</option>
              <option value="AUT">âœï¸ Author</option>
              <option value="EXT">ğŸŒ External Partner</option>
            </select>
            
            <!-- Settings -->
            <a href="playbook-manager.html" class="p-2 rounded-lg bg-slate-800/50 hover:bg-slate-700/50 transition-colors" title="Playbook Manager">
              <svg class="w-5 h-5 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
              </svg>
            </a>
          </div>
        </div>
      </header>
      
      
      <!-- Content Grid: Agents + Chat -->
      <div class="flex-1 overflow-hidden p-6">
        <div class="grid grid-cols-4 gap-6 h-full">
          
          <!-- Agent Selection Panel -->
          <div class="glass-card p-4 overflow-y-auto">
            <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-4">Select Agent</h3>
            <div id="agents-list" class="space-y-2">
              <!-- Agents populated by JS -->
            </div>
          </div>
          
          
          <!-- Chat Interface (3 columns) -->
          <div class="col-span-3 glass-card flex flex-col overflow-hidden">
            
            <!-- Chat Header -->
            <div id="chat-header" class="flex items-center justify-between px-6 py-4 border-b border-slate-700/50">
              <div class="flex items-center gap-3">
                <span id="selected-agent-icon" class="text-3xl">ğŸ¤–</span>
                <div>
                  <h3 id="selected-agent-name" class="font-semibold text-white">Select an Agent</h3>
                  <p id="selected-agent-desc" class="text-sm text-slate-400">Choose an AI agent to start chatting</p>
                </div>
              </div>
              
              <div class="flex items-center gap-2">
                <!-- Save Session Button -->
                <button id="btn-save-session" onclick="saveCurrentSession()" class="hidden px-3 py-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 text-green-400 text-sm font-medium transition-colors" title="Save Session">
                  <span class="flex items-center gap-2">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg>
                    Save
                  </span>
                </button>
                
                <!-- Clear Chat Button -->
                <button onclick="clearChat()" class="px-3 py-2 rounded-lg bg-slate-700/50 hover:bg-slate-600/50 text-slate-400 text-sm transition-colors" title="Clear Chat">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                  </svg>
                </button>
                
                <!-- Export Chat Button -->
                <button onclick="exportChat()" class="px-3 py-2 rounded-lg bg-slate-700/50 hover:bg-slate-600/50 text-slate-400 text-sm transition-colors" title="Export Chat">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                </button>
              </div>
            </div>
            
            
            <!-- Chat Messages Area -->
            <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
              <!-- Welcome State -->
              <div id="welcome-state" class="h-full flex items-center justify-center text-center">
                <div>
                  <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center">
                    <svg class="w-10 h-10 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                    </svg>
                  </div>
                  <h3 class="text-xl font-semibold text-white mb-2">Welcome to Agent Hub</h3>
                  <p class="text-slate-400 max-w-md">Select an AI agent from the panel on the left to start a conversation. Your chats can be saved and resumed anytime.</p>
                </div>
              </div>
            </div>
            
            
            <!-- Chat Input Area -->
            <div class="px-6 py-4 border-t border-slate-700/50">
              <div class="flex gap-3">
                <input
                  type="text"
                  id="chat-input"
                  placeholder="Type your message..."
                  disabled
                  class="flex-1 bg-slate-800/50 border border-slate-700 rounded-xl px-4 py-3 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50 disabled:opacity-50 disabled:cursor-not-allowed"
                  onkeypress="if(event.key === 'Enter') sendMessage()"
                />
                <button
                  id="btn-send"
                  onclick="sendMessage()"
                  disabled
                  class="px-6 py-3 bg-gradient-to-r from-cyan-500 to-blue-500 rounded-xl font-medium text-white hover:opacity-90 transition-opacity cyan-glow-sm disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  Send
                </button>
              </div>
              
              <!-- AI Disclaimer -->
              <p class="text-xs text-amber-400/60 mt-3 text-center">
                âš ï¸ AI GENERATED - REQUIRES HUMAN REVIEW â€¢ All outputs must be verified before use in proposals
              </p>
            </div>
            
          </div>
        </div>
      </div>
      
    </main>
  </div>
  
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- SAVE TO PLAYBOOK MODAL -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="playbook-modal" class="hidden fixed inset-0 bg-black/70 backdrop-blur-sm flex items-center justify-center z-50">
    <div class="glass-card p-6 w-full max-w-lg mx-4 animate-fadeIn">
      <h3 class="text-lg font-semibold text-white mb-4">â­ Save to Playbook</h3>
      
      <div class="space-y-4">
        <div>
          <label class="text-sm text-slate-400 block mb-1">Category</label>
          <select id="playbook-category" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-500/50">
            <option value="win_theme">Win Theme</option>
            <option value="compliance">Compliance</option>
            <option value="pricing">Pricing Strategy</option>
            <option value="past_performance">Past Performance</option>
            <option value="technical">Technical Approach</option>
            <option value="competitive_intel">Competitive Intel</option>
          </select>
        </div>
        
        <div>
          <label class="text-sm text-slate-400 block mb-1">Quality Rating</label>
          <select id="playbook-rating" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-white focus:outline-none focus:border-cyan-500/50">
            <option value="gold">ğŸ¥‡ Gold - Exemplary</option>
            <option value="silver">ğŸ¥ˆ Silver - Good</option>
            <option value="bronze">ğŸ¥‰ Bronze - Acceptable</option>
          </select>
        </div>
        
        <div>
          <label class="text-sm text-slate-400 block mb-1">Notes (optional)</label>
          <textarea id="playbook-notes" rows="2" class="w-full bg-slate-800/50 border border-slate-700 rounded-lg px-3 py-2 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/50" placeholder="Why is this a good example?"></textarea>
        </div>
      </div>
      
      <div class="flex justify-end gap-3 mt-6">
        <button onclick="closePlaybookModal()" class="px-4 py-2 rounded-lg bg-slate-700/50 hover:bg-slate-600/50 text-slate-300 transition-colors">Cancel</button>
        <button onclick="confirmSaveToPlaybook()" class="px-4 py-2 rounded-lg bg-gradient-to-r from-cyan-500 to-blue-500 text-white font-medium hover:opacity-90 transition-opacity">Save to Playbook</button>
      </div>
    </div>
  </div>
  
  
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <!-- JAVASCRIPT -->
  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const API_BASE = 'https://missionpulse-api.onrender.com';
    
    // AI Agents Configuration
    const AI_AGENTS = [
      { id: 'capture', name: 'Capture Intel', icon: 'ğŸ“¡', desc: 'Opportunity analysis & pWin', restricted: false },
      { id: 'strategy', name: 'Strategy Advisor', icon: 'ğŸ¯', desc: 'Win themes & positioning', restricted: true },
      { id: 'compliance', name: 'Compliance Guardian', icon: 'âœ…', desc: 'RFP requirements check', restricted: false },
      { id: 'writer', name: 'Proposal Writer', icon: 'âœï¸', desc: 'Section drafting', restricted: false },
      { id: 'pricing', name: 'Pricing Intelligence', icon: 'ğŸ’°', desc: 'Cost strategy & BOE', restricted: true, requiresPricing: true },
      { id: 'blackhat', name: 'Black Hat Intel', icon: 'ğŸ•µï¸', desc: 'Competitor analysis', restricted: true },
      { id: 'contracts', name: 'Contracts Analyst', icon: 'ğŸ“‹', desc: 'FAR/DFARS guidance', restricted: false },
      { id: 'orals', name: 'Orals Coach', icon: 'ğŸ¤', desc: 'Presentation prep', restricted: false }
    ];
    
    // RBAC Configuration
    const ROLE_PERMISSIONS = {
      'CEO': { agents: ['capture', 'strategy', 'compliance', 'writer', 'pricing', 'blackhat', 'contracts', 'orals'] },
      'COO': { agents: ['capture', 'strategy', 'compliance', 'writer', 'pricing', 'blackhat', 'contracts', 'orals'] },
      'CAP': { agents: ['capture', 'strategy', 'compliance', 'writer', 'blackhat', 'contracts', 'orals'] },
      'PM': { agents: ['capture', 'compliance', 'writer', 'contracts', 'orals'] },
      'VOL': { agents: ['capture', 'compliance', 'writer', 'contracts'] },
      'SA': { agents: ['capture', 'compliance', 'writer'] },
      'FIN': { agents: ['capture', 'pricing', 'contracts'] },
      'CON': { agents: ['capture', 'compliance', 'contracts'] },
      'SME': { agents: ['capture', 'compliance', 'writer'] },
      'AUT': { agents: ['capture', 'compliance', 'writer'] },
      'EXT': { agents: ['compliance', 'writer'] }
    };
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // STATE MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    let state = {
      currentRole: 'CAP',
      selectedAgent: null,
      currentSessionId: null,
      chatHistory: [],
      isStreaming: false,
      sessionCost: 0,
      pendingPlaybookMessage: null
    };
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INITIALIZATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    document.addEventListener('DOMContentLoaded', () => {
      renderAgents();
      loadSessions();
      loadStats();
    });
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AGENT MANAGEMENT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function renderAgents() {
      const container = document.getElementById('agents-list');
      const allowedAgents = ROLE_PERMISSIONS[state.currentRole]?.agents || [];
      
      container.innerHTML = AI_AGENTS
        .filter(agent => allowedAgents.includes(agent.id))
        .map(agent => `
          <button
            onclick="selectAgent('${agent.id}')"
            class="w-full flex items-center gap-3 p-3 rounded-xl transition-all ${
              state.selectedAgent?.id === agent.id
                ? 'bg-cyan-500/20 border border-cyan-500/50'
                : 'bg-slate-800/30 hover:bg-slate-800/50 border border-transparent'
            }"
          >
            <span class="text-2xl">${agent.icon}</span>
            <div class="text-left flex-1 min-w-0">
              <p class="font-medium ${state.selectedAgent?.id === agent.id ? 'text-cyan-400' : 'text-white'} truncate">${agent.name}</p>
              <p class="text-xs text-slate-500 truncate">${agent.desc}</p>
            </div>
          </button>
        `).join('');
    }
    
    function selectAgent(agentId) {
      state.selectedAgent = AI_AGENTS.find(a => a.id === agentId);
      state.chatHistory = [];
      state.currentSessionId = null;
      state.sessionCost = 0;
      
      renderAgents();
      updateChatHeader();
      clearChatMessages();
      enableChatInput();
      
      document.getElementById('btn-save-session').classList.remove('hidden');
      document.getElementById('session-cost').textContent = '0.00';
    }
    
    function updateChatHeader() {
      if (state.selectedAgent) {
        document.getElementById('selected-agent-icon').textContent = state.selectedAgent.icon;
        document.getElementById('selected-agent-name').textContent = state.selectedAgent.name;
        document.getElementById('selected-agent-desc').textContent = state.selectedAgent.desc;
      }
    }
    
    function handleRoleChange() {
      state.currentRole = document.getElementById('role-selector').value;
      state.selectedAgent = null;
      renderAgents();
      clearChat();
      loadSessions();
    }
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CHAT FUNCTIONALITY
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function enableChatInput() {
      document.getElementById('chat-input').disabled = false;
      document.getElementById('btn-send').disabled = false;
      document.getElementById('chat-input').placeholder = `Ask ${state.selectedAgent?.name || 'the agent'}...`;
    }
    
    function disableChatInput() {
      document.getElementById('chat-input').disabled = true;
      document.getElementById('btn-send').disabled = true;
    }
    
    function clearChatMessages() {
      const container = document.getElementById('chat-messages');
      container.innerHTML = `
        <div id="welcome-state" class="h-full flex items-center justify-center text-center">
          <div>
            <span class="text-5xl mb-4 block">${state.selectedAgent?.icon || 'ğŸ¤–'}</span>
            <p class="text-slate-400">Start a conversation with ${state.selectedAgent?.name || 'an agent'}</p>
            <p class="text-sm text-slate-500 mt-2">Ask about proposals, compliance, strategy, or any GovCon topic</p>
          </div>
        </div>
      `;
    }
    
    function clearChat() {
      state.chatHistory = [];
      state.currentSessionId = null;
      state.sessionCost = 0;
      
      document.getElementById('session-cost').textContent = '0.00';
      
      if (state.selectedAgent) {
        clearChatMessages();
      } else {
        document.getElementById('chat-messages').innerHTML = `
          <div id="welcome-state" class="h-full flex items-center justify-center text-center">
            <div>
              <div class="w-20 h-20 mx-auto mb-4 rounded-2xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center">
                <svg class="w-10 h-10 text-cyan-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
                </svg>
              </div>
              <h3 class="text-xl font-semibold text-white mb-2">Welcome to Agent Hub</h3>
              <p class="text-slate-400 max-w-md">Select an AI agent from the panel to start a conversation.</p>
            </div>
          </div>
        `;
        disableChatInput();
      }
    }
    
    async function sendMessage() {
      const input = document.getElementById('chat-input');
      const message = input.value.trim();
      
      if (!message || !state.selectedAgent || state.isStreaming) return;
      
      // Clear welcome state on first message
      const welcomeState = document.getElementById('welcome-state');
      if (welcomeState) welcomeState.remove();
      
      // Add user message to UI
      addMessageToUI('user', message);
      state.chatHistory.push({ role: 'user', content: message });
      
      input.value = '';
      state.isStreaming = true;
      disableChatInput();
      
      // Add typing indicator
      const typingId = addTypingIndicator();
      
      try {
        // Call API with SSE streaming
        const response = await fetch(`${API_BASE}/api/agents/${state.selectedAgent.id}/chat`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            message: message,
            conversation_history: state.chatHistory.slice(0, -1),
            role_id: state.currentRole,
            stream: true
          })
        });
        
        if (!response.ok) throw new Error('API request failed');
        
        // Handle streaming response
        const reader = response.body.getReader();
        const decoder = new TextDecoder();
        let assistantMessage = '';
        let tokenUsage = { input: 0, output: 0 };
        
        removeTypingIndicator(typingId);
        const messageId = addMessageToUI('assistant', '', true);
        
        while (true) {
          const { done, value } = await reader.read();
          if (done) break;
          
          const chunk = decoder.decode(value);
          const lines = chunk.split('\n');
          
          for (const line of lines) {
            if (line.startsWith('data: ')) {
              try {
                const data = JSON.parse(line.slice(6));
                
                if (data.token) {
                  assistantMessage += data.token;
                  updateStreamingMessage(messageId, assistantMessage);
                }
                
                if (data.token_usage) {
                  tokenUsage = data.token_usage;
                }
                
                if (data.done) {
                  finalizeMessage(messageId, assistantMessage, tokenUsage);
                }
              } catch (e) {
                // Ignore JSON parse errors for partial chunks
              }
            }
          }
        }
        
        state.chatHistory.push({ role: 'assistant', content: assistantMessage });
        
        // Update cost
        const cost = calculateCost(tokenUsage);
        state.sessionCost += cost;
        document.getElementById('session-cost').textContent = state.sessionCost.toFixed(4);
        
      } catch (error) {
        console.error('Chat error:', error);
        removeTypingIndicator(typingId);
        addMessageToUI('assistant', 'âŒ Sorry, there was an error processing your request. Please try again.');
      }
      
      state.isStreaming = false;
      enableChatInput();
      document.getElementById('chat-input').focus();
    }
    
    function addMessageToUI(role, content, streaming = false) {
      const container = document.getElementById('chat-messages');
      const messageId = `msg-${Date.now()}`;
      
      const messageHTML = `
        <div id="${messageId}" class="flex ${role === 'user' ? 'justify-end' : 'justify-start'} animate-fadeIn">
          <div class="max-w-[80%] p-4 rounded-2xl ${
            role === 'user'
              ? 'bg-cyan-500/20 text-white'
              : 'bg-slate-800 text-slate-200'
          }">
            ${role === 'assistant' && state.selectedAgent ? `
              <div class="flex items-center gap-2 mb-2 text-xs text-cyan-400">
                <span>${state.selectedAgent.icon}</span>
                <span>${state.selectedAgent.name}</span>
              </div>
            ` : ''}
            <div class="message-content text-sm whitespace-pre-wrap">${content}</div>
            ${role === 'assistant' && !streaming ? `
              <div class="flex items-center justify-between mt-3 pt-3 border-t border-slate-700">
                <p class="text-xs text-amber-400">âš ï¸ AI GENERATED - REQUIRES HUMAN REVIEW</p>
                <button onclick="openPlaybookModal('${messageId}')" class="text-xs text-cyan-400 hover:text-cyan-300 transition-colors">
                  â­ Save to Playbook
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
      
      container.insertAdjacentHTML('beforeend', messageHTML);
      container.scrollTop = container.scrollHeight;
      
      return messageId;
    }
    
    function addTypingIndicator() {
      const container = document.getElementById('chat-messages');
      const id = `typing-${Date.now()}`;
      
      container.insertAdjacentHTML('beforeend', `
        <div id="${id}" class="flex justify-start animate-fadeIn">
          <div class="bg-slate-800 p-4 rounded-2xl">
            <div class="typing-indicator flex items-center gap-1">
              <span></span><span></span><span></span>
            </div>
          </div>
        </div>
      `);
      
      container.scrollTop = container.scrollHeight;
      return id;
    }
    
    function removeTypingIndicator(id) {
      document.getElementById(id)?.remove();
    }
    
    function updateStreamingMessage(messageId, content) {
      const element = document.querySelector(`#${messageId} .message-content`);
      if (element) {
        element.textContent = content;
        document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;
      }
    }
    
    function finalizeMessage(messageId, content, tokenUsage) {
      const messageDiv = document.getElementById(messageId);
      if (messageDiv) {
        const contentDiv = messageDiv.querySelector('.message-content');
        contentDiv.textContent = content;
        
        // Add footer
        const bubbleDiv = messageDiv.querySelector('.bg-slate-800');
        bubbleDiv.insertAdjacentHTML('beforeend', `
          <div class="flex items-center justify-between mt-3 pt-3 border-t border-slate-700">
            <p class="text-xs text-amber-400">âš ï¸ AI GENERATED - REQUIRES HUMAN REVIEW</p>
            <button onclick="openPlaybookModal('${messageId}')" class="text-xs text-cyan-400 hover:text-cyan-300 transition-colors">
              â­ Save to Playbook
            </button>
          </div>
        `);
      }
    }
    
    function calculateCost(tokenUsage) {
      // Claude Sonnet pricing: $3/M input, $15/M output
      const inputCost = (tokenUsage.input || 0) * 0.000003;
      const outputCost = (tokenUsage.output || 0) * 0.000015;
      return inputCost + outputCost;
    }
    
    function exportChat() {
      if (state.chatHistory.length === 0) {
        alert('No chat history to export');
        return;
      }
      
      const exportData = {
        agent: state.selectedAgent?.name || 'Unknown',
        role: state.currentRole,
        timestamp: new Date().toISOString(),
        messages: state.chatHistory
      };
      
      const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `missionpulse-chat-${state.selectedAgent?.id || 'export'}-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
    }
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // SESSION MANAGEMENT (Phase 11)
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function loadSessions() {
      const agentFilter = document.getElementById('agent-filter').value;
      
      try {
        let url = `${API_BASE}/api/chat/sessions?limit=50`;
        if (agentFilter) url += `&agent_id=${agentFilter}`;
        
        const response = await fetch(url);
        
        if (!response.ok) {
          throw new Error('Failed to load sessions');
        }
        
        const sessions = await response.json();
        renderSessions(sessions);
        
      } catch (error) {
        console.error('Error loading sessions:', error);
        // Show empty state
        document.getElementById('sessions-list').innerHTML = `
          <div class="text-center py-8 text-slate-500 text-sm">
            <p>Unable to load sessions</p>
            <button onclick="loadSessions()" class="text-cyan-400 hover:text-cyan-300 mt-2">Retry</button>
          </div>
        `;
      }
    }
    
    function renderSessions(sessions) {
      const container = document.getElementById('sessions-list');
      
      if (sessions.length === 0) {
        container.innerHTML = `
          <div class="text-center py-8 text-slate-500 text-sm">
            <svg class="w-12 h-12 mx-auto mb-3 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"/>
            </svg>
            <p>No saved conversations yet</p>
            <p class="text-xs mt-1">Start chatting to save sessions</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = sessions.map(session => {
        const agent = AI_AGENTS.find(a => a.id === session.agent_id);
        const date = new Date(session.updated_at);
        const timeAgo = getTimeAgo(date);
        
        return `
          <div 
            class="session-item p-3 rounded-xl border border-transparent cursor-pointer transition-all ${state.currentSessionId === session.id ? 'active' : ''}"
            onclick="loadSession('${session.id}')"
          >
            <div class="flex items-start gap-3">
              <span class="text-xl">${agent?.icon || 'ğŸ¤–'}</span>
              <div class="flex-1 min-w-0">
                <p class="text-sm font-medium text-white truncate">${session.title}</p>
                <p class="text-xs text-slate-500">${agent?.name || session.agent_id}</p>
                <div class="flex items-center gap-2 mt-1 text-xs text-slate-600">
                  <span>${session.message_count} msgs</span>
                  <span>â€¢</span>
                  <span>${timeAgo}</span>
                </div>
              </div>
              <button 
                onclick="event.stopPropagation(); deleteSession('${session.id}')" 
                class="p-1 rounded hover:bg-red-500/20 text-slate-500 hover:text-red-400 transition-colors"
                title="Delete"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
              </button>
            </div>
          </div>
        `;
      }).join('');
    }
    
    async function loadSession(sessionId) {
      try {
        const response = await fetch(`${API_BASE}/api/chat/sessions/${sessionId}`);
        
        if (!response.ok) throw new Error('Failed to load session');
        
        const session = await response.json();
        
        // Set state
        state.currentSessionId = session.id;
        state.selectedAgent = AI_AGENTS.find(a => a.id === session.agent_id);
        state.chatHistory = session.messages || [];
        state.sessionCost = session.token_count ? calculateCost({ output: session.token_count }) : 0;
        
        // Update UI
        renderAgents();
        updateChatHeader();
        enableChatInput();
        document.getElementById('btn-save-session').classList.remove('hidden');
        document.getElementById('session-cost').textContent = state.sessionCost.toFixed(4);
        
        // Render messages
        const container = document.getElementById('chat-messages');
        container.innerHTML = '';
        
        for (const msg of state.chatHistory) {
          addMessageToUI(msg.role, msg.content);
        }
        
        // Highlight active session
        loadSessions();
        
      } catch (error) {
        console.error('Error loading session:', error);
        alert('Failed to load session. Please try again.');
      }
    }
    
    async function saveCurrentSession() {
      if (!state.selectedAgent || state.chatHistory.length === 0) {
        alert('No messages to save');
        return;
      }
      
      try {
        const roleSelector = document.getElementById('role-selector');
        const roleName = roleSelector.options[roleSelector.selectedIndex].text;
        
        if (state.currentSessionId) {
          // Update existing session
          const response = await fetch(`${API_BASE}/api/chat/sessions/${state.currentSessionId}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: state.chatHistory,
              token_count: Math.round(state.sessionCost * 1000000 / 15) // Estimate tokens from cost
            })
          });
          
          if (!response.ok) throw new Error('Failed to update session');
          
          showNotification('Session updated!', 'success');
          
        } else {
          // Create new session
          const response = await fetch(`${API_BASE}/api/chat/sessions`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              agent_id: state.selectedAgent.id,
              agent_name: state.selectedAgent.name,
              role_id: state.currentRole,
              role_name: roleName
            })
          });
          
          if (!response.ok) throw new Error('Failed to create session');
          
          const session = await response.json();
          state.currentSessionId = session.id;
          
          // Now update with messages
          await fetch(`${API_BASE}/api/chat/sessions/${session.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              messages: state.chatHistory,
              token_count: Math.round(state.sessionCost * 1000000 / 15)
            })
          });
          
          showNotification('Session saved!', 'success');
        }
        
        loadSessions();
        loadStats();
        
      } catch (error) {
        console.error('Error saving session:', error);
        alert('Failed to save session. Please try again.');
      }
    }
    
    async function deleteSession(sessionId) {
      if (!confirm('Delete this conversation? This cannot be undone.')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/chat/sessions/${sessionId}`, {
          method: 'DELETE'
        });
        
        if (!response.ok) throw new Error('Failed to delete session');
        
        if (state.currentSessionId === sessionId) {
          state.currentSessionId = null;
          clearChat();
        }
        
        showNotification('Session deleted', 'info');
        loadSessions();
        loadStats();
        
      } catch (error) {
        console.error('Error deleting session:', error);
        alert('Failed to delete session. Please try again.');
      }
    }
    
    function createNewSession() {
      state.currentSessionId = null;
      state.chatHistory = [];
      state.sessionCost = 0;
      
      if (state.selectedAgent) {
        clearChatMessages();
        document.getElementById('session-cost').textContent = '0.00';
      }
      
      loadSessions();
    }
    
    async function loadStats() {
      try {
        const response = await fetch(`${API_BASE}/api/chat/stats`);
        
        if (!response.ok) throw new Error('Failed to load stats');
        
        const stats = await response.json();
        
        document.getElementById('stat-sessions').textContent = stats.total_sessions || 0;
        document.getElementById('stat-tokens').textContent = formatNumber(stats.total_tokens || 0);
        
      } catch (error) {
        console.error('Error loading stats:', error);
      }
    }
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // PLAYBOOK INTEGRATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function openPlaybookModal(messageId) {
      const messageDiv = document.getElementById(messageId);
      const content = messageDiv?.querySelector('.message-content')?.textContent;
      
      if (!content) return;
      
      state.pendingPlaybookMessage = {
        messageId,
        content,
        agent: state.selectedAgent
      };
      
      document.getElementById('playbook-modal').classList.remove('hidden');
    }
    
    function closePlaybookModal() {
      document.getElementById('playbook-modal').classList.add('hidden');
      state.pendingPlaybookMessage = null;
    }
    
    async function confirmSaveToPlaybook() {
      if (!state.pendingPlaybookMessage) return;
      
      const category = document.getElementById('playbook-category').value;
      const rating = document.getElementById('playbook-rating').value;
      const notes = document.getElementById('playbook-notes').value;
      
      try {
        const response = await fetch(`${API_BASE}/api/playbook/entries`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            content: state.pendingPlaybookMessage.content,
            category,
            quality_rating: rating,
            agent_id: state.pendingPlaybookMessage.agent?.id,
            notes
          })
        });
        
        if (!response.ok) throw new Error('Failed to save to playbook');
        
        showNotification('Saved to Playbook! â­', 'success');
        closePlaybookModal();
        
      } catch (error) {
        console.error('Error saving to playbook:', error);
        alert('Failed to save to playbook. Please try again.');
      }
    }
    
    
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function getTimeAgo(date) {
      const seconds = Math.floor((new Date() - date) / 1000);
      
      const intervals = {
        year: 31536000,
        month: 2592000,
        week: 604800,
        day: 86400,
        hour: 3600,
        minute: 60
      };
      
      for (const [unit, secondsInUnit] of Object.entries(intervals)) {
        const interval = Math.floor(seconds / secondsInUnit);
        if (interval >= 1) {
          return `${interval} ${unit}${interval > 1 ? 's' : ''} ago`;
        }
      }
      
      return 'Just now';
    }
    
    function formatNumber(num) {
      if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
      if (num >= 1000) return (num / 1000).toFixed(1) + 'K';
      return num.toString();
    }
    
    function showNotification(message, type = 'info') {
      const colors = {
        success: 'bg-green-500',
        error: 'bg-red-500',
        info: 'bg-cyan-500'
      };
      
      const notification = document.createElement('div');
      notification.className = `fixed bottom-4 right-4 px-4 py-3 rounded-xl ${colors[type]} text-white font-medium shadow-lg animate-fadeIn z-50`;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translateY(10px)';
        notification.style.transition = 'all 0.3s ease-out';
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
  </script>
  
</body>
</html>
