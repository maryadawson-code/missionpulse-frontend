<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S134 - Clearance Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Space Grotesk',sans-serif;background:#00050F;min-height:100vh}.font-mono{font-family:'JetBrains Mono',monospace}@keyframes slideIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.animate-slide-in{animation:slideIn .4s ease-out forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.glass-card{background:linear-gradient(135deg,rgba(15,23,42,.9) 0%,rgba(15,23,42,.7) 100%);backdrop-filter:blur(10px);border:1px solid rgba(0,229,250,.15)}.glass-card:hover{border-color:rgba(0,229,250,.3)}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#0a1628}::-webkit-scrollbar-thumb{background:rgba(0,229,250,.3);border-radius:3px}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const{useState,useEffect}=React;
    const SUPABASE_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;try{sbClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY)}catch(e){sbClient=null}

    const Icons={
      shield:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
      user:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>,
      clock:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6l4 2"/></svg>,
      alert:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>,
      check:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>,
      search:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>,
    };
    const Icon=({name,className="w-4 h-4"})=>{const C=Icons[name];return C?<span className={`inline-block ${className}`}><C/></span>:null};

    const PERSONNEL=[
      {id:1,name:'Sarah Chen',role:'SA Lead',clearance:'TS/SCI',level_num:5,sponsor:'DHA',adjudication:'Current',granted:'2024-03-15',expires:'2029-03-15',poly:'CI Poly',poly_date:'2024-03-15',status:'active'},
      {id:2,name:'James Rivera',role:'PM Lead',clearance:'Secret',level_num:3,sponsor:'VA',adjudication:'Current',granted:'2023-08-01',expires:'2033-08-01',poly:'None',poly_date:null,status:'active'},
      {id:3,name:'Diana Kim',role:'CAP Manager',clearance:'TS/SCI',level_num:5,sponsor:'DoD',adjudication:'Current',granted:'2022-11-20',expires:'2027-11-20',poly:'Full Scope',poly_date:'2022-11-20',status:'active'},
      {id:4,name:'Marcus Johnson',role:'Pricing Lead',clearance:'Secret',level_num:3,sponsor:'DHA',adjudication:'Current',granted:'2024-06-10',expires:'2034-06-10',poly:'None',poly_date:null,status:'active'},
      {id:5,name:'Emily Zhao',role:'Compliance Lead',clearance:'Top Secret',level_num:4,sponsor:'DoD',adjudication:'Current',granted:'2023-01-22',expires:'2028-01-22',poly:'CI Poly',poly_date:'2023-01-22',status:'active'},
      {id:6,name:'Robert Kim',role:'Cloud Architect',clearance:'TS/SCI',level_num:5,sponsor:'DHA',adjudication:'Pending Upgrade',granted:'2021-09-05',expires:'2026-09-05',poly:'CI Poly',poly_date:'2021-09-05',status:'pending'},
      {id:7,name:'Anna Patel',role:'Data Engineer',clearance:'Secret',level_num:3,sponsor:'VA',adjudication:'In Progress',granted:null,expires:null,poly:'None',poly_date:null,status:'processing'},
      {id:8,name:'David Torres',role:'DevSecOps',clearance:'Top Secret',level_num:4,sponsor:'DoD',adjudication:'Current',granted:'2024-09-18',expires:'2029-09-18',poly:'None',poly_date:null,status:'active'},
      {id:9,name:'Lisa Chang',role:'UX Designer',clearance:'Public Trust',level_num:1,sponsor:'CMS',adjudication:'Current',granted:'2025-02-01',expires:'2030-02-01',poly:'None',poly_date:null,status:'active'},
      {id:10,name:'Michael Brown',role:'QA Lead',clearance:'Secret',level_num:3,sponsor:'DHA',adjudication:'Expiring Soon',granted:'2020-05-12',expires:'2026-05-12',poly:'None',poly_date:null,status:'expiring'},
    ];

    const ConnectionIndicator=({connected})=>(
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{background:connected?'rgba(0,255,136,0.1)':'rgba(255,184,0,0.1)',border:`1px solid ${connected?'rgba(0,255,136,0.3)':'rgba(255,184,0,0.3)'}`}}>
        <div className={`w-2 h-2 rounded-full ${connected?'bg-green-400':'bg-amber-400 animate-pulse'}`}/>
        <span style={{color:connected?'#00ff88':'#ffb800'}}>{connected?'LIVE':'DEMO'}</span>
      </div>
    );

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[userRole]=useState('CEO');
      const[search,setSearch]=useState('');
      const[filterLevel,setFilterLevel]=useState('all');

      useEffect(()=>{
        const allowed=['CEO','COO','PM','Admin'];
        if(!allowed.includes(userRole))return;
      },[userRole]);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data}=await sbClient.from('opportunities').select('id').limit(1);if(data)setConnected(true)}catch(e){}})()},[]);

      const filtered=PERSONNEL.filter(p=>{
        if(search&&!p.name.toLowerCase().includes(search.toLowerCase())&&!p.role.toLowerCase().includes(search.toLowerCase()))return false;
        if(filterLevel!=='all'&&p.clearance!==filterLevel)return false;
        return true;
      });

      const active=PERSONNEL.filter(p=>p.status==='active').length;
      const pending=PERSONNEL.filter(p=>p.status==='processing'||p.status==='pending').length;
      const expiring=PERSONNEL.filter(p=>p.status==='expiring').length;
      const tsSci=PERSONNEL.filter(p=>p.clearance==='TS/SCI').length;
      const levels=[...new Set(PERSONNEL.map(p=>p.clearance))];

      const daysUntil=(date)=>{if(!date)return null;const d=Math.ceil((new Date(date)-new Date())/(1000*60*60*24));return d};

      const StatusBadge=({status})=>{
        const m={active:{c:'#00ff88',l:'ACTIVE'},pending:{c:'#ffb800',l:'PENDING'},processing:{c:'#00E5FA',l:'PROCESSING'},expiring:{c:'#ff4444',l:'EXPIRING'}};
        const s=m[status]||m.active;
        return <span className="px-2 py-0.5 rounded text-xs font-mono font-bold" style={{background:`${s.c}15`,color:s.c,border:`1px solid ${s.c}30`}}>{s.l}</span>;
      };

      const ClearanceBadge=({level})=>{
        const m={'TS/SCI':{c:'#ff4444',bg:'rgba(255,68,68,0.1)'},'Top Secret':{c:'#ff8c00',bg:'rgba(255,140,0,0.1)'},'Secret':{c:'#ffb800',bg:'rgba(255,184,0,0.1)'},'Public Trust':{c:'#00E5FA',bg:'rgba(0,229,250,0.1)'}};
        const s=m[level]||m.Secret;
        return <span className="px-2 py-0.5 rounded text-xs font-mono font-bold" style={{background:s.bg,color:s.c,border:`1px solid ${s.c}30`}}>{level}</span>;
      };

      return(
        <div className="min-h-screen" style={{background:'#00050F'}}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div>
                <div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Clearance Tracker</h1><ConnectionIndicator connected={connected}/></div>
                <p className="text-sm text-slate-400">Personnel clearance levels, expiration tracking & adjudication status</p>
              </div>
              <div className="relative">
                <Icon name="search" className="w-4 h-4 text-slate-500 absolute left-3 top-1/2 -translate-y-1/2"/>
                <input type="text" placeholder="Search personnel..." value={search} onChange={e=>setSearch(e.target.value)} className="pl-9 pr-4 py-2 rounded-lg bg-slate-800/50 border border-slate-700/30 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 w-56"/>
              </div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
              {[
                {label:'Total Personnel',value:PERSONNEL.length,color:'#00E5FA'},
                {label:'Active',value:active,color:'#00ff88'},
                {label:'TS/SCI',value:tsSci,color:'#ff4444'},
                {label:'Pending/Processing',value:pending,color:'#ffb800'},
                {label:'Expiring (<90d)',value:expiring,color:'#ff4444'},
              ].map((k,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{color:k.color}}>{k.value}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-2 mb-4">
              {['all',...levels].map(l=>(
                <button key={l} onClick={()=>setFilterLevel(l)} className={`px-3 py-1 rounded-md text-xs font-mono font-bold transition ${filterLevel===l?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300 bg-slate-800/30'}`}>{l==='all'?'All':l}</button>
              ))}
            </div>

            <div className="glass-card rounded-xl overflow-hidden">
              <div className="grid grid-cols-12 gap-2 px-5 py-3 border-b border-slate-700/30 text-xs font-mono text-slate-500 uppercase">
                <span className="col-span-2">Name</span><span className="col-span-2">Role</span><span>Clearance</span><span>Sponsor</span><span className="col-span-2">Adjudication</span><span>Polygraph</span><span>Granted</span><span>Expires</span><span>Status</span>
              </div>
              {filtered.map((p,i)=>{
                const days=daysUntil(p.expires);
                return(
                  <div key={p.id} className="grid grid-cols-12 gap-2 items-center px-5 py-3 border-b border-slate-700/10 hover:bg-slate-800/20 transition animate-slide-in" style={{animationDelay:`${i*.04}s`}}>
                    <span className="col-span-2 text-sm text-white font-medium">{p.name}</span>
                    <span className="col-span-2 text-xs text-slate-400">{p.role}</span>
                    <span><ClearanceBadge level={p.clearance}/></span>
                    <span className="text-xs font-mono text-slate-400">{p.sponsor}</span>
                    <span className="col-span-2 text-xs text-slate-300">{p.adjudication}</span>
                    <span className="text-xs font-mono text-slate-400">{p.poly}</span>
                    <span className="text-xs font-mono text-slate-500">{p.granted||'—'}</span>
                    <span className={`text-xs font-mono ${days&&days<90?'text-red-400 font-bold':days&&days<365?'text-amber-400':'text-slate-500'}`}>{p.expires||'Pending'}{days&&days<90?` (${days}d)`:''}</span>
                    <span><StatusBadge status={p.status}/></span>
                  </div>
                );
              })}
            </div>

            <div className="mt-8 text-center">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20">
                <Icon name="shield" className="w-3.5 h-3.5 text-amber-500"/>
                <span className="text-xs text-amber-500/80 font-mono">AI GENERATED — REQUIRES HUMAN REVIEW</span>
              </div>
            </div>
          </div>
        </div>
      );
    };
    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
