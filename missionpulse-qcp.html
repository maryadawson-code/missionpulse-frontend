<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Quality Control Plan</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const DEMO_GATES=[
      {id:1,gate:'QG-01',name:'Requirements Validation',phase:'Planning',trigger:'RFP shred complete',criteria:['All L/M/C sections mapped to response','Compliance matrix 100% populated','Requirements traceable to WBS'],inspector:'QA Lead',frequency:'Per opportunity',method:'Peer review + checklist',status:'ACTIVE'},
      {id:2,gate:'QG-02',name:'Blue Team Readiness',phase:'Development',trigger:'Draft volume complete',criteria:['All sections at ≥80% completion','Graphics placeholders filled','Win themes woven into each section','Page count within 90% of limit'],inspector:'PM + QA Lead',frequency:'Per color review',method:'Structured walkthrough',status:'ACTIVE'},
      {id:3,gate:'QG-03',name:'Pink Team Review',phase:'Review',trigger:'Full draft complete',criteria:['Compliance matrix green (≥95%)','All evaluator-facing sections complete','Ghosting/discriminator statements present','No TBD placeholders remaining'],inspector:'External reviewer',frequency:'Per opportunity',method:'Independent evaluation simulation',status:'ACTIVE'},
      {id:4,gate:'QG-04',name:'Red Team Review',phase:'Review',trigger:'Pink Team deficiencies resolved',criteria:['All Pink Team findings addressed','Scoring simulation ≥85/100','Executive summary compelling','Pricing volume reconciled'],inspector:'Red Team panel',frequency:'Per opportunity',method:'Full evaluation simulation',status:'ACTIVE'},
      {id:5,gate:'QG-05',name:'Gold Team / Final QC',phase:'Production',trigger:'Red Team approval',criteria:['Zero compliance gaps','Format matches RFP instructions exactly','Cross-references verified','Spelling/grammar clean','Print/PDF rendering validated'],inspector:'QA Lead + PM',frequency:'Per submission',method:'Line-by-line inspection',status:'ACTIVE'},
      {id:6,gate:'QG-06',name:'Code Release Gate',phase:'Development',trigger:'Sprint complete',criteria:['All unit tests passing (≥95%)','Code coverage ≥80%','Zero critical/high SAST findings','Peer review approved','STIG compliance scan clean'],inspector:'DevSecOps + QA',frequency:'Per sprint',method:'Automated + manual review',status:'ACTIVE'},
      {id:7,gate:'QG-07',name:'Deliverable Acceptance',phase:'Delivery',trigger:'Deliverable drafted',criteria:['Meets CDRLs format requirements','Technical accuracy verified by SME','508 compliance validated','Government-ready formatting'],inspector:'PM + Technical Lead',frequency:'Per deliverable',method:'Dual review + sign-off',status:'ACTIVE'},
    ];

    const DEMO_DEFECTS=[
      {id:1,defectId:'DEF-001',title:'Missing transition acceptance criteria',severity:'CRITICAL',phase:'Pink Team',section:'Vol III §3.4',assignee:'Tom Patterson',dateFound:'2026-02-10',dateDue:'2026-02-14',dateResolved:'2026-02-13',status:'CLOSED',rootCause:'Incomplete KT requirements analysis',corrective:'Added acceptance criteria checklist template to transition plan standard'},
      {id:2,defectId:'DEF-002',title:'ConMon tool not specified in ATO section',severity:'MAJOR',phase:'Pink Team',section:'Vol II §2.3',assignee:'Angela Foster',dateFound:'2026-02-10',dateDue:'2026-02-15',dateResolved:null,status:'OPEN',rootCause:'Vendor selection still in progress',corrective:'Interim: State "Datadog or equivalent FedRAMP-authorized tool" with decision criteria'},
      {id:3,defectId:'DEF-003',title:'Tier 3 escalation procedures lack detail',severity:'MAJOR',phase:'Pink Team',section:'Vol II §2.6',assignee:'Kevin Brown',dateFound:'2026-02-11',dateDue:'2026-02-16',dateResolved:null,status:'OPEN',rootCause:'SME availability gap during drafting',corrective:'Schedule dedicated SME session; add escalation flowchart'},
      {id:4,defectId:'DEF-004',title:'Past performance AI narrative uses sub PP only',severity:'MAJOR',phase:'Blue Team',section:'Vol IV §4.3',assignee:'Mary Womack',dateFound:'2026-01-28',dateDue:'2026-02-05',dateResolved:'2026-02-03',status:'CLOSED',rootCause:'No prime federal healthcare AI contract',corrective:'Combine CMS analytics (prime) with DoD AI sub; add relevance bridge narrative'},
      {id:5,defectId:'DEF-005',title:'Org chart missing dotted-line to COR',severity:'MINOR',phase:'Blue Team',section:'Vol III §3.1',assignee:'Tom Patterson',dateFound:'2026-01-28',dateDue:'2026-02-02',dateResolved:'2026-01-30',status:'CLOSED',rootCause:'Template oversight',corrective:'Updated org chart template to include government oversight lines'},
      {id:6,defectId:'DEF-006',title:'BOE hours mismatch between Vol V and staffing',severity:'CRITICAL',phase:'Red Team',section:'Vol V §5.1',assignee:'Finance',dateFound:'2026-02-15',dateDue:'2026-02-17',dateResolved:'2026-02-16',status:'CLOSED',rootCause:'Staffing plan updated without BOE reconciliation',corrective:'Added automated cross-check between staffing plan and BOE spreadsheet'},
      {id:7,defectId:'DEF-007',title:'Win theme not referenced in Exec Summary',severity:'MINOR',phase:'Red Team',section:'Vol I §1.0',assignee:'Sarah Kim',dateFound:'2026-02-15',dateDue:'2026-02-17',dateResolved:null,status:'OPEN',rootCause:'Exec summary written before final win theme refinement',corrective:'Update exec summary post-Red Team with all 7 win themes'},
      {id:8,defectId:'DEF-008',title:'Section 508 VPAT not attached to admin volume',severity:'MINOR',phase:'Gold Team',section:'Admin §6.3',assignee:'Patricia Nguyen',dateFound:'2026-02-17',dateDue:'2026-02-18',dateResolved:null,status:'OPEN',rootCause:'Document assembly oversight',corrective:'Added VPAT to final assembly checklist'},
    ];

    const CMMI_PROCESSES=[
      {area:'Requirements Management',level:'ML2',practice:'REQM SP 1.1: Obtain understanding of requirements',implementation:'RFP Shredder + Compliance Matrix modules parse and track every requirement.',evidence:'Compliance mapping at 91% coverage'},
      {area:'Project Planning',level:'ML2',practice:'PP SP 2.1: Establish and maintain the budget and schedule',implementation:'Schedule Builder + Pricing Engine with EVM baseline. Milestones Tracker for gate management.',evidence:'WBS-based schedule with critical path analysis'},
      {area:'Project Monitoring & Control',level:'ML2',practice:'PMC SP 1.1: Monitor project planning parameters',implementation:'Dashboard pipeline cards + War Room for real-time status. Swimlane Board for workflow visibility.',evidence:'Weekly status reviews with variance tracking'},
      {area:'Configuration Management',level:'ML2',practice:'CM SP 1.1: Identify configuration items',implementation:'Document Versioning module tracks all proposal artifacts with version history and branch management.',evidence:'Full audit trail per document with diff tracking'},
      {area:'Process & Product Quality Assurance',level:'ML2',practice:'PPQA SP 1.1: Objectively evaluate processes',implementation:'This QCP module + Review Workflow (Blue→Pink→Red→Gold). Defect tracking with root cause analysis.',evidence:'7 QA gates, defect log with corrective actions'},
      {area:'Measurement & Analysis',level:'ML2',practice:'MA SP 1.1: Establish measurement objectives',implementation:'Win Themes Analytics + Launch & ROI module. Lessons Playbook captures metrics across proposals.',evidence:'pWin tracking, review scores, defect density metrics'},
    ];

    const sevColor={CRITICAL:'#ef4444',MAJOR:'#f59e0b',MINOR:'#94a3b8'};
    const statColor={OPEN:'#f59e0b',CLOSED:'#00ff88',ACTIVE:'#00E5FA'};
    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[tab,setTab]=useState('gates');
      const[expandedGate,setExpandedGate]=useState(null);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('ai_approvals').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const openDefects=DEMO_DEFECTS.filter(d=>d.status==='OPEN').length;
      const critOpen=DEMO_DEFECTS.filter(d=>d.status==='OPEN'&&d.severity==='CRITICAL').length;
      const closureRate=Math.round(DEMO_DEFECTS.filter(d=>d.status==='CLOSED').length/DEMO_DEFECTS.length*100);

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>QUALITY MANAGEMENT</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Quality Control Plan</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>QA gates • Defect tracking • CMMI-aligned processes</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'QA Gates',value:DEMO_GATES.length,color:'#00E5FA'},
              {label:'Total Defects',value:DEMO_DEFECTS.length,color:'#a78bfa'},
              {label:'Open',value:openDefects,color:openDefects>0?'#f59e0b':'#00ff88'},
              {label:'Critical Open',value:critOpen,color:critOpen>0?'#ef4444':'#00ff88'},
              {label:'Closure Rate',value:`${closureRate}%`,color:closureRate>=75?'#00ff88':'#f59e0b'},
              {label:'CMMI Areas',value:CMMI_PROCESSES.length,color:'#00E5FA'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'120px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          <div style={{display:'flex',gap:'4px',marginBottom:'16px'}}>
            {[{k:'gates',l:'QA Gates'},{k:'defects',l:'Defect Log'},{k:'cmmi',l:'CMMI Alignment'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
          </div>

          {tab==='gates'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'6px'}}>
              {DEMO_GATES.map(g=>(
                <div key={g.id} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',overflow:'hidden'}}>
                  <div onClick={()=>setExpandedGate(expandedGate===g.id?null:g.id)} style={{padding:'12px 16px',cursor:'pointer',display:'flex',alignItems:'center',gap:'12px'}}>
                    <div style={{width:'40px',height:'40px',borderRadius:'8px',background:'rgba(0,229,250,0.06)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'12px',fontWeight:800,color:'#00E5FA',flexShrink:0}}>{g.gate}</div>
                    <div style={{flex:1}}>
                      <div style={{fontSize:'14px',fontWeight:600,color:'white'}}>{g.name}</div>
                      <div style={{display:'flex',gap:'8px',marginTop:'3px',fontSize:'10px',color:'#5a7a9a'}}>
                        <span style={{padding:'0 5px',borderRadius:'3px',background:'rgba(167,139,250,0.08)',color:'#a78bfa'}}>{g.phase}</span>
                        <span>Inspector: {g.inspector}</span>
                        <span>{g.frequency}</span>
                      </div>
                    </div>
                    <span style={{fontSize:'10px',fontWeight:700,padding:'2px 8px',borderRadius:'4px',background:`${statColor[g.status]}12`,color:statColor[g.status]}}>{g.status}</span>
                    <span style={{color:'#5a7a9a',fontSize:'16px',transform:expandedGate===g.id?'rotate(180deg)':'rotate(0)',transition:'transform 0.2s'}}>▾</span>
                  </div>
                  {expandedGate===g.id&&(
                    <div style={{padding:'0 16px 14px 68px',borderTop:'1px solid rgba(0,229,250,0.06)'}}>
                      <div style={{padding:'10px 0'}}>
                        <div style={{fontSize:'9px',fontWeight:700,color:'#00ff88',letterSpacing:'0.5px',marginBottom:'6px'}}>PASS CRITERIA</div>
                        {g.criteria.map(c=><div key={c} style={{fontSize:'11px',color:'#86efac',padding:'2px 0'}}>✓ {c}</div>)}
                      </div>
                      <div style={{display:'flex',gap:'16px',fontSize:'11px',color:'#5a7a9a'}}>
                        <span><strong>Trigger:</strong> {g.trigger}</span>
                        <span><strong>Method:</strong> {g.method}</span>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {tab==='defects'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'auto'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px',minWidth:'900px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  {['ID','Defect','Severity','Phase','Section','Assignee','Due','Status'].map(h=>(
                    <th key={h} style={{padding:'10px 8px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px',letterSpacing:'0.5px',textTransform:'uppercase'}}>{h}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {DEMO_DEFECTS.map(d=>(
                    <tr key={d.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}} onMouseOver={e=>e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
                      <td style={{padding:'8px',fontFamily:'monospace',fontSize:'10px',color:'#00E5FA',fontWeight:600}}>{d.defectId}</td>
                      <td style={{padding:'8px',color:'white',fontWeight:500,maxWidth:'200px'}}>{d.title}</td>
                      <td style={{padding:'8px'}}><span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${sevColor[d.severity]}12`,color:sevColor[d.severity]}}>{d.severity}</span></td>
                      <td style={{padding:'8px',color:'#a78bfa',fontSize:'11px'}}>{d.phase}</td>
                      <td style={{padding:'8px',fontFamily:'monospace',fontSize:'10px',color:'#94a3b8'}}>{d.section}</td>
                      <td style={{padding:'8px',color:'#94a3b8',fontSize:'11px'}}>{d.assignee}</td>
                      <td style={{padding:'8px',fontSize:'10px',color:d.status==='OPEN'&&new Date(d.dateDue)<new Date()?'#ef4444':'#5a7a9a'}}>{d.dateDue}</td>
                      <td style={{padding:'8px'}}><span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${statColor[d.status]}12`,color:statColor[d.status]}}>{d.status}</span></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          {tab==='cmmi'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
              {CMMI_PROCESSES.map((p,i)=>(
                <div key={i} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'14px 18px'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'6px'}}>
                    <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:'rgba(167,139,250,0.1)',color:'#a78bfa'}}>{p.level}</span>
                    <span style={{fontSize:'14px',fontWeight:700,color:'white'}}>{p.area}</span>
                  </div>
                  <div style={{fontSize:'11px',color:'#67e8f9',marginBottom:'4px',fontWeight:500}}>{p.practice}</div>
                  <div style={{fontSize:'12px',color:'#94a3b8',lineHeight:'1.5',marginBottom:'4px'}}>{p.implementation}</div>
                  <div style={{fontSize:'10px',color:'#00ff88'}}>Evidence: {p.evidence}</div>
                </div>
              ))}
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
