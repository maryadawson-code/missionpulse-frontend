<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MissionPulse — Evaluation Criteria</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:fadeIn .3s ease-out forwards}</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const SB_URL='https://djuviwarqdvlbgcfuupa.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MzUyMjQsImV4cCI6MjA1MzQxMTIyNH0.pBPL9l2zL7LLd_A5I--hPBzw5YwG3ajPMtbYsqsxIgQ';
var sbClient=null;let connected=false;
try{sbClient=supabase.createClient(SB_URL,SB_KEY);connected=true}catch(e){}

const ADJECTIVAL=['Outstanding','Good','Acceptable','Marginal','Unacceptable'];
const ADJ_COLORS={Outstanding:'text-green-400 bg-green-500/10',Good:'text-cyan-400 bg-cyan-500/10',Acceptable:'text-blue-400 bg-blue-500/10',Marginal:'text-amber-400 bg-amber-500/10',Unacceptable:'text-red-400 bg-red-500/10'};
const ADJ_DESC={Outstanding:'Exceeds requirements with significant strengths, no weaknesses',Good:'Exceeds some requirements with strengths, minor weaknesses',Acceptable:'Meets requirements, minor weaknesses',Marginal:'Does not clearly meet requirements, significant weaknesses',Unacceptable:'Fails to meet requirements, major deficiencies'};

const DEMO_FACTORS=[
  {id:1,name:'Technical Approach',weight:35,section:'M.1',subfactors:[
    {name:'Understanding of Requirements',selfScore:'Good',alignment:85,strengths:['Clear mapping to SOW','Detailed implementation timeline'],weaknesses:['Limited discussion of legacy integration']},
    {name:'Technical Innovation',selfScore:'Outstanding',alignment:92,strengths:['AI-driven automation','Novel data architecture'],weaknesses:[]},
    {name:'Quality Assurance Methodology',selfScore:'Acceptable',alignment:72,strengths:['Defined QA gates'],weaknesses:['No mention of automated testing','Missing defect tracking process']},
  ]},
  {id:2,name:'Management Approach',weight:25,section:'M.2',subfactors:[
    {name:'Program Management Plan',selfScore:'Good',alignment:80,strengths:['Experienced PM identified','Clear WBS'],weaknesses:['Transition timeline aggressive']},
    {name:'Risk Management',selfScore:'Good',alignment:78,strengths:['Comprehensive risk register','Mitigation strategies defined'],weaknesses:['No quantitative risk analysis']},
  ]},
  {id:3,name:'Past Performance',weight:20,section:'M.3',subfactors:[
    {name:'Relevance of Experience',selfScore:'Outstanding',alignment:95,strengths:['3 DHA contracts','CPARS ratings 4.5+ avg'],weaknesses:[]},
    {name:'Contract Performance',selfScore:'Good',alignment:88,strengths:['Zero CDRLs missed','On-budget delivery'],weaknesses:['One minor schedule slip on VA contract']},
  ]},
  {id:4,name:'Price/Cost',weight:15,section:'M.4',subfactors:[
    {name:'Price Reasonableness',selfScore:'Acceptable',alignment:70,strengths:['Competitive labor rates'],weaknesses:['ODC pricing above market','Missing volume discounts']},
    {name:'Cost Realism',selfScore:'Good',alignment:82,strengths:['Detailed BOE','Realistic FTE ramp'],weaknesses:[]},
  ]},
  {id:5,name:'Small Business Participation',weight:3,section:'M.5',subfactors:[
    {name:'SB Subcontracting Plan',selfScore:'Outstanding',alignment:98,strengths:['SDVOSB prime','45% SB subcontracting'],weaknesses:[]},
  ]},
  {id:6,name:'Security',weight:2,section:'M.6',subfactors:[
    {name:'Security Approach',selfScore:'Good',alignment:85,strengths:['CMMC 2.0 L2 ready','FedRAMP architecture'],weaknesses:['ATO timeline not specified']},
  ]},
];

function App(){
  const[factors,setFactors]=React.useState(DEMO_FACTORS);
  const[expanded,setExpanded]=React.useState(1);
  const[tab,setTab]=React.useState('factors');

  React.useEffect(()=>{if(connected){sbClient.from('compliance_items').select('*').then(({data})=>{if(data?.length){/*merge*/}})}},[]);

  const weightedScore=factors.reduce((sum,f)=>{
    const avgAlign=f.subfactors.reduce((a,s)=>a+s.alignment,0)/f.subfactors.length;
    return sum+(avgAlign*f.weight/100);
  },0).toFixed(1);

  const totalStrengths=factors.flatMap(f=>f.subfactors.flatMap(s=>s.strengths)).length;
  const totalWeaknesses=factors.flatMap(f=>f.subfactors.flatMap(s=>s.weaknesses)).length;

  return(
    <div className="min-h-screen p-6 max-w-6xl mx-auto">
      <div className="flex items-center justify-between mb-6">
        <div><a href="index.html" className="text-cyan-400 text-xs hover:underline mb-1 inline-block">← Dashboard</a><h1 className="text-2xl font-extrabold text-white">Evaluation Criteria</h1><p className="text-sm text-gray-500">Section M Analysis · {factors.length} factors · {factors.reduce((a,f)=>a+f.subfactors.length,0)} sub-factors</p></div>
        <span className={`px-3 py-1 rounded-full text-xs font-mono font-semibold ${connected?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`}>{connected?'LIVE':'DEMO'}</span>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-cyan-400">{weightedScore}%</div><div className="text-xs text-gray-500">Weighted Score</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-green-400">{totalStrengths}</div><div className="text-xs text-gray-500">Strengths</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-red-400">{totalWeaknesses}</div><div className="text-xs text-gray-500">Weaknesses</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-purple-400">{factors.length}</div><div className="text-xs text-gray-500">Eval Factors</div></div>
      </div>

      {/* Weight distribution bar */}
      <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 mb-6">
        <div className="text-xs text-gray-500 mb-2 font-medium">Weight Distribution</div>
        <div className="flex h-6 rounded-full overflow-hidden">
          {factors.map((f,i)=>{const colors=['bg-cyan-500','bg-purple-500','bg-green-500','bg-amber-500','bg-blue-500','bg-red-500'];return(<div key={f.id} className={`${colors[i%6]} relative group`} style={{width:`${f.weight}%`}} title={`${f.name}: ${f.weight}%`}><span className="absolute inset-0 flex items-center justify-center text-[9px] font-bold text-white">{f.weight>5?`${f.weight}%`:''}</span></div>)})}
        </div>
        <div className="flex flex-wrap gap-3 mt-2">{factors.map((f,i)=>{const colors=['text-cyan-400','text-purple-400','text-green-400','text-amber-400','text-blue-400','text-red-400'];return(<span key={f.id} className={`text-[10px] font-mono ${colors[i%6]}`}>{f.section} {f.name} ({f.weight}%)</span>)})}</div>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-4">
        {[['factors','Factor Cards'],['scale','Adjectival Scale'],['matrix','Alignment Matrix']].map(([k,l])=>(
          <button key={k} onClick={()=>setTab(k)} className={`px-3 py-1.5 rounded-lg text-xs font-semibold ${tab===k?'bg-cyan-500/15 text-cyan-400 border border-cyan-500/30':'bg-[#0a1628] text-gray-500 border border-gray-800'}`}>{l}</button>
        ))}
      </div>

      {/* Factor Cards */}
      {tab==='factors'&&(
        <div className="space-y-3">
          {factors.map(factor=>(
            <div key={factor.id} className="bg-[#0a1628] border border-gray-800 rounded-xl overflow-hidden fade-in">
              <div className="flex items-center justify-between px-5 py-4 cursor-pointer hover:bg-gray-800/20" onClick={()=>setExpanded(expanded===factor.id?null:factor.id)}>
                <div className="flex items-center gap-3">
                  <span className="text-xs font-mono text-purple-400 bg-purple-500/10 px-2 py-0.5 rounded">{factor.section}</span>
                  <span className="text-white font-semibold text-sm">{factor.name}</span>
                  <span className="text-xs text-gray-500">{factor.subfactors.length} sub-factors</span>
                </div>
                <div className="flex items-center gap-3">
                  <span className="text-xs font-bold text-cyan-400">{factor.weight}%</span>
                  <span className="text-gray-600">{expanded===factor.id?'▲':'▼'}</span>
                </div>
              </div>
              {expanded===factor.id&&(
                <div className="px-5 pb-4 border-t border-gray-800 pt-3 space-y-3 fade-in">
                  {factor.subfactors.map((sf,i)=>(
                    <div key={i} className="bg-[#00050F] border border-gray-800 rounded-lg p-3">
                      <div className="flex items-center justify-between mb-2">
                        <span className="text-sm text-white font-medium">{sf.name}</span>
                        <div className="flex items-center gap-2">
                          <span className={`text-[10px] font-semibold px-2 py-0.5 rounded ${ADJ_COLORS[sf.selfScore]}`}>{sf.selfScore}</span>
                          <span className="text-xs font-mono text-cyan-400">{sf.alignment}%</span>
                        </div>
                      </div>
                      <div className="h-1.5 bg-gray-800 rounded-full mb-2"><div className="h-1.5 rounded-full bg-cyan-400" style={{width:`${sf.alignment}%`}}/></div>
                      {sf.strengths.length>0&&<div className="text-xs text-green-400 mb-1">✓ {sf.strengths.join(' · ')}</div>}
                      {sf.weaknesses.length>0&&<div className="text-xs text-red-400">✗ {sf.weaknesses.join(' · ')}</div>}
                    </div>
                  ))}
                </div>
              )}
            </div>
          ))}
        </div>
      )}

      {/* Adjectival Scale */}
      {tab==='scale'&&(
        <div className="space-y-2 fade-in">
          {ADJECTIVAL.map(a=>(
            <div key={a} className="bg-[#0a1628] border border-gray-800 rounded-lg px-5 py-3 flex items-center gap-4">
              <span className={`text-sm font-bold px-3 py-1 rounded ${ADJ_COLORS[a]}`}>{a}</span>
              <span className="text-xs text-gray-400 flex-1">{ADJ_DESC[a]}</span>
            </div>
          ))}
        </div>
      )}

      {/* Alignment Matrix */}
      {tab==='matrix'&&(
        <div className="overflow-x-auto fade-in">
          <table className="w-full text-xs">
            <thead><tr className="text-gray-500 border-b border-gray-800"><th className="text-left px-3 py-2">Factor</th><th className="text-left px-3 py-2">Sub-Factor</th><th className="text-center px-3 py-2">Self-Score</th><th className="text-center px-3 py-2">Alignment</th><th className="text-center px-3 py-2">S</th><th className="text-center px-3 py-2">W</th></tr></thead>
            <tbody>{factors.flatMap(f=>f.subfactors.map((sf,i)=>(
              <tr key={`${f.id}-${i}`} className="border-b border-gray-800/50 hover:bg-gray-800/20">
                <td className="px-3 py-2 text-purple-400 font-mono">{f.section}</td>
                <td className="px-3 py-2 text-white">{sf.name}</td>
                <td className="px-3 py-2 text-center"><span className={`px-1.5 py-0.5 rounded text-[10px] font-semibold ${ADJ_COLORS[sf.selfScore]}`}>{sf.selfScore}</span></td>
                <td className="px-3 py-2 text-center text-cyan-400 font-mono">{sf.alignment}%</td>
                <td className="px-3 py-2 text-center text-green-400">{sf.strengths.length}</td>
                <td className="px-3 py-2 text-center text-red-400">{sf.weaknesses.length}</td>
              </tr>
            )))}</tbody>
          </table>
        </div>
      )}

      <p className="text-center text-[10px] text-gray-600 mt-8 font-mono">⚠️ AI GENERATED — REQUIRES HUMAN REVIEW | MissionPulse v12.0 — Mission Meets Tech</p>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
