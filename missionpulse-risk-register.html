<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse ‚Äî Risk Register</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const DEMO_ITEMS=[
      {id:'R-001',type:'RISK',title:'Key Personnel Departure Mid-Performance',category:'Staffing',prob:2,impact:5,score:10,owner:'Mary Womack',status:'MITIGATED',trend:'STABLE',dateId:'2025-11-15',
        mitigation:'Maintain bench of 2 pre-cleared alternates per KP role. Cross-training ensures 2-deep coverage on all critical functions.',
        trigger:'KP resignation, illness >30 days, or clearance revocation',
        contingency:'Deploy alternate within 5 business days. COR notification within 24 hours. Resume submitted for government approval within 10 days.',
        costImpact:'$50K-150K replacement recruiting + productivity loss'},
      {id:'R-002',type:'RISK',title:'ATO Timeline Exceeds 90-Day Target',category:'Security',prob:3,impact:4,score:12,owner:'Angela Foster',status:'WATCH',trend:'IMPROVING',dateId:'2025-12-01',
        mitigation:'Leverage Azure Gov FedRAMP High inheritance (180+ controls). Pre-populate eMASS with inherited controls. Begin ConMon Day 1.',
        trigger:'Authorization milestone slips >15 days from plan',
        contingency:'Escalate to ISSM. Request interim ATC. Deploy in limited ATO scope while completing full package.',
        costImpact:'$75K additional security engineering labor + schedule slip'},
      {id:'R-003',type:'RISK',title:'Incumbent Non-Cooperation During Transition',category:'Transition',prob:3,impact:3,score:9,owner:'Tom Patterson',status:'MITIGATED',trend:'STABLE',dateId:'2025-12-10',
        mitigation:'Automated knowledge capture tools. Independent system discovery. Government mandate in PWS for KT cooperation.',
        trigger:'Incumbent misses 2+ scheduled KT sessions or withholds documentation',
        contingency:'Activate independent discovery protocol. Engage CO for contract enforcement. Extend parallel operations if needed.',
        costImpact:'$30K additional discovery labor + potential 15-day schedule impact'},
      {id:'R-004',type:'RISK',title:'Data Migration Integrity Failure',category:'Technical',prob:2,impact:5,score:10,owner:'Michelle Torres',status:'MITIGATED',trend:'STABLE',dateId:'2026-01-05',
        mitigation:'4-phase migration with automated reconciliation at each gate. Parallel validation period. Automated rollback capability.',
        trigger:'Data variance >0.1% in reconciliation reports',
        contingency:'Halt migration. Execute rollback to last validated checkpoint. Root cause analysis before retry.',
        costImpact:'$40K re-migration labor + 7-day schedule impact per rollback'},
      {id:'R-005',type:'RISK',title:'Scope Creep Beyond Baseline',category:'Management',prob:4,impact:3,score:12,owner:'Tom Patterson',status:'WATCH',trend:'STABLE',dateId:'2026-01-10',
        mitigation:'Formal CCB with impact assessment. EVM tracking against baseline. Monthly scope review with COR.',
        trigger:'>10% variance from baseline hours in any CLIN',
        contingency:'CCB review. Negotiate contract modification or re-baseline with CO approval.',
        costImpact:'$100K-500K depending on scope magnitude'},
      {id:'R-006',type:'RISK',title:'Clearance Processing Delay for New Staff',category:'Staffing',prob:3,impact:4,score:12,owner:'Mary Womack',status:'WATCH',trend:'STABLE',dateId:'2026-01-15',
        mitigation:'Pre-submit clearance packages 90 days before need-date. Maintain cleared bench of 3 resources.',
        trigger:'Clearance adjudication exceeds 120 days',
        contingency:'Deploy interim cleared staff. Escalate through SSO. Adjust ramp schedule as needed.',
        costImpact:'$25K per month for interim staffing premium'},
      {id:'I-001',type:'ISSUE',title:'ConMon Tool Selection Not Finalized',category:'Security',prob:5,impact:3,score:15,owner:'Angela Foster',status:'OPEN',trend:'STABLE',dateId:'2026-02-10',
        mitigation:'Evaluating Datadog Gov vs Splunk Cloud Gov. Decision criteria documented. Interim language in proposal: "FedRAMP-authorized SIEM."',
        trigger:'Current ‚Äî active issue',
        contingency:'Default to Datadog Gov (lower cost, FedRAMP authorized). Budget for either option in pricing.',
        costImpact:'$15K price delta between options'},
      {id:'I-002',type:'ISSUE',title:'Past Performance Gap ‚Äî Federal Healthcare AI',category:'Capture',prob:5,impact:4,score:20,owner:'Mary Womack',status:'OPEN',trend:'IMPROVING',dateId:'2026-01-28',
        mitigation:'Combining CMS analytics (prime PP) with DoD AI (sub PP). Adding relevance bridge narrative. Pursuing teaming with AI-focused firm.',
        trigger:'Current ‚Äî evaluator may score as weakness',
        contingency:'Emphasize CMS ML platform (2M+ claims daily, 94% accuracy) as directly relevant. Add customer testimonial.',
        costImpact:'Potential 5-10 point eval score reduction if not addressed'},
      {id:'O-001',type:'OPPORTUNITY',title:'AskSage Partnership as Sole Discriminator',category:'Technical',prob:4,impact:4,score:16,owner:'James Rodriguez',status:'ACTIVE',trend:'IMPROVING',dateId:'2025-11-20',
        mitigation:'Formalize AskSage teaming/licensing agreement. Position FedRAMP High AI as unique in competitive set.',
        trigger:'No competitor has equivalent FedRAMP High AI partnership',
        contingency:'If AskSage partnership falls through, pivot to Azure OpenAI Service (also FedRAMP High).',
        costImpact:'+$2-5M additional contract value if AI scope expands'},
      {id:'O-002',type:'OPPORTUNITY',title:'100% Small Business Team for Max SB Score',category:'Capture',prob:5,impact:3,score:15,owner:'Mary Womack',status:'ACTIVE',trend:'STABLE',dateId:'2026-01-05',
        mitigation:'All 4 team members are small businesses (SDVOSB + SDB + HUBZone + WOSB). Exceeds all SB goals.',
        trigger:'Evaluators typically give max points for exceeding SB goals',
        contingency:'Maintain current team composition. No large business additions needed.',
        costImpact:'+3-5 eval points in SB category'},
    ];

    const typeColor={RISK:'#f59e0b',ISSUE:'#ef4444',OPPORTUNITY:'#00ff88'};
    const typeIcon={RISK:'‚ö†Ô∏è',ISSUE:'üî¥',OPPORTUNITY:'üü¢'};
    const statColor={MITIGATED:'#00ff88',WATCH:'#f59e0b',OPEN:'#ef4444',ACTIVE:'#00E5FA',CLOSED:'#94a3b8'};
    const trendIcon={IMPROVING:'üìà',STABLE:'‚û°Ô∏è',WORSENING:'üìâ'};
    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const HeatCell=({p,i,items})=>{
      const s=p*i;
      const count=items.filter(it=>it.prob===p&&it.impact===i).length;
      const bg=s>=15?'rgba(239,68,68,0.25)':s>=10?'rgba(245,158,11,0.2)':s>=5?'rgba(0,229,250,0.1)':'rgba(255,255,255,0.02)';
      return(
        <td style={{width:'48px',height:'40px',textAlign:'center',border:'1px solid rgba(0,229,250,0.06)',background:bg,position:'relative'}}>
          {count>0&&<div style={{fontSize:'12px',fontWeight:800,color:s>=15?'#ef4444':s>=10?'#f59e0b':'#00E5FA'}}>{count}</div>}
          <div style={{fontSize:'8px',color:'#3e4f63'}}>{s}</div>
        </td>
      );
    };

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[tab,setTab]=useState('log');
      const[typeFilter,setTypeFilter]=useState('All');
      const[expanded,setExpanded]=useState(null);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('opportunities').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const filtered=useMemo(()=>{
        let f=DEMO_ITEMS;
        if(typeFilter!=='All')f=f.filter(i=>i.type===typeFilter);
        return f.sort((a,b)=>b.score-a.score);
      },[typeFilter]);

      const risks=DEMO_ITEMS.filter(i=>i.type==='RISK');
      const issues=DEMO_ITEMS.filter(i=>i.type==='ISSUE');
      const opps=DEMO_ITEMS.filter(i=>i.type==='OPPORTUNITY');
      const avgRiskScore=(risks.reduce((s,r)=>s+r.score,0)/risks.length).toFixed(1);

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>RISK MANAGEMENT</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Risk Register</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Risks ‚Ä¢ Issues ‚Ä¢ Opportunities ‚Ä¢ P√óI matrix ‚Ä¢ Mitigation plans</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Risks',value:risks.length,color:'#f59e0b'},
              {label:'Issues',value:issues.length,color:'#ef4444'},
              {label:'Opportunities',value:opps.length,color:'#00ff88'},
              {label:'Avg Risk Score',value:avgRiskScore,color:avgRiskScore>=12?'#ef4444':'#f59e0b'},
              {label:'Open Issues',value:issues.filter(i=>i.status==='OPEN').length,color:'#ef4444'},
              {label:'Watch Items',value:DEMO_ITEMS.filter(i=>i.status==='WATCH').length,color:'#f59e0b'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'120px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          <div style={{display:'flex',gap:'4px',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'log',l:'Risk Log'},{k:'matrix',l:'Heat Map'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{display:'flex',gap:'3px',marginLeft:'12px'}}>
              {['All','RISK','ISSUE','OPPORTUNITY'].map(t=>(
                <button key={t} onClick={()=>setTypeFilter(t)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',background:typeFilter===t?`${typeColor[t]||'rgba(0,229,250,0.15)'}20`:'transparent',color:typeFilter===t?(typeColor[t]||'#00E5FA'):'#5a7a9a'}}>{t==='All'?'All':t.charAt(0)+t.slice(1).toLowerCase()+'s'}</button>
              ))}
            </div>
          </div>

          {tab==='log'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'6px'}}>
              {filtered.map(item=>(
                <div key={item.id} style={{background:'rgba(10,22,40,0.5)',border:`1px solid ${typeColor[item.type]}15`,borderRadius:'10px',overflow:'hidden'}}>
                  <div onClick={()=>setExpanded(expanded===item.id?null:item.id)} style={{padding:'12px 16px',cursor:'pointer',display:'flex',gap:'12px',alignItems:'center'}}>
                    <div style={{width:'40px',height:'40px',borderRadius:'8px',background:item.score>=15?'rgba(239,68,68,0.12)':item.score>=10?'rgba(245,158,11,0.12)':'rgba(0,255,136,0.08)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:'14px',fontWeight:800,color:item.score>=15?'#ef4444':item.score>=10?'#f59e0b':'#00ff88',flexShrink:0}}>{item.score}</div>
                    <div style={{flex:1}}>
                      <div style={{display:'flex',alignItems:'center',gap:'6px',marginBottom:'3px'}}>
                        <span style={{fontSize:'10px'}}>{typeIcon[item.type]}</span>
                        <span style={{fontFamily:'monospace',fontSize:'10px',fontWeight:700,color:typeColor[item.type]}}>{item.id}</span>
                        <span style={{fontSize:'13px',fontWeight:600,color:'white'}}>{item.title}</span>
                      </div>
                      <div style={{display:'flex',gap:'8px',fontSize:'10px',color:'#5a7a9a',flexWrap:'wrap'}}>
                        <span>P:{item.prob} √ó I:{item.impact}</span>
                        <span style={{padding:'0 5px',borderRadius:'3px',background:'rgba(0,229,250,0.06)',color:'#67e8f9'}}>{item.category}</span>
                        <span>Owner: {item.owner}</span>
                        <span>{trendIcon[item.trend]} {item.trend}</span>
                      </div>
                    </div>
                    <span style={{fontSize:'10px',fontWeight:700,padding:'2px 8px',borderRadius:'4px',background:`${statColor[item.status]}12`,color:statColor[item.status]}}>{item.status}</span>
                    <span style={{color:'#5a7a9a',fontSize:'16px',transform:expanded===item.id?'rotate(180deg)':'rotate(0)',transition:'transform 0.2s'}}>‚ñæ</span>
                  </div>
                  {expanded===item.id&&(
                    <div style={{padding:'0 16px 14px 68px',borderTop:'1px solid rgba(0,229,250,0.06)'}}>
                      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'12px',padding:'10px 0'}}>
                        <div><div style={{fontSize:'9px',fontWeight:700,color:'#00E5FA',marginBottom:'4px'}}>MITIGATION / STRATEGY</div><div style={{fontSize:'11px',color:'#94a3b8',lineHeight:'1.5'}}>{item.mitigation}</div></div>
                        <div><div style={{fontSize:'9px',fontWeight:700,color:'#f59e0b',marginBottom:'4px'}}>TRIGGER</div><div style={{fontSize:'11px',color:'#fbbf24',lineHeight:'1.5'}}>{item.trigger}</div></div>
                      </div>
                      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'12px'}}>
                        <div><div style={{fontSize:'9px',fontWeight:700,color:'#ef4444',marginBottom:'4px'}}>CONTINGENCY</div><div style={{fontSize:'11px',color:'#fca5a5',lineHeight:'1.5'}}>{item.contingency}</div></div>
                        <div><div style={{fontSize:'9px',fontWeight:700,color:'#a78bfa',marginBottom:'4px'}}>COST IMPACT</div><div style={{fontSize:'11px',color:'#c4b5fd',lineHeight:'1.5'}}>{item.costImpact}</div></div>
                      </div>
                      <div style={{marginTop:'6px',fontSize:'10px',color:'#3e4f63'}}>Identified: {item.dateId}</div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {tab==='matrix'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'20px',display:'flex',justifyContent:'center'}}>
              <div>
                <div style={{fontSize:'12px',fontWeight:700,color:'white',marginBottom:'12px',textAlign:'center'}}>Probability √ó Impact Heat Map (Risks Only)</div>
                <table style={{borderCollapse:'collapse'}}>
                  <thead><tr>
                    <th style={{width:'80px',padding:'6px',fontSize:'9px',color:'#5a7a9a'}}></th>
                    {[1,2,3,4,5].map(i=><th key={i} style={{width:'48px',textAlign:'center',padding:'6px',fontSize:'9px',color:'#5a7a9a'}}>I={i}</th>)}
                  </tr></thead>
                  <tbody>
                    {[5,4,3,2,1].map(p=>(
                      <tr key={p}>
                        <td style={{padding:'6px 8px',fontSize:'9px',color:'#5a7a9a',textAlign:'right'}}>P={p}</td>
                        {[1,2,3,4,5].map(i=><HeatCell key={i} p={p} i={i} items={risks}/>)}
                      </tr>
                    ))}
                  </tbody>
                </table>
                <div style={{display:'flex',gap:'12px',marginTop:'12px',justifyContent:'center',fontSize:'10px'}}>
                  <span style={{display:'flex',alignItems:'center',gap:'4px'}}><div style={{width:'12px',height:'12px',borderRadius:'2px',background:'rgba(239,68,68,0.25)'}}/>High (15-25)</span>
                  <span style={{display:'flex',alignItems:'center',gap:'4px'}}><div style={{width:'12px',height:'12px',borderRadius:'2px',background:'rgba(245,158,11,0.2)'}}/>Medium (10-14)</span>
                  <span style={{display:'flex',alignItems:'center',gap:'4px'}}><div style={{width:'12px',height:'12px',borderRadius:'2px',background:'rgba(0,229,250,0.1)'}}/>Low (5-9)</span>
                </div>
              </div>
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>‚ö†Ô∏è AI GENERATED ‚Äî REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 ‚Äî Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
