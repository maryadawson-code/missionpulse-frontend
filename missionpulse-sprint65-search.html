<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MissionPulse | Search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-cyan-dark': '#00B8C8',
                        'mp-slate': '#0A1628',
                        'mp-card': '#111827',
                        'mp-border': '#1E3A5F'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glow-cyan { box-shadow: 0 0 20px rgba(0, 229, 250, 0.15); }
        .search-highlight { background: rgba(0, 229, 250, 0.2); padding: 0 2px; border-radius: 2px; }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy text-white min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Search data
        const SEARCH_DATA = {
            opportunities: [
                { id: 1, type: 'opportunity', title: 'VA EHR Modernization', value: '$245M', pwin: 78, status: 'Active', agency: 'VA', dueDate: 'Feb 5, 2025' },
                { id: 2, type: 'opportunity', title: 'DHA Telehealth Platform', value: '$180M', pwin: 72, status: 'Active', agency: 'DHA', dueDate: 'Feb 1, 2025' },
                { id: 3, type: 'opportunity', title: 'CMS Data Analytics', value: '$156M', pwin: 65, status: 'Active', agency: 'CMS', dueDate: 'Feb 12, 2025' },
                { id: 4, type: 'opportunity', title: 'IHS Cloud Migration', value: '$134M', pwin: 58, status: 'Active', agency: 'IHS', dueDate: 'Feb 18, 2025' },
                { id: 5, type: 'opportunity', title: 'DoD Health Records Integration', value: '$132M', pwin: 45, status: 'Pursuit', agency: 'DoD', dueDate: 'Mar 1, 2025' },
            ],
            documents: [
                { id: 101, type: 'document', title: 'VA EHR Technical Volume Draft', format: 'DOCX', modified: '2 hours ago', author: 'Sarah Chen' },
                { id: 102, type: 'document', title: 'DHA Telehealth Pricing BOE', format: 'XLSX', modified: '4 hours ago', author: 'Daniel Torres' },
                { id: 103, type: 'document', title: 'CMS Past Performance Matrix', format: 'PDF', modified: 'Yesterday', author: 'Mary Womack' },
                { id: 104, type: 'document', title: 'IHS Migration Architecture Diagram', format: 'PNG', modified: '2 days ago', author: 'Mike Johnson' },
                { id: 105, type: 'document', title: 'FAR 52.219-14 Compliance Checklist', format: 'PDF', modified: '3 days ago', author: 'Sarah Chen' },
            ],
            team: [
                { id: 201, type: 'team', name: 'Mary Womack', role: 'CEO', email: 'mary@missionmeetstech.com', status: 'online' },
                { id: 202, type: 'team', name: 'Daniel Torres', role: 'Capture Manager', email: 'daniel@missionmeetstech.com', status: 'online' },
                { id: 203, type: 'team', name: 'Sarah Chen', role: 'Contracts Lead', email: 'sarah@missionmeetstech.com', status: 'away' },
                { id: 204, type: 'team', name: 'Mike Johnson', role: 'Technical Writer', email: 'mike@missionmeetstech.com', status: 'offline' },
            ],
            modules: [
                { id: 301, type: 'module', name: 'War Room', icon: 'üéØ', href: 'missionpulse-sprint61-warroom.html', desc: 'Real-time proposal command center' },
                { id: 302, type: 'module', name: 'RFP Shredder', icon: 'üìÑ', href: 'index__13_.html', desc: 'AI-powered requirement extraction' },
                { id: 303, type: 'module', name: 'Black Hat Analysis', icon: 'üé©', href: 'missionpulse-m7-blackhat-enhanced.html', desc: 'Competitor intelligence' },
                { id: 304, type: 'module', name: 'Pricing Studio', icon: 'üí∞', href: 'missionpulse-m8-pricing.html', desc: 'BOE and rate calculations' },
                { id: 305, type: 'module', name: 'Iron Dome', icon: 'üõ°Ô∏è', href: 'missionpulse-m6-iron-dome.html', desc: 'Compliance risk detection' },
                { id: 306, type: 'module', name: 'Agent Hub', icon: 'ü§ñ', href: 'missionpulse-sprint55-agenthub.html', desc: '8 AI agents unified interface' },
            ],
            actions: [
                { id: 401, type: 'action', title: 'Review Pricing BOE', opportunity: 'VA EHR Modernization', priority: 'high' },
                { id: 402, type: 'action', title: 'Approve Tech Approach', opportunity: 'CMS Data Analytics', priority: 'medium' },
                { id: 403, type: 'action', title: 'Sign Teaming Agreement', opportunity: 'DHA Telehealth', priority: 'high' },
            ]
        };

        const RECENT_SEARCHES = [
            'VA EHR compliance',
            'pricing BOE template',
            'FAR 52.219',
            'telehealth requirements',
            'Daniel Torres'
        ];

        const FILTERS = [
            { id: 'all', label: 'All', icon: 'üîç' },
            { id: 'opportunities', label: 'Opportunities', icon: 'üìã' },
            { id: 'documents', label: 'Documents', icon: 'üìÑ' },
            { id: 'team', label: 'Team', icon: 'üë•' },
            { id: 'modules', label: 'Modules', icon: 'üì¶' },
            { id: 'actions', label: 'Actions', icon: '‚ö°' }
        ];

        // Components
        const SearchBar = ({ query, setQuery, onSearch, inputRef }) => (
            <div className="relative">
                <div className="absolute inset-y-0 left-4 flex items-center pointer-events-none">
                    <span className="text-gray-400 text-xl">üîç</span>
                </div>
                <input
                    ref={inputRef}
                    type="text"
                    value={query}
                    onChange={(e) => setQuery(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && onSearch()}
                    placeholder="Search opportunities, documents, team members, modules..."
                    className="w-full bg-mp-card border border-mp-border rounded-xl pl-14 pr-20 py-4 text-lg text-white placeholder-gray-500 focus:outline-none focus:border-mp-cyan focus:ring-1 focus:ring-mp-cyan"
                    autoFocus
                />
                <div className="absolute inset-y-0 right-4 flex items-center gap-2">
                    {query && (
                        <button 
                            onClick={() => setQuery('')}
                            className="text-gray-400 hover:text-white"
                        >
                            ‚úï
                        </button>
                    )}
                    <kbd className="hidden sm:inline-block px-2 py-1 text-xs text-gray-400 bg-mp-slate rounded">‚åòK</kbd>
                </div>
            </div>
        );

        const FilterTabs = ({ activeFilter, setActiveFilter, counts }) => (
            <div className="flex items-center gap-2 overflow-x-auto py-2">
                {FILTERS.map(filter => (
                    <button
                        key={filter.id}
                        onClick={() => setActiveFilter(filter.id)}
                        className={`flex items-center gap-2 px-4 py-2 rounded-lg text-sm whitespace-nowrap transition-colors ${
                            activeFilter === filter.id
                                ? 'bg-mp-cyan text-mp-navy font-medium'
                                : 'bg-mp-slate text-gray-400 hover:text-white'
                        }`}
                    >
                        <span>{filter.icon}</span>
                        {filter.label}
                        {counts[filter.id] > 0 && (
                            <span className={`text-xs px-1.5 rounded-full ${
                                activeFilter === filter.id
                                    ? 'bg-mp-navy/30 text-mp-navy'
                                    : 'bg-mp-border text-gray-400'
                            }`}>
                                {counts[filter.id]}
                            </span>
                        )}
                    </button>
                ))}
            </div>
        );

        const highlightMatch = (text, query) => {
            if (!query) return text;
            const regex = new RegExp(`(${query})`, 'gi');
            const parts = text.split(regex);
            return parts.map((part, i) => 
                regex.test(part) ? <span key={i} className="search-highlight text-mp-cyan">{part}</span> : part
            );
        };

        const OpportunityResult = ({ item, query }) => (
            <a href="missionpulse-sprint61-warroom.html" className="block bg-mp-card border border-mp-border rounded-xl p-4 hover:border-mp-cyan/50 transition-colors">
                <div className="flex items-start justify-between">
                    <div className="flex items-start gap-3">
                        <span className="text-2xl">üìã</span>
                        <div>
                            <p className="text-sm font-medium text-white">{highlightMatch(item.title, query)}</p>
                            <p className="text-xs text-gray-400 mt-1">{item.agency} ‚Ä¢ {item.value} ‚Ä¢ Due {item.dueDate}</p>
                        </div>
                    </div>
                    <div className="flex items-center gap-2">
                        <span className={`text-xs px-2 py-1 rounded-full ${
                            item.pwin >= 70 ? 'bg-green-500/20 text-green-400' :
                            item.pwin >= 50 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-red-500/20 text-red-400'
                        }`}>
                            {item.pwin}% pWin
                        </span>
                        <span className="text-xs bg-mp-slate text-gray-400 px-2 py-1 rounded-full">{item.status}</span>
                    </div>
                </div>
            </a>
        );

        const DocumentResult = ({ item, query }) => {
            const formatIcons = { DOCX: 'üìù', XLSX: 'üìä', PDF: 'üìï', PNG: 'üñºÔ∏è' };
            return (
                <div className="bg-mp-card border border-mp-border rounded-xl p-4 hover:border-mp-cyan/50 transition-colors cursor-pointer">
                    <div className="flex items-start gap-3">
                        <span className="text-2xl">{formatIcons[item.format] || 'üìÑ'}</span>
                        <div className="flex-1">
                            <p className="text-sm font-medium text-white">{highlightMatch(item.title, query)}</p>
                            <p className="text-xs text-gray-400 mt-1">{item.format} ‚Ä¢ Modified {item.modified} ‚Ä¢ by {item.author}</p>
                        </div>
                        <button className="text-xs text-mp-cyan hover:text-white">Open ‚Üí</button>
                    </div>
                </div>
            );
        };

        const TeamResult = ({ item, query }) => {
            const statusColors = { online: 'bg-green-400', away: 'bg-yellow-400', offline: 'bg-gray-400' };
            return (
                <div className="bg-mp-card border border-mp-border rounded-xl p-4 hover:border-mp-cyan/50 transition-colors cursor-pointer">
                    <div className="flex items-center gap-3">
                        <div className="relative">
                            <div className="w-10 h-10 rounded-full bg-mp-cyan/20 flex items-center justify-center text-sm font-medium text-mp-cyan">
                                {item.name.split(' ').map(n => n[0]).join('')}
                            </div>
                            <span className={`absolute bottom-0 right-0 w-3 h-3 ${statusColors[item.status]} rounded-full border-2 border-mp-card`}></span>
                        </div>
                        <div className="flex-1">
                            <p className="text-sm font-medium text-white">{highlightMatch(item.name, query)}</p>
                            <p className="text-xs text-gray-400">{item.role} ‚Ä¢ {item.email}</p>
                        </div>
                        <button className="text-xs bg-mp-slate hover:bg-mp-cyan/20 text-mp-cyan px-3 py-1 rounded-lg transition-colors">
                            Message
                        </button>
                    </div>
                </div>
            );
        };

        const ModuleResult = ({ item, query }) => (
            <a href={item.href} className="block bg-mp-card border border-mp-border rounded-xl p-4 hover:border-mp-cyan/50 transition-colors">
                <div className="flex items-center gap-3">
                    <span className="text-2xl">{item.icon}</span>
                    <div className="flex-1">
                        <p className="text-sm font-medium text-white">{highlightMatch(item.name, query)}</p>
                        <p className="text-xs text-gray-400">{item.desc}</p>
                    </div>
                    <span className="text-xs text-mp-cyan">Open ‚Üí</span>
                </div>
            </a>
        );

        const ActionResult = ({ item, query }) => {
            const priorityColors = { high: 'border-orange-500 bg-orange-500/10', medium: 'border-yellow-500 bg-yellow-500/10' };
            return (
                <div className={`border-l-2 ${priorityColors[item.priority]} bg-mp-card rounded-r-xl p-4 hover:bg-mp-slate transition-colors cursor-pointer`}>
                    <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                            <span className="text-xl">‚ö°</span>
                            <div>
                                <p className="text-sm font-medium text-white">{highlightMatch(item.title, query)}</p>
                                <p className="text-xs text-gray-400">{item.opportunity}</p>
                            </div>
                        </div>
                        <button className="text-xs bg-mp-cyan text-mp-navy px-3 py-1 rounded-lg font-medium">
                            Take Action
                        </button>
                    </div>
                </div>
            );
        };

        const RecentSearches = ({ searches, onSelect }) => (
            <div className="bg-mp-card border border-mp-border rounded-xl p-6">
                <h3 className="text-sm font-medium text-white mb-4 flex items-center gap-2">
                    <span>üïê</span> Recent Searches
                </h3>
                <div className="flex flex-wrap gap-2">
                    {searches.map((search, idx) => (
                        <button
                            key={idx}
                            onClick={() => onSelect(search)}
                            className="text-sm bg-mp-slate text-gray-400 hover:text-white px-3 py-1.5 rounded-lg transition-colors"
                        >
                            {search}
                        </button>
                    ))}
                </div>
            </div>
        );

        const QuickActions = () => (
            <div className="bg-mp-card border border-mp-border rounded-xl p-6">
                <h3 className="text-sm font-medium text-white mb-4 flex items-center gap-2">
                    <span>‚ö°</span> Quick Actions
                </h3>
                <div className="grid grid-cols-2 gap-2">
                    <a href="missionpulse-sprint61-warroom.html" className="flex items-center gap-2 p-3 bg-mp-slate rounded-lg hover:bg-mp-cyan/20 transition-colors">
                        <span>üéØ</span>
                        <span className="text-sm text-gray-300">Open War Room</span>
                    </a>
                    <a href="missionpulse-sprint55-agenthub.html" className="flex items-center gap-2 p-3 bg-mp-slate rounded-lg hover:bg-mp-cyan/20 transition-colors">
                        <span>ü§ñ</span>
                        <span className="text-sm text-gray-300">Ask AI Agent</span>
                    </a>
                    <a href="missionpulse-sprint63-notifications.html" className="flex items-center gap-2 p-3 bg-mp-slate rounded-lg hover:bg-mp-cyan/20 transition-colors">
                        <span>üîî</span>
                        <span className="text-sm text-gray-300">View Notifications</span>
                    </a>
                    <a href="missionpulse-sprint64-settings.html" className="flex items-center gap-2 p-3 bg-mp-slate rounded-lg hover:bg-mp-cyan/20 transition-colors">
                        <span>‚öôÔ∏è</span>
                        <span className="text-sm text-gray-300">Settings</span>
                    </a>
                </div>
            </div>
        );

        // Main App
        const App = () => {
            const [query, setQuery] = useState('');
            const [activeFilter, setActiveFilter] = useState('all');
            const [results, setResults] = useState(null);
            const inputRef = useRef(null);

            // Search logic
            useEffect(() => {
                if (!query.trim()) {
                    setResults(null);
                    return;
                }

                const q = query.toLowerCase();
                const filtered = {
                    opportunities: SEARCH_DATA.opportunities.filter(o => 
                        o.title.toLowerCase().includes(q) || o.agency.toLowerCase().includes(q)
                    ),
                    documents: SEARCH_DATA.documents.filter(d => 
                        d.title.toLowerCase().includes(q) || d.author.toLowerCase().includes(q)
                    ),
                    team: SEARCH_DATA.team.filter(t => 
                        t.name.toLowerCase().includes(q) || t.role.toLowerCase().includes(q) || t.email.toLowerCase().includes(q)
                    ),
                    modules: SEARCH_DATA.modules.filter(m => 
                        m.name.toLowerCase().includes(q) || m.desc.toLowerCase().includes(q)
                    ),
                    actions: SEARCH_DATA.actions.filter(a => 
                        a.title.toLowerCase().includes(q) || a.opportunity.toLowerCase().includes(q)
                    )
                };
                setResults(filtered);
            }, [query]);

            // Keyboard shortcut
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        inputRef.current?.focus();
                    }
                    if (e.key === 'Escape') {
                        setQuery('');
                        inputRef.current?.blur();
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            const counts = results ? {
                all: Object.values(results).flat().length,
                opportunities: results.opportunities.length,
                documents: results.documents.length,
                team: results.team.length,
                modules: results.modules.length,
                actions: results.actions.length
            } : { all: 0, opportunities: 0, documents: 0, team: 0, modules: 0, actions: 0 };

            const getFilteredResults = () => {
                if (!results) return [];
                if (activeFilter === 'all') {
                    return [
                        ...results.opportunities.map(r => ({ ...r, _type: 'opportunity' })),
                        ...results.documents.map(r => ({ ...r, _type: 'document' })),
                        ...results.team.map(r => ({ ...r, _type: 'team' })),
                        ...results.modules.map(r => ({ ...r, _type: 'module' })),
                        ...results.actions.map(r => ({ ...r, _type: 'action' }))
                    ];
                }
                return results[activeFilter]?.map(r => ({ ...r, _type: activeFilter.slice(0, -1) })) || [];
            };

            const renderResult = (item) => {
                const type = item._type || item.type;
                switch (type) {
                    case 'opportunity': return <OpportunityResult key={item.id} item={item} query={query} />;
                    case 'document': return <DocumentResult key={item.id} item={item} query={query} />;
                    case 'team': return <TeamResult key={item.id} item={item} query={query} />;
                    case 'module': return <ModuleResult key={item.id} item={item} query={query} />;
                    case 'action': return <ActionResult key={item.id} item={item} query={query} />;
                    default: return null;
                }
            };

            return (
                <div className="min-h-screen bg-mp-navy">
                    <header className="bg-mp-slate border-b border-mp-border px-6 py-4">
                        <div className="max-w-4xl mx-auto flex items-center justify-between">
                            <a href="missionpulse-sprint62-dashboard.html" className="text-gray-400 hover:text-white transition-colors">
                                ‚Üê Back to Dashboard
                            </a>
                            <h1 className="text-xl font-bold text-white">üîç Global Search</h1>
                            <div className="w-32"></div>
                        </div>
                    </header>

                    <main className="max-w-4xl mx-auto px-6 py-8">
                        <SearchBar 
                            query={query} 
                            setQuery={setQuery} 
                            onSearch={() => {}} 
                            inputRef={inputRef}
                        />

                        {results && (
                            <div className="mt-4">
                                <FilterTabs 
                                    activeFilter={activeFilter} 
                                    setActiveFilter={setActiveFilter}
                                    counts={counts}
                                />
                            </div>
                        )}

                        {results ? (
                            <div className="mt-6 space-y-3">
                                {counts.all > 0 ? (
                                    <>
                                        <p className="text-sm text-gray-400">{counts.all} results for "{query}"</p>
                                        {getFilteredResults().map(renderResult)}
                                    </>
                                ) : (
                                    <div className="text-center py-12">
                                        <p className="text-4xl mb-2">üîç</p>
                                        <p className="text-gray-400">No results found for "{query}"</p>
                                        <p className="text-sm text-gray-500 mt-2">Try different keywords or check your spelling</p>
                                    </div>
                                )}
                            </div>
                        ) : (
                            <div className="mt-8 grid grid-cols-1 md:grid-cols-2 gap-6">
                                <RecentSearches searches={RECENT_SEARCHES} onSelect={setQuery} />
                                <QuickActions />
                            </div>
                        )}
                    </main>

                    <footer className="border-t border-mp-border py-4 mt-8">
                        <div className="max-w-4xl mx-auto px-6 flex items-center justify-between text-xs text-gray-500">
                            <p>Press <kbd className="px-1.5 py-0.5 bg-mp-slate rounded">‚åòK</kbd> to search anywhere</p>
                            <p>MissionPulse v12 ‚Ä¢ Sprint 65</p>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
