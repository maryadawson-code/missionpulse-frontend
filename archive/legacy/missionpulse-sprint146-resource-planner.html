<!DOCTYPE html>
<!--
FILE: missionpulse-sprint146-resource-planner.html
MODULE: Resource Planner
SPRINT: 146
ROLE: CEO | COO | PM | CAP | DEL
SECURITY: Standard (No CUI)
CMMC: Level 2 Compliant
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resource Planner | MissionPulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-slate': '#0A1628',
                        'mp-gray': '#1E293B',
                        'mp-success': '#10B981',
                        'mp-warning': '#F59E0B',
                        'mp-danger': '#EF4444'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .scrollbar-thin::-webkit-scrollbar { width: 6px; height: 6px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: #0A1628; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #00E5FA; border-radius: 3px; }
        .drag-over { border: 2px dashed #00E5FA !important; background: rgba(0, 229, 250, 0.1) !important; }
        .dragging { opacity: 0.5; }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy text-white min-h-screen">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // Demo Data - Federal Health IT Proposals
        const DEMO_PROPOSALS = [
            { id: 'P001', name: 'DHA MHS GENESIS Phase 4', agency: 'DHA', value: '$45M', deadline: '2025-03-15', priority: 'high', status: 'active' },
            { id: 'P002', name: 'VA EHR Modernization Support', agency: 'VA', value: '$28M', deadline: '2025-04-01', priority: 'high', status: 'active' },
            { id: 'P003', name: 'CMS HCQIS Data Analytics', agency: 'CMS', value: '$15M', deadline: '2025-03-28', priority: 'medium', status: 'active' },
            { id: 'P004', name: 'IHS Telehealth Expansion', agency: 'IHS', value: '$12M', deadline: '2025-05-10', priority: 'medium', status: 'pipeline' },
            { id: 'P005', name: 'NIH STRIDES Cloud Migration', agency: 'NIH', value: '$22M', deadline: '2025-04-20', priority: 'low', status: 'pipeline' }
        ];

        const DEMO_STAFF = [
            { id: 'S001', name: 'Dr. Sarah Chen', role: 'Solution Architect', skills: ['Cloud', 'FHIR', 'Security'], utilization: 85, maxHours: 40, color: '#00E5FA' },
            { id: 'S002', name: 'Marcus Williams', role: 'Proposal Manager', skills: ['Shipley', 'IDIQ', 'GovCon'], utilization: 92, maxHours: 40, color: '#10B981' },
            { id: 'S003', name: 'Jennifer Park', role: 'Technical Writer', skills: ['508', 'RFP Analysis', 'Graphics'], utilization: 78, maxHours: 40, color: '#F59E0B' },
            { id: 'S004', name: 'David Kumar', role: 'Pricing Analyst', skills: ['BOE', 'Cost Volume', 'Excel'], utilization: 65, maxHours: 40, color: '#8B5CF6' },
            { id: 'S005', name: 'Lisa Thompson', role: 'Contracts Specialist', skills: ['FAR', 'DFARS', 'T&Cs'], utilization: 70, maxHours: 32, color: '#EC4899' },
            { id: 'S006', name: 'Robert Jackson', role: 'Subject Matter Expert', skills: ['MHS', 'Clinical', 'EHR'], utilization: 55, maxHours: 40, color: '#14B8A6' },
            { id: 'S007', name: 'Amanda Foster', role: 'Capture Manager', skills: ['BD', 'Teaming', 'Orals'], utilization: 88, maxHours: 40, color: '#F97316' },
            { id: 'S008', name: 'James Mitchell', role: 'Security Engineer', skills: ['CMMC', 'FedRAMP', 'RMF'], utilization: 72, maxHours: 40, color: '#6366F1' }
        ];

        const DEMO_ASSIGNMENTS = [
            { staffId: 'S001', proposalId: 'P001', hours: 20, role: 'Lead Architect' },
            { staffId: 'S001', proposalId: 'P002', hours: 15, role: 'Technical Reviewer' },
            { staffId: 'S002', proposalId: 'P001', hours: 30, role: 'Proposal Lead' },
            { staffId: 'S002', proposalId: 'P003', hours: 8, role: 'Volume Lead' },
            { staffId: 'S003', proposalId: 'P001', hours: 25, role: 'Writer Lead' },
            { staffId: 'S003', proposalId: 'P002', hours: 10, role: 'Writer Support' },
            { staffId: 'S004', proposalId: 'P001', hours: 15, role: 'Pricing Lead' },
            { staffId: 'S004', proposalId: 'P004', hours: 10, role: 'Cost Analyst' },
            { staffId: 'S005', proposalId: 'P001', hours: 12, role: 'Contracts Lead' },
            { staffId: 'S005', proposalId: 'P003', hours: 10, role: 'Compliance Check' },
            { staffId: 'S006', proposalId: 'P001', hours: 18, role: 'Clinical SME' },
            { staffId: 'S006', proposalId: 'P002', hours: 5, role: 'Advisor' },
            { staffId: 'S007', proposalId: 'P002', hours: 25, role: 'Capture Lead' },
            { staffId: 'S007', proposalId: 'P004', hours: 10, role: 'BD Support' },
            { staffId: 'S008', proposalId: 'P001', hours: 15, role: 'Security Lead' },
            { staffId: 'S008', proposalId: 'P003', hours: 12, role: 'Compliance SME' }
        ];

        // Utility Components
        const UtilizationBar = ({ percent, size = 'md' }) => {
            const getColor = () => {
                if (percent >= 90) return 'bg-mp-danger';
                if (percent >= 75) return 'bg-mp-warning';
                return 'bg-mp-success';
            };
            const heights = { sm: 'h-1.5', md: 'h-2', lg: 'h-3' };
            
            return (
                <div className={`w-full bg-mp-gray rounded-full ${heights[size]}`}>
                    <div 
                        className={`${heights[size]} rounded-full ${getColor()} transition-all duration-300`}
                        style={{ width: `${Math.min(percent, 100)}%` }}
                    />
                </div>
            );
        };

        const PriorityBadge = ({ priority }) => {
            const styles = {
                high: 'bg-red-500/20 text-red-400 border-red-500/30',
                medium: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
                low: 'bg-green-500/20 text-green-400 border-green-500/30'
            };
            return (
                <span className={`px-2 py-0.5 text-xs font-medium rounded border ${styles[priority]}`}>
                    {priority.toUpperCase()}
                </span>
            );
        };

        // Staff Card Component
        const StaffCard = ({ staff, assignments, proposals, onDragStart }) => {
            const staffAssignments = assignments.filter(a => a.staffId === staff.id);
            const totalHours = staffAssignments.reduce((sum, a) => sum + a.hours, 0);
            const utilization = Math.round((totalHours / staff.maxHours) * 100);

            return (
                <div 
                    className="bg-mp-slate border border-mp-gray rounded-lg p-4 hover:border-mp-cyan/50 transition-all cursor-grab"
                    draggable
                    onDragStart={(e) => onDragStart(e, staff)}
                >
                    <div className="flex items-start justify-between mb-3">
                        <div className="flex items-center gap-3">
                            <div 
                                className="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold"
                                style={{ backgroundColor: staff.color + '20', color: staff.color }}
                            >
                                {staff.name.split(' ').map(n => n[0]).join('')}
                            </div>
                            <div>
                                <h4 className="font-medium text-white">{staff.name}</h4>
                                <p className="text-xs text-gray-400">{staff.role}</p>
                            </div>
                        </div>
                        <div className="text-right">
                            <span className={`text-lg font-bold ${utilization >= 90 ? 'text-mp-danger' : utilization >= 75 ? 'text-mp-warning' : 'text-mp-success'}`}>
                                {utilization}%
                            </span>
                            <p className="text-xs text-gray-500">{totalHours}/{staff.maxHours}h</p>
                        </div>
                    </div>
                    
                    <UtilizationBar percent={utilization} />
                    
                    <div className="mt-3 flex flex-wrap gap-1">
                        {staff.skills.map(skill => (
                            <span key={skill} className="px-2 py-0.5 text-xs bg-mp-navy rounded text-gray-400">
                                {skill}
                            </span>
                        ))}
                    </div>
                    
                    {staffAssignments.length > 0 && (
                        <div className="mt-3 pt-3 border-t border-mp-gray">
                            <p className="text-xs text-gray-500 mb-2">Assigned to:</p>
                            <div className="space-y-1">
                                {staffAssignments.slice(0, 3).map(a => {
                                    const proposal = proposals.find(p => p.id === a.proposalId);
                                    return (
                                        <div key={a.proposalId} className="flex items-center justify-between text-xs">
                                            <span className="text-gray-300 truncate max-w-[120px]">{proposal?.name}</span>
                                            <span className="text-mp-cyan">{a.hours}h</span>
                                        </div>
                                    );
                                })}
                                {staffAssignments.length > 3 && (
                                    <p className="text-xs text-gray-500">+{staffAssignments.length - 3} more</p>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // Proposal Row Component
        const ProposalRow = ({ proposal, assignments, staff, onDrop, onRemoveAssignment }) => {
            const [isDragOver, setIsDragOver] = useState(false);
            const proposalAssignments = assignments.filter(a => a.proposalId === proposal.id);
            const totalHours = proposalAssignments.reduce((sum, a) => sum + a.hours, 0);

            const handleDragOver = (e) => {
                e.preventDefault();
                setIsDragOver(true);
            };

            const handleDragLeave = () => setIsDragOver(false);

            const handleDrop = (e) => {
                e.preventDefault();
                setIsDragOver(false);
                const staffData = JSON.parse(e.dataTransfer.getData('staff'));
                onDrop(staffData, proposal);
            };

            return (
                <div 
                    className={`bg-mp-slate border rounded-lg p-4 transition-all ${isDragOver ? 'drag-over border-mp-cyan' : 'border-mp-gray'}`}
                    onDragOver={handleDragOver}
                    onDragLeave={handleDragLeave}
                    onDrop={handleDrop}
                >
                    <div className="flex items-center justify-between mb-3">
                        <div className="flex items-center gap-4">
                            <div>
                                <div className="flex items-center gap-2">
                                    <h4 className="font-medium text-white">{proposal.name}</h4>
                                    <PriorityBadge priority={proposal.priority} />
                                </div>
                                <div className="flex items-center gap-3 mt-1 text-xs text-gray-400">
                                    <span>{proposal.agency}</span>
                                    <span>•</span>
                                    <span>{proposal.value}</span>
                                    <span>•</span>
                                    <span>Due: {new Date(proposal.deadline).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                        <div className="text-right">
                            <span className="text-lg font-bold text-mp-cyan">{totalHours}h</span>
                            <p className="text-xs text-gray-500">allocated</p>
                        </div>
                    </div>

                    <div className="flex flex-wrap gap-2">
                        {proposalAssignments.map(a => {
                            const member = staff.find(s => s.id === a.staffId);
                            return (
                                <div 
                                    key={a.staffId}
                                    className="flex items-center gap-2 bg-mp-navy rounded-full pl-1 pr-3 py-1 group"
                                >
                                    <div 
                                        className="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold"
                                        style={{ backgroundColor: member?.color + '20', color: member?.color }}
                                    >
                                        {member?.name.split(' ').map(n => n[0]).join('')}
                                    </div>
                                    <div className="text-xs">
                                        <span className="text-gray-300">{member?.name.split(' ')[0]}</span>
                                        <span className="text-mp-cyan ml-1">{a.hours}h</span>
                                    </div>
                                    <button 
                                        onClick={() => onRemoveAssignment(a.staffId, proposal.id)}
                                        className="opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 transition-all"
                                    >
                                        ×
                                    </button>
                                </div>
                            );
                        })}
                        {proposalAssignments.length === 0 && (
                            <p className="text-sm text-gray-500 italic">Drag staff here to assign</p>
                        )}
                    </div>
                </div>
            );
        };

        // Assignment Modal
        const AssignmentModal = ({ staff, proposal, onClose, onSave }) => {
            const [hours, setHours] = useState(10);
            const [role, setRole] = useState('');

            const roles = ['Proposal Lead', 'Volume Lead', 'Technical Writer', 'Pricing Lead', 'Contracts Lead', 
                          'Security Lead', 'SME Advisor', 'Reviewer', 'Capture Support', 'Graphics Lead'];

            return (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50">
                    <div className="bg-mp-slate border border-mp-gray rounded-xl p-6 w-full max-w-md">
                        <h3 className="text-lg font-semibold text-white mb-4">Assign Resource</h3>
                        
                        <div className="space-y-4">
                            <div className="bg-mp-navy rounded-lg p-3">
                                <p className="text-sm text-gray-400">Assigning</p>
                                <p className="text-white font-medium">{staff?.name}</p>
                                <p className="text-xs text-gray-500">{staff?.role}</p>
                            </div>

                            <div className="bg-mp-navy rounded-lg p-3">
                                <p className="text-sm text-gray-400">To Proposal</p>
                                <p className="text-white font-medium">{proposal?.name}</p>
                                <p className="text-xs text-gray-500">{proposal?.agency} • {proposal?.value}</p>
                            </div>

                            <div>
                                <label className="block text-sm text-gray-400 mb-2">Hours per Week</label>
                                <input 
                                    type="range" 
                                    min="1" 
                                    max={staff?.maxHours || 40}
                                    value={hours}
                                    onChange={(e) => setHours(parseInt(e.target.value))}
                                    className="w-full accent-mp-cyan"
                                />
                                <div className="flex justify-between text-sm mt-1">
                                    <span className="text-gray-500">1h</span>
                                    <span className="text-mp-cyan font-bold">{hours}h</span>
                                    <span className="text-gray-500">{staff?.maxHours}h</span>
                                </div>
                            </div>

                            <div>
                                <label className="block text-sm text-gray-400 mb-2">Assignment Role</label>
                                <select 
                                    value={role}
                                    onChange={(e) => setRole(e.target.value)}
                                    className="w-full bg-mp-navy border border-mp-gray rounded-lg px-3 py-2 text-white focus:border-mp-cyan outline-none"
                                >
                                    <option value="">Select role...</option>
                                    {roles.map(r => (
                                        <option key={r} value={r}>{r}</option>
                                    ))}
                                </select>
                            </div>
                        </div>

                        <div className="flex gap-3 mt-6">
                            <button 
                                onClick={onClose}
                                className="flex-1 px-4 py-2 bg-mp-gray text-gray-300 rounded-lg hover:bg-mp-gray/80 transition-colors"
                            >
                                Cancel
                            </button>
                            <button 
                                onClick={() => onSave({ staffId: staff.id, proposalId: proposal.id, hours, role })}
                                disabled={!role}
                                className="flex-1 px-4 py-2 bg-mp-cyan text-mp-navy font-semibold rounded-lg hover:bg-mp-cyan/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Assign
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Capacity Forecast Component
        const CapacityForecast = ({ staff, assignments }) => {
            const weeks = ['This Week', 'Week 2', 'Week 3', 'Week 4'];
            
            const calculateWeeklyCapacity = () => {
                const totalCapacity = staff.reduce((sum, s) => sum + s.maxHours, 0);
                const totalAssigned = assignments.reduce((sum, a) => sum + a.hours, 0);
                return weeks.map((_, i) => ({
                    capacity: totalCapacity,
                    assigned: totalAssigned * (1 - i * 0.05), // Simulated decline
                    available: totalCapacity - totalAssigned * (1 - i * 0.05)
                }));
            };

            const forecast = calculateWeeklyCapacity();

            return (
                <div className="bg-mp-slate border border-mp-gray rounded-lg p-4">
                    <h4 className="font-medium text-white mb-4">4-Week Capacity Forecast</h4>
                    <div className="grid grid-cols-4 gap-3">
                        {weeks.map((week, i) => (
                            <div key={week} className="text-center">
                                <p className="text-xs text-gray-400 mb-2">{week}</p>
                                <div className="bg-mp-navy rounded-lg p-3">
                                    <div className="text-lg font-bold text-mp-cyan">
                                        {Math.round(forecast[i].available)}h
                                    </div>
                                    <p className="text-xs text-gray-500">available</p>
                                    <div className="mt-2">
                                        <UtilizationBar 
                                            percent={(forecast[i].assigned / forecast[i].capacity) * 100} 
                                            size="sm" 
                                        />
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // Main App Component
        const ResourcePlanner = () => {
            const [staff] = useState(DEMO_STAFF);
            const [proposals] = useState(DEMO_PROPOSALS);
            const [assignments, setAssignments] = useState(DEMO_ASSIGNMENTS);
            const [view, setView] = useState('board'); // board | list | forecast
            const [showModal, setShowModal] = useState(false);
            const [pendingAssignment, setPendingAssignment] = useState({ staff: null, proposal: null });
            const [searchTerm, setSearchTerm] = useState('');
            const [filterPriority, setFilterPriority] = useState('all');

            const handleDragStart = (e, staffMember) => {
                e.dataTransfer.setData('staff', JSON.stringify(staffMember));
            };

            const handleDrop = (staffMember, proposal) => {
                // Check if already assigned
                const existing = assignments.find(a => a.staffId === staffMember.id && a.proposalId === proposal.id);
                if (existing) {
                    alert('This staff member is already assigned to this proposal.');
                    return;
                }
                setPendingAssignment({ staff: staffMember, proposal });
                setShowModal(true);
            };

            const handleSaveAssignment = (newAssignment) => {
                setAssignments([...assignments, newAssignment]);
                setShowModal(false);
                setPendingAssignment({ staff: null, proposal: null });
            };

            const handleRemoveAssignment = (staffId, proposalId) => {
                setAssignments(assignments.filter(a => !(a.staffId === staffId && a.proposalId === proposalId)));
            };

            // Calculate team stats
            const teamStats = {
                totalCapacity: staff.reduce((sum, s) => sum + s.maxHours, 0),
                totalAssigned: assignments.reduce((sum, a) => sum + a.hours, 0),
                avgUtilization: Math.round(staff.reduce((sum, s) => {
                    const hours = assignments.filter(a => a.staffId === s.id).reduce((h, a) => h + a.hours, 0);
                    return sum + (hours / s.maxHours) * 100;
                }, 0) / staff.length),
                overloaded: staff.filter(s => {
                    const hours = assignments.filter(a => a.staffId === s.id).reduce((h, a) => h + a.hours, 0);
                    return (hours / s.maxHours) >= 0.9;
                }).length
            };

            const filteredProposals = proposals.filter(p => {
                const matchesSearch = p.name.toLowerCase().includes(searchTerm.toLowerCase());
                const matchesPriority = filterPriority === 'all' || p.priority === filterPriority;
                return matchesSearch && matchesPriority;
            });

            return (
                <div className="min-h-screen bg-mp-navy">
                    {/* Header */}
                    <header className="bg-mp-slate border-b border-mp-gray px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <a href="index.html" className="text-mp-cyan hover:text-mp-cyan/80 transition-colors">
                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                                    </svg>
                                </a>
                                <div>
                                    <h1 className="text-xl font-bold text-white">Resource Planner</h1>
                                    <p className="text-sm text-gray-400">Staffing allocation across proposals</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-4">
                                <div className="flex bg-mp-navy rounded-lg p-1">
                                    {['board', 'list', 'forecast'].map(v => (
                                        <button
                                            key={v}
                                            onClick={() => setView(v)}
                                            className={`px-4 py-1.5 text-sm rounded-md transition-colors ${
                                                view === v ? 'bg-mp-cyan text-mp-navy font-medium' : 'text-gray-400 hover:text-white'
                                            }`}
                                        >
                                            {v.charAt(0).toUpperCase() + v.slice(1)}
                                        </button>
                                    ))}
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Stats Bar */}
                    <div className="bg-mp-slate/50 border-b border-mp-gray px-6 py-3">
                        <div className="flex items-center gap-8">
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400 text-sm">Team Capacity:</span>
                                <span className="text-white font-semibold">{teamStats.totalCapacity}h/week</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400 text-sm">Allocated:</span>
                                <span className="text-mp-cyan font-semibold">{teamStats.totalAssigned}h</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400 text-sm">Avg Utilization:</span>
                                <span className={`font-semibold ${teamStats.avgUtilization >= 85 ? 'text-mp-warning' : 'text-mp-success'}`}>
                                    {teamStats.avgUtilization}%
                                </span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="text-gray-400 text-sm">Overloaded:</span>
                                <span className={`font-semibold ${teamStats.overloaded > 0 ? 'text-mp-danger' : 'text-mp-success'}`}>
                                    {teamStats.overloaded} staff
                                </span>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="p-6">
                        {view === 'board' && (
                            <div className="grid grid-cols-12 gap-6">
                                {/* Staff Column */}
                                <div className="col-span-4">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="font-semibold text-white">Team Members ({staff.length})</h3>
                                    </div>
                                    <div className="space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto scrollbar-thin pr-2">
                                        {staff.map(s => (
                                            <StaffCard 
                                                key={s.id}
                                                staff={s}
                                                assignments={assignments}
                                                proposals={proposals}
                                                onDragStart={handleDragStart}
                                            />
                                        ))}
                                    </div>
                                </div>

                                {/* Proposals Column */}
                                <div className="col-span-8">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="font-semibold text-white">Active Proposals ({filteredProposals.length})</h3>
                                        <div className="flex items-center gap-3">
                                            <input 
                                                type="text"
                                                placeholder="Search proposals..."
                                                value={searchTerm}
                                                onChange={(e) => setSearchTerm(e.target.value)}
                                                className="bg-mp-navy border border-mp-gray rounded-lg px-3 py-1.5 text-sm text-white placeholder-gray-500 focus:border-mp-cyan outline-none w-48"
                                            />
                                            <select 
                                                value={filterPriority}
                                                onChange={(e) => setFilterPriority(e.target.value)}
                                                className="bg-mp-navy border border-mp-gray rounded-lg px-3 py-1.5 text-sm text-white focus:border-mp-cyan outline-none"
                                            >
                                                <option value="all">All Priorities</option>
                                                <option value="high">High</option>
                                                <option value="medium">Medium</option>
                                                <option value="low">Low</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="space-y-3 max-h-[calc(100vh-280px)] overflow-y-auto scrollbar-thin pr-2">
                                        {filteredProposals.map(p => (
                                            <ProposalRow 
                                                key={p.id}
                                                proposal={p}
                                                assignments={assignments}
                                                staff={staff}
                                                onDrop={handleDrop}
                                                onRemoveAssignment={handleRemoveAssignment}
                                            />
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'list' && (
                            <div className="bg-mp-slate border border-mp-gray rounded-lg overflow-hidden">
                                <table className="w-full">
                                    <thead className="bg-mp-navy">
                                        <tr>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Staff</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Role</th>
                                            <th className="px-4 py-3 text-left text-xs font-medium text-gray-400 uppercase">Proposals</th>
                                            <th className="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase">Hours</th>
                                            <th className="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase">Utilization</th>
                                            <th className="px-4 py-3 text-center text-xs font-medium text-gray-400 uppercase">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-mp-gray">
                                        {staff.map(s => {
                                            const staffAssignments = assignments.filter(a => a.staffId === s.id);
                                            const totalHours = staffAssignments.reduce((sum, a) => sum + a.hours, 0);
                                            const utilization = Math.round((totalHours / s.maxHours) * 100);
                                            
                                            return (
                                                <tr key={s.id} className="hover:bg-mp-navy/50 transition-colors">
                                                    <td className="px-4 py-3">
                                                        <div className="flex items-center gap-3">
                                                            <div 
                                                                className="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold"
                                                                style={{ backgroundColor: s.color + '20', color: s.color }}
                                                            >
                                                                {s.name.split(' ').map(n => n[0]).join('')}
                                                            </div>
                                                            <span className="text-white font-medium">{s.name}</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-3 text-gray-400 text-sm">{s.role}</td>
                                                    <td className="px-4 py-3">
                                                        <div className="flex flex-wrap gap-1">
                                                            {staffAssignments.map(a => {
                                                                const p = proposals.find(pr => pr.id === a.proposalId);
                                                                return (
                                                                    <span key={a.proposalId} className="px-2 py-0.5 bg-mp-navy rounded text-xs text-gray-300">
                                                                        {p?.agency}
                                                                    </span>
                                                                );
                                                            })}
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-3 text-center text-mp-cyan font-semibold">{totalHours}/{s.maxHours}</td>
                                                    <td className="px-4 py-3">
                                                        <div className="flex items-center justify-center gap-2">
                                                            <UtilizationBar percent={utilization} size="sm" />
                                                            <span className="text-xs text-gray-400 w-10">{utilization}%</span>
                                                        </div>
                                                    </td>
                                                    <td className="px-4 py-3 text-center">
                                                        <span className={`px-2 py-1 rounded text-xs font-medium ${
                                                            utilization >= 90 ? 'bg-red-500/20 text-red-400' :
                                                            utilization >= 75 ? 'bg-yellow-500/20 text-yellow-400' :
                                                            'bg-green-500/20 text-green-400'
                                                        }`}>
                                                            {utilization >= 90 ? 'Overloaded' : utilization >= 75 ? 'Busy' : 'Available'}
                                                        </span>
                                                    </td>
                                                </tr>
                                            );
                                        })}
                                    </tbody>
                                </table>
                            </div>
                        )}

                        {view === 'forecast' && (
                            <div className="space-y-6">
                                <CapacityForecast staff={staff} assignments={assignments} />
                                
                                <div className="grid grid-cols-2 gap-6">
                                    <div className="bg-mp-slate border border-mp-gray rounded-lg p-4">
                                        <h4 className="font-medium text-white mb-4">Utilization by Role</h4>
                                        <div className="space-y-3">
                                            {['Solution Architect', 'Proposal Manager', 'Technical Writer', 'Pricing Analyst', 'Contracts Specialist'].map(role => {
                                                const roleStaff = staff.filter(s => s.role === role);
                                                const roleHours = roleStaff.reduce((sum, s) => {
                                                    return sum + assignments.filter(a => a.staffId === s.id).reduce((h, a) => h + a.hours, 0);
                                                }, 0);
                                                const roleCapacity = roleStaff.reduce((sum, s) => sum + s.maxHours, 0);
                                                const util = roleCapacity > 0 ? Math.round((roleHours / roleCapacity) * 100) : 0;
                                                
                                                return (
                                                    <div key={role} className="flex items-center justify-between">
                                                        <span className="text-sm text-gray-400">{role}</span>
                                                        <div className="flex items-center gap-2 w-48">
                                                            <UtilizationBar percent={util} size="sm" />
                                                            <span className="text-xs text-gray-400 w-10">{util}%</span>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <div className="bg-mp-slate border border-mp-gray rounded-lg p-4">
                                        <h4 className="font-medium text-white mb-4">Upcoming Deadlines</h4>
                                        <div className="space-y-3">
                                            {proposals.sort((a, b) => new Date(a.deadline) - new Date(b.deadline)).map(p => {
                                                const daysLeft = Math.ceil((new Date(p.deadline) - new Date()) / (1000 * 60 * 60 * 24));
                                                const assignedHours = assignments.filter(a => a.proposalId === p.id).reduce((sum, a) => sum + a.hours, 0);
                                                
                                                return (
                                                    <div key={p.id} className="flex items-center justify-between bg-mp-navy rounded-lg p-3">
                                                        <div>
                                                            <p className="text-sm text-white font-medium">{p.name}</p>
                                                            <p className="text-xs text-gray-500">{p.agency} • {assignedHours}h allocated</p>
                                                        </div>
                                                        <div className={`text-sm font-semibold ${daysLeft <= 14 ? 'text-mp-danger' : daysLeft <= 30 ? 'text-mp-warning' : 'text-mp-success'}`}>
                                                            {daysLeft}d
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Modal */}
                    {showModal && (
                        <AssignmentModal 
                            staff={pendingAssignment.staff}
                            proposal={pendingAssignment.proposal}
                            onClose={() => {
                                setShowModal(false);
                                setPendingAssignment({ staff: null, proposal: null });
                            }}
                            onSave={handleSaveAssignment}
                        />
                    )}

                    {/* Footer */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-mp-slate border-t border-mp-gray px-6 py-2">
                        <div className="flex items-center justify-between text-xs text-gray-500">
                            <span>MissionPulse v12 • Resource Planner • Sprint 146</span>
                            <span>AI GENERATED - REQUIRES HUMAN REVIEW</span>
                        </div>
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<ResourcePlanner />);
    </script>
</body>
</html>
