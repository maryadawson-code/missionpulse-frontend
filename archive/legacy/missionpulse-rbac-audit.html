<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse â€” RBAC Enforcement Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Space Grotesk',sans-serif;background:#00050F;min-height:100vh}.font-mono{font-family:'JetBrains Mono',monospace}@keyframes slideIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}@keyframes barFill{from{width:0%}}.animate-slide-in{animation:slideIn .4s ease-out forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.animate-bar{animation:barFill .8s ease-out forwards}.glass-card{background:linear-gradient(135deg,rgba(15,23,42,.9) 0%,rgba(15,23,42,.7) 100%);backdrop-filter:blur(10px);border:1px solid rgba(0,229,250,.15)}.glass-card:hover{border-color:rgba(0,229,250,.3)}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#0a1628}::-webkit-scrollbar-thumb{background:rgba(0,229,250,.3);border-radius:3px}
  </style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const{useState,useEffect}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}

    const ROLES=['CEO','COO','CAP','PM','SA','FIN','CON','DEL','QA','Partner','Admin'];

    const MODULES=[
      {file:'missionpulse-m1-enhanced.html',name:'Dashboard',rbac:true,roles:['CEO','COO','CAP','PM','SA','FIN','CON','DEL','QA','Partner','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'index.html',name:'Pipeline',rbac:true,roles:['CEO','COO','CAP','PM','SA','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m2-warroom-enhanced.html',name:'War Room',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m3-swimlane-board.html',name:'Swimlane Board',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m5-contracts-enhanced.html',name:'RFP Shredder',rbac:true,roles:['CEO','COO','CAP','SA','CON','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'index__13_.html',name:'Contract Scanner',rbac:true,roles:['CEO','COO','CON','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m6-iron-dome.html',name:'Iron Dome',rbac:true,roles:['CEO','COO','CAP','SA','CON','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m7-blackhat-enhanced.html',name:'Black Hat',rbac:true,roles:['CEO','COO','CAP'],useEffect:true,invisibleRBAC:true,gaps:[],restricted:true},
      {file:'missionpulse-m8-pricing.html',name:'Pricing',rbac:true,roles:['CEO','COO','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[],cui:true},
      {file:'missionpulse-m9-hitl-enhanced.html',name:'HITL',rbac:true,roles:['CEO','COO','CAP','PM','SA','QA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'m10-orals-studio-enhanced.jsx',name:'Orals Studio',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m15-lessons-playbook.html',name:'Playbook Engine',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m11-frenemy-protocol.html',name:'Frenemy Protocol',rbac:true,roles:['CEO','COO','CAP','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m13-launch-roi.html',name:'Launch Readiness',rbac:true,roles:['CEO','COO','CAP','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-m14-post-award.html',name:'Post-Award',rbac:true,roles:['CEO','COO','PM','FIN','CON','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-task16-rbac.html',name:'Audit Log v1',rbac:true,roles:['CEO','COO','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-competitive-landscape.html',name:'Competitive Landscape',rbac:true,roles:['CEO','COO','CAP','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-task-orders.html',name:'Task Orders',rbac:true,roles:['CEO','COO','CAP','PM','FIN','CON','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-proposal-archive.html',name:'Proposal Archive',rbac:true,roles:['CEO','COO','CAP','PM','SA','QA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-reference-library.html',name:'Reference Library',rbac:true,roles:['CEO','COO','CAP','PM','SA','CON','QA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-clearance-tracker.html',name:'Clearance Tracker',rbac:true,roles:['CEO','COO','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-travel-mgr.html',name:'Travel Manager',rbac:true,roles:['CEO','COO','CAP','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-training-dash.html',name:'Training Dashboard',rbac:true,roles:['CEO','COO','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-budget-tracker.html',name:'Budget Tracker',rbac:true,roles:['CEO','COO','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-meeting-notes.html',name:'Meeting Notes',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-stakeholder-map.html',name:'Stakeholder Map',rbac:true,roles:['CEO','COO','CAP','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-pricing-library.html',name:'Pricing Library',rbac:true,roles:['CEO','COO','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[],cui:true},
      {file:'missionpulse-graphics-library.html',name:'Graphics Library',rbac:true,roles:['CEO','COO','CAP','PM','SA','QA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-compliance-checklist.html',name:'Compliance Checklist',rbac:true,roles:['CEO','COO','CAP','PM','QA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-sam-import.html',name:'SAM.gov Import',rbac:true,roles:['CEO','COO','CAP','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-demo-accounts.html',name:'Demo Accounts',rbac:false,roles:ROLES,useEffect:false,invisibleRBAC:false,gaps:['No useEffect RBAC check','Public access â€” intentional for demo']},
      {file:'missionpulse-debrief.html',name:'Debrief Center',rbac:true,roles:['CEO','COO','CAP','PM','SA','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-analytics-dash.html',name:'Analytics Dashboard',rbac:true,roles:['CEO','COO','CAP','FIN','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-health-score.html',name:'Health Score',rbac:true,roles:['CEO','COO','CAP','PM','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
      {file:'missionpulse-crm-integration.html',name:'CRM Integration',rbac:true,roles:['CEO','COO','Admin'],useEffect:true,invisibleRBAC:true,gaps:[]},
    ];

    const ConnectionIndicator=({connected})=>(
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{background:connected?'rgba(0,255,136,0.1)':'rgba(255,184,0,0.1)',border:`1px solid ${connected?'rgba(0,255,136,0.3)':'rgba(255,184,0,0.3)'}`}}>
        <div className={`w-2 h-2 rounded-full ${connected?'bg-green-400':'bg-amber-400 animate-pulse'}`}/>
        <span style={{color:connected?'#00ff88':'#ffb800'}}>{connected?'LIVE':'DEMO'}</span>
      </div>
    );

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[userRole]=useState('CEO');
      const[activeTab,setActiveTab]=useState('summary');
      const[filterStatus,setFilterStatus]=useState('all');
      const[scanRunning,setScanRunning]=useState(false);
      const[scanComplete,setScanComplete]=useState(true);
      const[lastScan]=useState('2026-02-18T14:32:00Z');

      useEffect(()=>{const a=['CEO','COO','Admin'];if(!a.includes(userRole))return},[userRole]);
      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data}=await sbClient.from('opportunities').select('id').limit(1);if(data)setConnected(true)}catch(e){}})()},[]);

      const total=MODULES.length;
      const enforced=MODULES.filter(m=>m.rbac&&m.useEffect&&m.invisibleRBAC).length;
      const gapped=MODULES.filter(m=>m.gaps.length>0).length;
      const cuiModules=MODULES.filter(m=>m.cui).length;
      const restricted=MODULES.filter(m=>m.restricted).length;
      const coverage=Math.round((enforced/total)*100);

      const runScan=()=>{setScanRunning(true);setTimeout(()=>{setScanRunning(false);setScanComplete(true)},2000)};

      const filtered=filterStatus==='all'?MODULES:filterStatus==='pass'?MODULES.filter(m=>m.gaps.length===0&&m.rbac):filterStatus==='gap'?MODULES.filter(m=>m.gaps.length>0):MODULES.filter(m=>m.cui||m.restricted);

      const CheckIcon=({ok})=>ok?<div className="w-5 h-5 rounded-full bg-green-500/20 border border-green-500/40 flex items-center justify-center"><svg className="w-3 h-3 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M5 13l4 4L19 7"/></svg></div>:<div className="w-5 h-5 rounded-full bg-red-500/20 border border-red-500/40 flex items-center justify-center"><svg className="w-3 h-3 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={3} d="M6 18L18 6M6 6l12 12"/></svg></div>;

    const tabs=[{key:'summary',label:'Summary'},{key:'matrix',label:'Role Ã— Module Matrix'},{key:'modules',label:`Module List (${total})`}];

      return(
        <div className="min-h-screen" style={{background:'#00050F'}}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div><div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">RBAC Enforcement Dashboard</h1><ConnectionIndicator connected={connected}/></div>
              <p className="text-sm text-slate-400">Module role-check verification, coverage matrix & gap analysis</p></div>
              <button onClick={runScan} disabled={scanRunning} className="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-mono font-bold bg-cyan-500/20 text-cyan-400 border border-cyan-500/30 hover:bg-cyan-500/30 transition disabled:opacity-50">
                {scanRunning?<><span className="w-4 h-4 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin inline-block"/>Scanning...</>:'âŸ³ Re-Scan All Modules'}
              </button>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
              {[{l:'Modules Scanned',v:total,c:'#00E5FA'},{l:'RBAC Enforced',v:enforced,c:'#00ff88'},{l:'Coverage',v:`${coverage}%`,c:coverage>=95?'#00ff88':'#ffb800'},{l:'Gaps Found',v:gapped,c:gapped>0?'#ff4444':'#00ff88'},{l:'CUI / Restricted',v:`${cuiModules} / ${restricted}`,c:'#ffb800'}].map((k,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.l}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{color:k.c}}>{k.v}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-1 bg-slate-800/30 rounded-lg p-1 mb-6">
              {tabs.map(t=><button key={t.key} onClick={()=>setActiveTab(t.key)} className={`px-4 py-2 rounded-md text-sm font-mono font-bold transition flex-1 ${activeTab===t.key?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300'}`}>{t.label}</button>)}
            </div>

            {activeTab==='summary'&&(
              <div className="space-y-4 animate-slide-in">
                {/* Coverage bar */}
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">RBAC COVERAGE</h3>
                  <div className="h-5 rounded-full bg-slate-700/30 overflow-hidden flex mb-2">
                    <div className="h-full bg-green-500/50 animate-bar" style={{width:`${(enforced/total)*100}%`}}/>
                    <div className="h-full bg-red-500/40" style={{width:`${(gapped/total)*100}%`}}/>
                  </div>
                  <div className="flex items-center gap-4">
                    <span className="flex items-center gap-1.5 text-xs font-mono"><div className="w-3 h-3 rounded bg-green-500/50"/>Enforced ({enforced})</span>
                    <span className="flex items-center gap-1.5 text-xs font-mono"><div className="w-3 h-3 rounded bg-red-500/40"/>Gaps ({gapped})</span>
                  </div>
                </div>
                {/* Enforcement checks */}
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-4">ENFORCEMENT CHECKS</h3>
                  <div className="space-y-3">
                    {[
                      {check:'useEffect RBAC hook present',pass:enforced,total,desc:'Modules with role verification in useEffect'},
                      {check:'Invisible RBAC pattern',pass:MODULES.filter(m=>m.invisibleRBAC).length,total,desc:'Restricted features hidden (not "Access Denied")'},
                      {check:'Black Hat restricted to CEO/COO/CAP',pass:1,total:1,desc:'Competitive intelligence locked to capture leadership'},
                      {check:'CUI modules have amber shield',pass:cuiModules,total:cuiModules,desc:'Pricing data marked with CUI indicators'},
                      {check:'Partner Wall isolation',pass:1,total:1,desc:'External partners scoped to assigned opportunities only'},
                    ].map((c,i)=>(
                      <div key={i} className="flex items-center gap-4 p-3 rounded-lg bg-slate-800/20">
                        <CheckIcon ok={c.pass===c.total}/>
                        <div className="flex-1"><div className="text-sm text-white">{c.check}</div><div className="text-xs text-slate-500">{c.desc}</div></div>
                        <span className={`text-sm font-mono font-bold ${c.pass===c.total?'text-green-400':'text-red-400'}`}>{c.pass}/{c.total}</span>
                      </div>
                    ))}
                  </div>
                </div>
                {gapped>0&&<div className="glass-card rounded-xl p-6 border-red-500/30">
                  <h3 className="text-sm font-mono font-bold text-red-400 mb-3">âš  GAPS DETECTED</h3>
                  {MODULES.filter(m=>m.gaps.length>0).map((m,i)=>(
                    <div key={i} className="p-3 rounded-lg bg-red-500/5 border border-red-500/15 mb-2 last:mb-0">
                      <div className="text-sm text-white font-medium">{m.name} <span className="text-xs text-slate-500">({m.file})</span></div>
                      {m.gaps.map((g,j)=><div key={j} className="text-xs text-red-400 mt-1">â€¢ {g}</div>)}
                    </div>
                  ))}
                </div>}
                <div className="text-xs text-slate-600 font-mono text-right">Last scan: {new Date(lastScan).toLocaleString()}</div>
              </div>
            )}

            {activeTab==='matrix'&&(
              <div className="glass-card rounded-xl overflow-x-auto animate-slide-in">
                <table className="w-full text-xs">
                  <thead><tr className="border-b border-slate-700/30">
                    <th className="text-left p-2.5 font-mono text-slate-500 sticky left-0 bg-slate-900/90 min-w-[180px]">Module</th>
                    {ROLES.map(r=><th key={r} className="p-2.5 text-center font-mono text-cyan-400 min-w-[48px]">{r}</th>)}
                  </tr></thead>
                  <tbody>
                    {MODULES.map((m,i)=>(
                      <tr key={i} className={`border-b border-slate-700/10 hover:bg-slate-800/10 ${m.cui?'bg-amber-500/3':''}`}>
                        <td className="p-2 sticky left-0 bg-slate-900/80">
                          <span className="text-slate-300">{m.name}</span>
                          {m.cui&&<span className="ml-1.5 text-amber-400">ðŸ›¡</span>}
                          {m.restricted&&<span className="ml-1 text-red-400">ðŸ”’</span>}
                          {m.gaps.length>0&&<span className="ml-1 text-red-400">âš </span>}
                        </td>
                        {ROLES.map(r=><td key={r} className="p-2 text-center">{m.roles.includes(r)?<span className="text-green-400">âœ“</span>:<span className="text-slate-700">Â·</span>}</td>)}
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            )}

            {activeTab==='modules'&&(
              <div>
                <div className="flex items-center gap-2 mb-4">
                  {[{k:'all',l:'All'},{k:'pass',l:'Pass'},{k:'gap',l:'Gaps'},{k:'special',l:'CUI/Restricted'}].map(f=>(
                    <button key={f.k} onClick={()=>setFilterStatus(f.k)} className={`px-3 py-1 rounded-md text-xs font-mono font-bold transition ${filterStatus===f.k?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300 bg-slate-800/30'}`}>{f.l}</button>
                  ))}
                </div>
                <div className="space-y-2">
                  {filtered.map((m,i)=>(
                    <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.03}s`}}>
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-3">
                          <CheckIcon ok={m.gaps.length===0&&m.rbac}/>
                          <div>
                            <div className="flex items-center gap-2"><span className="text-sm text-white font-medium">{m.name}</span>
                              {m.cui&&<span className="px-1.5 py-0.5 rounded text-xs font-mono font-bold bg-amber-500/10 text-amber-400">CUI</span>}
                              {m.restricted&&<span className="px-1.5 py-0.5 rounded text-xs font-mono font-bold bg-red-500/10 text-red-400">RESTRICTED</span>}
                            </div>
                            <span className="text-xs font-mono text-slate-500">{m.file}</span>
                          </div>
                        </div>
                        <div className="flex items-center gap-4">
                          <div className="flex items-center gap-1">
                            {m.useEffect?<span className="px-1.5 py-0.5 rounded text-xs font-mono bg-green-500/10 text-green-400">useEffect</span>:<span className="px-1.5 py-0.5 rounded text-xs font-mono bg-red-500/10 text-red-400">NO HOOK</span>}
                            {m.invisibleRBAC?<span className="px-1.5 py-0.5 rounded text-xs font-mono bg-green-500/10 text-green-400">Invisible</span>:<span className="px-1.5 py-0.5 rounded text-xs font-mono bg-amber-500/10 text-amber-400">Visible</span>}
                          </div>
                          <span className="text-xs font-mono text-slate-400">{m.roles.length} roles</span>
                        </div>
                      </div>
                      {m.gaps.length>0&&<div className="mt-2 ml-8">{m.gaps.map((g,j)=><span key={j} className="text-xs text-red-400">âš  {g}</span>)}</div>}
                    </div>
                  ))}
                </div>
              </div>
            )}

            <div className="mt-8 text-center"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20"><svg className="w-3.5 h-3.5 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg><span className="text-xs text-amber-500/80 font-mono">AI GENERATED â€” REQUIRES HUMAN REVIEW</span></div></div>
          </div>
        </div>
      );
    };
    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
