<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Training Dashboard</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; } .font-mono { font-family: 'JetBrains Mono', monospace; } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-up { animation: fadeInUp 0.5s ease-out forwards; } .glass-card { background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0, 229, 250, 0.2); }</style>
</head>
<body>
  <div id="root"></div>
  <script src="supabase-client.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const ROLES_ALLOWED = ['CEO','COO','CAP','PM','SA','FIN','CON','DEL','QA','Partner','Admin'];

    const DEMO_TRAINING = [
      { id: 'TRN-001', name: 'CMMC Level 2 Awareness', category: 'Compliance', required: true, dueDate: '2025-03-31', completions: [{ person: 'Mary Womack', date: '2025-01-15', score: 95 }, { person: 'Marcus Johnson', date: '2025-01-20', score: 92 }, { person: 'Sarah Chen', date: null, score: null }], totalRequired: 7 },
      { id: 'TRN-002', name: 'CUI Handling Procedures', category: 'Security', required: true, dueDate: '2025-02-28', completions: [{ person: 'Mary Womack', date: '2025-02-01', score: 100 }, { person: 'Marcus Johnson', date: '2025-02-05', score: 98 }, { person: 'Emily Rodriguez', date: '2025-02-03', score: 96 }], totalRequired: 7 },
      { id: 'TRN-003', name: 'Shipley Capture Management', category: 'Process', required: false, dueDate: '2025-04-30', completions: [{ person: 'Mary Womack', date: '2025-01-10', score: 88 }], totalRequired: 4 },
      { id: 'TRN-004', name: 'AI Ethics & Responsible Use', category: 'AI/ML', required: true, dueDate: '2025-03-15', completions: [], totalRequired: 7 },
      { id: 'TRN-005', name: 'Incident Response Procedures', category: 'Security', required: true, dueDate: '2025-03-31', completions: [{ person: 'Emily Rodriguez', date: '2025-02-10', score: 100 }, { person: 'David Park', date: '2025-02-12', score: 94 }], totalRequired: 3 },
      { id: 'TRN-006', name: 'Federal Proposal Writing', category: 'Process', required: false, dueDate: '2025-05-31', completions: [{ person: 'Sarah Chen', date: '2025-01-25', score: 85 }, { person: 'Jessica Williams', date: '2025-01-28', score: 82 }], totalRequired: 5 },
    ];

    const App = () => {
      const [training, setTraining] = useState(DEMO_TRAINING);
      const [filter, setFilter] = useState('all');
      const [expandedId, setExpandedId] = useState(null);
      const [connected, setConnected] = useState(false);

      useEffect(() => {
        const role = localStorage.getItem('missionpulse_role');
        if (role && !ROLES_ALLOWED.includes(role)) { window.location.href = 'index.html'; return; }
        const load = async () => { try { if (typeof sbClient !== 'undefined') { const { data } = await sbClient.from('training_courses').select('*'); if (data?.length) { setTraining(data); setConnected(true); } } } catch (e) {} };
        load();
      }, []);

      const filtered = training.filter(t => filter === 'all' || (filter === 'required' && t.required) || (filter === 'overdue' && new Date(t.dueDate) < new Date() && t.completions.length < t.totalRequired) || t.category.toLowerCase() === filter);
      const overallCompletion = Math.round(training.reduce((s, t) => s + (t.completions.length / t.totalRequired * 100), 0) / training.length);
      const overdueCount = training.filter(t => new Date(t.dueDate) < new Date() && t.completions.length < t.totalRequired).length;

      return React.createElement('div', { className: 'min-h-screen p-6', style: { background: '#00050F' } },
        React.createElement('div', { className: 'flex items-center justify-between mb-6' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'text-2xl font-bold text-white' }, 'üéì Training Dashboard'),
            React.createElement('p', { className: 'text-gray-400 text-sm mt-1' }, 'Compliance training ‚Ä¢ Certifications ‚Ä¢ Team readiness')
          ),
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement('div', { className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs', style: { background: connected ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)', color: connected ? '#10B981' : '#F59E0B', border: `1px solid ${connected ? 'rgba(16,185,129,0.3)' : 'rgba(245,158,11,0.3)'}` } },
              React.createElement('span', { className: `w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-yellow-500'}` }), connected ? 'Connected' : 'Demo Mode'
            ),
            React.createElement('a', { href: 'index.html', className: 'px-3 py-1.5 rounded-lg text-xs text-gray-400 hover:text-white', style: { border: '1px solid rgba(255,255,255,0.1)' } }, '‚Üê Dashboard')
          )
        ),

        React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-6' },
          [
            { label: 'Overall Completion', value: `${overallCompletion}%`, color: overallCompletion >= 80 ? '#10B981' : '#F59E0B' },
            { label: 'Active Courses', value: training.length, color: '#00E5FA' },
            { label: 'Required', value: training.filter(t => t.required).length, color: '#818CF8' },
            { label: 'Overdue', value: overdueCount, color: overdueCount > 0 ? '#EF4444' : '#10B981' }
          ].map((s, i) =>
            React.createElement('div', { key: i, className: 'glass-card rounded-lg p-4 text-center animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'font-mono text-2xl font-bold', style: { color: s.color } }, s.value),
              React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, s.label)
            )
          )
        ),

        React.createElement('div', { className: 'flex gap-2 mb-6 flex-wrap' },
          ['all', 'required', 'overdue', 'compliance', 'security', 'process', 'ai/ml'].map(f =>
            React.createElement('button', { key: f, className: `px-3 py-2 rounded-lg text-xs font-medium ${filter === f ? 'text-white' : 'text-gray-400'}`, style: { background: filter === f ? 'rgba(0,229,250,0.15)' : 'transparent', border: `1px solid ${filter === f ? 'rgba(0,229,250,0.4)' : 'rgba(255,255,255,0.1)'}` }, onClick: () => setFilter(f) },
              f === 'all' ? 'All' : f === 'ai/ml' ? 'AI/ML' : f.charAt(0).toUpperCase() + f.slice(1)
            )
          )
        ),

        React.createElement('div', { className: 'space-y-3 mb-8' },
          filtered.map((t, i) => {
            const pct = Math.round(t.completions.length / t.totalRequired * 100);
            const isOverdue = new Date(t.dueDate) < new Date() && pct < 100;
            return React.createElement('div', { key: t.id, className: 'glass-card rounded-lg overflow-hidden animate-fade-up', style: { animationDelay: `${i*0.05}s` } },
              React.createElement('div', { className: 'p-4 cursor-pointer hover:bg-white/5', onClick: () => setExpandedId(expandedId === t.id ? null : t.id) },
                React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('h3', { className: 'text-white font-semibold' }, t.name),
                    t.required && React.createElement('span', { className: 'px-1.5 py-0.5 rounded text-xs', style: { background: 'rgba(239,68,68,0.15)', color: '#EF4444' } }, 'REQUIRED'),
                    React.createElement('span', { className: 'px-1.5 py-0.5 rounded text-xs', style: { background: 'rgba(0,229,250,0.1)', color: '#00E5FA' } }, t.category),
                    isOverdue && React.createElement('span', { className: 'px-1.5 py-0.5 rounded text-xs', style: { background: 'rgba(239,68,68,0.15)', color: '#EF4444' } }, '‚ö† OVERDUE')
                  ),
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('span', { className: 'font-mono text-xs text-gray-400' }, `Due: ${t.dueDate}`),
                    React.createElement('span', { className: 'font-mono text-lg font-bold', style: { color: pct >= 100 ? '#10B981' : pct >= 50 ? '#F59E0B' : '#EF4444' } }, `${pct}%`),
                    React.createElement('span', { className: 'text-gray-500' }, expandedId === t.id ? '‚ñæ' : '‚ñ∏')
                  )
                ),
                React.createElement('div', { className: 'h-2 bg-gray-800 rounded-full overflow-hidden' },
                  React.createElement('div', { className: 'h-full rounded-full transition-all', style: { width: `${pct}%`, background: pct >= 100 ? '#10B981' : pct >= 50 ? '#F59E0B' : '#EF4444' } })
                ),
                React.createElement('div', { className: 'text-xs text-gray-500 mt-1' }, `${t.completions.length} of ${t.totalRequired} team members completed`)
              ),
              expandedId === t.id && React.createElement('div', { className: 'border-t border-gray-800 p-4' },
                React.createElement('div', { className: 'space-y-2' },
                  t.completions.map((c, ci) =>
                    React.createElement('div', { key: ci, className: 'flex items-center justify-between bg-gray-900/50 rounded-lg px-3 py-2' },
                      React.createElement('span', { className: 'text-white text-sm' }, c.person),
                      React.createElement('div', { className: 'flex items-center gap-3' },
                        c.score && React.createElement('span', { className: 'font-mono text-xs', style: { color: c.score >= 90 ? '#10B981' : '#F59E0B' } }, `Score: ${c.score}%`),
                        React.createElement('span', { className: 'text-xs text-gray-400' }, c.date || 'Not completed')
                      )
                    )
                  )
                ),
                React.createElement('div', { className: 'flex gap-2 mt-3' },
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(0,229,250,0.15)', color: '#00E5FA', border: '1px solid rgba(0,229,250,0.3)' } }, 'üìß Send Reminders'),
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(99,102,241,0.15)', color: '#818CF8', border: '1px solid rgba(99,102,241,0.3)' } }, 'üìä Export Report')
                )
              )
            );
          })
        ),

        React.createElement('div', { className: 'text-center py-4 border-t border-gray-800' },
          React.createElement('p', { className: 'text-xs text-gray-600' }, '‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW ‚Ä¢ MissionPulse by Mission Meets Tech ‚Ä¢ NIST 800-171 Compliant')
        )
      );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
