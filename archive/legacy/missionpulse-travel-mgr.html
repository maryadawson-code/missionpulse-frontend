<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S135 - Travel Manager</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Space Grotesk',sans-serif;background:#00050F;min-height:100vh}.font-mono{font-family:'JetBrains Mono',monospace}@keyframes slideIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}.animate-slide-in{animation:slideIn .4s ease-out forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.glass-card{background:linear-gradient(135deg,rgba(15,23,42,.9) 0%,rgba(15,23,42,.7) 100%);backdrop-filter:blur(10px);border:1px solid rgba(0,229,250,.15)}.glass-card:hover{border-color:rgba(0,229,250,.3)}
  </style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const{useState,useEffect}=React;
    const SUPABASE_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;try{sbClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY)}catch(e){sbClient=null}

    const Icons={
      plane:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>,
      map:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"/></svg>,
      dollar:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
      calendar:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>,
      users:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/></svg>,
      document:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>,
      shield:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
    };
    const Icon=({name,className="w-4 h-4"})=>{const C=Icons[name];return C?<span className={`inline-block ${className}`}><C/></span>:null};

    const TRIPS=[
      {id:1,title:'DHA Program Review',type:'Customer Meeting',location:'Falls Church, VA',agency:'DHA',dates:'2026-02-24 to 2026-02-25',travelers:['Sarah Chen','James Rivera'],opportunity:'DHA EHR Modernization',status:'upcoming',expenses:{airfare:850,hotel:420,meals:180,transport:95,total:1545},report:null},
      {id:2,title:'VA Stakeholder Workshop',type:'Site Visit',location:'Washington, DC',agency:'VA',dates:'2026-03-10 to 2026-03-12',travelers:['Diana Kim','Marcus Johnson','Emily Zhao'],opportunity:'VA Claims Processing AI',status:'planned',expenses:{airfare:1200,hotel:840,meals:360,transport:150,total:2550},report:null},
      {id:3,title:'CMS Technical Review',type:'Customer Meeting',location:'Baltimore, MD',agency:'CMS',dates:'2026-01-28 to 2026-01-29',travelers:['Sarah Chen','David Torres'],opportunity:'CMS Data Analytics Platform',status:'complete',expenses:{airfare:680,hotel:350,meals:140,transport:65,total:1235},report:{summary:'Successful review. CMS stakeholders approved Phase 2 data migration approach. Action items: provide updated SLA benchmarks by 2/15, schedule follow-up demo for analytics dashboard.',outcomes:['Phase 2 approach approved','SLA benchmarks due 2/15','Follow-up demo scheduled 3/5']}},
      {id:4,title:'DoD Advana Customer Discovery',type:'Site Visit',location:'Pentagon, Arlington, VA',agency:'DoD',dates:'2026-01-15 to 2026-01-16',travelers:['Diana Kim','Robert Kim'],opportunity:'DoD Advana Expansion',status:'complete',expenses:{airfare:0,hotel:280,meals:120,transport:45,total:445},report:{summary:'Met with Advana PMO. Strong interest in AI analytics expansion. Competition includes Deloitte and Booz Allen. Key differentiator: our FedRAMP Moderate architecture. Need to address TS/SCI staffing gap.',outcomes:['PMO supportive of expansion','Deloitte & BAH confirmed competitors','TS/SCI staffing gap flagged','Follow-up brief requested for March']}},
      {id:5,title:'Shipley Conference',type:'Conference',location:'Orlando, FL',agency:'N/A',dates:'2026-04-07 to 2026-04-09',travelers:['Mary Womack','Diana Kim'],opportunity:'N/A',status:'planned',expenses:{airfare:520,hotel:680,meals:300,transport:120,total:1620},report:null},
    ];

    const ConnectionIndicator=({connected})=>(
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{background:connected?'rgba(0,255,136,0.1)':'rgba(255,184,0,0.1)',border:`1px solid ${connected?'rgba(0,255,136,0.3)':'rgba(255,184,0,0.3)'}`}}>
        <div className={`w-2 h-2 rounded-full ${connected?'bg-green-400':'bg-amber-400 animate-pulse'}`}/>
        <span style={{color:connected?'#00ff88':'#ffb800'}}>{connected?'LIVE':'DEMO'}</span>
      </div>
    );

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[userRole]=useState('CEO');
      const[selectedTrip,setSelectedTrip]=useState(null);
      const[filter,setFilter]=useState('all');

      useEffect(()=>{const allowed=['CEO','COO','CAP','PM','Admin'];if(!allowed.includes(userRole))return},[userRole]);
      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data}=await sbClient.from('opportunities').select('id').limit(1);if(data)setConnected(true)}catch(e){}})()},[]);

      const filtered=TRIPS.filter(t=>filter==='all'||t.status===filter);
      const totalSpend=TRIPS.reduce((s,t)=>s+t.expenses.total,0);
      const upcoming=TRIPS.filter(t=>t.status==='upcoming'||t.status==='planned').length;

      const StatusBadge=({status})=>{
        const m={upcoming:{c:'#00E5FA',l:'UPCOMING'},planned:{c:'#a78bfa',l:'PLANNED'},complete:{c:'#00ff88',l:'COMPLETE'},cancelled:{c:'#ff4444',l:'CANCELLED'}};
        const s=m[status]||m.planned;
        return <span className="px-2 py-0.5 rounded text-xs font-mono font-bold" style={{background:`${s.c}15`,color:s.c,border:`1px solid ${s.c}30`}}>{s.l}</span>;
      };

      if(selectedTrip){
        const t=selectedTrip;
        return(
          <div className="min-h-screen" style={{background:'#00050F'}}>
            <div className="max-w-5xl mx-auto p-6">
              <button onClick={()=>setSelectedTrip(null)} className="text-sm text-slate-400 hover:text-cyan-400 transition mb-6">← Back to Travel Manager</button>
              <div className="glass-card rounded-xl p-6 mb-6">
                <div className="flex items-center justify-between">
                  <div><div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">{t.title}</h1><StatusBadge status={t.status}/></div>
                  <p className="text-sm text-slate-400">{t.type} · {t.location} · {t.agency} · {t.dates}</p></div>
                </div>
              </div>
              <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">TRAVELERS</h3>
                  <div className="space-y-2">{t.travelers.map((tr,i)=><div key={i} className="flex items-center gap-2 p-2 rounded-lg bg-slate-800/20"><Icon name="users" className="w-4 h-4 text-cyan-400"/><span className="text-sm text-white">{tr}</span></div>)}</div>
                  {t.opportunity!=='N/A'&&<div className="mt-4 pt-3 border-t border-slate-700/30"><span className="text-xs text-slate-500">Linked Opportunity: </span><span className="text-sm text-cyan-400">{t.opportunity}</span></div>}
                </div>
                <div className="glass-card rounded-xl p-6">
                  <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">EXPENSES</h3>
                  {Object.entries(t.expenses).filter(([k])=>k!=='total').map(([k,v],i)=>(
                    <div key={i} className="flex justify-between py-1.5 border-b border-slate-700/10 last:border-0">
                      <span className="text-sm text-slate-400 capitalize">{k}</span>
                      <span className="text-sm font-mono text-slate-300">${v.toLocaleString()}</span>
                    </div>
                  ))}
                  <div className="flex justify-between pt-3 mt-2 border-t border-slate-700/30">
                    <span className="text-sm font-bold text-white">Total</span>
                    <span className="text-sm font-mono font-bold text-cyan-400">${t.expenses.total.toLocaleString()}</span>
                  </div>
                </div>
                {t.report&&(
                  <div className="glass-card rounded-xl p-6 lg:col-span-2">
                    <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3"><span className="flex items-center gap-2"><Icon name="document" className="w-4 h-4"/> TRIP REPORT</span></h3>
                    <p className="text-sm text-slate-300 leading-relaxed mb-4">{t.report.summary}</p>
                    <h4 className="text-xs font-mono text-slate-500 mb-2">KEY OUTCOMES</h4>
                    <div className="space-y-1.5">{t.report.outcomes.map((o,i)=><div key={i} className="flex items-start gap-2 text-sm text-slate-300"><span className="text-green-400 mt-0.5">✦</span>{o}</div>)}</div>
                  </div>
                )}
              </div>
            </div>
          </div>
        );
      }

      return(
        <div className="min-h-screen" style={{background:'#00050F'}}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div><div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Travel Manager</h1><ConnectionIndicator connected={connected}/></div>
              <p className="text-sm text-slate-400">Site visits, customer meetings, trip reports & expense tracking</p></div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              {[{label:'Total Trips',value:TRIPS.length,color:'#00E5FA'},{label:'Upcoming',value:upcoming,color:'#a78bfa'},{label:'Total Spend',value:`$${(totalSpend/1000).toFixed(1)}K`,color:'#ffb800'},{label:'Trip Reports',value:TRIPS.filter(t=>t.report).length,color:'#00ff88'}].map((k,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{color:k.color}}>{k.value}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-2 mb-4">
              {['all','upcoming','planned','complete'].map(f=>(
                <button key={f} onClick={()=>setFilter(f)} className={`px-3 py-1 rounded-md text-xs font-mono font-bold transition ${filter===f?'bg-cyan-500/20 text-cyan-400':'text-slate-500 hover:text-slate-300 bg-slate-800/30'}`}>{f==='all'?'All':f.charAt(0).toUpperCase()+f.slice(1)}</button>
              ))}
            </div>

            <div className="space-y-3">
              {filtered.map((t,i)=>(
                <div key={t.id} onClick={()=>setSelectedTrip(t)} className="glass-card rounded-xl p-5 cursor-pointer hover:border-cyan-500/40 transition-all animate-slide-in" style={{animationDelay:`${i*.06}s`}}>
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className="w-11 h-11 rounded-xl bg-cyan-500/10 flex items-center justify-center"><Icon name={t.type==='Conference'?'users':'plane'} className="w-5 h-5 text-cyan-400"/></div>
                      <div>
                        <div className="flex items-center gap-2"><h3 className="text-white font-semibold">{t.title}</h3><StatusBadge status={t.status}/></div>
                        <p className="text-xs text-slate-500 mt-0.5">{t.type} · {t.location} · {t.dates}</p>
                      </div>
                    </div>
                    <div className="flex items-center gap-6">
                      <div className="text-right"><span className="text-sm font-mono text-slate-300">{t.travelers.length}</span><div className="text-xs text-slate-500">travelers</div></div>
                      <div className="text-right"><span className="text-sm font-mono text-amber-400">${t.expenses.total.toLocaleString()}</span><div className="text-xs text-slate-500">cost</div></div>
                      {t.report&&<Icon name="document" className="w-4 h-4 text-green-400"/>}
                      <span className="text-slate-600 text-lg">→</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>

            <div className="mt-8 text-center"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20"><Icon name="shield" className="w-3.5 h-3.5 text-amber-500"/><span className="text-xs text-amber-500/80 font-mono">AI GENERATED — REQUIRES HUMAN REVIEW</span></div></div>
          </div>
        </div>
      );
    };
    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
