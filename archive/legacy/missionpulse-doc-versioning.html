<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse ‚Äî Document Versioning</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const DEMO_DOCS=[
      {id:1,name:'Vol II ‚Äî Technical Approach',file:'DHA_EHR_Vol_II_Tech.docx',opp:'DHA EHR Modernization',volume:'Technical',currentVersion:'3.4',status:'In Review',branch:'main',locked:false,lockHolder:null,pageCount:42,wordCount:18200,
        versions:[
          {ver:'3.4',date:'2026-02-17',author:'Sarah K.',changes:'Rewrote ¬ß2.1 discriminators per Pink Team feedback. Added AI-first architecture diagram.',linesAdded:340,linesRemoved:180,reviewStatus:'PENDING',branch:'main'},
          {ver:'3.3',date:'2026-02-10',author:'James R.',changes:'Updated ¬ß2.5 AI/ML section with MLOps pipeline and bias testing protocol.',linesAdded:220,linesRemoved:85,reviewStatus:'APPROVED',branch:'main'},
          {ver:'3.2',date:'2026-02-03',author:'Lisa W.',changes:'Redesigned DevSecOps diagram (¬ß2.2). Added STIG/SCAP annotation layer.',linesAdded:95,linesRemoved:60,reviewStatus:'APPROVED',branch:'main'},
          {ver:'3.1',date:'2026-01-25',author:'Angela F.',changes:'Complete rewrite of ¬ß2.3 ATO section. FedRAMP inheritance narrative.',linesAdded:480,linesRemoved:320,reviewStatus:'APPROVED',branch:'main'},
          {ver:'3.0',date:'2026-01-15',author:'Sarah K.',changes:'Post-Pink Team major revision. Restructured all sections per reviewer comments.',linesAdded:1200,linesRemoved:900,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.0',date:'2025-12-10',author:'Sarah K.',changes:'Post-Blue Team revision. Compliance gaps addressed.',linesAdded:600,linesRemoved:200,reviewStatus:'APPROVED',branch:'main'},
          {ver:'1.0',date:'2025-11-20',author:'Sarah K.',changes:'Initial draft for Blue Team review.',linesAdded:8400,linesRemoved:0,reviewStatus:'APPROVED',branch:'main'},
        ],
        comments:[
          {id:1,ver:'3.4',author:'Mary W.',date:'2026-02-17',section:'¬ß2.1',text:'Discriminators are stronger now but need a clearer "so what" statement for the evaluator. Add benefit quantification.',status:'OPEN',priority:'HIGH'},
          {id:2,ver:'3.4',author:'Tom P.',date:'2026-02-17',section:'¬ß2.1',text:'Transition timeline reference in paragraph 3 conflicts with Vol III ¬ß3.4. Reconcile dates.',status:'OPEN',priority:'MEDIUM'},
          {id:3,ver:'3.3',author:'Angela F.',date:'2026-02-11',section:'¬ß2.5',text:'AI governance framework looks solid. Add reference to NIST AI 600-1.',status:'RESOLVED',priority:'LOW'},
        ]},
      {id:2,name:'Vol III ‚Äî Management Approach',file:'DHA_EHR_Vol_III_Mgmt.docx',opp:'DHA EHR Modernization',volume:'Management',currentVersion:'2.3',status:'Approved',branch:'main',locked:false,lockHolder:null,pageCount:28,wordCount:12400,
        versions:[
          {ver:'2.3',date:'2026-02-12',author:'Mary W.',changes:'Added DHA-specific IPT structure and PFM reporting cadence.',linesAdded:180,linesRemoved:60,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.2',date:'2026-01-28',author:'Tom P.',changes:'Expanded risk register to 10 items with quantified impacts.',linesAdded:320,linesRemoved:140,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.1',date:'2026-01-19',author:'Mary W.',changes:'Pink Team feedback incorporated. Governance section strengthened.',linesAdded:240,linesRemoved:180,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.0',date:'2026-01-10',author:'Tom P.',changes:'Post-Blue Team revision.',linesAdded:400,linesRemoved:150,reviewStatus:'APPROVED',branch:'main'},
          {ver:'1.0',date:'2025-12-01',author:'Tom P.',changes:'Initial draft.',linesAdded:6200,linesRemoved:0,reviewStatus:'APPROVED',branch:'main'},
        ],
        comments:[]},
      {id:3,name:'Vol II ‚Äî Technical Approach',file:'VA_Claims_Vol_II.docx',opp:'VA Claims Processing AI',volume:'Technical',currentVersion:'1.2',status:'Draft',branch:'main',locked:true,lockHolder:'James R.',pageCount:30,wordCount:13100,
        versions:[
          {ver:'1.2',date:'2026-02-14',author:'James R.',changes:'Added AskSage integration architecture and FedRAMP High positioning.',linesAdded:280,linesRemoved:40,reviewStatus:'PENDING',branch:'main'},
          {ver:'1.1',date:'2026-02-05',author:'James R.',changes:'Responsible AI framework + bias testing section.',linesAdded:350,linesRemoved:20,reviewStatus:'APPROVED',branch:'main'},
          {ver:'1.0',date:'2026-01-20',author:'James R.',changes:'Initial draft for Blue Team.',linesAdded:6800,linesRemoved:0,reviewStatus:'APPROVED',branch:'main'},
        ],
        comments:[
          {id:4,ver:'1.2',author:'Sarah K.',date:'2026-02-15',section:'¬ß2.1',text:'Architecture diagram needs Azure Gov IL5 boundary clearly marked.',status:'OPEN',priority:'MEDIUM'},
        ]},
      {id:4,name:'Vol V ‚Äî Pricing / BOE',file:'DHA_EHR_Vol_V_Pricing.docx',opp:'DHA EHR Modernization',volume:'Pricing',currentVersion:'2.4',status:'Approved',branch:'main',locked:false,lockHolder:null,pageCount:15,wordCount:5600,
        versions:[
          {ver:'2.4',date:'2026-02-11',author:'Finance',changes:'Added value engineering section with 3-year TCO savings model.',linesAdded:160,linesRemoved:20,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.3',date:'2026-01-30',author:'Finance',changes:'Rate card updated to GSA MAS refresh.',linesAdded:80,linesRemoved:75,reviewStatus:'APPROVED',branch:'main'},
          {ver:'2.0',date:'2026-01-15',author:'Finance',changes:'Complete BOE with historical actuals.',linesAdded:2800,linesRemoved:1200,reviewStatus:'APPROVED',branch:'main'},
          {ver:'1.0',date:'2025-12-15',author:'Finance',changes:'Initial estimate.',linesAdded:2400,linesRemoved:0,reviewStatus:'APPROVED',branch:'main'},
        ],
        comments:[]},
    ];

    const DEMO_BRANCHES=[
      {name:'main',docs:4,status:'ACTIVE',description:'Production proposal content'},
      {name:'red-team-edits',docs:2,status:'MERGED',description:'Red Team response branch ‚Äî merged Feb 15',mergedDate:'2026-02-15'},
      {name:'pricing-scenario-b',docs:1,status:'ACTIVE',description:'Alternative pricing with lower wrap rates for sensitivity analysis'},
    ];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[docs]=useState(DEMO_DOCS);
      const[tab,setTab]=useState('docs');
      const[selectedDoc,setSelectedDoc]=useState(null);
      const[diffView,setDiffView]=useState(null);
      const[oppFilter,setOppFilter]=useState('All');

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('proposal_sections').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const opps=[...new Set(docs.map(d=>d.opp))];
      const filtered=useMemo(()=>oppFilter==='All'?docs:docs.filter(d=>d.opp===oppFilter),[docs,oppFilter]);
      const totalVersions=docs.reduce((s,d)=>s+d.versions.length,0);
      const openComments=docs.reduce((s,d)=>s+d.comments.filter(c=>c.status==='OPEN').length,0);
      const statusColor={Draft:'#f59e0b','In Review':'#00E5FA',Approved:'#00ff88',Locked:'#ef4444'};
      const reviewColor={PENDING:'#f59e0b',APPROVED:'#00ff88',REJECTED:'#ef4444'};

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>CONTENT MANAGEMENT</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Document Versioning</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Version history ‚Ä¢ Diff tracking ‚Ä¢ Branch management ‚Ä¢ Comments</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Documents',value:docs.length,color:'#00E5FA'},
              {label:'Total Versions',value:totalVersions,color:'#a78bfa'},
              {label:'Open Comments',value:openComments,color:openComments>0?'#f59e0b':'#00ff88'},
              {label:'Branches',value:DEMO_BRANCHES.length,color:'#00E5FA'},
              {label:'Total Pages',value:docs.reduce((s,d)=>s+d.pageCount,0),color:'#94a3b8'},
              {label:'Total Words',value:`${(docs.reduce((s,d)=>s+d.wordCount,0)/1000).toFixed(1)}K`,color:'#a78bfa'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'120px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'docs',l:'Documents'},{k:'branches',l:'Branches'}].map(t=>(
              <button key={t.k} onClick={()=>{setTab(t.k);setSelectedDoc(null)}} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{marginLeft:'auto',display:'flex',gap:'3px'}}>
              {['All',...opps].map(o=>(
                <button key={o} onClick={()=>setOppFilter(o)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',whiteSpace:'nowrap',background:oppFilter===o?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:oppFilter===o?'#00E5FA':'#5a7a9a'}}>{o==='All'?'All':o.split(' ').slice(0,2).join(' ')}</button>
              ))}
            </div>
          </div>

          {tab==='docs'&&!selectedDoc&&(
            <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(340px,1fr))',gap:'10px'}}>
              {filtered.map(d=>(
                <div key={d.id} onClick={()=>setSelectedDoc(d.id)} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'16px',cursor:'pointer',transition:'all 0.15s'}} onMouseOver={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.25)'} onMouseOut={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'10px'}}>
                    <div>
                      <div style={{fontSize:'14px',fontWeight:700,color:'white'}}>{d.name}</div>
                      <div style={{fontSize:'11px',color:'#5a7a9a',marginTop:'2px'}}>{d.opp}</div>
                    </div>
                    <div style={{display:'flex',gap:'4px',flexDirection:'column',alignItems:'flex-end'}}>
                      <span style={{fontSize:'10px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${statusColor[d.status]}12`,color:statusColor[d.status]}}>{d.status}</span>
                      <span style={{fontSize:'10px',fontWeight:600,color:'#00E5FA'}}>v{d.currentVersion}</span>
                    </div>
                  </div>
                  <div style={{display:'flex',gap:'12px',fontSize:'10px',color:'#5a7a9a',marginBottom:'8px'}}>
                    <span>üìÑ {d.pageCount} pages</span><span>üìù {(d.wordCount/1000).toFixed(1)}K words</span><span>üîÑ {d.versions.length} versions</span>
                    {d.comments.filter(c=>c.status==='OPEN').length>0&&<span style={{color:'#f59e0b'}}>üí¨ {d.comments.filter(c=>c.status==='OPEN').length} open</span>}
                  </div>
                  {d.locked&&<div style={{fontSize:'10px',color:'#ef4444',fontWeight:600}}>üîí Locked by {d.lockHolder}</div>}
                  <div style={{fontFamily:'monospace',fontSize:'9px',color:'#3e4f63',marginTop:'4px'}}>{d.file}</div>
                </div>
              ))}
            </div>
          )}

          {tab==='docs'&&selectedDoc&&(()=>{
            const doc=docs.find(d=>d.id===selectedDoc);
            if(!doc)return null;
            return(
              <div>
                <button onClick={()=>setSelectedDoc(null)} style={{marginBottom:'12px',padding:'5px 12px',fontSize:'11px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',background:'rgba(10,22,40,0.5)',color:'#00E5FA'}}>‚Üê Back to Documents</button>
                <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'18px',marginBottom:'16px'}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start'}}>
                    <div>
                      <div style={{fontSize:'18px',fontWeight:800,color:'white'}}>{doc.name}</div>
                      <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>{doc.opp} ‚Ä¢ {doc.file} ‚Ä¢ Branch: <span style={{color:'#00E5FA'}}>{doc.branch}</span></div>
                    </div>
                    <div style={{display:'flex',gap:'8px',alignItems:'center'}}>
                      <span style={{fontSize:'16px',fontWeight:800,color:'#00E5FA'}}>v{doc.currentVersion}</span>
                      <span style={{fontSize:'10px',fontWeight:700,padding:'2px 8px',borderRadius:'4px',background:`${statusColor[doc.status]}12`,color:statusColor[doc.status]}}>{doc.status}</span>
                    </div>
                  </div>
                </div>

                {/* Version Timeline */}
                <div style={{fontSize:'12px',fontWeight:700,color:'white',marginBottom:'10px'}}>Version History</div>
                <div style={{display:'flex',flexDirection:'column',gap:'0',marginBottom:'20px'}}>
                  {doc.versions.map((v,i)=>(
                    <div key={v.ver} style={{display:'flex',gap:'14px',alignItems:'flex-start',position:'relative',paddingLeft:'24px',paddingBottom:'14px'}}>
                      {i<doc.versions.length-1&&<div style={{position:'absolute',left:'10px',top:'16px',bottom:'0',width:'2px',background:'rgba(0,229,250,0.1)'}}/>}
                      <div style={{position:'absolute',left:'4px',top:'4px',width:'14px',height:'14px',borderRadius:'50%',background:i===0?'#00E5FA20':'rgba(255,255,255,0.04)',border:`2px solid ${i===0?'#00E5FA':'#3e4f63'}`,zIndex:1}}/>
                      <div style={{flex:1,background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.06)',borderRadius:'8px',padding:'10px 14px'}}>
                        <div style={{display:'flex',alignItems:'center',gap:'8px',flexWrap:'wrap',marginBottom:'4px'}}>
                          <span style={{fontFamily:'monospace',fontSize:'12px',fontWeight:700,color:'#00E5FA'}}>v{v.ver}</span>
                          <span style={{fontSize:'10px',color:'#5a7a9a'}}>{v.date}</span>
                          <span style={{fontSize:'10px',fontWeight:600,color:'#94a3b8'}}>by {v.author}</span>
                          <span style={{fontSize:'9px',fontWeight:700,padding:'1px 5px',borderRadius:'3px',background:`${reviewColor[v.reviewStatus]}12`,color:reviewColor[v.reviewStatus]}}>{v.reviewStatus}</span>
                          <span style={{fontSize:'9px',color:'#00ff88'}}>+{v.linesAdded}</span>
                          <span style={{fontSize:'9px',color:'#ef4444'}}>-{v.linesRemoved}</span>
                        </div>
                        <div style={{fontSize:'11px',color:'#94a3b8',lineHeight:'1.4'}}>{v.changes}</div>
                      </div>
                    </div>
                  ))}
                </div>

                {/* Comments */}
                {doc.comments.length>0&&(<>
                  <div style={{fontSize:'12px',fontWeight:700,color:'white',marginBottom:'10px'}}>Review Comments ({doc.comments.filter(c=>c.status==='OPEN').length} open)</div>
                  <div style={{display:'flex',flexDirection:'column',gap:'6px'}}>
                    {doc.comments.map(c=>(
                      <div key={c.id} style={{background:'rgba(10,22,40,0.5)',border:`1px solid ${c.status==='OPEN'?'rgba(245,158,11,0.15)':'rgba(0,255,136,0.08)'}`,borderRadius:'8px',padding:'10px 14px'}}>
                        <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'4px'}}>
                          <span style={{fontSize:'11px',fontWeight:600,color:'white'}}>{c.author}</span>
                          <span style={{fontFamily:'monospace',fontSize:'10px',color:'#00E5FA'}}>{c.section}</span>
                          <span style={{fontSize:'9px',fontWeight:600,padding:'1px 5px',borderRadius:'3px',background:c.priority==='HIGH'?'rgba(239,68,68,0.1)':c.priority==='MEDIUM'?'rgba(245,158,11,0.1)':'rgba(148,163,184,0.08)',color:c.priority==='HIGH'?'#ef4444':c.priority==='MEDIUM'?'#f59e0b':'#94a3b8'}}>{c.priority}</span>
                          <span style={{fontSize:'9px',fontWeight:700,padding:'1px 5px',borderRadius:'3px',background:c.status==='OPEN'?'rgba(245,158,11,0.1)':'rgba(0,255,136,0.1)',color:c.status==='OPEN'?'#f59e0b':'#00ff88'}}>{c.status}</span>
                          <span style={{fontSize:'10px',color:'#3e4f63',marginLeft:'auto'}}>{c.date}</span>
                        </div>
                        <div style={{fontSize:'12px',color:'#e2e8f0',lineHeight:'1.4'}}>{c.text}</div>
                      </div>
                    ))}
                  </div>
                </>)}
              </div>
            );
          })()}

          {tab==='branches'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
              {DEMO_BRANCHES.map(b=>(
                <div key={b.name} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'14px 18px'}}>
                  <div style={{display:'flex',alignItems:'center',gap:'10px',marginBottom:'6px'}}>
                    <span style={{fontFamily:'monospace',fontSize:'14px',fontWeight:700,color:b.name==='main'?'#00ff88':'#00E5FA'}}>{b.name}</span>
                    <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:b.status==='ACTIVE'?'rgba(0,255,136,0.1)':'rgba(167,139,250,0.1)',color:b.status==='ACTIVE'?'#00ff88':'#a78bfa'}}>{b.status}</span>
                    <span style={{fontSize:'10px',color:'#5a7a9a'}}>{b.docs} document{b.docs!==1?'s':''}</span>
                  </div>
                  <div style={{fontSize:'12px',color:'#94a3b8'}}>{b.description}</div>
                  {b.mergedDate&&<div style={{fontSize:'10px',color:'#3e4f63',marginTop:'4px'}}>Merged: {b.mergedDate}</div>}
                </div>
              ))}
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>‚ö†Ô∏è AI GENERATED ‚Äî REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 ‚Äî Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
