<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse ‚Äî Review Workflow</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const TEAM_COLORS={Blue:'#3b82f6',Pink:'#ec4899',Red:'#ef4444',Gold:'#f59e0b'};
    const TEAM_DESC={Blue:'Compliance & completeness check',Pink:'Persuasiveness & strategy review',Red:'Final mock evaluation (scored)',Gold:'Executive sign-off & polish'};

    const DEMO_REVIEWS=[
      {id:1,opp:'DHA EHR Modernization',team:'Blue',date:'2025-12-10',status:'COMPLETE',lead:'Sarah K.',reviewers:['Tom P.','Patricia N.','Mark S.'],totalComments:12,resolved:12,critical:2,major:5,minor:5,verdict:'PASS',notes:'All L/M requirements addressed. 2 critical gaps in ¬ß2.3 resolved same day.'},
      {id:2,opp:'DHA EHR Modernization',team:'Pink',date:'2026-01-15',status:'COMPLETE',lead:'Mary W.',reviewers:['James R.','Angela F.','External SME'],totalComments:28,resolved:28,critical:4,major:12,minor:12,verdict:'PASS WITH REWORK',notes:'Win themes need strengthening in Vol II. Discriminators not clear in ¬ß2.1. Pricing narrative weak.'},
      {id:3,opp:'DHA EHR Modernization',team:'Red',date:'2026-02-20',status:'SCHEDULED',lead:'External Reviewer',reviewers:['Eval Panel (3)','Mary W.','Tom P.'],totalComments:0,resolved:0,critical:0,major:0,minor:0,verdict:'PENDING',notes:'Mock scoring against Section M criteria. Panelists briefed on eval factors.'},
      {id:4,opp:'DHA EHR Modernization',team:'Gold',date:'2026-03-01',status:'SCHEDULED',lead:'Mary W.',reviewers:['CEO','COO','Legal'],totalComments:0,resolved:0,critical:0,major:0,minor:0,verdict:'PENDING',notes:'Final executive review. Compliance check + sign-off.'},
      {id:5,opp:'VA Claims Processing AI',team:'Blue',date:'2026-02-15',status:'COMPLETE',lead:'Tom P.',reviewers:['Lisa W.','Mark S.'],totalComments:8,resolved:8,critical:0,major:4,minor:4,verdict:'PASS',notes:'Clean review. Minor formatting issues in Vol III.'},
      {id:6,opp:'VA Claims Processing AI',team:'Pink',date:'2026-03-05',status:'SCHEDULED',lead:'Mary W.',reviewers:['Sarah K.','James R.'],totalComments:0,resolved:0,critical:0,major:0,minor:0,verdict:'PENDING',notes:'Focus on AI approach differentiation vs Booz Allen.'},
      {id:7,opp:'CMS Data Analytics Platform',team:'Blue',date:'2025-11-01',status:'COMPLETE',lead:'Tom P.',reviewers:['Patricia N.'],totalComments:6,resolved:6,critical:0,major:2,minor:4,verdict:'PASS',notes:'Straightforward. Minor section reference errors.'},
      {id:8,opp:'CMS Data Analytics Platform',team:'Pink',date:'2025-12-01',status:'COMPLETE',lead:'Mary W.',reviewers:['Sarah K.','External SME'],totalComments:15,resolved:15,critical:1,major:8,minor:6,verdict:'PASS WITH REWORK',notes:'Past performance section needs stronger relevance argument.'},
      {id:9,opp:'CMS Data Analytics Platform',team:'Red',date:'2026-01-20',status:'COMPLETE',lead:'External Reviewer',reviewers:['Eval Panel (2)'],totalComments:18,resolved:18,critical:2,major:9,minor:7,verdict:'PASS',notes:'Scored 87/100. Technical strong, management average. Addressed in final.'},
      {id:10,opp:'CMS Data Analytics Platform',team:'Gold',date:'2026-02-05',status:'COMPLETE',lead:'Mary W.',reviewers:['CEO'],totalComments:3,resolved:3,critical:0,major:1,minor:2,verdict:'PASS',notes:'Minor executive messaging edits. Approved for submission.'},
    ];

    const DEMO_COMMENTS=[
      {id:1,reviewId:2,team:'Pink',section:'Vol II ¬ß2.1',severity:'CRITICAL',comment:'The technical approach does not clearly articulate how MissionPulse differentiates from incumbent solution. Evaluator scanning this section would not find a discriminator in first 2 paragraphs.',resolution:'Rewrote opening paragraph with 3 clear discriminators: AI-powered automation, 40% faster deployment, FedRAMP High on Day 1.',status:'RESOLVED',assignee:'Sarah K.',resolvedDate:'2026-01-18'},
      {id:2,reviewId:2,team:'Pink',section:'Vol II ¬ß2.3',severity:'CRITICAL',comment:'ATO timeline shows 180 days but PWS requires operational capability at 90 days. This is a non-compliance risk.',resolution:'Revised to show inherited ATO from Azure Gov reducing timeline to 75 days. Added ConMon from Day 1.',status:'RESOLVED',assignee:'Angela F.',resolvedDate:'2026-01-17'},
      {id:3,reviewId:2,team:'Pink',section:'Vol II ¬ß2.5',severity:'MAJOR',comment:'AI/ML section reads like a product brochure. Needs concrete methodology ‚Äî what models, what training data, what validation approach.',resolution:'Added MLOps pipeline diagram, model governance framework, and bias testing protocol with quantitative thresholds.',status:'RESOLVED',assignee:'James R.',resolvedDate:'2026-01-20'},
      {id:4,reviewId:2,team:'Pink',section:'Vol III ¬ß3.1',severity:'MAJOR',comment:'Management approach is generic. Could apply to any IT contract. No DHA-specific governance described.',resolution:'Added DHA-specific IPT structure, MHS GENESIS coordination touchpoints, and PFM reporting cadence.',status:'RESOLVED',assignee:'Mary W.',resolvedDate:'2026-01-19'},
      {id:5,reviewId:2,team:'Pink',section:'Vol V',severity:'CRITICAL',comment:'Pricing narrative does not justify the 15% premium over estimated incumbent pricing. Evaluator will see this as price risk.',resolution:'Added value engineering section showing 3-year TCO savings of 22% through automation. Included ROI table.',status:'RESOLVED',assignee:'Finance',resolvedDate:'2026-01-21'},
      {id:6,reviewId:2,team:'Pink',section:'Vol II ¬ß2.2',severity:'MAJOR',comment:'DevSecOps diagram is too small to read. Pipeline stages not clearly labeled.',resolution:'Redesigned as full-page diagram with numbered steps and STIG/SCAP touchpoints annotated.',status:'RESOLVED',assignee:'Lisa W.',resolvedDate:'2026-01-17'},
      {id:7,reviewId:9,team:'Red',section:'Vol II Overall',severity:'CRITICAL',comment:'Mock score: Technical 42/50. Weakness: Section 2.4 migration approach lacks rollback detail. Evaluator docked 4 points.',resolution:'Added 2-page rollback appendix with decision tree and data integrity validation checkpoints.',status:'RESOLVED',assignee:'David C.',resolvedDate:'2026-01-25'},
      {id:8,reviewId:9,team:'Red',section:'Vol III Overall',severity:'CRITICAL',comment:'Mock score: Management 35/40. Weakness: Risk register shows only 5 risks ‚Äî evaluator expected at least 8 for a program this size.',resolution:'Expanded to 10 risks with cost/schedule impact quantified. Added risk burndown chart.',status:'RESOLVED',assignee:'Tom P.',resolvedDate:'2026-01-24'},
    ];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[tab,setTab]=useState('pipeline');
      const[oppFilter,setOppFilter]=useState('All');
      const[teamFilter,setTeamFilter]=useState('All');
      const[expanded,setExpanded]=useState(null);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('ai_approvals').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const opps=[...new Set(DEMO_REVIEWS.map(r=>r.opp))];
      const filteredR=useMemo(()=>DEMO_REVIEWS.filter(r=>{
        if(oppFilter!=='All'&&r.opp!==oppFilter)return false;
        if(teamFilter!=='All'&&r.team!==teamFilter)return false;
        return true;
      }),[oppFilter,teamFilter]);

      const filteredC=useMemo(()=>{
        const reviewIds=filteredR.map(r=>r.id);
        return DEMO_COMMENTS.filter(c=>reviewIds.includes(c.reviewId));
      },[filteredR]);

      const sevColor={CRITICAL:'#ef4444',MAJOR:'#f59e0b',MINOR:'#94a3b8'};
      const statusColor={COMPLETE:'#00ff88',SCHEDULED:'#00E5FA','IN PROGRESS':'#f59e0b'};
      const verdictColor={PASS:'#00ff88','PASS WITH REWORK':'#f59e0b',FAIL:'#ef4444',PENDING:'#5a7a9a'};

      const totalComments=DEMO_REVIEWS.reduce((s,r)=>s+r.totalComments,0);
      const totalResolved=DEMO_REVIEWS.reduce((s,r)=>s+r.resolved,0);

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>COLOR TEAM REVIEWS</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Review Workflow</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Blue ‚Üí Pink ‚Üí Red ‚Üí Gold ‚Ä¢ Comment tracking ‚Ä¢ Resolution log</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          {/* Stats */}
          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Reviews',value:DEMO_REVIEWS.length,color:'#00E5FA'},
              {label:'Complete',value:DEMO_REVIEWS.filter(r=>r.status==='COMPLETE').length,color:'#00ff88'},
              {label:'Scheduled',value:DEMO_REVIEWS.filter(r=>r.status==='SCHEDULED').length,color:'#00E5FA'},
              {label:'Total Comments',value:totalComments,color:'#a78bfa'},
              {label:'Resolved',value:totalResolved,color:'#00ff88'},
              {label:'Resolution Rate',value:totalComments>0?`${Math.round(totalResolved/totalComments*100)}%`:'‚Äî',color:'#00ff88'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'120px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Tabs + Filters */}
          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'pipeline',l:'Review Pipeline'},{k:'comments',l:'Comment Log'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{display:'flex',gap:'3px',marginLeft:'8px'}}>
              {['All','Blue','Pink','Red','Gold'].map(t=>(
                <button key={t} onClick={()=>setTeamFilter(t)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:700,borderRadius:'6px',border:'none',cursor:'pointer',background:teamFilter===t?(TEAM_COLORS[t]||'rgba(0,229,250,0.15)')+'20':'rgba(10,22,40,0.5)',color:teamFilter===t?(TEAM_COLORS[t]||'#00E5FA'):'#5a7a9a'}}>{t}</button>
              ))}
            </div>
            <div style={{marginLeft:'auto',display:'flex',gap:'3px'}}>
              {['All',...opps].map(o=>(
                <button key={o} onClick={()=>setOppFilter(o)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',whiteSpace:'nowrap',background:oppFilter===o?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:oppFilter===o?'#00E5FA':'#5a7a9a'}}>{o==='All'?'All':o.split(' ').slice(0,2).join(' ')}</button>
              ))}
            </div>
          </div>

          {/* PIPELINE TAB */}
          {tab==='pipeline'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
              {opps.filter(o=>oppFilter==='All'||o===oppFilter).map(opp=>{
                const oppRevs=filteredR.filter(r=>r.opp===opp);
                if(oppRevs.length===0)return null;
                return(
                  <div key={opp} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'16px'}}>
                    <div style={{fontSize:'14px',fontWeight:700,color:'white',marginBottom:'12px'}}>{opp}</div>
                    {/* Gate Flow */}
                    <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'12px'}}>
                      {['Blue','Pink','Red','Gold'].map((team,i)=>{
                        const rev=oppRevs.find(r=>r.team===team);
                        const c=TEAM_COLORS[team];
                        return(
                          <React.Fragment key={team}>
                            {i>0&&<div style={{display:'flex',alignItems:'center',color:'#3e4f63',fontSize:'16px'}}>‚Üí</div>}
                            <div onClick={()=>rev&&setExpanded(expanded===rev.id?null:rev.id)} style={{background:`${c}08`,border:`1px solid ${c}25`,borderRadius:'10px',padding:'12px 16px',minWidth:'180px',flex:1,cursor:rev?'pointer':'default',transition:'all 0.15s'}}
                              onMouseOver={e=>{if(rev)e.currentTarget.style.borderColor=c+'60'}} onMouseOut={e=>{if(rev)e.currentTarget.style.borderColor=c+'25'}}>
                              <div style={{display:'flex',alignItems:'center',gap:'6px',marginBottom:'6px'}}>
                                <div style={{width:'10px',height:'10px',borderRadius:'3px',background:c}}/>
                                <span style={{fontSize:'13px',fontWeight:700,color:c}}>{team} Team</span>
                                {rev&&<span style={{marginLeft:'auto',fontSize:'9px',fontWeight:700,padding:'1px 6px',borderRadius:'3px',background:`${statusColor[rev.status]}12`,color:statusColor[rev.status]}}>{rev.status}</span>}
                              </div>
                              {rev?(
                                <div style={{fontSize:'11px',color:'#94a3b8'}}>
                                  <div>{rev.date} ‚Ä¢ Lead: {rev.lead}</div>
                                  <div style={{marginTop:'4px',display:'flex',gap:'8px'}}>
                                    <span>üí¨ {rev.totalComments}</span>
                                    <span style={{color:'#00ff88'}}>‚úì {rev.resolved}</span>
                                    {rev.critical>0&&<span style={{color:'#ef4444'}}>üî¥ {rev.critical}</span>}
                                  </div>
                                  <div style={{marginTop:'4px'}}><span style={{fontSize:'10px',fontWeight:700,padding:'1px 6px',borderRadius:'3px',background:`${verdictColor[rev.verdict]}12`,color:verdictColor[rev.verdict]}}>{rev.verdict}</span></div>
                                </div>
                              ):(
                                <div style={{fontSize:'11px',color:'#3e4f63'}}>Not scheduled</div>
                              )}
                            </div>
                          </React.Fragment>
                        );
                      })}
                    </div>
                    {/* Expanded Review Detail */}
                    {oppRevs.map(rev=>expanded===rev.id&&(
                      <div key={rev.id} style={{background:'rgba(0,0,0,0.2)',borderRadius:'8px',padding:'14px',marginTop:'4px',borderLeft:`3px solid ${TEAM_COLORS[rev.team]}`}}>
                        <div style={{fontSize:'12px',fontWeight:700,color:'white',marginBottom:'8px'}}>{rev.team} Team Review ‚Äî {rev.date}</div>
                        <div style={{display:'flex',gap:'16px',fontSize:'11px',color:'#94a3b8',marginBottom:'8px'}}>
                          <span>Lead: {rev.lead}</span>
                          <span>Reviewers: {rev.reviewers.join(', ')}</span>
                        </div>
                        <div style={{display:'flex',gap:'10px',marginBottom:'8px',fontSize:'11px'}}>
                          <span style={{color:'#ef4444'}}>Critical: {rev.critical}</span>
                          <span style={{color:'#f59e0b'}}>Major: {rev.major}</span>
                          <span style={{color:'#94a3b8'}}>Minor: {rev.minor}</span>
                          <span style={{color:'#00ff88'}}>Resolved: {rev.resolved}/{rev.totalComments}</span>
                        </div>
                        <div style={{fontSize:'12px',color:'#94a3b8',lineHeight:'1.5'}}>{rev.notes}</div>
                      </div>
                    ))}
                  </div>
                );
              })}
            </div>
          )}

          {/* COMMENTS TAB */}
          {tab==='comments'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'hidden'}}>
              <table style={{width:'100%',borderCollapse:'collapse',fontSize:'12px'}}>
                <thead><tr style={{borderBottom:'1px solid rgba(0,229,250,0.1)'}}>
                  {['Team','Section','Severity','Comment','Resolution','Assignee','Status'].map(h=>(
                    <th key={h} style={{padding:'10px 10px',textAlign:'left',color:'#5a7a9a',fontWeight:700,fontSize:'10px',letterSpacing:'0.5px',textTransform:'uppercase'}}>{h}</th>
                  ))}
                </tr></thead>
                <tbody>
                  {filteredC.map(c=>(
                    <tr key={c.id} style={{borderBottom:'1px solid rgba(0,229,250,0.04)'}} onMouseOver={e=>e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e=>e.currentTarget.style.background='transparent'}>
                      <td style={{padding:'9px 10px'}}><span style={{fontSize:'10px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${TEAM_COLORS[c.team]}15`,color:TEAM_COLORS[c.team]}}>{c.team}</span></td>
                      <td style={{padding:'9px 10px',fontFamily:'monospace',fontSize:'10px',color:'#00E5FA',whiteSpace:'nowrap'}}>{c.section}</td>
                      <td style={{padding:'9px 10px'}}><span style={{fontSize:'9px',fontWeight:700,padding:'1px 5px',borderRadius:'3px',background:`${sevColor[c.severity]}10`,color:sevColor[c.severity]}}>{c.severity}</span></td>
                      <td style={{padding:'9px 10px',color:'#e2e8f0',fontSize:'11px',maxWidth:'250px'}}>{c.comment.length>100?c.comment.slice(0,100)+'‚Ä¶':c.comment}</td>
                      <td style={{padding:'9px 10px',color:'#86efac',fontSize:'11px',maxWidth:'200px'}}>{c.resolution?c.resolution.length>80?c.resolution.slice(0,80)+'‚Ä¶':c.resolution:'‚Äî'}</td>
                      <td style={{padding:'9px 10px',color:'#94a3b8',fontSize:'11px',whiteSpace:'nowrap'}}>{c.assignee}</td>
                      <td style={{padding:'9px 10px'}}><span style={{fontSize:'9px',fontWeight:700,padding:'1px 5px',borderRadius:'3px',background:c.status==='RESOLVED'?'rgba(0,255,136,0.1)':'rgba(245,158,11,0.1)',color:c.status==='RESOLVED'?'#00ff88':'#f59e0b'}}>{c.status}</span></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>‚ö†Ô∏è AI GENERATED ‚Äî REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 ‚Äî Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
