<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse v12.0 - Command Center</title>
  <link rel="icon" type="image/png" href="MMT_icon_32px.png">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #00050F; min-height: 100vh; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-ping { animation: ping 1s cubic-bezier(0, 0, 0.2, 1) infinite; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    .gradient-text { background: linear-gradient(135deg, #00E5FA 0%, #00D29F 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .sidebar-item:hover { background: rgba(0, 229, 250, 0.1); }
    .sidebar-item.active { background: rgba(0, 229, 250, 0.15); border-left: 3px solid #00E5FA; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1e293b; }
    ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
  </style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <!-- Auth Loading Screen -->
  <div id="authLoader" class="fixed inset-0 bg-slate-900 flex items-center justify-center z-50">
    <div class="text-center">
      <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center mx-auto mb-4 animate-pulse">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
        </svg>
      </div>
      <p class="text-slate-400">Verifying access...</p>
    </div>
  </div>
  
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;
    
    // ============================================================
    // SUPABASE CLIENT
    // ============================================================
    const SUPABASE_URL = 'https://djuviwarqdvlbgcfuupa.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MzUyMjQsImV4cCI6MjA1MzQxMTIyNH0.pBPL9l2zL7LLd_A5I--hPBzw5YwG3ajPMtbYsqsxIgQ';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // ============================================================
    // ICONS
    // ============================================================
    const Icons = {
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      target: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><circle cx="12" cy="12" r="6" strokeWidth={2}/><circle cx="12" cy="12" r="2" strokeWidth={2}/></svg>,
      users: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>,
      swords: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      shieldCheck: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      calculator: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg>,
      cpu: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>,
      logout: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>,
      user: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
      activity: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M22 12h-4l-3 9L9 3l-3 9H2" /></svg>,
      dollar: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      trophy: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" /></svg>,
      check: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
      alert: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
      loader: () => <svg className="w-full h-full animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
      database: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><ellipse cx="12" cy="5" rx="9" ry="3" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5" strokeWidth={2}/></svg>,
    };
    
    const Icon = ({ name, className = "w-4 h-4" }) => {
      const IconComponent = Icons[name];
      return IconComponent ? <span className={`inline-block ${className}`}><IconComponent /></span> : null;
    };
    
    // ============================================================
    // UI COMPONENTS
    // ============================================================
    const Card = ({ children, className = '', glow = false, onClick }) => (
      <div onClick={onClick} className={`bg-slate-800/50 backdrop-blur-sm border border-slate-700/50 rounded-2xl transition-all duration-300 ${onClick ? 'cursor-pointer hover:border-cyan-500/50' : ''} ${glow ? 'shadow-lg shadow-cyan-500/20 border-cyan-500/30' : ''} ${className}`}>{children}</div>
    );
    
    const Button = ({ children, variant = 'primary', size = 'md', icon, className = '', disabled = false, ...props }) => {
      const variants = {
        primary: 'bg-gradient-to-r from-cyan-500 to-teal-500 text-white hover:from-cyan-400 hover:to-teal-400 shadow-lg shadow-cyan-500/25',
        secondary: 'bg-slate-700 text-white hover:bg-slate-600 border border-slate-600',
        ghost: 'bg-transparent text-slate-400 hover:text-white hover:bg-slate-700/50',
        danger: 'bg-red-600 text-white hover:bg-red-500'
      };
      const sizes = { sm: 'px-3 py-1.5 text-sm', md: 'px-4 py-2 text-sm', lg: 'px-6 py-3 text-base' };
      return (
        <button className={`inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all duration-200 ${variants[variant]} ${sizes[size]} ${disabled ? 'opacity-50 cursor-not-allowed' : ''} ${className}`} disabled={disabled} {...props}>
          {icon && <Icon name={icon} className="w-4 h-4" />}{children}
        </button>
      );
    };
    
    const Badge = ({ children, variant = 'default', className = '' }) => {
      const variants = {
        default: 'bg-slate-700 text-slate-300',
        success: 'bg-emerald-500/20 text-emerald-400',
        warning: 'bg-amber-500/20 text-amber-400',
        danger: 'bg-red-500/20 text-red-400',
        info: 'bg-cyan-500/20 text-cyan-400'
      };
      return <span className={`px-2 py-1 rounded-full text-xs font-medium ${variants[variant]} ${className}`}>{children}</span>;
    };
    
    // ============================================================
    // UTILITY FUNCTIONS
    // ============================================================
    const formatCurrency = (value) => {
      if (!value) return '$0';
      if (value >= 1000000000) return `$${(value / 1000000000).toFixed(1)}B`;
      if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
      if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
      return `$${value.toLocaleString()}`;
    };
    
    // ============================================================
    // SIDEBAR NAVIGATION
    // ============================================================
    const NAVIGATION = [
      { id: 'dashboard', label: 'Dashboard', icon: 'activity' },
      { id: 'pipeline', label: 'Pipeline Intel', icon: 'target' },
      { id: 'warroom', label: 'War Room', icon: 'swords' },
      { id: 'compliance', label: 'Iron Dome', icon: 'shieldCheck' },
      { id: 'pricing', label: 'Pricing Studio', icon: 'calculator' },
      { id: 'agents', label: 'AI Agents', icon: 'cpu', href: 'missionpulse-agent-hub.html' },
    ];
    
    // ============================================================
    // MAIN APPLICATION
    // ============================================================
    function App() {
      const [user, setUser] = useState(null);
      const [authChecked, setAuthChecked] = useState(false);
      const [activeModule, setActiveModule] = useState('dashboard');
      const [isLoading, setIsLoading] = useState(true);
      const [dataStatus, setDataStatus] = useState({ connected: false, message: 'Connecting...' });
      
      // Data states
      const [opportunities, setOpportunities] = useState([]);
      const [competitors, setCompetitors] = useState([]);
      const [compliance, setCompliance] = useState([]);
      const [teamMembers, setTeamMembers] = useState([]);
      const [stats, setStats] = useState({ totalValue: 0, avgPwin: 0, count: 0 });
      
      // ============================================================
      // AUTHENTICATION CHECK
      // ============================================================
      useEffect(() => {
        async function checkAuth() {
          try {
            const { data: { session } } = await supabase.auth.getSession();
            
            if (!session) {
              console.log('[MissionPulse] No session, redirecting to login');
              window.location.href = 'login.html';
              return;
            }
            
            setUser(session.user);
            setAuthChecked(true);
            document.getElementById('authLoader').style.display = 'none';
            
            console.log('[MissionPulse] Authenticated as:', session.user.email);
          } catch (error) {
            console.error('[MissionPulse] Auth check failed:', error);
            window.location.href = 'login.html';
          }
        }
        
        checkAuth();
        
        // Listen for auth changes
        const { data: { subscription } } = supabase.auth.onAuthStateChange((event, session) => {
          if (event === 'SIGNED_OUT') {
            window.location.href = 'login.html';
          }
        });
        
        return () => subscription?.unsubscribe();
      }, []);
      
      // ============================================================
      // DATA FETCHING
      // ============================================================
      const fetchAllData = useCallback(async () => {
        setIsLoading(true);
        
        try {
          // Fetch opportunities
          const { data: opps, error: oppsError } = await supabase
            .from('opportunities')
            .select('*')
            .order('created_at', { ascending: false });
          
          if (oppsError) throw oppsError;
          setOpportunities(opps || []);
          
          // Calculate stats
          const totalValue = (opps || []).reduce((sum, o) => sum + (o.ceiling || 0), 0);
          const avgPwin = opps?.length > 0 
            ? Math.round((opps.reduce((sum, o) => sum + (o.win_probability || 0), 0)) / opps.length)
            : 0;
          setStats({ totalValue, avgPwin, count: opps?.length || 0 });
          
          // Fetch competitors
          const { data: comps } = await supabase
            .from('competitors')
            .select('*')
            .order('threat_level', { ascending: false });
          setCompetitors(comps || []);
          
          // Fetch compliance
          const { data: reqs } = await supabase
            .from('compliance_requirements')
            .select('*')
            .order('risk_level', { ascending: false });
          setCompliance(reqs || []);
          
          // Fetch team
          const { data: team } = await supabase
            .from('team_members')
            .select('*')
            .order('name', { ascending: true });
          setTeamMembers(team || []);
          
          setDataStatus({ 
            connected: true, 
            message: `Live from Supabase (${opps?.length || 0} opportunities, ${comps?.length || 0} competitors)` 
          });
          
        } catch (error) {
          console.error('[MissionPulse] Data fetch error:', error);
          setDataStatus({ connected: false, message: 'Connection failed - using demo data' });
        } finally {
          setIsLoading(false);
        }
      }, []);
      
      useEffect(() => {
        if (authChecked) {
          fetchAllData();
        }
      }, [authChecked, fetchAllData]);
      
      // ============================================================
      // LOGOUT
      // ============================================================
      const handleLogout = async () => {
        try {
          await supabase.auth.signOut();
          window.location.href = 'login.html';
        } catch (error) {
          console.error('[MissionPulse] Logout error:', error);
        }
      };
      
      // Don't render until auth is checked
      if (!authChecked) return null;
      
      // ============================================================
      // RENDER MODULES
      // ============================================================
      const renderModule = () => {
        switch (activeModule) {
          case 'dashboard':
            return <DashboardModule stats={stats} opportunities={opportunities} competitors={competitors} compliance={compliance} />;
          case 'pipeline':
            return <PipelineModule opportunities={opportunities} stats={stats} />;
          case 'warroom':
            return <WarRoomModule competitors={competitors} />;
          case 'compliance':
            return <ComplianceModule requirements={compliance} />;
          case 'pricing':
            return <PricingModule teamMembers={teamMembers} />;
          default:
            return <DashboardModule stats={stats} opportunities={opportunities} competitors={competitors} compliance={compliance} />;
        }
      };
      
      return (
        <div className="flex h-screen overflow-hidden">
          {/* Sidebar */}
          <aside className="w-64 bg-slate-900/95 border-r border-slate-800 flex flex-col">
            {/* Logo */}
            <div className="p-6 border-b border-slate-800">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center">
                  <Icon name="shield" className="w-6 h-6 text-white" />
                </div>
                <div>
                  <h1 className="font-bold text-white">MissionPulse</h1>
                  <p className="text-xs text-slate-500">v12.0 Production</p>
                </div>
              </div>
            </div>
            
            {/* Navigation */}
            <nav className="flex-1 py-4 overflow-y-auto">
              {NAVIGATION.map((item) => (
                item.href ? (
                  <a
                    key={item.id}
                    href={item.href}
                    className="sidebar-item flex items-center gap-3 px-6 py-3 text-slate-400 hover:text-white transition-colors"
                  >
                    <Icon name={item.icon} className="w-5 h-5" />
                    <span className="text-sm font-medium">{item.label}</span>
                  </a>
                ) : (
                  <button
                    key={item.id}
                    onClick={() => setActiveModule(item.id)}
                    className={`sidebar-item w-full flex items-center gap-3 px-6 py-3 text-left transition-colors ${activeModule === item.id ? 'active text-cyan-400' : 'text-slate-400 hover:text-white'}`}
                  >
                    <Icon name={item.icon} className="w-5 h-5" />
                    <span className="text-sm font-medium">{item.label}</span>
                  </button>
                )
              ))}
            </nav>
            
            {/* Data Status */}
            <div className="p-4 border-t border-slate-800">
              <div className={`flex items-center gap-2 text-xs ${dataStatus.connected ? 'text-emerald-400' : 'text-amber-400'}`}>
                <span className={`w-2 h-2 rounded-full ${dataStatus.connected ? 'bg-emerald-400 animate-pulse' : 'bg-amber-400'}`}></span>
                {dataStatus.message}
              </div>
            </div>
            
            {/* User Profile */}
            <div className="p-4 border-t border-slate-800">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center">
                  <Icon name="user" className="w-5 h-5 text-slate-400" />
                </div>
                <div className="flex-1 min-w-0">
                  <p className="text-sm font-medium text-white truncate">
                    {user?.user_metadata?.name || user?.email?.split('@')[0] || 'User'}
                  </p>
                  <p className="text-xs text-slate-500 truncate">{user?.email}</p>
                </div>
              </div>
              <Button variant="ghost" size="sm" icon="logout" className="w-full" onClick={handleLogout}>
                Sign Out
              </Button>
            </div>
          </aside>
          
          {/* Main Content */}
          <main className="flex-1 overflow-y-auto bg-gradient-to-br from-slate-900 via-slate-900 to-slate-800">
            {isLoading ? (
              <div className="flex items-center justify-center h-full">
                <div className="text-center">
                  <Icon name="loader" className="w-12 h-12 text-cyan-500 mx-auto mb-4" />
                  <p className="text-slate-400">Loading data...</p>
                </div>
              </div>
            ) : (
              <div className="p-8 animate-fadeIn">
                {renderModule()}
              </div>
            )}
          </main>
        </div>
      );
    }
    
    // ============================================================
    // DASHBOARD MODULE
    // ============================================================
    function DashboardModule({ stats, opportunities, competitors, compliance }) {
      const kpiCards = [
        { label: 'Pipeline Value', value: formatCurrency(stats.totalValue), icon: 'dollar', color: 'cyan' },
        { label: 'Active Opportunities', value: stats.count, icon: 'target', color: 'emerald' },
        { label: 'Avg Win Probability', value: `${stats.avgPwin}%`, icon: 'trophy', color: 'amber' },
        { label: 'Competitors Tracked', value: competitors.length, icon: 'swords', color: 'purple' },
      ];
      
      return (
        <div className="space-y-8">
          <div>
            <h2 className="text-2xl font-bold text-white mb-2">Command Center</h2>
            <p className="text-slate-400">Real-time visibility across your entire proposal pipeline</p>
          </div>
          
          {/* KPI Cards */}
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
            {kpiCards.map((kpi, i) => (
              <Card key={i} className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <div className={`w-12 h-12 rounded-xl bg-${kpi.color}-500/20 flex items-center justify-center`}>
                    <Icon name={kpi.icon} className={`w-6 h-6 text-${kpi.color}-400`} />
                  </div>
                  <Badge variant="info">Live</Badge>
                </div>
                <p className="text-3xl font-bold text-white mb-1">{kpi.value}</p>
                <p className="text-sm text-slate-400">{kpi.label}</p>
              </Card>
            ))}
          </div>
          
          {/* Recent Activity */}
          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <Card className="p-6">
              <h3 className="text-lg font-semibold text-white mb-4">Recent Opportunities</h3>
              <div className="space-y-3">
                {opportunities.slice(0, 5).map((opp, i) => (
                  <div key={opp.id || i} className="flex items-center justify-between py-2 border-b border-slate-700/50 last:border-0">
                    <div>
                      <p className="text-sm font-medium text-white">{opp.title || opp.name || 'Untitled'}</p>
                      <p className="text-xs text-slate-500">{opp.nickname || opp.agency || 'N/A'}</p>
                    </div>
                    <div className="text-right">
                      <p className="text-sm font-medium text-cyan-400">{formatCurrency(opp.ceiling)}</p>
                      <p className="text-xs text-slate-500">{opp.win_probability || 0}% pWin</p>
                    </div>
                  </div>
                ))}
              </div>
            </Card>
            
            <Card className="p-6">
              <h3 className="text-lg font-semibold text-white mb-4">Compliance Status</h3>
              <div className="space-y-3">
                {compliance.slice(0, 5).map((req, i) => (
                  <div key={req.id || i} className="flex items-center justify-between py-2 border-b border-slate-700/50 last:border-0">
                    <div className="flex items-center gap-3">
                      <span className={`w-2 h-2 rounded-full ${req.status === 'compliant' ? 'bg-emerald-400' : req.status === 'pending' ? 'bg-amber-400' : 'bg-red-400'}`}></span>
                      <p className="text-sm font-medium text-white">{req.requirement || req.name}</p>
                    </div>
                    <Badge variant={req.risk_level === 'high' ? 'danger' : req.risk_level === 'medium' ? 'warning' : 'success'}>
                      {req.risk_level || 'low'}
                    </Badge>
                  </div>
                ))}
              </div>
            </Card>
          </div>
        </div>
      );
    }
    
    // ============================================================
    // PIPELINE MODULE
    // ============================================================
    function PipelineModule({ opportunities, stats }) {
      return (
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-white">Pipeline Intel</h2>
              <p className="text-slate-400">Track and manage your opportunity pipeline</p>
            </div>
            <Badge variant="success">{opportunities.length} opportunities â€¢ {formatCurrency(stats.totalValue)}</Badge>
          </div>
          
          <Card className="overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-800/50">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Opportunity</th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Agency</th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider">Ceiling</th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider">Win Prob</th>
                    <th className="px-6 py-4 text-center text-xs font-semibold text-slate-400 uppercase tracking-wider">Phase</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-700/50">
                  {opportunities.map((opp, i) => (
                    <tr key={opp.id || i} className="hover:bg-slate-800/30 transition-colors">
                      <td className="px-6 py-4">
                        <p className="font-medium text-white">{opp.title || opp.name}</p>
                        <p className="text-sm text-slate-500">{opp.nickname}</p>
                      </td>
                      <td className="px-6 py-4 text-slate-300">{opp.agency || 'N/A'}</td>
                      <td className="px-6 py-4 text-right font-medium text-cyan-400">{formatCurrency(opp.ceiling)}</td>
                      <td className="px-6 py-4 text-right">
                        <span className={`font-medium ${opp.win_probability >= 60 ? 'text-emerald-400' : opp.win_probability >= 40 ? 'text-amber-400' : 'text-red-400'}`}>
                          {opp.win_probability || 0}%
                        </span>
                      </td>
                      <td className="px-6 py-4 text-center">
                        <Badge variant={opp.shipley_phase === 'submitted' ? 'success' : 'default'}>
                          {opp.shipley_phase || 'gate_1'}
                        </Badge>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>
        </div>
      );
    }
    
    // ============================================================
    // WAR ROOM MODULE
    // ============================================================
    function WarRoomModule({ competitors }) {
      return (
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-white">War Room</h2>
              <p className="text-slate-400">Competitive intelligence and threat analysis</p>
            </div>
            <Badge variant="info">{competitors.length} competitors tracked</Badge>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {competitors.map((comp, i) => (
              <Card key={comp.id || i} className="p-6">
                <div className="flex items-center justify-between mb-4">
                  <div className="w-12 h-12 rounded-xl bg-slate-700 flex items-center justify-center text-xl font-bold text-white">
                    {(comp.name || 'C')[0]}
                  </div>
                  <Badge variant={comp.threat_level === 'critical' ? 'danger' : comp.threat_level === 'high' ? 'warning' : 'default'}>
                    {comp.threat_level || 'low'} threat
                  </Badge>
                </div>
                <h3 className="font-semibold text-white mb-2">{comp.name}</h3>
                <div className="space-y-2 text-sm">
                  <div className="flex justify-between">
                    <span className="text-slate-400">Est. pWin</span>
                    <span className="text-slate-300">{comp.estimated_pwin || 0}%</span>
                  </div>
                  <div>
                    <span className="text-slate-400">Strength: </span>
                    <span className="text-emerald-400">{comp.strength || 'Unknown'}</span>
                  </div>
                  <div>
                    <span className="text-slate-400">Weakness: </span>
                    <span className="text-red-400">{comp.weakness || 'Unknown'}</span>
                  </div>
                </div>
                {comp.is_incumbent && <Badge variant="warning" className="mt-3">Incumbent</Badge>}
              </Card>
            ))}
          </div>
        </div>
      );
    }
    
    // ============================================================
    // COMPLIANCE MODULE
    // ============================================================
    function ComplianceModule({ requirements }) {
      const compliantCount = requirements.filter(r => r.status === 'compliant').length;
      const score = requirements.length > 0 ? Math.round((compliantCount / requirements.length) * 100) : 0;
      
      return (
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-white">Iron Dome</h2>
              <p className="text-slate-400">Compliance tracking and risk management</p>
            </div>
            <div className="text-right">
              <p className="text-3xl font-bold text-emerald-400">{score}%</p>
              <p className="text-sm text-slate-400">Compliance Score</p>
            </div>
          </div>
          
          <Card className="overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-800/50">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Requirement</th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Category</th>
                    <th className="px-6 py-4 text-center text-xs font-semibold text-slate-400 uppercase tracking-wider">Risk</th>
                    <th className="px-6 py-4 text-center text-xs font-semibold text-slate-400 uppercase tracking-wider">Status</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-700/50">
                  {requirements.map((req, i) => (
                    <tr key={req.id || i} className="hover:bg-slate-800/30 transition-colors">
                      <td className="px-6 py-4">
                        <p className="font-medium text-white">{req.requirement}</p>
                        <p className="text-sm text-slate-500">{req.section}</p>
                      </td>
                      <td className="px-6 py-4 text-slate-300">{req.category}</td>
                      <td className="px-6 py-4 text-center">
                        <Badge variant={req.risk_level === 'high' ? 'danger' : req.risk_level === 'medium' ? 'warning' : 'success'}>
                          {req.risk_level}
                        </Badge>
                      </td>
                      <td className="px-6 py-4 text-center">
                        {req.status === 'compliant' ? (
                          <Icon name="check" className="w-5 h-5 text-emerald-400 mx-auto" />
                        ) : (
                          <Icon name="alert" className="w-5 h-5 text-amber-400 mx-auto" />
                        )}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>
        </div>
      );
    }
    
    // ============================================================
    // PRICING MODULE
    // ============================================================
    function PricingModule({ teamMembers }) {
      const totalCost = teamMembers.reduce((sum, m) => sum + ((m.hourly_rate || 0) * 2080), 0);
      
      return (
        <div className="space-y-6">
          <div className="flex items-center justify-between">
            <div>
              <h2 className="text-2xl font-bold text-white">Pricing Studio</h2>
              <p className="text-slate-400">BOE development and labor rate management</p>
            </div>
            <div className="text-right">
              <p className="text-2xl font-bold text-cyan-400">{formatCurrency(totalCost)}</p>
              <p className="text-sm text-slate-400">Annual Labor Cost</p>
            </div>
          </div>
          
          <Card className="overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-slate-800/50">
                  <tr>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Team Member</th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">Role</th>
                    <th className="px-6 py-4 text-left text-xs font-semibold text-slate-400 uppercase tracking-wider">LCAT</th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider">Hourly Rate</th>
                    <th className="px-6 py-4 text-right text-xs font-semibold text-slate-400 uppercase tracking-wider">Annual Cost</th>
                  </tr>
                </thead>
                <tbody className="divide-y divide-slate-700/50">
                  {teamMembers.map((member, i) => (
                    <tr key={member.id || i} className="hover:bg-slate-800/30 transition-colors">
                      <td className="px-6 py-4">
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center text-sm font-medium text-white">
                            {(member.name || 'U')[0]}
                          </div>
                          <span className="font-medium text-white">{member.name}</span>
                        </div>
                      </td>
                      <td className="px-6 py-4 text-slate-300">{member.role}</td>
                      <td className="px-6 py-4 text-slate-300">{member.lcat}</td>
                      <td className="px-6 py-4 text-right text-slate-300">${member.hourly_rate || 0}/hr</td>
                      <td className="px-6 py-4 text-right font-medium text-cyan-400">
                        {formatCurrency((member.hourly_rate || 0) * 2080)}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </Card>
        </div>
      );
    }
    
    // ============================================================
    // RENDER
    // ============================================================
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
