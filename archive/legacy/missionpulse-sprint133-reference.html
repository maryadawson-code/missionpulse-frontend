<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Reference Library</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-up { animation: fadeInUp 0.5s ease-out forwards; }
    .glass-card { background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0, 229, 250, 0.2); }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="supabase-client.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const ROLES_ALLOWED = ['CEO','COO','CAP','PM','SA','FIN','CON','DEL','QA','Partner','Admin'];

    const DEMO_REFS = [
      { id: 'REF-001', title: 'FHIR Integration Technical Approach', category: 'Technical', type: 'Boilerplate', agency: 'DHA', lastUsed: '2025-01-15', useCount: 8, rating: 4.5, wordCount: 1250, tags: ['FHIR', 'HL7', 'Interoperability', 'MHS GENESIS'], status: 'approved' },
      { id: 'REF-002', title: 'CMMC Level 2 Compliance Narrative', category: 'Security', type: 'Compliance', agency: 'DoD', lastUsed: '2025-02-01', useCount: 12, rating: 4.8, wordCount: 890, tags: ['CMMC', 'NIST 800-171', 'CUI'], status: 'approved' },
      { id: 'REF-003', title: 'Agile Development Management Approach', category: 'Management', type: 'Boilerplate', agency: 'Multi', lastUsed: '2024-12-20', useCount: 15, rating: 4.2, wordCount: 2100, tags: ['Agile', 'SAFe', 'DevSecOps', 'CI/CD'], status: 'approved' },
      { id: 'REF-004', title: 'Past Performance - DHA EHR Migration', category: 'Past Performance', type: 'Past Perf', agency: 'DHA', lastUsed: '2025-01-28', useCount: 5, rating: 4.7, wordCount: 650, tags: ['EHR', 'Migration', 'DHA', 'CPAR Exceptional'], status: 'approved' },
      { id: 'REF-005', title: 'AI/ML Governance Framework', category: 'Technical', type: 'Boilerplate', agency: 'DoD', lastUsed: '2025-02-10', useCount: 3, rating: 3.9, wordCount: 1800, tags: ['AI', 'ML', 'ATO', 'FedRAMP', 'AskSage'], status: 'draft' },
      { id: 'REF-006', title: 'Section 508 Accessibility Statement', category: 'Compliance', type: 'Compliance', agency: 'Multi', lastUsed: '2024-11-15', useCount: 20, rating: 4.0, wordCount: 420, tags: ['508', 'WCAG', 'Accessibility'], status: 'approved' },
      { id: 'REF-007', title: 'Transition-In Plan Template', category: 'Management', type: 'Template', agency: 'Multi', lastUsed: '2025-01-05', useCount: 7, rating: 4.3, wordCount: 1650, tags: ['Transition', 'Onboarding', 'Knowledge Transfer'], status: 'approved' },
      { id: 'REF-008', title: 'SLA/KPI Performance Metrics', category: 'Management', type: 'Template', agency: 'VA', lastUsed: '2024-10-22', useCount: 9, rating: 4.1, wordCount: 780, tags: ['SLA', 'KPI', 'Metrics', 'QASP'], status: 'needs_update' },
    ];

    const CATEGORIES = ['All', 'Technical', 'Management', 'Security', 'Compliance', 'Past Performance'];

    const App = () => {
      const [refs, setRefs] = useState(DEMO_REFS);
      const [search, setSearch] = useState('');
      const [category, setCategory] = useState('All');
      const [expandedId, setExpandedId] = useState(null);
      const [connected, setConnected] = useState(false);

      useEffect(() => {
        const role = localStorage.getItem('missionpulse_role');
        if (role && !ROLES_ALLOWED.includes(role)) { window.location.href = 'index.html'; return; }
        const load = async () => {
          try {
            if (typeof sbClient !== 'undefined') {
              const { data } = await sbClient.from('reference_library').select('*');
              if (data?.length) { setRefs(data); setConnected(true); }
            }
          } catch (e) {}
        };
        load();
      }, []);

      const filtered = refs
        .filter(r => category === 'All' || r.category === category)
        .filter(r => !search || r.title.toLowerCase().includes(search.toLowerCase()) || r.tags.some(t => t.toLowerCase().includes(search.toLowerCase())));

      return React.createElement('div', { className: 'min-h-screen p-6', style: { background: '#00050F' } },
        React.createElement('div', { className: 'flex items-center justify-between mb-6' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'text-2xl font-bold text-white' }, 'üìö Reference Library'),
            React.createElement('p', { className: 'text-gray-400 text-sm mt-1' }, 'Reusable content ‚Ä¢ Boilerplates ‚Ä¢ Past performance ‚Ä¢ Templates')
          ),
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement('div', { className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs', style: { background: connected ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)', color: connected ? '#10B981' : '#F59E0B', border: `1px solid ${connected ? 'rgba(16,185,129,0.3)' : 'rgba(245,158,11,0.3)'}` } },
              React.createElement('span', { className: `w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-yellow-500'}` }), connected ? 'Supabase Connected' : 'Demo Mode'
            ),
            React.createElement('a', { href: 'index.html', className: 'px-3 py-1.5 rounded-lg text-xs text-gray-400 hover:text-white', style: { border: '1px solid rgba(255,255,255,0.1)' } }, '‚Üê Dashboard')
          )
        ),

        React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-6' },
          [
            { label: 'Total References', value: refs.length, color: '#00E5FA' },
            { label: 'Approved', value: refs.filter(r => r.status === 'approved').length, color: '#10B981' },
            { label: 'Total Reuses', value: refs.reduce((s, r) => s + r.useCount, 0), color: '#818CF8' },
            { label: 'Avg Rating', value: (refs.reduce((s, r) => s + r.rating, 0) / refs.length).toFixed(1), color: '#F59E0B' }
          ].map((s, i) =>
            React.createElement('div', { key: i, className: 'glass-card rounded-lg p-4 text-center animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'font-mono text-2xl font-bold', style: { color: s.color } }, s.value),
              React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, s.label)
            )
          )
        ),

        React.createElement('div', { className: 'flex gap-3 mb-6 flex-wrap' },
          React.createElement('input', { type: 'text', placeholder: 'Search by title, tag, keyword...', className: 'flex-1 bg-gray-900 border border-gray-700 rounded-lg px-4 py-2 text-white text-sm focus:border-cyan-400 focus:outline-none', value: search, onChange: e => setSearch(e.target.value) }),
          CATEGORIES.map(c =>
            React.createElement('button', { key: c, className: `px-3 py-2 rounded-lg text-xs font-medium transition-all ${category === c ? 'text-white' : 'text-gray-400'}`, style: { background: category === c ? 'rgba(0,229,250,0.15)' : 'transparent', border: `1px solid ${category === c ? 'rgba(0,229,250,0.4)' : 'rgba(255,255,255,0.1)'}` }, onClick: () => setCategory(c) }, c)
          )
        ),

        React.createElement('div', { className: 'space-y-3 mb-8' },
          filtered.map((r, i) =>
            React.createElement('div', { key: r.id, className: 'glass-card rounded-lg overflow-hidden animate-fade-up', style: { animationDelay: `${i*0.05}s` } },
              React.createElement('div', { className: 'p-4 cursor-pointer hover:bg-white/5 transition-colors', onClick: () => setExpandedId(expandedId === r.id ? null : r.id) },
                React.createElement('div', { className: 'flex items-center justify-between' },
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs font-medium', style: { background: r.status === 'approved' ? 'rgba(16,185,129,0.15)' : r.status === 'draft' ? 'rgba(99,102,241,0.15)' : 'rgba(245,158,11,0.15)', color: r.status === 'approved' ? '#10B981' : r.status === 'draft' ? '#818CF8' : '#F59E0B' } }, r.status === 'needs_update' ? 'üîÑ Update' : r.status.charAt(0).toUpperCase() + r.status.slice(1)),
                    React.createElement('div', null,
                      React.createElement('h3', { className: 'text-white font-semibold' }, r.title),
                      React.createElement('div', { className: 'flex items-center gap-3 text-xs text-gray-400 mt-0.5' },
                        React.createElement('span', null, r.category),
                        React.createElement('span', null, `${r.wordCount} words`),
                        React.createElement('span', null, `Used ${r.useCount}x`),
                        React.createElement('span', null, `Last: ${r.lastUsed}`)
                      )
                    )
                  ),
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('div', { className: 'text-right' },
                      React.createElement('div', { className: 'text-yellow-400 text-sm' }, '‚òÖ'.repeat(Math.floor(r.rating)) + (r.rating % 1 >= 0.5 ? '¬Ω' : '')),
                      React.createElement('div', { className: 'text-xs text-gray-500 font-mono' }, r.agency)
                    ),
                    React.createElement('span', { className: 'text-gray-500' }, expandedId === r.id ? '‚ñæ' : '‚ñ∏')
                  )
                )
              ),
              expandedId === r.id && React.createElement('div', { className: 'border-t border-gray-800 p-4' },
                React.createElement('div', { className: 'flex flex-wrap gap-2 mb-3' },
                  r.tags.map(t => React.createElement('span', { key: t, className: 'px-2 py-0.5 rounded text-xs font-mono', style: { background: 'rgba(0,229,250,0.1)', color: '#00E5FA', border: '1px solid rgba(0,229,250,0.2)' } }, t))
                ),
                React.createElement('div', { className: 'bg-gray-900/50 rounded-lg p-3 mb-3' },
                  React.createElement('p', { className: 'text-gray-300 text-sm italic' }, `[Preview] This ${r.type.toLowerCase()} covers ${r.title.toLowerCase()} with ${r.wordCount} words of reusable proposal content. Click "Use in Proposal" to insert into your active proposal sections.`)
                ),
                React.createElement('div', { className: 'flex gap-2' },
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(0,229,250,0.15)', color: '#00E5FA', border: '1px solid rgba(0,229,250,0.3)' } }, 'üìã Use in Proposal'),
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(99,102,241,0.15)', color: '#818CF8', border: '1px solid rgba(99,102,241,0.3)' } }, '‚úèÔ∏è Edit Content'),
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(245,158,11,0.15)', color: '#F59E0B', border: '1px solid rgba(245,158,11,0.3)' } }, 'ü§ñ AI: Tailor for RFP'),
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(107,114,128,0.15)', color: '#9CA3AF', border: '1px solid rgba(107,114,128,0.3)' } }, 'üì§ Export')
                )
              )
            )
          )
        ),

        React.createElement('div', { className: 'text-center py-4 border-t border-gray-800' },
          React.createElement('p', { className: 'text-xs text-gray-600' }, '‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW ‚Ä¢ MissionPulse by Mission Meets Tech ‚Ä¢ NIST 800-171 Compliant')
        )
      );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
