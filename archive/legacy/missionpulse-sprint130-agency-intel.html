<!DOCTYPE html>
<html lang="en">
<head>
    <!-- FILE: missionpulse-sprint130-agency-intel.html -->
    <!-- ROLE: Admin | User -->
    <!-- SECURITY: env vars verified, no hardcoded keys -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agency Intelligence | MissionPulse</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-slate': '#0A1628',
                        'mp-dark': '#010510'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
        .gradient-border { background: linear-gradient(135deg, #00E5FA 0%, #0066FF 100%); padding: 1px; }
        .glass-card { background: rgba(10, 22, 40, 0.8); backdrop-filter: blur(10px); }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy min-h-screen text-white">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo } = React;

        // Demo Data - Agency Profiles
        const agencies = [
            {
                id: 'DHA',
                name: 'Defense Health Agency',
                acronym: 'DHA',
                parent: 'Department of Defense',
                mission: 'Unified medical program for MHS beneficiaries',
                budget: 52400000000,
                itBudget: 8200000000,
                hq: 'Falls Church, VA',
                employees: 140000,
                logo: 'üè•',
                procurementOffices: ['J-6/CIO', 'CHIO', 'Solution Delivery Division'],
                vehicles: ['ENCORE III', 'T4NG', 'OASIS+', 'ITES-3S'],
                hotButtons: ['EHR Modernization', 'Interoperability', 'Cybersecurity', 'AI/ML'],
                sentiment: 'positive'
            },
            {
                id: 'VA',
                name: 'Department of Veterans Affairs',
                acronym: 'VA',
                parent: 'Independent Agency',
                mission: 'Care for veterans and their families',
                budget: 301000000000,
                itBudget: 6800000000,
                hq: 'Washington, DC',
                employees: 412000,
                logo: 'üéñÔ∏è',
                procurementOffices: ['OIT', 'Technology Acquisition Center', 'Strategic Acquisition Center'],
                vehicles: ['T4NG', 'VETS 2', 'GSA IT Schedule 70'],
                hotButtons: ['EHRM', 'Claims Processing', 'Telehealth', 'Patient Experience'],
                sentiment: 'neutral'
            },
            {
                id: 'CMS',
                name: 'Centers for Medicare & Medicaid Services',
                acronym: 'CMS',
                parent: 'Department of Health and Human Services',
                mission: 'Health coverage for eligible Americans',
                budget: 1500000000000,
                itBudget: 4200000000,
                hq: 'Baltimore, MD',
                employees: 6700,
                logo: 'üèõÔ∏è',
                procurementOffices: ['Office of Acquisition and Grants Management', 'OAGM'],
                vehicles: ['CMS SPARC', 'HHSAR Vehicles', 'GSA Schedule'],
                hotButtons: ['Healthcare.gov', 'Data Analytics', 'Fraud Prevention', 'Interoperability'],
                sentiment: 'positive'
            },
            {
                id: 'IHS',
                name: 'Indian Health Service',
                acronym: 'IHS',
                parent: 'Department of Health and Human Services',
                mission: 'Health services to American Indians and Alaska Natives',
                budget: 8500000000,
                itBudget: 420000000,
                hq: 'Rockville, MD',
                employees: 15000,
                logo: 'ü¶Ö',
                procurementOffices: ['Division of Acquisition Policy', 'Area Offices'],
                vehicles: ['Buy Indian Act', 'GSA Schedule', 'BPA'],
                hotButtons: ['RPMS Modernization', 'Telehealth', 'EHR', 'Rural Access'],
                sentiment: 'positive'
            }
        ];

        const keyPersonnel = [
            { id: 'KP-001', name: 'Dr. Jennifer Santos', title: 'CIO', agency: 'DHA', influence: 'high', background: 'Former Oracle Health exec, Navy veteran', linkedIn: true, engagement: 'Met at HIMSS 2024' },
            { id: 'KP-002', name: 'Michael Richardson', title: 'Deputy CIO', agency: 'DHA', influence: 'high', background: '15 years federal IT, former IBM', linkedIn: true, engagement: null },
            { id: 'KP-003', name: 'Dr. Neil Evans', title: 'Acting CTO', agency: 'VA', influence: 'high', background: 'Healthcare interoperability expert', linkedIn: true, engagement: 'Industry day Q&A' },
            { id: 'KP-004', name: 'Andrea Fletcher', title: 'Contracting Officer', agency: 'VA', influence: 'medium', background: '20+ years FAR/DFARS experience', linkedIn: false, engagement: null },
            { id: 'KP-005', name: 'Rajesh Patel', title: 'Program Director', agency: 'CMS', influence: 'high', background: 'Former Deloitte, cloud transformation', linkedIn: true, engagement: 'Conference panel' },
            { id: 'KP-006', name: 'Sarah Blackwood', title: 'CISO', agency: 'DHA', influence: 'medium', background: 'NSA alum, Zero Trust pioneer', linkedIn: true, engagement: null }
        ];

        const procurementHistory = [
            { id: 'PC-001', agency: 'DHA', title: 'MHS GENESIS Support Services', vehicle: 'ENCORE III', value: 245000000, awardee: 'Leidos', date: '2024-09-15', type: 'IDIQ TO' },
            { id: 'PC-002', agency: 'VA', title: 'EHRM Infrastructure Modernization', vehicle: 'T4NG', value: 187000000, awardee: 'Oracle Cerner', date: '2024-08-22', type: 'FFP' },
            { id: 'PC-003', agency: 'DHA', title: 'Cybersecurity Operations Center', vehicle: 'ITES-3S', value: 78000000, awardee: 'Booz Allen Hamilton', date: '2024-07-10', type: 'CPFF' },
            { id: 'PC-004', agency: 'CMS', title: 'Healthcare.gov Analytics Platform', vehicle: 'CMS SPARC', value: 156000000, awardee: 'Accenture Federal', date: '2024-06-28', type: 'T&M' },
            { id: 'PC-005', agency: 'IHS', title: 'RPMS Cloud Migration', vehicle: 'GSA Schedule', value: 42000000, awardee: 'GDIT', date: '2024-11-05', type: 'FFP' },
            { id: 'PC-006', agency: 'VA', title: 'Claims Processing AI/ML', vehicle: 'VETS 2', value: 89000000, awardee: 'IBM Federal', date: '2024-10-18', type: 'IDIQ TO' }
        ];

        const buyingPatterns = {
            DHA: { q1: 320, q2: 280, q3: 410, q4: 520 },
            VA: { q1: 450, q2: 380, q3: 290, q4: 610 },
            CMS: { q1: 180, q2: 220, q3: 340, q4: 280 },
            IHS: { q1: 45, q2: 52, q3: 38, q4: 85 }
        };

        // Format currency
        const formatCurrency = (value) => {
            if (value >= 1000000000) return `$${(value / 1000000000).toFixed(1)}B`;
            if (value >= 1000000) return `$${(value / 1000000).toFixed(0)}M`;
            return `$${value.toLocaleString()}`;
        };

        // Agency Card Component
        function AgencyCard({ agency, isSelected, onSelect }) {
            const sentimentColors = {
                positive: 'border-green-500/30 bg-green-500/5',
                neutral: 'border-yellow-500/30 bg-yellow-500/5',
                negative: 'border-red-500/30 bg-red-500/5'
            };

            return (
                <div 
                    onClick={() => onSelect(agency)}
                    className={`glass-card rounded-lg border p-4 cursor-pointer transition-all ${
                        isSelected 
                            ? 'border-mp-cyan bg-mp-cyan/5' 
                            : 'border-gray-800 hover:border-gray-600'
                    }`}
                >
                    <div className="flex items-start gap-3 mb-3">
                        <div className="text-3xl">{agency.logo}</div>
                        <div className="flex-1">
                            <h3 className="font-semibold">{agency.acronym}</h3>
                            <p className="text-gray-400 text-sm">{agency.name}</p>
                        </div>
                        <div className={`px-2 py-1 rounded text-xs ${sentimentColors[agency.sentiment]}`}>
                            {agency.sentiment === 'positive' ? 'üü¢' : agency.sentiment === 'neutral' ? 'üü°' : 'üî¥'} {agency.sentiment}
                        </div>
                    </div>
                    <div className="grid grid-cols-2 gap-2 text-sm">
                        <div>
                            <span className="text-gray-500">IT Budget:</span>
                            <span className="text-mp-cyan ml-1">{formatCurrency(agency.itBudget)}</span>
                        </div>
                        <div>
                            <span className="text-gray-500">Employees:</span>
                            <span className="text-white ml-1">{agency.employees.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            );
        }

        // Key Personnel Row
        function PersonnelRow({ person }) {
            const influenceColors = {
                high: 'bg-red-500/20 text-red-400',
                medium: 'bg-yellow-500/20 text-yellow-400',
                low: 'bg-gray-500/20 text-gray-400'
            };

            return (
                <tr className="border-b border-gray-800 hover:bg-mp-slate/50 transition-colors">
                    <td className="py-3 px-4">
                        <div className="flex items-center gap-3">
                            <div className="w-10 h-10 bg-gradient-to-br from-mp-cyan/20 to-blue-600/20 rounded-full flex items-center justify-center">
                                üë§
                            </div>
                            <div>
                                <div className="font-medium">{person.name}</div>
                                <div className="text-gray-500 text-xs">{person.title}</div>
                            </div>
                        </div>
                    </td>
                    <td className="py-3 px-4 text-mp-cyan">{person.agency}</td>
                    <td className="py-3 px-4">
                        <span className={`px-2 py-1 rounded text-xs ${influenceColors[person.influence]}`}>
                            {person.influence}
                        </span>
                    </td>
                    <td className="py-3 px-4 text-gray-400 text-sm max-w-xs truncate">{person.background}</td>
                    <td className="py-3 px-4 text-center">
                        {person.linkedIn ? <span className="text-blue-400">üîó</span> : <span className="text-gray-600">‚Äî</span>}
                    </td>
                    <td className="py-3 px-4 text-sm">
                        {person.engagement ? (
                            <span className="text-green-400">{person.engagement}</span>
                        ) : (
                            <span className="text-gray-500">No contact</span>
                        )}
                    </td>
                </tr>
            );
        }

        // Procurement History Row
        function ProcurementRow({ contract }) {
            return (
                <tr className="border-b border-gray-800 hover:bg-mp-slate/50 transition-colors">
                    <td className="py-3 px-4 text-mp-cyan font-medium">{contract.agency}</td>
                    <td className="py-3 px-4">
                        <div className="font-medium text-sm">{contract.title}</div>
                        <div className="text-gray-500 text-xs">{contract.vehicle}</div>
                    </td>
                    <td className="py-3 px-4 font-mono text-sm">{formatCurrency(contract.value)}</td>
                    <td className="py-3 px-4 text-sm">{contract.awardee}</td>
                    <td className="py-3 px-4">
                        <span className="px-2 py-1 bg-gray-700 rounded text-xs">{contract.type}</span>
                    </td>
                    <td className="py-3 px-4 text-gray-400 text-sm">{contract.date}</td>
                </tr>
            );
        }

        // Spending Chart Component
        function SpendingChart({ data, agency }) {
            const agencyData = data[agency] || { q1: 0, q2: 0, q3: 0, q4: 0 };
            const maxValue = Math.max(agencyData.q1, agencyData.q2, agencyData.q3, agencyData.q4);
            
            return (
                <div className="flex items-end justify-between gap-4 h-40">
                    {['Q1', 'Q2', 'Q3', 'Q4'].map((quarter, idx) => {
                        const value = agencyData[quarter.toLowerCase()];
                        const height = (value / maxValue) * 100;
                        return (
                            <div key={quarter} className="flex-1 flex flex-col items-center">
                                <div className="text-xs text-gray-400 mb-2">${value}M</div>
                                <div className="w-full bg-gray-800 rounded-t flex-1 relative" style={{ height: '100%' }}>
                                    <div 
                                        className="absolute bottom-0 w-full bg-gradient-to-t from-mp-cyan to-blue-500 rounded-t transition-all"
                                        style={{ height: `${height}%` }}
                                    ></div>
                                </div>
                                <div className="mt-2 text-xs text-gray-500">{quarter} FY25</div>
                            </div>
                        );
                    })}
                </div>
            );
        }

        // Main App Component
        function App() {
            const [selectedAgency, setSelectedAgency] = useState(agencies[0]);
            const [activeTab, setActiveTab] = useState('profile');
            const [searchTerm, setSearchTerm] = useState('');

            const filteredPersonnel = keyPersonnel.filter(p => 
                selectedAgency ? p.agency === selectedAgency.acronym : true
            );

            const filteredContracts = procurementHistory.filter(c =>
                selectedAgency ? c.agency === selectedAgency.acronym : true
            );

            return (
                <div className="min-h-screen bg-mp-navy">
                    {/* Header */}
                    <header className="bg-mp-slate/50 border-b border-gray-800 px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="w-10 h-10 bg-gradient-to-br from-mp-cyan to-blue-600 rounded-lg flex items-center justify-center">
                                    <span className="text-xl">üèõÔ∏è</span>
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold">Agency Intelligence</h1>
                                    <p className="text-gray-400 text-sm">Profiles, Buying Patterns & Key Personnel</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <input 
                                    type="text"
                                    placeholder="Search agencies, people..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="bg-mp-slate border border-gray-700 rounded-lg px-4 py-2 text-sm focus:border-mp-cyan focus:outline-none w-64"
                                />
                                <button className="px-4 py-2 bg-mp-cyan text-mp-navy font-semibold rounded-lg hover:bg-mp-cyan/80 transition-colors">
                                    + Add Agency
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="p-6">
                        {/* Agency Cards */}
                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                            {agencies.map(agency => (
                                <AgencyCard 
                                    key={agency.id}
                                    agency={agency}
                                    isSelected={selectedAgency?.id === agency.id}
                                    onSelect={setSelectedAgency}
                                />
                            ))}
                        </div>

                        {/* Agency Detail Section */}
                        {selectedAgency && (
                            <div className="glass-card rounded-lg border border-gray-800">
                                {/* Agency Header */}
                                <div className="p-6 border-b border-gray-800">
                                    <div className="flex items-start justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className="text-5xl">{selectedAgency.logo}</div>
                                            <div>
                                                <h2 className="text-2xl font-bold">{selectedAgency.name}</h2>
                                                <p className="text-gray-400">{selectedAgency.parent}</p>
                                                <p className="text-gray-500 text-sm mt-1">üìç {selectedAgency.hq}</p>
                                            </div>
                                        </div>
                                        <div className="text-right">
                                            <div className="text-3xl font-bold text-mp-cyan">{formatCurrency(selectedAgency.itBudget)}</div>
                                            <div className="text-gray-500 text-sm">Annual IT Budget</div>
                                        </div>
                                    </div>
                                </div>

                                {/* Tabs */}
                                <div className="flex gap-2 p-4 border-b border-gray-800">
                                    {['profile', 'personnel', 'contracts', 'spending'].map(tab => (
                                        <button
                                            key={tab}
                                            onClick={() => setActiveTab(tab)}
                                            className={`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${
                                                activeTab === tab 
                                                    ? 'bg-mp-cyan text-mp-navy' 
                                                    : 'bg-gray-800 text-gray-400 hover:bg-gray-700'
                                            }`}
                                        >
                                            {tab === 'profile' && 'üìã Profile'}
                                            {tab === 'personnel' && 'üë• Key Personnel'}
                                            {tab === 'contracts' && 'üìÑ Recent Contracts'}
                                            {tab === 'spending' && 'üìä Spending Patterns'}
                                        </button>
                                    ))}
                                </div>

                                {/* Tab Content */}
                                <div className="p-6">
                                    {activeTab === 'profile' && (
                                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                            <div>
                                                <h3 className="font-semibold mb-3">Mission</h3>
                                                <p className="text-gray-400 mb-6">{selectedAgency.mission}</p>

                                                <h3 className="font-semibold mb-3">Hot Buttons</h3>
                                                <div className="flex flex-wrap gap-2 mb-6">
                                                    {selectedAgency.hotButtons.map(item => (
                                                        <span key={item} className="px-3 py-1 bg-mp-cyan/20 text-mp-cyan rounded-full text-sm">
                                                            {item}
                                                        </span>
                                                    ))}
                                                </div>

                                                <h3 className="font-semibold mb-3">Procurement Offices</h3>
                                                <ul className="space-y-2">
                                                    {selectedAgency.procurementOffices.map(office => (
                                                        <li key={office} className="flex items-center gap-2 text-gray-400">
                                                            <span className="text-mp-cyan">‚Ä¢</span> {office}
                                                        </li>
                                                    ))}
                                                </ul>
                                            </div>
                                            <div>
                                                <h3 className="font-semibold mb-3">Contract Vehicles</h3>
                                                <div className="space-y-2 mb-6">
                                                    {selectedAgency.vehicles.map(vehicle => (
                                                        <div key={vehicle} className="flex items-center justify-between p-3 bg-mp-slate rounded-lg">
                                                            <span>{vehicle}</span>
                                                            <span className="text-green-400 text-xs">Active</span>
                                                        </div>
                                                    ))}
                                                </div>

                                                <h3 className="font-semibold mb-3">Quick Stats</h3>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="p-3 bg-mp-slate rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-mp-cyan">{formatCurrency(selectedAgency.budget)}</div>
                                                        <div className="text-gray-500 text-xs">Total Budget</div>
                                                    </div>
                                                    <div className="p-3 bg-mp-slate rounded-lg text-center">
                                                        <div className="text-2xl font-bold text-green-400">{selectedAgency.employees.toLocaleString()}</div>
                                                        <div className="text-gray-500 text-xs">Employees</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    )}

                                    {activeTab === 'personnel' && (
                                        <table className="w-full">
                                            <thead className="bg-mp-slate/50">
                                                <tr className="text-left text-gray-400 text-sm">
                                                    <th className="py-3 px-4 font-medium">Name</th>
                                                    <th className="py-3 px-4 font-medium">Agency</th>
                                                    <th className="py-3 px-4 font-medium">Influence</th>
                                                    <th className="py-3 px-4 font-medium">Background</th>
                                                    <th className="py-3 px-4 font-medium text-center">LinkedIn</th>
                                                    <th className="py-3 px-4 font-medium">Engagement</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {filteredPersonnel.map(person => (
                                                    <PersonnelRow key={person.id} person={person} />
                                                ))}
                                            </tbody>
                                        </table>
                                    )}

                                    {activeTab === 'contracts' && (
                                        <table className="w-full">
                                            <thead className="bg-mp-slate/50">
                                                <tr className="text-left text-gray-400 text-sm">
                                                    <th className="py-3 px-4 font-medium">Agency</th>
                                                    <th className="py-3 px-4 font-medium">Contract</th>
                                                    <th className="py-3 px-4 font-medium">Value</th>
                                                    <th className="py-3 px-4 font-medium">Awardee</th>
                                                    <th className="py-3 px-4 font-medium">Type</th>
                                                    <th className="py-3 px-4 font-medium">Date</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                {filteredContracts.map(contract => (
                                                    <ProcurementRow key={contract.id} contract={contract} />
                                                ))}
                                            </tbody>
                                        </table>
                                    )}

                                    {activeTab === 'spending' && (
                                        <div>
                                            <h3 className="font-semibold mb-4">Quarterly IT Spending (FY2025)</h3>
                                            <SpendingChart data={buyingPatterns} agency={selectedAgency.acronym} />
                                            <div className="mt-6 p-4 bg-mp-slate rounded-lg">
                                                <h4 className="font-medium text-mp-cyan mb-2">üí° AI Insight</h4>
                                                <p className="text-gray-400 text-sm">
                                                    {selectedAgency.acronym} shows strong Q4 spending patterns, likely due to end-of-year budget execution. 
                                                    Consider timing proposals to align with Q3-Q4 procurement cycles for higher success rates.
                                                </p>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="border-t border-gray-800 px-6 py-4 mt-8">
                        <div className="flex items-center justify-between text-xs text-gray-500">
                            <span>MissionPulse v12 ‚Ä¢ Sprint 130</span>
                            <span className="text-yellow-500/70">‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW</span>
                            <span>¬© 2025 Mission Meets Tech</span>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
