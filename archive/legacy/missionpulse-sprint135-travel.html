<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Travel Manager</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    .animate-fade-up { animation: fadeInUp 0.5s ease-out forwards; }
    .glass-card { background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0, 229, 250, 0.2); }
  </style>
</head>
<body>
  <div id="root"></div>
  <script src="supabase-client.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const ROLES_ALLOWED = ['CEO','COO','CAP','PM','SA','FIN','DEL','Admin'];

    const DEMO_TRIPS = [
      { id: 'TRV-001', purpose: 'Orals Presentation - DHA EHR', destination: 'Falls Church, VA', traveler: 'Marcus Johnson', dates: '2025-03-10 to 2025-03-12', status: 'approved', cost: 2850, opportunity: 'DHA EHR Modernization', type: 'Orals' },
      { id: 'TRV-002', purpose: 'Site Visit - VA Medical Center', destination: 'Tampa, FL', traveler: 'Sarah Chen', dates: '2025-03-18 to 2025-03-19', status: 'pending', cost: 1620, opportunity: 'VA Claims Processing', type: 'Site Visit' },
      { id: 'TRV-003', purpose: 'Capture Meeting - CMS HQ', destination: 'Baltimore, MD', traveler: 'Mary Womack', dates: '2025-02-28 to 2025-03-01', status: 'approved', cost: 980, opportunity: 'CMS Data Analytics', type: 'Capture' },
      { id: 'TRV-004', purpose: 'Industry Day - IHS Telehealth', destination: 'Rockville, MD', traveler: 'David Park', dates: '2025-04-05', status: 'requested', cost: 450, opportunity: 'IHS Telehealth', type: 'Industry Day' },
      { id: 'TRV-005', purpose: 'Teaming Partner Meeting', destination: 'Reston, VA', traveler: 'Emily Rodriguez', dates: '2025-03-25', status: 'approved', cost: 320, opportunity: 'DoD JADC2', type: 'Teaming' },
      { id: 'TRV-006', purpose: 'Color Team Review (Red)', destination: 'Charlotte, NC (Remote)', traveler: 'Team (5)', dates: '2025-03-05', status: 'completed', cost: 0, opportunity: 'DHA EHR Modernization', type: 'Review' },
    ];

    const App = () => {
      const [trips, setTrips] = useState(DEMO_TRIPS);
      const [filter, setFilter] = useState('all');
      const [connected, setConnected] = useState(false);

      useEffect(() => {
        const role = localStorage.getItem('missionpulse_role');
        if (role && !ROLES_ALLOWED.includes(role)) { window.location.href = 'index.html'; return; }
        const load = async () => {
          try {
            if (typeof sbClient !== 'undefined') {
              const { data } = await sbClient.from('travel_requests').select('*');
              if (data?.length) { setTrips(data); setConnected(true); }
            }
          } catch (e) {}
        };
        load();
      }, []);

      const filtered = trips.filter(t => filter === 'all' || t.status === filter);
      const totalBudget = trips.reduce((s, t) => s + t.cost, 0);
      const approvedCost = trips.filter(t => t.status === 'approved' || t.status === 'completed').reduce((s, t) => s + t.cost, 0);

      const statusConfig = {
        approved: { bg: 'rgba(16,185,129,0.15)', color: '#10B981' },
        pending: { bg: 'rgba(245,158,11,0.15)', color: '#F59E0B' },
        requested: { bg: 'rgba(99,102,241,0.15)', color: '#818CF8' },
        completed: { bg: 'rgba(107,114,128,0.15)', color: '#9CA3AF' },
        denied: { bg: 'rgba(239,68,68,0.15)', color: '#EF4444' }
      };

      return React.createElement('div', { className: 'min-h-screen p-6', style: { background: '#00050F' } },
        React.createElement('div', { className: 'flex items-center justify-between mb-6' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'text-2xl font-bold text-white' }, '‚úàÔ∏è Travel Manager'),
            React.createElement('p', { className: 'text-gray-400 text-sm mt-1' }, 'Proposal travel ‚Ä¢ Orals prep ‚Ä¢ Site visits ‚Ä¢ Capture meetings')
          ),
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement('div', { className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs', style: { background: connected ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)', color: connected ? '#10B981' : '#F59E0B', border: `1px solid ${connected ? 'rgba(16,185,129,0.3)' : 'rgba(245,158,11,0.3)'}` } },
              React.createElement('span', { className: `w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-yellow-500'}` }), connected ? 'Supabase Connected' : 'Demo Mode'
            ),
            React.createElement('a', { href: 'index.html', className: 'px-3 py-1.5 rounded-lg text-xs text-gray-400 hover:text-white', style: { border: '1px solid rgba(255,255,255,0.1)' } }, '‚Üê Dashboard')
          )
        ),

        React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-6' },
          [
            { label: 'Total Trips', value: trips.length, color: '#00E5FA' },
            { label: 'Pending Approval', value: trips.filter(t => t.status === 'pending' || t.status === 'requested').length, color: '#F59E0B' },
            { label: 'Total Budget', value: `$${totalBudget.toLocaleString()}`, color: '#818CF8' },
            { label: 'Committed', value: `$${approvedCost.toLocaleString()}`, color: '#10B981' }
          ].map((s, i) =>
            React.createElement('div', { key: i, className: 'glass-card rounded-lg p-4 text-center animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'font-mono text-2xl font-bold', style: { color: s.color } }, s.value),
              React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, s.label)
            )
          )
        ),

        React.createElement('div', { className: 'flex gap-2 mb-6' },
          ['all', 'approved', 'pending', 'requested', 'completed'].map(f =>
            React.createElement('button', { key: f, className: `px-3 py-2 rounded-lg text-xs font-medium ${filter === f ? 'text-white' : 'text-gray-400'}`, style: { background: filter === f ? 'rgba(0,229,250,0.15)' : 'transparent', border: `1px solid ${filter === f ? 'rgba(0,229,250,0.4)' : 'rgba(255,255,255,0.1)'}` }, onClick: () => setFilter(f) },
              f === 'all' ? 'All' : f.charAt(0).toUpperCase() + f.slice(1)
            )
          )
        ),

        React.createElement('div', { className: 'space-y-3 mb-8' },
          filtered.map((t, i) => {
            const sc = statusConfig[t.status] || statusConfig.pending;
            return React.createElement('div', { key: t.id, className: 'glass-card rounded-lg p-4 animate-fade-up', style: { animationDelay: `${i*0.05}s` } },
              React.createElement('div', { className: 'flex items-center justify-between' },
                React.createElement('div', { className: 'flex items-center gap-4' },
                  React.createElement('div', { className: 'w-10 h-10 rounded-lg flex items-center justify-center text-lg', style: { background: 'rgba(0,229,250,0.1)' } },
                    t.type === 'Orals' ? 'üé§' : t.type === 'Site Visit' ? 'üè•' : t.type === 'Capture' ? 'üéØ' : t.type === 'Industry Day' ? 'üèõÔ∏è' : t.type === 'Teaming' ? 'ü§ù' : 'üìã'
                  ),
                  React.createElement('div', null,
                    React.createElement('h3', { className: 'text-white font-semibold' }, t.purpose),
                    React.createElement('div', { className: 'flex items-center gap-3 text-xs text-gray-400 mt-0.5' },
                      React.createElement('span', null, `üìç ${t.destination}`),
                      React.createElement('span', null, `üë§ ${t.traveler}`),
                      React.createElement('span', { className: 'font-mono' }, t.dates)
                    )
                  )
                ),
                React.createElement('div', { className: 'flex items-center gap-4' },
                  React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs', style: { background: 'rgba(0,229,250,0.1)', color: '#00E5FA' } }, t.opportunity),
                  React.createElement('span', { className: 'font-mono text-lg text-white' }, t.cost > 0 ? `$${t.cost.toLocaleString()}` : 'Virtual'),
                  React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs font-medium capitalize', style: { background: sc.bg, color: sc.color } }, t.status)
                )
              )
            );
          })
        ),

        React.createElement('div', { className: 'text-center py-4 border-t border-gray-800' },
          React.createElement('p', { className: 'text-xs text-gray-600' }, '‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW ‚Ä¢ MissionPulse by Mission Meets Tech ‚Ä¢ NIST 800-171 Compliant')
        )
      );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
