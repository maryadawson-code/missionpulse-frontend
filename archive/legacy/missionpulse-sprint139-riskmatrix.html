<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Risk Matrix</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; } .font-mono { font-family: 'JetBrains Mono', monospace; } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-up { animation: fadeInUp 0.5s ease-out forwards; } .glass-card { background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0, 229, 250, 0.2); }</style>
</head>
<body>
  <div id="root"></div>
  <script src="supabase-client.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const ROLES_ALLOWED = ['CEO','COO','CAP','PM','SA','FIN','CON','DEL','QA','Admin'];
    const DEMO_RISKS = [
      { id: 'RSK-001', title: 'Key Personnel Availability', category: 'Staffing', probability: 'High', impact: 'Critical', score: 20, mitigation: 'Identified 2 backup candidates with equivalent qualifications', owner: 'Mary Womack', status: 'mitigated', opportunity: 'DHA EHR Modernization' },
      { id: 'RSK-002', title: 'Subcontractor Performance', category: 'Teaming', probability: 'Medium', impact: 'High', score: 12, mitigation: 'Monthly performance reviews, SLA enforcement in teaming agreement', owner: 'Marcus Johnson', status: 'monitoring', opportunity: 'DHA EHR Modernization' },
      { id: 'RSK-003', title: 'RFP Requirements Change', category: 'Technical', probability: 'Medium', impact: 'Medium', score: 9, mitigation: 'Modular architecture allows rapid pivot. Amendment tracking active.', owner: 'Sarah Chen', status: 'monitoring', opportunity: 'VA Claims Processing' },
      { id: 'RSK-004', title: 'Budget Overrun (B&P)', category: 'Financial', probability: 'Low', impact: 'High', score: 8, mitigation: 'Weekly burn rate tracking. Contingency reserve at 15%.', owner: 'Mary Womack', status: 'mitigated', opportunity: 'CMS Data Analytics' },
      { id: 'RSK-005', title: 'Security Clearance Delays', category: 'Staffing', probability: 'High', impact: 'Medium', score: 15, mitigation: 'Interim clearance path identified. Backup cleared staff available.', owner: 'Emily Rodriguez', status: 'active', opportunity: 'DoD JADC2' },
      { id: 'RSK-006', title: 'Competitor Underbid', category: 'Competitive', probability: 'High', impact: 'High', score: 16, mitigation: 'LPTA analysis complete. Technical differentiation strategy in win themes.', owner: 'Mary Womack', status: 'active', opportunity: 'VA Claims Processing' },
      { id: 'RSK-007', title: 'CMMC Certification Timeline', category: 'Compliance', probability: 'Low', impact: 'Critical', score: 10, mitigation: 'Pre-assessment scheduled Q2. POA&M items tracked in Iron Dome.', owner: 'Emily Rodriguez', status: 'monitoring', opportunity: 'All' },
    ];

    const GRID_CELLS = [
      { prob: 'Very High', impacts: ['Low', 'Medium', 'High', 'Critical'] },
      { prob: 'High', impacts: ['Low', 'Medium', 'High', 'Critical'] },
      { prob: 'Medium', impacts: ['Low', 'Medium', 'High', 'Critical'] },
      { prob: 'Low', impacts: ['Low', 'Medium', 'High', 'Critical'] },
    ];

    const riskColor = (score) => score >= 15 ? '#EF4444' : score >= 10 ? '#F59E0B' : score >= 5 ? '#00E5FA' : '#10B981';
    const statusConfig = { active: { bg: 'rgba(239,68,68,0.15)', color: '#EF4444' }, monitoring: { bg: 'rgba(245,158,11,0.15)', color: '#F59E0B' }, mitigated: { bg: 'rgba(16,185,129,0.15)', color: '#10B981' }, closed: { bg: 'rgba(107,114,128,0.15)', color: '#9CA3AF' } };

    const App = () => {
      const [risks, setRisks] = useState(DEMO_RISKS);
      const [filter, setFilter] = useState('all');
      const [view, setView] = useState('list');
      const [connected, setConnected] = useState(false);

      useEffect(() => {
        const role = localStorage.getItem('missionpulse_role');
        if (role && !ROLES_ALLOWED.includes(role)) { window.location.href = 'index.html'; return; }
        const load = async () => { try { if (typeof sbClient !== 'undefined') { const { data } = await sbClient.from('risk_register').select('*'); if (data?.length) { setRisks(data); setConnected(true); } } } catch (e) {} };
        load();
      }, []);

      const filtered = risks.filter(r => filter === 'all' || r.status === filter);
      const criticalCount = risks.filter(r => r.score >= 15).length;

      return React.createElement('div', { className: 'min-h-screen p-6', style: { background: '#00050F' } },
        React.createElement('div', { className: 'flex items-center justify-between mb-6' },
          React.createElement('div', null,
            React.createElement('h1', { className: 'text-2xl font-bold text-white' }, '⚡ Risk Matrix'),
            React.createElement('p', { className: 'text-gray-400 text-sm mt-1' }, 'Risk scoring • Mitigation tracking • Probability × Impact')
          ),
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement('div', { className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs', style: { background: connected ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)', color: connected ? '#10B981' : '#F59E0B', border: `1px solid ${connected ? 'rgba(16,185,129,0.3)' : 'rgba(245,158,11,0.3)'}` } },
              React.createElement('span', { className: `w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-yellow-500'}` }), connected ? 'Connected' : 'Demo Mode'
            ),
            React.createElement('a', { href: 'index.html', className: 'px-3 py-1.5 rounded-lg text-xs text-gray-400 hover:text-white', style: { border: '1px solid rgba(255,255,255,0.1)' } }, '← Dashboard')
          )
        ),

        React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-6' },
          [
            { label: 'Total Risks', value: risks.length, color: '#00E5FA' },
            { label: 'Critical (15+)', value: criticalCount, color: criticalCount > 0 ? '#EF4444' : '#10B981' },
            { label: 'Active', value: risks.filter(r => r.status === 'active').length, color: '#F59E0B' },
            { label: 'Mitigated', value: risks.filter(r => r.status === 'mitigated').length, color: '#10B981' }
          ].map((s, i) =>
            React.createElement('div', { key: i, className: 'glass-card rounded-lg p-4 text-center animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'font-mono text-2xl font-bold', style: { color: s.color } }, s.value),
              React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, s.label)
            )
          )
        ),

        React.createElement('div', { className: 'flex gap-2 mb-6' },
          ['all', 'active', 'monitoring', 'mitigated'].map(f =>
            React.createElement('button', { key: f, className: `px-3 py-2 rounded-lg text-xs font-medium ${filter === f ? 'text-white' : 'text-gray-400'}`, style: { background: filter === f ? 'rgba(0,229,250,0.15)' : 'transparent', border: `1px solid ${filter === f ? 'rgba(0,229,250,0.4)' : 'rgba(255,255,255,0.1)'}` }, onClick: () => setFilter(f) },
              f === 'all' ? 'All' : f.charAt(0).toUpperCase() + f.slice(1)
            )
          )
        ),

        React.createElement('div', { className: 'space-y-3 mb-8' },
          filtered.sort((a, b) => b.score - a.score).map((r, i) => {
            const sc = statusConfig[r.status] || statusConfig.monitoring;
            return React.createElement('div', { key: r.id, className: 'glass-card rounded-lg p-4 animate-fade-up', style: { animationDelay: `${i*0.05}s`, borderLeftWidth: '3px', borderLeftColor: riskColor(r.score) } },
              React.createElement('div', { className: 'flex items-center justify-between mb-2' },
                React.createElement('div', { className: 'flex items-center gap-3' },
                  React.createElement('span', { className: 'font-mono text-2xl font-bold', style: { color: riskColor(r.score) } }, r.score),
                  React.createElement('div', null,
                    React.createElement('h3', { className: 'text-white font-semibold' }, r.title),
                    React.createElement('div', { className: 'flex items-center gap-3 text-xs text-gray-400 mt-0.5' },
                      React.createElement('span', null, r.category),
                      React.createElement('span', null, `P: ${r.probability}`),
                      React.createElement('span', null, `I: ${r.impact}`),
                      React.createElement('span', null, r.opportunity)
                    )
                  )
                ),
                React.createElement('div', { className: 'flex items-center gap-3' },
                  React.createElement('span', { className: 'text-xs text-cyan-400' }, r.owner),
                  React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs font-medium capitalize', style: { background: sc.bg, color: sc.color } }, r.status)
                )
              ),
              React.createElement('div', { className: 'bg-gray-900/50 rounded px-3 py-2' },
                React.createElement('span', { className: 'text-xs text-gray-500' }, 'Mitigation: '),
                React.createElement('span', { className: 'text-xs text-gray-300' }, r.mitigation)
              )
            );
          })
        ),

        React.createElement('div', { className: 'text-center py-4 border-t border-gray-800' },
          React.createElement('p', { className: 'text-xs text-gray-600' }, '⚠️ AI GENERATED - REQUIRES HUMAN REVIEW • MissionPulse by Mission Meets Tech • NIST 800-171 Compliant')
        )
      );
    };
    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
