<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S137 - Budget Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}body{font-family:'Space Grotesk',sans-serif;background:#00050F;min-height:100vh}.font-mono{font-family:'JetBrains Mono',monospace}@keyframes slideIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}@keyframes barFill{from{width:0%}}.animate-slide-in{animation:slideIn .4s ease-out forwards}.animate-pulse{animation:pulse 2s ease-in-out infinite}.animate-bar{animation:barFill .8s ease-out forwards}.glass-card{background:linear-gradient(135deg,rgba(15,23,42,.9) 0%,rgba(15,23,42,.7) 100%);backdrop-filter:blur(10px);border:1px solid rgba(0,229,250,.15)}.glass-card:hover{border-color:rgba(0,229,250,.3)}
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const{useState,useEffect}=React;
    const SUPABASE_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;try{sbClient=supabase.createClient(SUPABASE_URL,SUPABASE_KEY)}catch(e){sbClient=null}

    const Icons={
      dollar:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>,
      trending:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>,
      shield:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
      alert:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/></svg>,
      zap:()=><svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>,
    };
    const Icon=({name,className="w-4 h-4"})=>{const C=Icons[name];return C?<span className={`inline-block ${className}`}><C/></span>:null};

    const BP_BUDGET={annual:850000,spent:482000,committed:125000,remaining:243000};
    const MONTHLY_BURN=[
      {month:'Aug',bp:52000,capture:18000},{month:'Sep',bp:61000,capture:22000},{month:'Oct',bp:75000,capture:28000},
      {month:'Nov',bp:68000,capture:25000},{month:'Dec',bp:58000,capture:20000},{month:'Jan',bp:82000,capture:35000},{month:'Feb',bp:86000,capture:32000},
    ];

    const OPP_INVESTMENTS=[
      {id:1,name:'DHA EHR Modernization',value:47000000,invested:185000,outcome:'win',roi:253.9,categories:{labor:120000,travel:25000,tools:15000,consultants:25000}},
      {id:2,name:'VA Claims Processing AI',value:23000000,invested:95000,outcome:'loss',roi:-100,categories:{labor:65000,travel:12000,tools:8000,consultants:10000}},
      {id:3,name:'CMS Data Analytics',value:15500000,invested:72000,outcome:'win',roi:214.2,categories:{labor:48000,travel:8000,tools:6000,consultants:10000}},
      {id:4,name:'IHS Telehealth',value:8200000,invested:45000,outcome:'loss',roi:-100,categories:{labor:30000,travel:8000,tools:3000,consultants:4000}},
      {id:5,name:'DoD Advana Expansion',value:125000000,invested:128000,outcome:'pursuing',roi:null,categories:{labor:85000,travel:15000,tools:12000,consultants:16000}},
    ];

    const ConnectionIndicator=({connected})=>(
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{background:connected?'rgba(0,255,136,0.1)':'rgba(255,184,0,0.1)',border:`1px solid ${connected?'rgba(0,255,136,0.3)':'rgba(255,184,0,0.3)'}`}}>
        <div className={`w-2 h-2 rounded-full ${connected?'bg-green-400':'bg-amber-400 animate-pulse'}`}/>
        <span style={{color:connected?'#00ff88':'#ffb800'}}>{connected?'LIVE':'DEMO'}</span>
      </div>
    );

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[userRole]=useState('CEO');

      useEffect(()=>{const a=['CEO','COO','FIN','Admin'];if(!a.includes(userRole))return},[userRole]);
      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data}=await sbClient.from('opportunities').select('id').limit(1);if(data)setConnected(true)}catch(e){}})()},[]);

      const fmt=(n)=>n>=1000000?`$${(n/1000000).toFixed(1)}M`:`$${(n/1000).toFixed(0)}K`;
      const pct=(a,b)=>b>0?Math.round((a/b)*100):0;
      const wins=OPP_INVESTMENTS.filter(o=>o.outcome==='win');
      const losses=OPP_INVESTMENTS.filter(o=>o.outcome==='loss');
      const winInvested=wins.reduce((s,o)=>s+o.invested,0);
      const lossInvested=losses.reduce((s,o)=>s+o.invested,0);
      const avgROI=wins.length?Math.round(wins.reduce((s,o)=>s+o.roi,0)/wins.length):0;
      const maxBurn=Math.max(...MONTHLY_BURN.map(m=>m.bp+m.capture));

      return(
        <div className="min-h-screen" style={{background:'#00050F'}}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div><div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Budget Tracker</h1><ConnectionIndicator connected={connected}/></div>
              <p className="text-sm text-slate-400">B&P spend, capture investment, ROI per opportunity & burn rate</p></div>
            </div>

            {/* Top KPIs */}
            <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-6">
              {[
                {label:'Annual B&P',value:fmt(BP_BUDGET.annual),color:'#00E5FA'},
                {label:'Spent YTD',value:fmt(BP_BUDGET.spent),color:'#ffb800',sub:`${pct(BP_BUDGET.spent,BP_BUDGET.annual)}% of budget`},
                {label:'Committed',value:fmt(BP_BUDGET.committed),color:'#a78bfa'},
                {label:'Remaining',value:fmt(BP_BUDGET.remaining),color:'#00ff88'},
                {label:'Avg Win ROI',value:`${avgROI}x`,color:'#f472b6'},
              ].map((k,i)=>(
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{animationDelay:`${i*.05}s`}}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-xl font-mono font-bold mt-1" style={{color:k.color}}>{k.value}</div>
                  {k.sub&&<span className="text-xs text-slate-500">{k.sub}</span>}
                </div>
              ))}
            </div>

            {/* Budget utilization bar */}
            <div className="glass-card rounded-xl p-6 mb-6 animate-slide-in">
              <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">B&P BUDGET UTILIZATION</h3>
              <div className="h-6 rounded-full bg-slate-700/30 overflow-hidden flex">
                <div className="h-full bg-amber-500/60 animate-bar" style={{width:`${pct(BP_BUDGET.spent,BP_BUDGET.annual)}%`}}/>
                <div className="h-full bg-purple-500/40" style={{width:`${pct(BP_BUDGET.committed,BP_BUDGET.annual)}%`}}/>
              </div>
              <div className="flex items-center gap-6 mt-2">
                <span className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded bg-amber-500/60"/>Spent ({pct(BP_BUDGET.spent,BP_BUDGET.annual)}%)</span>
                <span className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded bg-purple-500/40"/>Committed ({pct(BP_BUDGET.committed,BP_BUDGET.annual)}%)</span>
                <span className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded bg-slate-700/30"/>Remaining ({pct(BP_BUDGET.remaining,BP_BUDGET.annual)}%)</span>
              </div>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
              {/* Monthly Burn */}
              <div className="glass-card rounded-xl p-6">
                <h3 className="text-sm font-mono font-bold text-cyan-400 mb-4">MONTHLY BURN RATE</h3>
                <div className="flex items-end gap-2 justify-between" style={{height:140}}>
                  {MONTHLY_BURN.map((m,i)=>(
                    <div key={i} className="flex flex-col items-center gap-1 flex-1">
                      <span className="text-xs font-mono text-slate-400">${((m.bp+m.capture)/1000).toFixed(0)}K</span>
                      <div className="w-full flex flex-col gap-0.5">
                        <div className="w-full rounded-t" style={{height:`${(m.bp/maxBurn)*100}px`,background:'rgba(0,229,250,0.5)'}}/>
                        <div className="w-full rounded-b" style={{height:`${(m.capture/maxBurn)*100}px`,background:'rgba(167,139,250,0.5)'}}/>
                      </div>
                      <span className="text-xs text-slate-500 font-mono">{m.month}</span>
                    </div>
                  ))}
                </div>
                <div className="flex items-center gap-4 mt-3 pt-3 border-t border-slate-700/30">
                  <span className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded bg-cyan-500/50"/>B&P</span>
                  <span className="flex items-center gap-1.5 text-xs text-slate-500"><div className="w-3 h-3 rounded bg-purple-500/50"/>Capture</span>
                </div>
              </div>

              {/* Win/Loss Investment */}
              <div className="glass-card rounded-xl p-6">
                <h3 className="text-sm font-mono font-bold text-cyan-400 mb-4">INVESTMENT OUTCOME</h3>
                <div className="grid grid-cols-2 gap-4 mb-4">
                  <div className="p-4 rounded-lg bg-green-500/5 border border-green-500/20 text-center">
                    <div className="text-xl font-mono font-bold text-green-400">{fmt(winInvested)}</div>
                    <div className="text-xs text-slate-500 mt-1">Won ({wins.length} opps)</div>
                    <div className="text-sm font-mono text-green-400 mt-1">{avgROI}x avg ROI</div>
                  </div>
                  <div className="p-4 rounded-lg bg-red-500/5 border border-red-500/20 text-center">
                    <div className="text-xl font-mono font-bold text-red-400">{fmt(lossInvested)}</div>
                    <div className="text-xs text-slate-500 mt-1">Lost ({losses.length} opps)</div>
                    <div className="text-sm font-mono text-red-400 mt-1">-100% ROI</div>
                  </div>
                </div>
                <div className="pt-3 border-t border-slate-700/30 flex justify-between">
                  <span className="text-xs text-slate-500">Net B&P efficiency</span>
                  <span className="text-sm font-mono font-bold text-green-400">{Math.round(winInvested/(winInvested+lossInvested)*100)}% win-invested</span>
                </div>
              </div>
            </div>

            {/* Per-Opportunity ROI */}
            <div className="glass-card rounded-xl overflow-hidden animate-slide-in">
              <div className="p-4 border-b border-slate-700/30"><h3 className="text-sm font-mono font-bold text-cyan-400">INVESTMENT PER OPPORTUNITY</h3></div>
              <div className="divide-y divide-slate-700/10">
                {OPP_INVESTMENTS.map((o,i)=>(
                  <div key={o.id} className="flex items-center justify-between px-5 py-4 hover:bg-slate-800/20 transition">
                    <div className="flex items-center gap-4">
                      <span className={`px-2 py-0.5 rounded text-xs font-mono font-bold ${o.outcome==='win'?'bg-green-500/15 text-green-400':o.outcome==='loss'?'bg-red-500/15 text-red-400':'bg-cyan-500/15 text-cyan-400'}`}>{o.outcome.toUpperCase()}</span>
                      <div>
                        <span className="text-sm text-white font-medium">{o.name}</span>
                        <span className="text-xs text-slate-500 ml-2">{fmt(o.value)} contract</span>
                      </div>
                    </div>
                    <div className="flex items-center gap-6">
                      <div className="text-right"><span className="text-sm font-mono text-amber-400">{fmt(o.invested)}</span><div className="text-xs text-slate-500">invested</div></div>
                      <div className="w-32">
                        <div className="flex gap-1">
                          {Object.entries(o.categories).map(([k,v])=>{
                            const colors={labor:'#00E5FA',travel:'#a78bfa',tools:'#00ff88',consultants:'#ffb800'};
                            return <div key={k} className="h-2 rounded" style={{width:`${(v/o.invested)*100}%`,background:colors[k]||'#64748b'}}/>;
                          })}
                        </div>
                      </div>
                      <div className="text-right w-16">
                        {o.roi!==null?<span className={`text-sm font-mono font-bold ${o.roi>0?'text-green-400':'text-red-400'}`}>{o.roi>0?`${o.roi.toFixed(0)}x`:'-100%'}</span>:<span className="text-xs text-slate-500 font-mono">TBD</span>}
                        <div className="text-xs text-slate-500">ROI</div>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>

            <div className="mt-8 text-center"><div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20"><Icon name="shield" className="w-3.5 h-3.5 text-amber-500"/><span className="text-xs text-amber-500/80 font-mono">AI GENERATED â€” REQUIRES HUMAN REVIEW</span></div></div>
          </div>
        </div>
      );
    };
    ReactDOM.render(<App/>,document.getElementById('root'));
  </script>
</body>
</html>
