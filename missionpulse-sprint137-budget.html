<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Budget Tracker</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; } .font-mono { font-family: 'JetBrains Mono', monospace; } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } .animate-fade-up { animation: fadeInUp 0.5s ease-out forwards; } .glass-card { background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0, 229, 250, 0.2); }</style>
</head>
<body>
  <div id="root"></div>
  <script src="supabase-client.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;
    const ROLES_ALLOWED = ['CEO','COO','CAP','PM','FIN','Admin'];

    const DEMO_BUDGETS = [
      { id: 'BUD-001', opportunity: 'DHA EHR Modernization', totalBudget: 85000, spent: 52300, categories: [
        { name: 'Labor (Internal)', budget: 45000, spent: 31200, items: ['Proposal Manager - 120hrs', 'SA - 80hrs', 'Writers - 160hrs'] },
        { name: 'Labor (Subcontractor)', budget: 18000, spent: 12500, items: ['SME Reviews - 40hrs', 'Graphic Design - 30hrs'] },
        { name: 'Travel', budget: 8000, spent: 2850, items: ['Orals - Falls Church', 'Site Visit - Bethesda'] },
        { name: 'Materials & Printing', budget: 5000, spent: 1200, items: ['Color printing - 500 pages', 'Binding - 12 copies'] },
        { name: 'Tools & Software', budget: 9000, spent: 4550, items: ['AskSage AI - $2000/mo', 'Confluence - $350/mo'] }
      ]},
      { id: 'BUD-002', opportunity: 'VA Claims Processing', totalBudget: 45000, spent: 18700, categories: [
        { name: 'Labor (Internal)', budget: 28000, spent: 12800 },
        { name: 'Labor (Subcontractor)', budget: 8000, spent: 3200 },
        { name: 'Travel', budget: 4000, spent: 1620 },
        { name: 'Materials', budget: 2000, spent: 0 },
        { name: 'Tools', budget: 3000, spent: 1080 }
      ]},
      { id: 'BUD-003', opportunity: 'CMS Data Analytics', totalBudget: 62000, spent: 58900, categories: [
        { name: 'Labor (Internal)', budget: 38000, spent: 37500 },
        { name: 'Labor (Subcontractor)', budget: 12000, spent: 11800 },
        { name: 'Travel', budget: 3000, spent: 980 },
        { name: 'Materials', budget: 4000, spent: 3800 },
        { name: 'Tools', budget: 5000, spent: 4820 }
      ]}
    ];

    const BudgetBar = ({ spent, budget, label }) => {
      const pct = Math.min(Math.round(spent / budget * 100), 100);
      const color = pct >= 90 ? '#EF4444' : pct >= 75 ? '#F59E0B' : '#10B981';
      return React.createElement('div', { className: 'mb-2' },
        React.createElement('div', { className: 'flex justify-between text-xs mb-1' },
          React.createElement('span', { className: 'text-gray-400' }, label),
          React.createElement('span', { className: 'font-mono', style: { color } }, `$${spent.toLocaleString()} / $${budget.toLocaleString()} (${pct}%)`)
        ),
        React.createElement('div', { className: 'h-2 bg-gray-800 rounded-full overflow-hidden' },
          React.createElement('div', { className: 'h-full rounded-full transition-all', style: { width: `${pct}%`, backgroundColor: color } })
        )
      );
    };

    const App = () => {
      const [budgets, setBudgets] = useState(DEMO_BUDGETS);
      const [expandedId, setExpandedId] = useState(null);
      const [connected, setConnected] = useState(false);

      useEffect(() => {
        const role = localStorage.getItem('missionpulse_role');
        if (role && !ROLES_ALLOWED.includes(role)) { window.location.href = 'index.html'; return; }
        const load = async () => { try { if (typeof sbClient !== 'undefined') { const { data } = await sbClient.from('proposal_budgets').select('*'); if (data?.length) { setBudgets(data); setConnected(true); } } } catch (e) {} };
        load();
      }, []);

      const totalBudget = budgets.reduce((s, b) => s + b.totalBudget, 0);
      const totalSpent = budgets.reduce((s, b) => s + b.spent, 0);
      const overBudget = budgets.filter(b => b.spent / b.totalBudget > 0.9).length;

      return React.createElement('div', { className: 'min-h-screen p-6', style: { background: '#00050F' } },
        React.createElement('div', { className: 'flex items-center justify-between mb-6' },
          React.createElement('div', null,
            React.createElement('div', { className: 'flex items-center gap-3' },
              React.createElement('h1', { className: 'text-2xl font-bold text-white' }, 'üí∞ B&P Budget Tracker'),
              React.createElement('span', { className: 'px-2 py-0.5 rounded text-xs font-bold', style: { background: 'rgba(245,158,11,0.15)', color: '#F59E0B', border: '1px solid rgba(245,158,11,0.3)' } }, 'CUI')
            ),
            React.createElement('p', { className: 'text-gray-400 text-sm mt-1' }, 'Bid & Proposal costs ‚Ä¢ Category tracking ‚Ä¢ Burn rate analysis')
          ),
          React.createElement('div', { className: 'flex items-center gap-3' },
            React.createElement('div', { className: 'flex items-center gap-2 px-3 py-1.5 rounded-lg text-xs', style: { background: connected ? 'rgba(16,185,129,0.15)' : 'rgba(245,158,11,0.15)', color: connected ? '#10B981' : '#F59E0B', border: `1px solid ${connected ? 'rgba(16,185,129,0.3)' : 'rgba(245,158,11,0.3)'}` } },
              React.createElement('span', { className: `w-2 h-2 rounded-full ${connected ? 'bg-green-500' : 'bg-yellow-500'}` }), connected ? 'Connected' : 'Demo Mode'
            ),
            React.createElement('a', { href: 'index.html', className: 'px-3 py-1.5 rounded-lg text-xs text-gray-400 hover:text-white', style: { border: '1px solid rgba(255,255,255,0.1)' } }, '‚Üê Dashboard')
          )
        ),

        React.createElement('div', { className: 'grid grid-cols-4 gap-4 mb-6' },
          [
            { label: 'Total B&P Budget', value: `$${(totalBudget/1000).toFixed(0)}K`, color: '#00E5FA' },
            { label: 'Total Spent', value: `$${(totalSpent/1000).toFixed(0)}K`, color: '#818CF8' },
            { label: 'Remaining', value: `$${((totalBudget-totalSpent)/1000).toFixed(0)}K`, color: '#10B981' },
            { label: 'At Risk (>90%)', value: overBudget, color: overBudget > 0 ? '#EF4444' : '#10B981' }
          ].map((s, i) =>
            React.createElement('div', { key: i, className: 'glass-card rounded-lg p-4 text-center animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'font-mono text-2xl font-bold', style: { color: s.color } }, s.value),
              React.createElement('div', { className: 'text-xs text-gray-400 mt-1' }, s.label)
            )
          )
        ),

        React.createElement('div', { className: 'space-y-4 mb-8' },
          budgets.map((b, i) => {
            const pct = Math.round(b.spent / b.totalBudget * 100);
            return React.createElement('div', { key: b.id, className: 'glass-card rounded-lg overflow-hidden animate-fade-up', style: { animationDelay: `${i*0.1}s` } },
              React.createElement('div', { className: 'p-4 cursor-pointer hover:bg-white/5', onClick: () => setExpandedId(expandedId === b.id ? null : b.id) },
                React.createElement('div', { className: 'flex items-center justify-between mb-3' },
                  React.createElement('h3', { className: 'text-white font-semibold text-lg' }, b.opportunity),
                  React.createElement('div', { className: 'flex items-center gap-3' },
                    React.createElement('span', { className: 'font-mono text-2xl font-bold', style: { color: pct >= 90 ? '#EF4444' : pct >= 75 ? '#F59E0B' : '#10B981' } }, `${pct}%`),
                    React.createElement('span', { className: 'text-gray-500 text-lg' }, expandedId === b.id ? '‚ñæ' : '‚ñ∏')
                  )
                ),
                React.createElement(BudgetBar, { spent: b.spent, budget: b.totalBudget, label: 'Overall' })
              ),
              expandedId === b.id && React.createElement('div', { className: 'border-t border-gray-800 p-4 space-y-3' },
                b.categories.map((c, ci) =>
                  React.createElement('div', { key: ci, className: 'bg-gray-900/50 rounded-lg p-3' },
                    React.createElement(BudgetBar, { spent: c.spent || 0, budget: c.budget, label: c.name }),
                    c.items && React.createElement('div', { className: 'flex flex-wrap gap-1 mt-1 ml-2' },
                      c.items.map((item, ii) => React.createElement('span', { key: ii, className: 'text-xs text-gray-500 px-2 py-0.5 bg-gray-800 rounded' }, item))
                    )
                  )
                ),
                React.createElement('div', { className: 'flex gap-2 mt-3' },
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(0,229,250,0.15)', color: '#00E5FA', border: '1px solid rgba(0,229,250,0.3)' } }, 'üìä Export Report'),
                  React.createElement('button', { className: 'px-3 py-1.5 rounded text-xs font-medium', style: { background: 'rgba(245,158,11,0.15)', color: '#F59E0B', border: '1px solid rgba(245,158,11,0.3)' } }, '‚ö° Add Expense')
                )
              )
            );
          })
        ),

        React.createElement('div', { className: 'text-center py-4 border-t border-gray-800' },
          React.createElement('p', { className: 'text-xs text-gray-600' }, '‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW ‚Ä¢ MissionPulse by Mission Meets Tech ‚Ä¢ NIST 800-171 Compliant')
        )
      );
    };

    ReactDOM.render(React.createElement(App), document.getElementById('root'));
  </script>
</body>
</html>
