# .clauderules â€” MissionPulse Agent OS v2.0
# Immutable operating rules. These override all other instructions.

## 1. AGENT LOOP (MANDATORY)

Every task follows: RESEARCH â†’ PLAN â†’ IMPLEMENT â†’ VERIFY â†’ REPORT.
Do not skip phases. Do not generate code before RESEARCH.
Do not present results before VERIFY.

## 2. SOURCE-OF-TRUTH PRIMACY

Do not invent or infer database tables, columns, enums, RBAC roles,
modules, or permission values. If a value is not in an uploaded canonical
file, it does not exist. Uploaded files override memory, prior chats,
and common conventions. Always.

Canonical files (in priority order):
- database.types.ts â†’ DB schema authority
- roles_permissions_config.json â†’ RBAC truth (v9.5, 12 roles Ã— 14 modules)
- GROUND_TRUTH_v2.md â†’ Live database audit
- PHASE_2_RULES.md â†’ Architecture and framework decisions
- AGENTS.md â†’ Project conventions and patterns

## 3. INVESTIGATE BEFORE ANSWERING

Never speculate about code you have not read. If the user references a
file, READ it before responding. Verify functions, classes, and imports
exist before referencing them. Never build reasoning on assumptions.

## 4. COMPLETE FILES ONLY

Output the entire file ready for direct copy/paste replacement.
Never output: sed, awk, perl, heredoc, cat << EOF, partial files,
diffs, git patches, or "rest remains the same" comments.

## 5. CIRCUIT BREAKER (FAIL-CLOSED)

If any output requires missing or ambiguous data, halt immediately:
ðŸš¨ BLOCKED: [CATEGORY] [What is missing]. Please provide [Filename].

Categories: MISSING_FILE, SCHEMA_CONFLICT, RBAC_UNDEFINED,
AMBIGUOUS_TRUTH_SOURCE, ACCEPTANCE_CRITERIA_UNMET,
OUT_OF_SCOPE_REQUEST, CONFIDENCE_BELOW_THRESHOLD.

Do not guess. Do not workaround. Do not continue after a blocker.

## 6. NO PLACEHOLDERS

No TODOs, no stub implementations, no fake values, no sample data,
no pseudocode, no "example" matrices, no partial files.
If real values are missing â†’ Circuit Breaker.

## 7. STRICT TYPING

`as any` is forbidden. No `@ts-ignore` without explanatory comment.
Use database.types.ts for all DB interfaces.

## 8. SCOPE DISCIPLINE

Do not expand scope. Do not "clean up" unrelated files.
Do not refactor code outside the current task.
Only touch files in the task's `allowed_writes`.

## 9. RESOURCE GOVERNORS

Max 3 build/fix cycles per subtask before escalating.
Max 10 files per task before confirming scope.
No unrelated changes. No bonus cleanups.

## 10. SECURITY BY DEFAULT

Fail closed, never open. RLS enforces access at DB level.
Service role key is server-only. No secrets in code.
Invisible RBAC â€” unauthorized modules don't render.
Sensitive mutations â†’ audit_logs (immutable, NIST AU-9).

## 11. SELF-HEALING LOOP

When build/lint/typecheck fails:
1. Read the error output (don't guess)
2. Trace to root cause in the specific file
3. Fix and re-run
4. If stuck after 3 attempts â†’ save state, report, escalate

## 12. COMPOUND LEARNING

After each task, report:
- What worked (â†’ future Conventions)
- What broke and how it was fixed (â†’ future Gotchas)
- Architecture decisions made and why

## 13. DETERMINISM

Re-running a task with the same inputs produces identical outputs.
No random ordering, cosmetic churn, or unnecessary timestamp changes.

## 14. SCHEMA COVENANT

database.types.ts is the sole DB typing authority.
No aliasing, no inferred renames, no guessed columns.
opportunities uses: title, ceiling, pwin, phase, owner_id.
profiles.mfa_enabled does NOT exist. Do not reference.
If database.types.ts is missing for DB work â†’ Circuit Breaker.
