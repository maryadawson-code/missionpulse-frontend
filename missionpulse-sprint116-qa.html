<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MissionPulse - Quality Assurance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'mp-navy': '#00050F',
                        'mp-cyan': '#00E5FA',
                        'mp-slate': '#0A1628'
                    },
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <style>
        * { font-family: 'Inter', sans-serif; }
    </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="bg-mp-navy min-h-screen text-white">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useMemo } = React;

        // Demo QA data
        const proposalQAData = [
            {
                id: 'OPP-2024-001',
                name: 'DHA EHR Modernization',
                dueDate: '2024-03-15',
                overallScore: 87,
                sections: [
                    {
                        id: 'SEC-001',
                        name: 'Technical Approach',
                        volume: 'Volume I',
                        status: 'approved',
                        score: 92,
                        reviewer: 'Dr. Sarah Chen',
                        lastReview: '2024-02-20',
                        checks: [
                            { name: 'Section L Compliance', status: 'pass', notes: '' },
                            { name: 'Section M Alignment', status: 'pass', notes: '' },
                            { name: 'Page Limit', status: 'pass', notes: '48/50 pages' },
                            { name: 'Font/Margin Compliance', status: 'pass', notes: '' },
                            { name: 'Graphics Quality', status: 'pass', notes: '' },
                            { name: 'Win Theme Integration', status: 'pass', notes: '' }
                        ],
                        comments: []
                    },
                    {
                        id: 'SEC-002',
                        name: 'Management Approach',
                        volume: 'Volume I',
                        status: 'in-review',
                        score: 78,
                        reviewer: 'Marcus Thompson',
                        lastReview: '2024-02-22',
                        checks: [
                            { name: 'Section L Compliance', status: 'pass', notes: '' },
                            { name: 'Section M Alignment', status: 'warning', notes: 'Missing key personnel qualifications' },
                            { name: 'Page Limit', status: 'pass', notes: '23/25 pages' },
                            { name: 'Font/Margin Compliance', status: 'pass', notes: '' },
                            { name: 'Org Chart Complete', status: 'warning', notes: 'Need reporting relationships' },
                            { name: 'Win Theme Integration', status: 'pass', notes: '' }
                        ],
                        comments: [
                            { author: 'Marcus T.', date: '2024-02-22', text: 'Need to strengthen risk mitigation section' }
                        ]
                    },
                    {
                        id: 'SEC-003',
                        name: 'Past Performance',
                        volume: 'Volume II',
                        status: 'approved',
                        score: 95,
                        reviewer: 'Jennifer Williams',
                        lastReview: '2024-02-18',
                        checks: [
                            { name: 'Relevancy Demonstrated', status: 'pass', notes: '' },
                            { name: 'Contract References Valid', status: 'pass', notes: 'All 5 refs confirmed' },
                            { name: 'CPARS Aligned', status: 'pass', notes: '' },
                            { name: 'Page Limit', status: 'pass', notes: '18/20 pages' },
                            { name: 'Contact Info Current', status: 'pass', notes: '' }
                        ],
                        comments: []
                    },
                    {
                        id: 'SEC-004',
                        name: 'Staffing Plan',
                        volume: 'Volume I',
                        status: 'revision-needed',
                        score: 62,
                        reviewer: 'David Park',
                        lastReview: '2024-02-23',
                        checks: [
                            { name: 'Key Personnel Identified', status: 'warning', notes: 'PM clearance pending' },
                            { name: 'Resumes Complete', status: 'fail', notes: '2 resumes missing' },
                            { name: 'Labor Mix Justified', status: 'pass', notes: '' },
                            { name: 'Transition Plan', status: 'warning', notes: 'Need more detail' },
                            { name: 'Retention Strategy', status: 'pass', notes: '' }
                        ],
                        comments: [
                            { author: 'David P.', date: '2024-02-23', text: 'Missing senior developer resume' },
                            { author: 'Mary W.', date: '2024-02-23', text: 'Escalated to HR for clearance processing' }
                        ]
                    },
                    {
                        id: 'SEC-005',
                        name: 'Cost Volume',
                        volume: 'Volume III',
                        status: 'draft',
                        score: 45,
                        reviewer: 'Amanda Rodriguez',
                        lastReview: '2024-02-24',
                        checks: [
                            { name: 'Rates Justified', status: 'fail', notes: 'Missing GSA comparison' },
                            { name: 'Indirect Rates Documented', status: 'warning', notes: 'G&A needs backup' },
                            { name: 'BOE Complete', status: 'fail', notes: 'Only 60% complete' },
                            { name: 'Price Reasonableness', status: 'pending', notes: '' },
                            { name: 'Subcontract Costs', status: 'pending', notes: '' },
                            { name: 'Travel Estimates', status: 'pass', notes: '' }
                        ],
                        comments: [
                            { author: 'Amanda R.', date: '2024-02-24', text: 'CRITICAL: Need rates by Monday' }
                        ]
                    }
                ],
                gates: [
                    { name: 'Pink Team', date: '2024-02-10', status: 'complete', score: 72 },
                    { name: 'Red Team', date: '2024-02-20', status: 'complete', score: 85 },
                    { name: 'Gold Team', date: '2024-03-01', status: 'scheduled', score: null },
                    { name: 'Final Review', date: '2024-03-10', status: 'pending', score: null }
                ]
            }
        ];

        function StatusBadge({ status }) {
            const config = {
                'approved': { bg: 'bg-green-500/20', text: 'text-green-400', border: 'border-green-500', label: 'APPROVED' },
                'in-review': { bg: 'bg-blue-500/20', text: 'text-blue-400', border: 'border-blue-500', label: 'IN REVIEW' },
                'revision-needed': { bg: 'bg-orange-500/20', text: 'text-orange-400', border: 'border-orange-500', label: 'REVISION NEEDED' },
                'draft': { bg: 'bg-gray-500/20', text: 'text-gray-400', border: 'border-gray-500', label: 'DRAFT' },
                'complete': { bg: 'bg-green-500/20', text: 'text-green-400', border: 'border-green-500', label: 'COMPLETE' },
                'scheduled': { bg: 'bg-purple-500/20', text: 'text-purple-400', border: 'border-purple-500', label: 'SCHEDULED' },
                'pending': { bg: 'bg-yellow-500/20', text: 'text-yellow-400', border: 'border-yellow-500', label: 'PENDING' }
            };
            const c = config[status] || config.draft;
            return (
                <span className={`px-2 py-1 rounded border text-xs font-medium ${c.bg} ${c.text} ${c.border}`}>
                    {c.label}
                </span>
            );
        }

        function CheckIcon({ status }) {
            switch (status) {
                case 'pass':
                    return <span className="text-green-400">‚úì</span>;
                case 'fail':
                    return <span className="text-red-400">‚úó</span>;
                case 'warning':
                    return <span className="text-yellow-400">‚ö†</span>;
                default:
                    return <span className="text-gray-400">‚óã</span>;
            }
        }

        function QualityGate({ gate }) {
            return (
                <div className={`bg-mp-slate rounded-lg p-4 ${gate.status === 'complete' ? 'border-l-4 border-green-500' : gate.status === 'scheduled' ? 'border-l-4 border-purple-500' : 'border-l-4 border-gray-600'}`}>
                    <div className="flex items-center justify-between mb-2">
                        <h4 className="font-semibold text-white">{gate.name}</h4>
                        <StatusBadge status={gate.status} />
                    </div>
                    <div className="flex items-center justify-between text-sm">
                        <span className="text-gray-400">{gate.date}</span>
                        {gate.score !== null && (
                            <span className={`font-bold ${gate.score >= 80 ? 'text-green-400' : gate.score >= 60 ? 'text-yellow-400' : 'text-red-400'}`}>
                                Score: {gate.score}
                            </span>
                        )}
                    </div>
                </div>
            );
        }

        function SectionCard({ section, onSelect, isSelected }) {
            const passCount = section.checks.filter(c => c.status === 'pass').length;
            const totalChecks = section.checks.length;

            return (
                <div 
                    className={`bg-mp-slate rounded-xl p-4 cursor-pointer transition-all hover:bg-mp-slate/80 ${isSelected ? 'ring-2 ring-mp-cyan' : ''}`}
                    onClick={() => onSelect(section)}
                >
                    <div className="flex items-start justify-between mb-3">
                        <div>
                            <p className="text-xs text-gray-400 mb-1">{section.volume}</p>
                            <h3 className="font-semibold text-white">{section.name}</h3>
                        </div>
                        <StatusBadge status={section.status} />
                    </div>

                    <div className="grid grid-cols-2 gap-3 mb-3">
                        <div className="bg-mp-navy/50 rounded-lg p-2 text-center">
                            <p className={`text-xl font-bold ${section.score >= 80 ? 'text-green-400' : section.score >= 60 ? 'text-yellow-400' : 'text-red-400'}`}>
                                {section.score}
                            </p>
                            <p className="text-xs text-gray-400">QA Score</p>
                        </div>
                        <div className="bg-mp-navy/50 rounded-lg p-2 text-center">
                            <p className="text-xl font-bold text-mp-cyan">{passCount}/{totalChecks}</p>
                            <p className="text-xs text-gray-400">Checks Passed</p>
                        </div>
                    </div>

                    <div className="flex items-center justify-between text-xs text-gray-400">
                        <span>Reviewer: {section.reviewer}</span>
                        <span>{section.lastReview}</span>
                    </div>
                </div>
            );
        }

        function SectionDetail({ section }) {
            return (
                <div>
                    {/* Header */}
                    <div className="bg-mp-slate rounded-xl p-4 mb-6">
                        <div className="flex items-start justify-between mb-4">
                            <div>
                                <p className="text-sm text-gray-400">{section.volume}</p>
                                <h2 className="text-xl font-bold text-white">{section.name}</h2>
                                <p className="text-sm text-gray-400 mt-1">Reviewer: {section.reviewer} ‚Ä¢ Last Review: {section.lastReview}</p>
                            </div>
                            <div className="text-right">
                                <p className={`text-3xl font-bold ${section.score >= 80 ? 'text-green-400' : section.score >= 60 ? 'text-yellow-400' : 'text-red-400'}`}>
                                    {section.score}
                                </p>
                                <p className="text-xs text-gray-400">QA Score</p>
                            </div>
                        </div>
                        <StatusBadge status={section.status} />
                    </div>

                    {/* Compliance Checklist */}
                    <div className="bg-mp-slate rounded-xl p-4 mb-6">
                        <h3 className="font-semibold text-white mb-4">Compliance Checklist</h3>
                        <div className="space-y-3">
                            {section.checks.map((check, idx) => (
                                <div key={idx} className={`flex items-center justify-between p-3 rounded-lg ${check.status === 'pass' ? 'bg-green-500/10' : check.status === 'fail' ? 'bg-red-500/10' : check.status === 'warning' ? 'bg-yellow-500/10' : 'bg-mp-navy/50'}`}>
                                    <div className="flex items-center gap-3">
                                        <CheckIcon status={check.status} />
                                        <span className="text-white">{check.name}</span>
                                    </div>
                                    {check.notes && (
                                        <span className="text-sm text-gray-400">{check.notes}</span>
                                    )}
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Review Comments */}
                    <div className="bg-mp-slate rounded-xl p-4">
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="font-semibold text-white">Review Comments ({section.comments.length})</h3>
                            <button className="text-sm text-mp-cyan hover:underline">+ Add Comment</button>
                        </div>
                        
                        {section.comments.length > 0 ? (
                            <div className="space-y-3">
                                {section.comments.map((comment, idx) => (
                                    <div key={idx} className="bg-mp-navy/50 rounded-lg p-3">
                                        <div className="flex items-center justify-between mb-2">
                                            <span className="font-medium text-mp-cyan">{comment.author}</span>
                                            <span className="text-xs text-gray-400">{comment.date}</span>
                                        </div>
                                        <p className="text-sm text-gray-300">{comment.text}</p>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div className="text-center py-6 text-gray-400">
                                <span className="text-2xl">üí¨</span>
                                <p className="mt-2 text-sm">No comments yet</p>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        function App() {
            const proposal = proposalQAData[0];
            const [selectedSection, setSelectedSection] = useState(proposal.sections[0]);
            const [filterStatus, setFilterStatus] = useState('all');

            const filteredSections = useMemo(() => {
                if (filterStatus === 'all') return proposal.sections;
                return proposal.sections.filter(s => s.status === filterStatus);
            }, [filterStatus, proposal.sections]);

            const metrics = useMemo(() => {
                const sections = proposal.sections;
                const approved = sections.filter(s => s.status === 'approved').length;
                const needsWork = sections.filter(s => s.status === 'revision-needed' || s.status === 'draft').length;
                const avgScore = Math.round(sections.reduce((sum, s) => sum + s.score, 0) / sections.length);
                const totalChecks = sections.reduce((sum, s) => sum + s.checks.length, 0);
                const passedChecks = sections.reduce((sum, s) => sum + s.checks.filter(c => c.status === 'pass').length, 0);
                return { approved, needsWork, avgScore, totalChecks, passedChecks };
            }, [proposal]);

            return (
                <div className="min-h-screen bg-mp-navy">
                    {/* Header */}
                    <header className="bg-mp-slate border-b border-gray-800 px-6 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center gap-4">
                                <div className="w-10 h-10 bg-gradient-to-br from-mp-cyan to-blue-600 rounded-lg flex items-center justify-center">
                                    <span className="text-xl">‚úÖ</span>
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-white">Quality Assurance Dashboard</h1>
                                    <p className="text-sm text-gray-400">{proposal.name} ‚Ä¢ Due: {proposal.dueDate}</p>
                                </div>
                            </div>
                            <div className="flex items-center gap-4">
                                <select 
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="bg-mp-navy border border-gray-700 rounded-lg px-4 py-2 text-sm text-white"
                                >
                                    <option value="all">All Sections</option>
                                    <option value="approved">Approved</option>
                                    <option value="in-review">In Review</option>
                                    <option value="revision-needed">Needs Revision</option>
                                    <option value="draft">Draft</option>
                                </select>
                                <button className="bg-mp-cyan text-mp-navy px-4 py-2 rounded-lg font-medium hover:bg-mp-cyan/90 transition-colors">
                                    Export Report
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Metrics */}
                    <div className="px-6 py-4 border-b border-gray-800">
                        <div className="grid grid-cols-6 gap-4">
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className={`text-3xl font-bold ${proposal.overallScore >= 80 ? 'text-green-400' : 'text-yellow-400'}`}>
                                    {proposal.overallScore}
                                </p>
                                <p className="text-sm text-gray-400">Overall Score</p>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className="text-3xl font-bold text-white">{proposal.sections.length}</p>
                                <p className="text-sm text-gray-400">Total Sections</p>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className="text-3xl font-bold text-green-400">{metrics.approved}</p>
                                <p className="text-sm text-gray-400">Approved</p>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className="text-3xl font-bold text-orange-400">{metrics.needsWork}</p>
                                <p className="text-sm text-gray-400">Needs Work</p>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className="text-3xl font-bold text-mp-cyan">{metrics.passedChecks}/{metrics.totalChecks}</p>
                                <p className="text-sm text-gray-400">Checks Passed</p>
                            </div>
                            <div className="bg-mp-slate rounded-xl p-4 text-center">
                                <p className="text-3xl font-bold text-purple-400">{metrics.avgScore}</p>
                                <p className="text-sm text-gray-400">Avg Section Score</p>
                            </div>
                        </div>
                    </div>

                    {/* Quality Gates */}
                    <div className="px-6 py-4 border-b border-gray-800">
                        <h3 className="text-sm font-semibold text-gray-400 mb-3">QUALITY GATES</h3>
                        <div className="grid grid-cols-4 gap-4">
                            {proposal.gates.map((gate, idx) => (
                                <QualityGate key={idx} gate={gate} />
                            ))}
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex">
                        {/* Section List */}
                        <div className="w-1/3 border-r border-gray-800 p-4 space-y-4 max-h-[calc(100vh-380px)] overflow-y-auto">
                            {filteredSections.map(section => (
                                <SectionCard
                                    key={section.id}
                                    section={section}
                                    isSelected={selectedSection?.id === section.id}
                                    onSelect={setSelectedSection}
                                />
                            ))}
                        </div>

                        {/* Section Detail */}
                        <div className="flex-1 p-6 max-h-[calc(100vh-380px)] overflow-y-auto">
                            {selectedSection && <SectionDetail section={selectedSection} />}
                        </div>
                    </div>

                    {/* Footer */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-mp-slate border-t border-gray-800 px-6 py-3">
                        <div className="flex items-center justify-between text-sm text-gray-400">
                            <span>MissionPulse v12 ‚Ä¢ Quality Assurance Dashboard Module</span>
                            <span className="text-yellow-500">‚ö†Ô∏è AI GENERATED - REQUIRES HUMAN REVIEW</span>
                        </div>
                    </footer>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
