<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MissionPulse ‚Äî Agent Hub V2</title>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh}@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}.fade-in{animation:fadeIn .3s ease-out forwards}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}</style>
  <script src="rbac-guard.js"></script>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const SB_URL='https://djuviwarqdvlbgcfuupa.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRqdXZpd2FycWR2bGJnY2Z1dXBhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MzUyMjQsImV4cCI6MjA1MzQxMTIyNH0.pBPL9l2zL7LLd_A5I--hPBzw5YwG3ajPMtbYsqsxIgQ';
var sbClient=null;let connected=false;
try{sbClient=supabase.createClient(SB_URL,SB_KEY);connected=true}catch(e){}

const AGENTS=[
  {id:1,name:'Capture Agent',icon:'üèπ',status:'active',model:'claude-sonnet-4-20250514',calls:342,tokens:1240000,avgLatency:2.1,module:'Pipeline',desc:'Opportunity qualification, DAFE scoring, Go/No-Go recommendations',rbac:['CEO','COO','CAP','PM']},
  {id:2,name:'Strategy Agent',icon:'‚ôüÔ∏è',status:'active',model:'claude-sonnet-4-20250514',calls:198,tokens:890000,avgLatency:3.4,module:'War Room',desc:'Win theme development, competitive positioning, ghost strategies',rbac:['CEO','COO','CAP']},
  {id:3,name:'Black Hat Agent',icon:'üé©',status:'active',model:'claude-sonnet-4-20250514',calls:87,tokens:420000,avgLatency:4.2,module:'Black Hat',desc:'Competitor analysis, threat assessment, counter-strategies',rbac:['CEO','COO','CAP']},
  {id:4,name:'Pricing Agent',icon:'üí∞',status:'active',model:'claude-sonnet-4-20250514',calls:156,tokens:560000,avgLatency:2.8,module:'Pricing',desc:'Cost volume generation, rate analysis, price-to-win modeling',rbac:['CEO','COO','FIN']},
  {id:5,name:'Compliance Agent',icon:'üõ°Ô∏è',status:'active',model:'claude-sonnet-4-20250514',calls:234,tokens:780000,avgLatency:1.9,module:'Iron Dome',desc:'FAR/DFARS clause analysis, compliance matrix generation',rbac:['CEO','COO','CON','PM']},
  {id:6,name:'Writer Agent',icon:'‚úçÔ∏è',status:'active',model:'claude-sonnet-4-20250514',calls:445,tokens:2100000,avgLatency:5.1,module:'Volumes',desc:'Technical/management volume drafting, executive summaries',rbac:['CEO','COO','SA','PM','CAP']},
  {id:7,name:'Contracts Agent',icon:'üìú',status:'active',model:'claude-sonnet-4-20250514',calls:112,tokens:340000,avgLatency:2.3,module:'Contracts',desc:'Contract clause extraction, risk flagging, amendment tracking',rbac:['CEO','COO','CON']},
  {id:8,name:'Orals Agent',icon:'üé§',status:'active',model:'claude-sonnet-4-20250514',calls:67,tokens:280000,avgLatency:3.8,module:'Orals',desc:'Presentation coaching, Q&A preparation, evaluator prediction',rbac:['CEO','COO','CAP','PM']},
  {id:9,name:'Transition Planner',icon:'üîÑ',status:'active',model:'claude-sonnet-4-20250514',calls:34,tokens:120000,avgLatency:3.1,module:'Post-Award',desc:'30-60-90 day plans, CDRL tracking, staffing ramp',rbac:['CEO','COO','DEL','PM']},
  {id:10,name:'EN Analyzer',icon:'üö®',status:'active',model:'claude-sonnet-4-20250514',calls:21,tokens:95000,avgLatency:2.6,module:'HITL',desc:'Evaluation notice classification, deficiency response strategy',rbac:['CEO','COO','CAP','PM','CON']},
  {id:11,name:'Market Intel',icon:'üì°',status:'active',model:'claude-sonnet-4-20250514',calls:89,tokens:310000,avgLatency:4.5,module:'Pipeline',desc:'SAM.gov monitoring, DAFE pipeline scoring, budget analysis',rbac:['CEO','COO','CAP']},
];

function App(){
  const user=JSON.parse(localStorage.getItem('mp_user')||'{"role":"CEO"}');
  const[search,setSearch]=React.useState('');
  const[selected,setSelected]=React.useState(null);
  const[tab,setTab]=React.useState('agents');

  const totalCalls=AGENTS.reduce((a,b)=>a+b.calls,0);
  const totalTokens=AGENTS.reduce((a,b)=>a+b.tokens,0);
  const avgLat=(AGENTS.reduce((a,b)=>a+b.avgLatency,0)/AGENTS.length).toFixed(1);
  const filtered=search?AGENTS.filter(a=>a.name.toLowerCase().includes(search.toLowerCase())||a.desc.toLowerCase().includes(search.toLowerCase())):AGENTS;
  const userAgents=AGENTS.filter(a=>a.rbac.includes(user.role));

  return(
    <div className="min-h-screen p-6 max-w-6xl mx-auto">
      <div className="flex items-center justify-between mb-6">
        <div><a href="index.html" className="text-cyan-400 text-xs hover:underline mb-1 inline-block">‚Üê Dashboard</a><h1 className="text-2xl font-extrabold text-white">Agent Hub</h1><p className="text-sm text-gray-500">11 AI agents ¬∑ Powered by Anthropic Claude</p></div>
        <span className={`px-3 py-1 rounded-full text-xs font-mono font-semibold ${connected?'bg-green-500/10 text-green-400':'bg-red-500/10 text-red-400'}`}>{connected?'LIVE':'DEMO'}</span>
      </div>

      {/* Stats */}
      <div className="grid grid-cols-4 gap-4 mb-6">
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-cyan-400">{AGENTS.length}</div><div className="text-xs text-gray-500">Agents</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-green-400">{totalCalls.toLocaleString()}</div><div className="text-xs text-gray-500">Total Calls</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-purple-400">{(totalTokens/1000000).toFixed(1)}M</div><div className="text-xs text-gray-500">Tokens Used</div></div>
        <div className="bg-[#0a1628] border border-gray-800 rounded-lg p-4 text-center"><div className="text-2xl font-extrabold text-amber-400">{avgLat}s</div><div className="text-xs text-gray-500">Avg Latency</div></div>
      </div>

      {/* Tabs */}
      <div className="flex gap-2 mb-4">
        {[['agents','All Agents'],['myagents','My Agents ('+userAgents.length+')'],['usage','Usage']].map(([k,l])=>(
          <button key={k} onClick={()=>setTab(k)} className={`px-3 py-1.5 rounded-lg text-xs font-semibold ${tab===k?'bg-cyan-500/15 text-cyan-400 border border-cyan-500/30':'bg-[#0a1628] text-gray-500 border border-gray-800'}`}>{l}</button>
        ))}
      </div>

      <input value={search} onChange={e=>setSearch(e.target.value)} placeholder="Search agents..." className="w-full bg-[#0a1628] border border-gray-800 rounded-lg px-4 py-2.5 text-white text-sm mb-4 focus:border-cyan-500/50 focus:outline-none"/>

      {/* Agent grid */}
      {(tab==='agents'||tab==='myagents')&&(
        <div className="grid grid-cols-1 md:grid-cols-2 gap-3">
          {(tab==='myagents'?userAgents:filtered).map(agent=>(
            <div key={agent.id} onClick={()=>setSelected(selected===agent.id?null:agent.id)} className={`bg-[#0a1628] border rounded-xl p-4 cursor-pointer transition fade-in ${selected===agent.id?'border-cyan-500/30':'border-gray-800 hover:border-gray-600'}`}>
              <div className="flex items-center gap-3 mb-2">
                <span className="text-2xl">{agent.icon}</span>
                <div className="flex-1"><div className="text-white font-semibold text-sm">{agent.name}</div><div className="text-xs text-gray-500">{agent.module} Module</div></div>
                <span className="w-2 h-2 rounded-full bg-green-400"/>
              </div>
              <p className="text-xs text-gray-400 mb-3">{agent.desc}</p>
              <div className="flex gap-3 text-[10px] font-mono text-gray-500">
                <span>{agent.calls} calls</span><span>{(agent.tokens/1000).toFixed(0)}K tokens</span><span>{agent.avgLatency}s avg</span>
              </div>
              {selected===agent.id&&(
                <div className="mt-3 pt-3 border-t border-gray-800 fade-in">
                  <div className="grid grid-cols-2 gap-2 text-xs mb-2">
                    <div><span className="text-gray-500">Model:</span> <span className="text-purple-400 font-mono">{agent.model}</span></div>
                    <div><span className="text-gray-500">Status:</span> <span className="text-green-400">{agent.status}</span></div>
                  </div>
                  <div className="text-xs text-gray-500 mb-2">Authorized roles: {agent.rbac.map(r=><span key={r} className="inline-block bg-purple-500/10 text-purple-400 px-1.5 py-0.5 rounded mr-1 font-mono">{r}</span>)}</div>
                  {agent.rbac.includes(user.role)?
                    <button className="px-3 py-1.5 bg-cyan-500/15 text-cyan-400 rounded-lg text-xs font-semibold hover:bg-cyan-500/25">üí¨ Chat with {agent.name}</button>:
                    <span className="text-xs text-red-400">üîí Not authorized for your role ({user.role})</span>
                  }
                </div>
              )}
            </div>
          ))}
        </div>
      )}

      {/* Usage tab */}
      {tab==='usage'&&(
        <div className="space-y-2">
          <div className="grid grid-cols-5 gap-2 text-[10px] font-mono text-gray-500 px-4 py-2">
            <div>Agent</div><div className="text-right">Calls</div><div className="text-right">Tokens</div><div className="text-right">Latency</div><div>Bar</div>
          </div>
          {[...AGENTS].sort((a,b)=>b.calls-a.calls).map(a=>(
            <div key={a.id} className="bg-[#0a1628] border border-gray-800 rounded-lg px-4 py-3 grid grid-cols-5 gap-2 items-center">
              <div className="text-sm text-white font-medium">{a.icon} {a.name}</div>
              <div className="text-right text-sm text-cyan-400 font-mono">{a.calls}</div>
              <div className="text-right text-xs text-gray-400 font-mono">{(a.tokens/1000).toFixed(0)}K</div>
              <div className="text-right text-xs text-amber-400 font-mono">{a.avgLatency}s</div>
              <div className="h-2 bg-gray-800 rounded-full"><div className="h-2 bg-cyan-400 rounded-full" style={{width:`${(a.calls/Math.max(...AGENTS.map(x=>x.calls)))*100}%`}}/></div>
            </div>
          ))}
        </div>
      )}

      <p className="text-center text-[10px] text-gray-600 mt-8 font-mono">‚ö†Ô∏è AI GENERATED ‚Äî REQUIRES HUMAN REVIEW | MissionPulse v12.0 ‚Äî Mission Meets Tech</p>
    </div>
  );
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
