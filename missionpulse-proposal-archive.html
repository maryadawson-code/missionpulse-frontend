<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S132 - Proposal Archive</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-slide-in { animation: slideIn 0.4s ease-out forwards; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .glass-card { background: linear-gradient(135deg, rgba(15,23,42,0.9) 0%, rgba(15,23,42,0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0,229,250,0.15); }
    .glass-card:hover { border-color: rgba(0,229,250,0.3); }
    ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #0a1628; } ::-webkit-scrollbar-thumb { background: rgba(0,229,250,0.3); border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const SUPABASE_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;
    try { sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY); } catch(e) { sbClient = null; }

    const Icons = {
      search: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
      document: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
      copy: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>,
      trophy: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 3h14l-1.5 6.5a5.5 5.5 0 01-11 0L5 3zm7 13v4m-4 0h8m-6-4a2 2 0 104 0" /></svg>,
      xCircle: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      star: () => <svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
      bookmark: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg>,
      tag: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>,
    };
    const Icon = ({ name, className = "w-4 h-4" }) => { const C = Icons[name]; return C ? <span className={`inline-block ${className}`}><C /></span> : null; };

    const PROPOSALS = [
      { id: 1, title: 'DHA EHR Modernization', agency: 'DHA', date: '2026-01-10', outcome: 'win', value: 47000000, score: 91, sections: [
        { name: 'Technical Volume', pages: 85, reusable: true, tags: ['EHR','MHS Genesis','Migration','Zero-Downtime'] },
        { name: 'Management Volume', pages: 42, reusable: true, tags: ['Agile','Risk Mgmt','Staffing Plan'] },
        { name: 'Past Performance', pages: 28, reusable: false, tags: ['CPARS','DHA','Leidos Sub'] },
        { name: 'Price Volume', pages: 35, reusable: false, tags: ['FFP','T&M','Labor Categories'] },
      ]},
      { id: 2, title: 'VA Claims Processing AI', agency: 'VA', date: '2025-12-15', outcome: 'loss', value: 23000000, score: 78, sections: [
        { name: 'Technical Volume', pages: 72, reusable: true, tags: ['AI/ML','NLP','Claims Processing'] },
        { name: 'Management Volume', pages: 38, reusable: true, tags: ['Agile','DevSecOps','SAFe'] },
        { name: 'Past Performance', pages: 22, reusable: false, tags: ['Commercial AI','Healthcare'] },
      ]},
      { id: 3, title: 'CMS Data Analytics Platform', agency: 'CMS', date: '2025-11-01', outcome: 'win', value: 15500000, score: 90, sections: [
        { name: 'Technical Volume', pages: 68, reusable: true, tags: ['Advana','FedRAMP','Data Lake','Analytics'] },
        { name: 'Management Volume', pages: 35, reusable: true, tags: ['Transition Plan','SLA','Governance'] },
        { name: 'Past Performance', pages: 25, reusable: true, tags: ['CMS','CPARS','Data Analytics'] },
        { name: 'Price Volume', pages: 30, reusable: false, tags: ['T&M','IGCE Aligned'] },
      ]},
      { id: 4, title: 'IHS Telehealth Expansion', agency: 'IHS', date: '2025-10-12', outcome: 'loss', value: 8200000, score: 72, sections: [
        { name: 'Technical Volume', pages: 55, reusable: false, tags: ['Telehealth','Video','Remote Care'] },
        { name: 'Management Volume', pages: 30, reusable: true, tags: ['PM Framework','Quality'] },
      ]},
      { id: 5, title: 'DoD Advana Expansion', agency: 'DoD', date: '2025-08-20', outcome: 'pending', value: 125000000, score: null, sections: [
        { name: 'Technical Volume', pages: 120, reusable: true, tags: ['Advana','AI/ML','Data Engineering','Cloud'] },
        { name: 'Management Volume', pages: 55, reusable: true, tags: ['Large Program','EVMS','Transition'] },
        { name: 'Past Performance', pages: 35, reusable: true, tags: ['DoD','Cleared Staff','Analytics'] },
        { name: 'Price Volume', pages: 48, reusable: false, tags: ['Hybrid','Labor Rates','Travel'] },
      ]},
    ];

    const BOILERPLATE = [
      { id: 1, name: 'FedRAMP Compliance Narrative', category: 'Security', uses: 8, lastUsed: '2026-01-10', tags: ['FedRAMP','NIST','Cloud'] },
      { id: 2, name: 'Agile Development Methodology', category: 'Management', uses: 12, lastUsed: '2026-01-10', tags: ['Agile','SAFe','Scrum'] },
      { id: 3, name: 'CMMC Level 2 Compliance', category: 'Security', uses: 6, lastUsed: '2025-12-15', tags: ['CMMC','NIST 800-171','CUI'] },
      { id: 4, name: 'DevSecOps Pipeline', category: 'Technical', uses: 10, lastUsed: '2026-01-10', tags: ['CI/CD','Security','Automation'] },
      { id: 5, name: 'Quality Management Plan', category: 'Management', uses: 9, lastUsed: '2025-11-01', tags: ['QMP','ISO','CMMI'] },
      { id: 6, name: 'Past Performance Narrative Template', category: 'Past Performance', uses: 7, lastUsed: '2025-12-15', tags: ['CPARS','References'] },
      { id: 7, name: 'Transition-In Plan', category: 'Management', uses: 5, lastUsed: '2025-11-01', tags: ['Transition','Onboarding','Phase-In'] },
      { id: 8, name: 'Data Governance Framework', category: 'Technical', uses: 4, lastUsed: '2025-12-15', tags: ['Data','Governance','Privacy'] },
    ];

    const ConnectionIndicator = ({ connected }) => (
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{ background: connected ? 'rgba(0,255,136,0.1)' : 'rgba(255,184,0,0.1)', border: `1px solid ${connected ? 'rgba(0,255,136,0.3)' : 'rgba(255,184,0,0.3)'}` }}>
        <div className={`w-2 h-2 rounded-full ${connected ? 'bg-green-400' : 'bg-amber-400 animate-pulse'}`} />
        <span style={{ color: connected ? '#00ff88' : '#ffb800' }}>{connected ? 'LIVE' : 'DEMO'}</span>
      </div>
    );

    const ProposalArchive = () => {
      const [connected, setConnected] = useState(false);
      const [userRole, setUserRole] = useState('CEO');
      const [activeTab, setActiveTab] = useState('proposals');
      const [searchTerm, setSearchTerm] = useState('');
      const [filterOutcome, setFilterOutcome] = useState('all');
      const [selectedProposal, setSelectedProposal] = useState(null);

      useEffect(() => {
        const allowed = ['CEO','COO','CAP','PM','SA','QA','Admin'];
        if (!allowed.includes(userRole)) setUserRole(null);
      }, [userRole]);

      useEffect(() => {
        const tryConnect = async () => {
          if (!sbClient) return;
          try { const { data } = await sbClient.from('opportunities').select('id').limit(1); if (data) setConnected(true); } catch(e) {}
        };
        tryConnect();
      }, []);

      const filtered = PROPOSALS.filter(p => {
        if (filterOutcome !== 'all' && p.outcome !== filterOutcome) return false;
        if (searchTerm) {
          const term = searchTerm.toLowerCase();
          const inTitle = p.title.toLowerCase().includes(term);
          const inTags = p.sections.some(s => s.tags.some(t => t.toLowerCase().includes(term)));
          return inTitle || inTags;
        }
        return true;
      });

      const filteredBoilerplate = BOILERPLATE.filter(b => {
        if (!searchTerm) return true;
        const term = searchTerm.toLowerCase();
        return b.name.toLowerCase().includes(term) || b.tags.some(t => t.toLowerCase().includes(term));
      });

      const totalSections = PROPOSALS.reduce((s,p) => s + p.sections.length, 0);
      const reusableSections = PROPOSALS.reduce((s,p) => s + p.sections.filter(sec => sec.reusable).length, 0);
      const allTags = [...new Set(PROPOSALS.flatMap(p => p.sections.flatMap(s => s.tags)))];

      const OutcomeBadge = ({ outcome }) => {
        const m = { win: { c: '#00ff88', l: 'üèÜ WIN' }, loss: { c: '#ff4444', l: '‚úó LOSS' }, pending: { c: '#ffb800', l: '‚è≥ PENDING' } };
        const s = m[outcome] || m.pending;
        return <span className="px-2 py-0.5 rounded text-xs font-mono font-bold" style={{ background: `${s.c}15`, color: s.c, border: `1px solid ${s.c}30` }}>{s.l}</span>;
      };

      if (selectedProposal) {
        const p = selectedProposal;
        return (
          <div className="min-h-screen" style={{ background: '#00050F' }}>
            <div className="max-w-5xl mx-auto p-6">
              <button onClick={() => setSelectedProposal(null)} className="text-sm text-slate-400 hover:text-cyan-400 transition mb-6">‚Üê Back to Archive</button>
              <div className="glass-card rounded-xl p-6 mb-6">
                <div className="flex items-center justify-between">
                  <div>
                    <div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">{p.title}</h1><OutcomeBadge outcome={p.outcome} /></div>
                    <p className="text-sm text-slate-400">{p.agency} ¬∑ ${(p.value/1000000).toFixed(1)}M ¬∑ Submitted {p.date}{p.score ? ` ¬∑ Score: ${p.score}` : ''}</p>
                  </div>
                </div>
              </div>
              <h3 className="text-sm font-mono font-bold text-cyan-400 mb-3">PROPOSAL SECTIONS</h3>
              <div className="space-y-3">
                {p.sections.map((sec, i) => (
                  <div key={i} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.06}s` }}>
                    <div className="flex items-center justify-between mb-3">
                      <div className="flex items-center gap-3">
                        <Icon name="document" className="w-5 h-5 text-cyan-400" />
                        <span className="text-white font-semibold">{sec.name}</span>
                        <span className="text-xs text-slate-500 font-mono">{sec.pages} pages</span>
                        {sec.reusable && <span className="px-2 py-0.5 rounded text-xs font-mono font-bold bg-green-500/10 text-green-400 border border-green-500/20">REUSABLE</span>}
                      </div>
                      <button className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-mono font-bold bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/20 transition">
                        <Icon name="copy" className="w-3.5 h-3.5" /> Reuse Section
                      </button>
                    </div>
                    <div className="flex flex-wrap gap-1.5">
                      {sec.tags.map((tag, j) => <span key={j} className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/40 text-slate-400">{tag}</span>)}
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      const tabs = [
        { key: 'proposals', label: 'Past Proposals' },
        { key: 'boilerplate', label: `Boilerplate (${BOILERPLATE.length})` },
      ];

      return (
        <div className="min-h-screen" style={{ background: '#00050F' }}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div>
                <div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Proposal Archive</h1><ConnectionIndicator connected={connected} /></div>
                <p className="text-sm text-slate-400">Searchable past proposals, section reuse & boilerplate library</p>
              </div>
              <div className="relative">
                <Icon name="search" className="w-4 h-4 text-slate-500 absolute left-3 top-1/2 -translate-y-1/2" />
                <input type="text" placeholder="Search proposals & tags..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="pl-9 pr-4 py-2 rounded-lg bg-slate-800/50 border border-slate-700/30 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 w-64" />
              </div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              {[
                { label: 'Proposals', value: PROPOSALS.length, color: '#00E5FA' },
                { label: 'Total Sections', value: totalSections, color: '#a78bfa' },
                { label: 'Reusable', value: reusableSections, color: '#00ff88' },
                { label: 'Boilerplate', value: BOILERPLATE.length, color: '#ffb800' },
              ].map((k,i) => (
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{ color: k.color }}>{k.value}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-1 bg-slate-800/30 rounded-lg p-1 mb-6">
              {tabs.map(t => (
                <button key={t.key} onClick={() => setActiveTab(t.key)} className={`px-4 py-2 rounded-md text-sm font-mono font-bold transition flex-1 ${activeTab === t.key ? 'bg-cyan-500/20 text-cyan-400' : 'text-slate-500 hover:text-slate-300'}`}>{t.label}</button>
              ))}
            </div>

            {activeTab === 'proposals' && (
              <div>
                <div className="flex items-center gap-2 mb-4">
                  {['all','win','loss','pending'].map(f => (
                    <button key={f} onClick={() => setFilterOutcome(f)} className={`px-3 py-1 rounded-md text-xs font-mono font-bold transition ${filterOutcome === f ? 'bg-cyan-500/20 text-cyan-400' : 'text-slate-500 hover:text-slate-300 bg-slate-800/30'}`}>{f === 'all' ? 'All' : f.charAt(0).toUpperCase()+f.slice(1)}</button>
                  ))}
                </div>
                <div className="space-y-3">
                  {filtered.map((p, i) => (
                    <div key={p.id} onClick={() => setSelectedProposal(p)} className="glass-card rounded-xl p-5 cursor-pointer hover:border-cyan-500/40 transition-all animate-slide-in" style={{ animationDelay: `${i*0.06}s` }}>
                      <div className="flex items-center justify-between">
                        <div>
                          <div className="flex items-center gap-2 mb-1"><h3 className="text-white font-semibold">{p.title}</h3><OutcomeBadge outcome={p.outcome} /></div>
                          <p className="text-xs text-slate-500">{p.agency} ¬∑ ${(p.value/1000000).toFixed(1)}M ¬∑ {p.date} ¬∑ {p.sections.length} sections{p.score ? ` ¬∑ Score: ${p.score}` : ''}</p>
                        </div>
                        <div className="flex items-center gap-4">
                          <div className="text-right"><span className="text-sm font-mono text-green-400">{p.sections.filter(s=>s.reusable).length}</span><div className="text-xs text-slate-500">reusable</div></div>
                          <span className="text-slate-600 text-lg">‚Üí</span>
                        </div>
                      </div>
                      <div className="flex flex-wrap gap-1 mt-3">
                        {[...new Set(p.sections.flatMap(s => s.tags))].slice(0,8).map((t,j) => <span key={j} className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/30 text-slate-500">{t}</span>)}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            )}

            {activeTab === 'boilerplate' && (
              <div className="space-y-3 animate-slide-in">
                {filteredBoilerplate.map((b, i) => (
                  <div key={b.id} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center gap-3">
                        <Icon name="document" className="w-5 h-5 text-cyan-400" />
                        <span className="text-white font-semibold">{b.name}</span>
                        <span className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/30 text-slate-400">{b.category}</span>
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="text-xs text-slate-500 font-mono">Used {b.uses}x</span>
                        <button className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-mono font-bold bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/20 transition">
                          <Icon name="copy" className="w-3.5 h-3.5" /> Use
                        </button>
                      </div>
                    </div>
                    <div className="flex flex-wrap gap-1.5">
                      {b.tags.map((t,j) => <span key={j} className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/30 text-slate-400">{t}</span>)}
                      <span className="text-xs text-slate-600 ml-2">Last: {b.lastUsed}</span>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <div className="mt-8 text-center">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20">
                <Icon name="shield" className="w-3.5 h-3.5 text-amber-500" />
                <span className="text-xs text-amber-500/80 font-mono">AI GENERATED ‚Äî REQUIRES HUMAN REVIEW</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<ProposalArchive />, document.getElementById('root'));
  </script>
</body>
</html>
