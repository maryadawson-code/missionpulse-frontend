<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Requirements Matrix</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const DEMO_REQS=[
      {id:1,rfpRef:'L.4.1',section:'Technical Approach',requirement:'Describe the proposed technical approach for modernizing the EHR system, including architecture, migration strategy, and integration points.',responseSection:'Vol II §2.1',volume:'Technical',priority:'Critical',compliance:'COMPLIANT',owner:'Sarah K.',pageRef:'pp. 5-12',notes:'Leverage MHS GENESIS integration pattern. Reference Azure Gov architecture.',wordCount:2800,pageLimit:8},
      {id:2,rfpRef:'L.4.2',section:'DevSecOps Pipeline',requirement:'Detail the CI/CD pipeline, including security scanning, automated testing, and deployment automation for Azure Government.',responseSection:'Vol II §2.2',volume:'Technical',priority:'Critical',compliance:'COMPLIANT',owner:'Lisa W.',pageRef:'pp. 13-17',notes:'Include GitLab CI + Terraform + STIG scanning workflow.',wordCount:1600,pageLimit:5},
      {id:3,rfpRef:'L.4.3',section:'Security & ATO',requirement:'Provide the approach for achieving and maintaining ATO, including RMF steps, continuous monitoring, and STIG compliance.',responseSection:'Vol II §2.3',volume:'Technical',priority:'Critical',compliance:'PARTIAL',owner:'Angela F.',pageRef:'pp. 18-22',notes:'GAP: Need to finalize ConMon tool selection. FedRAMP inheritance narrative drafted.',wordCount:1400,pageLimit:5},
      {id:4,rfpRef:'L.4.4',section:'Data Migration',requirement:'Describe the approach for migrating legacy data, including validation, rollback procedures, and data integrity assurance.',responseSection:'Vol II §2.4',volume:'Technical',priority:'High',compliance:'COMPLIANT',owner:'David C.',pageRef:'pp. 23-26',notes:'4-phase migration with parallel validation.',wordCount:1200,pageLimit:4},
      {id:5,rfpRef:'L.4.5',section:'AI/ML Integration',requirement:'If proposing AI/ML capabilities, describe the responsible AI framework, model governance, and bias mitigation strategies.',responseSection:'Vol II §2.5',volume:'Technical',priority:'High',compliance:'COMPLIANT',owner:'James R.',pageRef:'pp. 27-30',notes:'AskSage integration with human-in-the-loop approval. NIST AI RMF aligned.',wordCount:1100,pageLimit:4},
      {id:6,rfpRef:'L.5.1',section:'Management Approach',requirement:'Describe the overall management methodology, including Agile/hybrid approach, governance, communication, and escalation procedures.',responseSection:'Vol III §3.1',volume:'Management',priority:'Critical',compliance:'COMPLIANT',owner:'Mary W.',pageRef:'pp. 1-8',notes:'SAFe + EVM hybrid. Includes RACI and comms matrix.',wordCount:2400,pageLimit:8},
      {id:7,rfpRef:'L.5.2',section:'Staffing Plan',requirement:'Provide a staffing plan showing all proposed personnel, LCATs, and a staffing timeline for ramp-up and steady state.',responseSection:'Vol III §3.2',volume:'Management',priority:'Critical',compliance:'COMPLIANT',owner:'Tom P.',pageRef:'pp. 9-14',notes:'14 FTEs. Org chart + LCAT matrix included.',wordCount:1800,pageLimit:6},
      {id:8,rfpRef:'L.5.3',section:'Risk Management',requirement:'Identify the top 5 risks and provide a detailed mitigation plan for each, including probability, impact, and triggers.',responseSection:'Vol III §3.3',volume:'Management',priority:'High',compliance:'COMPLIANT',owner:'Tom P.',pageRef:'pp. 15-18',notes:'5x5 matrix. Weekly risk register cadence.',wordCount:1100,pageLimit:4},
      {id:9,rfpRef:'L.5.4',section:'Transition Plan',requirement:'Provide a 90-day transition-in plan with phases, milestones, knowledge transfer activities, and acceptance criteria.',responseSection:'Vol III §3.4',volume:'Management',priority:'High',compliance:'PARTIAL',owner:'Tom P.',pageRef:'pp. 19-22',notes:'GAP: Acceptance criteria for Phase 3 needs KO input. Draft complete.',wordCount:900,pageLimit:4},
      {id:10,rfpRef:'L.5.5',section:'Quality Control',requirement:'Describe the QCP including inspections, testing methodology, defect tracking, and continuous improvement processes.',responseSection:'Vol III §3.5',volume:'Management',priority:'Medium',compliance:'COMPLIANT',owner:'Patricia N.',pageRef:'pp. 23-26',notes:'ISO 9001:2015 aligned. Includes automated test metrics.',wordCount:1000,pageLimit:4},
      {id:11,rfpRef:'L.6.1',section:'Past Performance — Contract 1',requirement:'Provide past performance for a relevant contract demonstrating EHR/Health IT modernization of similar scope and complexity.',responseSection:'Vol IV §4.1',volume:'Past Performance',priority:'Critical',compliance:'COMPLIANT',owner:'Mary W.',pageRef:'pp. 1-4',notes:'DHA contract. Exceptional CPARS.',wordCount:1500,pageLimit:4},
      {id:12,rfpRef:'L.6.2',section:'Past Performance — Contract 2',requirement:'Provide past performance for a contract demonstrating cloud migration to a FedRAMP environment.',responseSection:'Vol IV §4.2',volume:'Past Performance',priority:'Critical',compliance:'COMPLIANT',owner:'Mary W.',pageRef:'pp. 5-8',notes:'VA cloud migration. Very Good CPARS.',wordCount:1400,pageLimit:4},
      {id:13,rfpRef:'L.6.3',section:'Past Performance — Contract 3',requirement:'Provide past performance demonstrating AI/ML implementation in a federal healthcare context.',responseSection:'Vol IV §4.3',volume:'Past Performance',priority:'High',compliance:'NOT MET',owner:'Mary W.',pageRef:'—',notes:'GAP: No direct federal healthcare AI PP. Using CMS analytics as closest analog + sub PP from TechPartner Alpha.',wordCount:0,pageLimit:4},
      {id:14,rfpRef:'L.7.1',section:'Pricing — BOE',requirement:'Provide a Basis of Estimate for all proposed labor categories with supporting rationale.',responseSection:'Vol V §5.1',volume:'Pricing',priority:'Critical',compliance:'COMPLIANT',owner:'Finance',pageRef:'Attachment A',notes:'Bottom-up BOE from historical actuals. GSA schedule rates.',wordCount:800,pageLimit:0},
      {id:15,rfpRef:'M.2',section:'Small Business Plan',requirement:'Submit a Small Business Subcontracting Plan per FAR 52.219-9.',responseSection:'Admin §6.1',volume:'Admin',priority:'Medium',compliance:'PARTIAL',owner:'Mary W.',pageRef:'—',notes:'Template drafted. Awaiting final sub percentages from Teaming Calculator.',wordCount:400,pageLimit:0},
    ];

    const VOLUMES=['All','Technical','Management','Past Performance','Pricing','Admin'];
    const COMPLIANCE_OPTS=['All','COMPLIANT','PARTIAL','NOT MET'];
    const PRIORITY_OPTS=['All','Critical','High','Medium'];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[reqs]=useState(DEMO_REQS);
      const[volFilter,setVolFilter]=useState('All');
      const[compFilter,setCompFilter]=useState('All');
      const[prioFilter,setPrioFilter]=useState('All');
      const[search,setSearch]=useState('');
      const[expanded,setExpanded]=useState(null);

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('compliance_items').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const filtered=useMemo(()=>reqs.filter(r=>{
        if(volFilter!=='All'&&r.volume!==volFilter)return false;
        if(compFilter!=='All'&&r.compliance!==compFilter)return false;
        if(prioFilter!=='All'&&r.priority!==prioFilter)return false;
        if(search){const s=search.toLowerCase();return r.requirement.toLowerCase().includes(s)||r.section.toLowerCase().includes(s)||r.rfpRef.toLowerCase().includes(s)}
        return true;
      }),[reqs,volFilter,compFilter,prioFilter,search]);

      const compColor={COMPLIANT:'#00ff88',PARTIAL:'#f59e0b','NOT MET':'#ef4444'};
      const prioColor={Critical:'#ef4444',High:'#f59e0b',Medium:'#00E5FA',Low:'#94a3b8'};
      const compCount=k=>reqs.filter(r=>r.compliance===k).length;
      const totalWords=reqs.reduce((s,r)=>s+r.wordCount,0);

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>COMPLIANCE TRACKING</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Requirements Matrix</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>RFP ↔ Response mapping • Compliance status • Page tracking</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          {/* Compliance Progress */}
          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Requirements',value:reqs.length,color:'#00E5FA'},
              {label:'Compliant',value:compCount('COMPLIANT'),color:'#00ff88'},
              {label:'Partial',value:compCount('PARTIAL'),color:'#f59e0b'},
              {label:'Not Met',value:compCount('NOT MET'),color:'#ef4444'},
              {label:'Compliance Rate',value:`${Math.round(compCount('COMPLIANT')/reqs.length*100)}%`,color:compCount('COMPLIANT')/reqs.length>=0.8?'#00ff88':'#f59e0b'},
              {label:'Total Words',value:`${(totalWords/1000).toFixed(1)}K`,color:'#a78bfa'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'125px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Progress Bar */}
          <div style={{marginBottom:'20px'}}>
            <div style={{display:'flex',height:'10px',borderRadius:'5px',overflow:'hidden',background:'rgba(255,255,255,0.03)'}}>
              <div style={{width:`${compCount('COMPLIANT')/reqs.length*100}%`,background:'#00ff88',transition:'width 0.3s'}}/>
              <div style={{width:`${compCount('PARTIAL')/reqs.length*100}%`,background:'#f59e0b',transition:'width 0.3s'}}/>
              <div style={{width:`${compCount('NOT MET')/reqs.length*100}%`,background:'#ef4444',transition:'width 0.3s'}}/>
            </div>
            <div style={{display:'flex',gap:'14px',marginTop:'6px',fontSize:'10px'}}>
              {Object.entries(compColor).map(([k,c])=><span key={k} style={{color:c}}><span style={{display:'inline-block',width:'8px',height:'8px',borderRadius:'2px',background:c,marginRight:'4px'}}/>{ k} ({compCount(k)})</span>)}
            </div>
          </div>

          {/* Filters */}
          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            <input type="text" placeholder="Search requirements…" value={search} onChange={e=>setSearch(e.target.value)} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.15)',borderRadius:'8px',padding:'7px 14px',fontSize:'12px',color:'#e2e8f0',outline:'none',width:'220px'}}/>
            {[{opts:VOLUMES,val:volFilter,set:setVolFilter},{opts:COMPLIANCE_OPTS,val:compFilter,set:setCompFilter},{opts:PRIORITY_OPTS,val:prioFilter,set:setPrioFilter}].map((fg,fi)=>(
              <div key={fi} style={{display:'flex',gap:'3px'}}>
                {fg.opts.map(o=><button key={o} onClick={()=>fg.set(o)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',whiteSpace:'nowrap',background:fg.val===o?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:fg.val===o?'#00E5FA':'#5a7a9a'}}>{o}</button>)}
              </div>
            ))}
          </div>

          {/* Requirements List */}
          <div style={{display:'flex',flexDirection:'column',gap:'6px'}}>
            {filtered.map(r=>(
              <div key={r.id} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',overflow:'hidden',transition:'all 0.15s'}} onMouseOver={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.2)'} onMouseOut={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                <div onClick={()=>setExpanded(expanded===r.id?null:r.id)} style={{padding:'12px 16px',cursor:'pointer',display:'flex',gap:'12px',alignItems:'flex-start'}}>
                  <div style={{width:'4px',height:'36px',borderRadius:'2px',background:compColor[r.compliance],flexShrink:0,marginTop:'2px'}}/>
                  <div style={{flex:1,minWidth:0}}>
                    <div style={{display:'flex',alignItems:'center',gap:'8px',flexWrap:'wrap',marginBottom:'4px'}}>
                      <span style={{fontFamily:'monospace',fontSize:'11px',fontWeight:700,color:'#00E5FA'}}>{r.rfpRef}</span>
                      <span style={{fontSize:'13px',fontWeight:600,color:'white'}}>{r.section}</span>
                      <span style={{fontSize:'9px',fontWeight:700,padding:'1px 6px',borderRadius:'3px',background:`${compColor[r.compliance]}12`,color:compColor[r.compliance]}}>{r.compliance}</span>
                      <span style={{fontSize:'9px',fontWeight:600,padding:'1px 6px',borderRadius:'3px',background:`${prioColor[r.priority]}10`,color:prioColor[r.priority]}}>{r.priority}</span>
                    </div>
                    <div style={{fontSize:'11px',color:'#5a7a9a',display:'flex',gap:'12px',flexWrap:'wrap'}}>
                      <span>→ {r.responseSection}</span>
                      <span>{r.volume}</span>
                      <span>Owner: {r.owner}</span>
                      {r.wordCount>0&&<span>{r.wordCount.toLocaleString()} words</span>}
                      {r.pageLimit>0&&<span>Limit: {r.pageLimit} pg</span>}
                    </div>
                  </div>
                  <span style={{color:'#5a7a9a',fontSize:'16px',transform:expanded===r.id?'rotate(180deg)':'rotate(0)',transition:'transform 0.2s',flexShrink:0}}>▾</span>
                </div>
                {expanded===r.id&&(
                  <div style={{padding:'0 16px 14px 32px',borderTop:'1px solid rgba(0,229,250,0.06)'}}>
                    <div style={{padding:'10px 0'}}>
                      <div style={{fontSize:'10px',fontWeight:700,color:'#5a7a9a',marginBottom:'4px'}}>RFP REQUIREMENT</div>
                      <div style={{fontSize:'12px',color:'#94a3b8',lineHeight:'1.6',background:'rgba(0,0,0,0.2)',padding:'10px 12px',borderRadius:'6px',marginBottom:'10px'}}>{r.requirement}</div>
                      <div style={{fontSize:'10px',fontWeight:700,color:'#00E5FA',marginBottom:'4px'}}>RESPONSE NOTES</div>
                      <div style={{fontSize:'12px',color:'#e2e8f0',lineHeight:'1.5',background:'rgba(0,229,250,0.03)',padding:'8px 12px',borderRadius:'6px',borderLeft:`3px solid ${compColor[r.compliance]}`}}>{r.notes}</div>
                      {r.pageRef!=='—'&&<div style={{marginTop:'8px',fontSize:'10px',color:'#3e4f63'}}>Page reference: {r.pageRef}</div>}
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
          <div style={{marginTop:'10px',fontSize:'11px',color:'#3e4f63',textAlign:'right'}}>{filtered.length} of {reqs.length} requirements shown</div>
          <div style={{textAlign:'center',padding:'20px 0',marginTop:'20px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
