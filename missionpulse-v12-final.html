<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse v12 | AI Proposal Command Center</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root{--mmt-cyan:#00E5FA;--mmt-navy:#00050F}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:var(--mmt-navy);color:#e2e8f0}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:#0f172a}::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}
    .glass{background:rgba(15,23,42,0.85);backdrop-filter:blur(12px);border:1px solid rgba(0,229,250,0.1)}
    .glow{box-shadow:0 0 30px rgba(0,229,250,0.2)}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
    @keyframes spin{to{transform:rotate(360deg)}}
    .animate-fadeIn{animation:fadeIn 0.3s ease-out}
    .animate-pulse{animation:pulse 2s infinite}
    .animate-spin{animation:spin 1s linear infinite}
    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
// ============================================================
// MISSIONPULSE v12 FINAL - ALL MODULES ACTIVE
// Mission Meets Tech ¬© 2026
// ============================================================
const{useState,useEffect,useRef}=React;

// CONFIG
const CONFIG={
  SUPABASE_URL:'https://qlbvbfaprymzdqywcsiq.supabase.co',
  SUPABASE_KEY:'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFsYnZiZmFwcnltemRxeXdjc2lxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc3NjQ4NjcsImV4cCI6MjA1MzM0MDg2N30.QEnpsflnMM9i9xvYPHJlJO7wGPazPTvTWSFIohHcA',
  API_URL:'https://missionpulse-api.onrender.com'
};
const supabase=window.supabase.createClient(CONFIG.SUPABASE_URL,CONFIG.SUPABASE_KEY);

// 11 ROLES
const ROLES=[
  {id:'CEO',name:'CEO',icon:'üëë',fn:'Executive Approver',access:['dashboard','pipeline','warroom','swarm','launch','orals','frenemy','post_award']},
  {id:'COO',name:'COO',icon:'üìä',fn:'Capture Oversight',access:['dashboard','pipeline','warroom','swarm','hitl','frenemy','launch','post_award','pricing']},
  {id:'CAP',name:'Capture',icon:'üéØ',fn:'Capture Manager',access:['dashboard','pipeline','blackhat','warroom','frenemy','swarm']},
  {id:'PM',name:'Proposal Mgr',icon:'üìã',fn:'Proposal Manager',access:['dashboard','pipeline','warroom','swarm','compliance','writer','hitl','launch','post_award','orals']},
  {id:'SA',name:'Solution Arch',icon:'üîß',fn:'Technical Lead',access:['dashboard','writer','compliance','contracts','orals','swarm']},
  {id:'FIN',name:'Pricing',icon:'üí∞',fn:'Volume Lead',access:['dashboard','pricing','contracts','launch','swarm']},
  {id:'CON',name:'Contracts',icon:'‚öñÔ∏è',fn:'Compliance',access:['dashboard','compliance','contracts','swarm','hitl']},
  {id:'DEL',name:'Delivery',icon:'üë•',fn:'Staffing',access:['dashboard','swarm','writer','post_award','orals']},
  {id:'QA',name:'QA Lead',icon:'‚úÖ',fn:'Quality',access:['dashboard','hitl','compliance','swarm','writer']},
  {id:'Partner',name:'Partner',icon:'ü§ù',fn:'External',access:['frenemy','swarm'],ext:true},
  {id:'Admin',name:'Admin',icon:'‚öôÔ∏è',fn:'System Admin',access:['dashboard','pipeline','warroom','swarm','compliance','contracts','writer','blackhat','pricing','hitl','orals','frenemy','launch','post_award','playbook','admin','training']}
];

// 16 MODULES
const MODULES=[
  {id:'dashboard',name:'Mission Control',icon:'üìä',cat:'Command',desc:'Executive Dashboard'},
  {id:'pipeline',name:'Pipeline Intel',icon:'üîç',cat:'Strategy',desc:'Opportunity Tracking'},
  {id:'warroom',name:'War Room',icon:'‚öîÔ∏è',cat:'Strategy',desc:'Pursuit Strategy'},
  {id:'swarm',name:'Agent Swarm',icon:'ü§ñ',cat:'Strategy',desc:'AI Assistants'},
  {id:'compliance',name:'RFP Shredder',icon:'üìÑ',cat:'Intelligence',desc:'Compliance Matrix'},
  {id:'contracts',name:'Contract Scanner',icon:'‚öñÔ∏è',cat:'Intelligence',desc:'Risk Analysis'},
  {id:'writer',name:'Iron Dome',icon:'‚úçÔ∏è',cat:'Intelligence',desc:'AI Writing'},
  {id:'blackhat',name:'Black Hat',icon:'üé≠',cat:'Intelligence',desc:'Competitive Intel',badge:'PRIVATE'},
  {id:'pricing',name:'Pricing Engine',icon:'üíµ',cat:'Delivery',desc:'LCAT & BOE',badge:'CUI'},
  {id:'hitl',name:'HITL Queue',icon:'üëÅÔ∏è',cat:'Delivery',desc:'Review Queue'},
  {id:'orals',name:'Orals Studio',icon:'üé§',cat:'Delivery',desc:'Presentation Prep'},
  {id:'frenemy',name:'Frenemy Protocol',icon:'üõ°Ô∏è',cat:'Delivery',desc:'Partner Access'},
  {id:'launch',name:'Launch & ROI',icon:'üöÄ',cat:'Command',desc:'Submission'},
  {id:'post_award',name:'Post-Award',icon:'üì¶',cat:'Command',desc:'Transition'},
  {id:'playbook',name:'Playbook',icon:'üìö',cat:'Admin',desc:'Golden Examples'},
  {id:'admin',name:'Admin',icon:'‚öôÔ∏è',cat:'Admin',desc:'Settings',badge:'ADMIN'},
  {id:'training',name:'Training Hub',icon:'üéì',cat:'Admin',desc:'Company Onboarding'}
];

// 9 DEMO SCENES
const SCENES=[
  {id:1,title:'Parking Lot Intel',icon:'üé§',mod:'pipeline',desc:'Capture intel from customer conversations'},
  {id:2,title:'Instant Compliance',icon:'üìÑ',mod:'compliance',desc:'AI extracts requirements from RFP'},
  {id:3,title:'Green Team Miracle',icon:'üí∞',mod:'pricing',desc:'Automated LCAT mapping and BOE'},
  {id:4,title:'Iron Dome Drafter',icon:'‚úçÔ∏è',mod:'writer',desc:'AI generates proposal sections'},
  {id:5,title:'Frenemy View',icon:'üõ°Ô∏è',mod:'frenemy',desc:'Partner collaboration with data masking'},
  {id:6,title:'Orals Studio',icon:'üé§',mod:'orals',desc:'AI-powered presentation prep'},
  {id:7,title:'Crisis Room',icon:'‚ö†Ô∏è',mod:'warroom',desc:'Rapid response to amendments'},
  {id:8,title:'Launch Sequence',icon:'üöÄ',mod:'launch',desc:'Final submission countdown'},
  {id:9,title:'The Handoff',icon:'ü§ù',mod:'post_award',desc:'Transition to delivery team'}
];

// AI AGENTS
const AGENTS=[
  {id:'capture',name:'Capture Agent',icon:'üéØ',desc:'Win strategy'},
  {id:'strategy',name:'Strategy Agent',icon:'‚ôüÔ∏è',desc:'Competitive analysis'},
  {id:'compliance',name:'Compliance Agent',icon:'üìã',desc:'FAR/DFARS'},
  {id:'pricing',name:'Pricing Agent',icon:'üíµ',desc:'Cost modeling'},
  {id:'writer',name:'Writer Agent',icon:'‚úçÔ∏è',desc:'Section drafting'},
  {id:'contracts',name:'Contracts Agent',icon:'‚öñÔ∏è',desc:'T&C review'},
  {id:'orals',name:'Orals Coach',icon:'üé§',desc:'Presentation'},
  {id:'blackhat',name:'Black Hat',icon:'üé≠',desc:'Competitor sim',priv:true}
];

// DEMO DATA
const DEMO_OPPS=[
  {id:1,nickname:'DHA EHR Mod',title:'Electronic Health Record Modernization',agency:'DHA',ceiling:125000000,phase:'Capture',pwin:72,due:'2026-03-15'},
  {id:2,nickname:'VA Claims AI',title:'Veterans Benefits Claims Processing',agency:'VA',ceiling:89000000,phase:'Proposal',pwin:65,due:'2026-02-28'},
  {id:3,nickname:'CMS Analytics',title:'Medicare Data Analytics Platform',agency:'CMS',ceiling:156000000,phase:'Blue Team',pwin:78,due:'2026-04-01'},
  {id:4,nickname:'IHS Telehealth',title:'Telehealth Expansion Program',agency:'IHS',ceiling:45000000,phase:'Capture',pwin:68,due:'2026-03-30'},
  {id:5,nickname:'SSA Legacy',title:'Legacy System Modernization',agency:'SSA',ceiling:200000000,phase:'Qualify',pwin:55,due:'2026-05-15'}
];

const DEMO_COMPLIANCE=[
  {id:1,section:'L.4.1',req:'Technical Approach',status:'Compliant',owner:'Sarah Chen',risk:'Green'},
  {id:2,section:'L.4.2',req:'Past Performance',status:'In Progress',owner:'Marcus Williams',risk:'Yellow'},
  {id:3,section:'L.5.1',req:'Management Plan',status:'Draft',owner:'Lisa Martinez',risk:'Yellow'},
  {id:4,section:'M.1',req:'Pricing Volume',status:'Not Started',owner:'Jennifer Park',risk:'Red'},
  {id:5,section:'L.6',req:'Staffing Plan',status:'Compliant',owner:'Amanda Foster',risk:'Green'}
];

const DEMO_COMPETITORS=[
  {id:1,name:'Leidos',threat:'High',strengths:'Incumbent, strong DHA relationships',weaknesses:'Higher rates, slow innovation',strategy:'Emphasize agility and AI capabilities'},
  {id:2,name:'Booz Allen',threat:'Medium',strengths:'Analytics expertise',weaknesses:'No healthcare focus',strategy:'Highlight healthcare IT specialization'},
  {id:3,name:'GDIT',threat:'Medium',strengths:'Scale, clearances',weaknesses:'Recent contract issues',strategy:'Reference recent performance challenges'}
];

const DEMO_LCATS=[
  {id:1,title:'Program Manager',rate:185,hours:2080,total:384800},
  {id:2,title:'Sr. Software Engineer',rate:165,hours:4160,total:686400},
  {id:3,title:'Data Scientist',rate:155,hours:2080,total:322400},
  {id:4,title:'Cloud Architect',rate:175,hours:1040,total:182000},
  {id:5,title:'QA Analyst',rate:125,hours:2080,total:260000}
];

const DEMO_HITL=[
  {id:1,section:'Executive Summary',confidence:92,status:'Approved',reviewer:'Mary Womack'},
  {id:2,section:'Technical Approach',confidence:87,status:'Pending',reviewer:'Sarah Chen'},
  {id:3,section:'Past Performance',confidence:78,status:'Needs Review',reviewer:'Lisa Martinez'},
  {id:4,section:'Pricing Narrative',confidence:65,status:'Rejected',reviewer:'Jennifer Park'}
];

// AUTH CHECK
function checkAuth(){
  const s=localStorage.getItem('MP_SESSION'),u=localStorage.getItem('MP_USER');
  if(!s||!u){window.location.href='login.html';return null}
  try{return JSON.parse(u)}catch{return{email:'demo@mmt.com',role:'CEO',name:'Demo User'}}
}

// ICONS
const I={
  menu:()=><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16"/></svg>,
  x:()=><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>,
  chev:()=><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7"/></svg>,
  chevR:()=><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7"/></svg>,
  out:()=><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"/></svg>,
  shield:()=><svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
  send:()=><svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/></svg>,
  play:()=><svg className="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>,
  check:()=><svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>,
};

// FORMAT
const fmt=v=>{if(v>=1e9)return`$${(v/1e9).toFixed(1)}B`;if(v>=1e6)return`$${(v/1e6).toFixed(0)}M`;return`$${(v||0).toLocaleString()}`};

// SIDEBAR
function Sidebar({col,setCol,active,setActive,role,demo,setDemo}){
  const acc=ROLES.find(r=>r.id===role)?.access||[];
  const has=id=>role==='Admin'||acc.includes(id);
  const cats=['Strategy','Intelligence','Delivery','Command','Admin'];
  return(
    <aside className={`fixed left-0 top-0 h-full bg-slate-900/95 border-r border-slate-700/50 transition-all z-40 flex flex-col ${col?'w-16':'w-64'}`}>
      <div className="h-14 flex items-center justify-between px-3 border-b border-slate-700/50">
        {!col&&<div className="flex items-center gap-2"><div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center text-white"><I.shield/></div><span className="font-bold text-white">MissionPulse</span></div>}
        {col&&<div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center text-white mx-auto"><I.shield/></div>}
      </div>
      {!col&&<div className="p-2 border-b border-slate-700/50"><button onClick={()=>setDemo(!demo)} className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg text-sm font-medium ${demo?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'bg-slate-800 text-slate-400'}`}><I.play/><span>Demo Mode</span>{demo&&<span className="ml-auto text-xs bg-cyan-500 text-black px-1.5 rounded">ON</span>}</button></div>}
      <nav className="flex-1 p-2 overflow-y-auto">
        {cats.map(cat=>{
          const mods=MODULES.filter(m=>m.cat===cat&&has(m.id));
          if(!mods.length)return null;
          return(<div key={cat} className="mb-2">{!col&&<div className="px-3 py-1.5 text-xs font-semibold text-slate-500 uppercase">{cat}</div>}{mods.map(m=><button key={m.id} onClick={()=>setActive(m.id)} className={`w-full flex items-center gap-2 px-3 py-2 rounded-lg mb-0.5 transition ${active===m.id?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'text-slate-400 hover:bg-slate-800 hover:text-white'}`} title={col?m.name:''}><span className="text-base">{m.icon}</span>{!col&&<><span className="flex-1 text-left text-sm">{m.name}</span>{m.badge&&<span className={`px-1 py-0.5 text-[9px] font-bold rounded ${m.badge==='PRIVATE'?'bg-amber-500/20 text-amber-400':m.badge==='CUI'?'bg-red-500/20 text-red-400':'bg-slate-600'}`}>{m.badge}</span>}</>}</button>)}</div>);
        })}
      </nav>
      <button onClick={()=>setCol(!col)} className="p-3 border-t border-slate-700/50 text-slate-400 hover:text-white flex justify-center"><span className={`transform ${col?'':'rotate-180'}`}><I.chevR/></span></button>
    </aside>
  );
}

// HEADER
function Header({user,role,setRole,col,active}){
  const[dd,setDd]=useState(false);
  const r=ROLES.find(x=>x.id===role);
  const m=MODULES.find(x=>x.id===active);
  const logout=()=>{localStorage.clear();window.location.href='login.html'};
  return(
    <header className={`fixed top-0 right-0 h-14 bg-slate-900/90 backdrop-blur border-b border-slate-700/50 z-30 transition-all ${col?'left-16':'left-64'}`}>
      <div className="h-full px-4 flex items-center justify-between">
        <div className="flex items-center gap-2"><span className="text-xl">{m?.icon}</span><div><h1 className="text-base font-semibold text-white">{m?.name}</h1><p className="text-xs text-slate-400">{m?.desc}</p></div></div>
        <div className="flex items-center gap-3">
          <div className="relative">
            <button onClick={()=>setDd(!dd)} className="flex items-center gap-2 px-2 py-1.5 rounded-lg bg-slate-800 border border-slate-700 hover:border-cyan-500/50"><span className="text-base">{r?.icon}</span><span className="text-sm font-medium text-white hidden sm:inline">{r?.name}</span><I.chev/></button>
            {dd&&<div className="absolute right-0 mt-2 w-64 bg-slate-800 border border-slate-700 rounded-xl shadow-2xl py-1 max-h-80 overflow-y-auto animate-fadeIn z-50">{ROLES.map(x=><button key={x.id} onClick={()=>{setRole(x.id);setDd(false)}} className={`w-full flex items-center gap-2 px-3 py-2 hover:bg-slate-700 ${role===x.id?'bg-cyan-500/10':''}`}><span className="text-lg">{x.icon}</span><div className="flex-1 text-left"><div className="text-sm text-white">{x.name}</div><div className="text-xs text-slate-400">{x.fn}</div></div>{role===x.id&&<span className="text-cyan-400">‚úì</span>}</button>)}</div>}
          </div>
          <div className="flex items-center gap-2 pl-3 border-l border-slate-700">
            <div className="w-7 h-7 rounded-full bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center text-white font-bold text-xs">{user?.name?.[0]||'U'}</div>
            <button onClick={logout} className="p-1.5 text-slate-400 hover:text-red-400" title="Sign Out"><I.out/></button>
          </div>
        </div>
      </div>
    </header>
  );
}

// DEMO FLOW
function DemoFlow({scene,setScene,setActive}){
  return(
    <div className="glass rounded-xl p-3 mb-4 animate-fadeIn">
      <div className="flex items-center justify-between mb-2"><span className="text-sm font-medium text-white flex items-center gap-1"><I.play/>Demo Flow</span><span className="text-xs text-cyan-400">Scene {scene+1}/9</span></div>
      <div className="flex gap-1.5 overflow-x-auto pb-1">
        {SCENES.map((s,i)=><button key={s.id} onClick={()=>{setScene(i);setActive(s.mod)}} className={`flex-shrink-0 px-2.5 py-1.5 rounded-lg text-xs font-medium transition ${scene===i?'bg-cyan-500 text-black':'bg-slate-800 text-slate-400 hover:text-white'}`}>{s.icon} {s.title}</button>)}
      </div>
    </div>
  );
}

// AI CHAT
function Chat({agent,setAgent}){
  const[open,setOpen]=useState(false);
  const[msgs,setMsgs]=useState([]);
  const[input,setInput]=useState('');
  const[loading,setLoading]=useState(false);
  const ref=useRef(null);
  useEffect(()=>{ref.current?.scrollIntoView({behavior:'smooth'})},[msgs]);
  useEffect(()=>{if(agent){setMsgs([{role:'ai',text:`Hi! I'm the ${agent.name}. ${agent.desc}. How can I help?`}]);setOpen(true)}},[agent]);
  const send=async()=>{
    if(!input.trim()||loading)return;
    setMsgs(p=>[...p,{role:'user',text:input}]);
    const q=input;setInput('');setLoading(true);
    try{
      const res=await fetch(`${CONFIG.API_URL}/api/chat`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({message:q,agent:agent?.id||'capture'})});
      if(res.ok){const d=await res.json();setMsgs(p=>[...p,{role:'ai',text:d.response||d.message}])}
      else throw new Error();
    }catch{
      setTimeout(()=>setMsgs(p=>[...p,{role:'ai',text:`Great question about "${q}". As the ${agent?.name||'AI'}, I recommend focusing on compliance and win themes.\n\n*Demo mode - connect API for full response*`}]),600);
    }
    setLoading(false);
  };
  if(!open)return<button onClick={()=>setOpen(true)} className="fixed bottom-4 right-4 w-12 h-12 bg-gradient-to-r from-cyan-500 to-teal-500 rounded-full shadow-lg flex items-center justify-center text-white hover:scale-105 transition z-50">ü§ñ</button>;
  return(
    <div className="fixed bottom-4 right-4 w-80 h-96 glass rounded-xl shadow-2xl flex flex-col z-50 animate-fadeIn">
      <div className="p-3 border-b border-slate-700/50 flex items-center justify-between">
        <div className="flex items-center gap-2"><span className="text-xl">{agent?.icon||'ü§ñ'}</span><div><div className="text-sm font-medium text-white">{agent?.name||'AI Assistant'}</div><div className="text-xs text-slate-400">{agent?.desc}</div></div></div>
        <button onClick={()=>setOpen(false)} className="p-1 text-slate-400 hover:text-white"><I.x/></button>
      </div>
      <div className="p-2 border-b border-slate-700/50 flex gap-1 overflow-x-auto">{AGENTS.filter(a=>!a.priv).map(a=><button key={a.id} onClick={()=>setAgent(a)} className={`px-2 py-1 rounded text-xs ${agent?.id===a.id?'bg-cyan-500/20 text-cyan-400':'text-slate-400 hover:bg-slate-700'}`}>{a.icon}</button>)}</div>
      <div className="flex-1 overflow-y-auto p-3 space-y-2">
        {msgs.map((m,i)=><div key={i} className={`flex ${m.role==='user'?'justify-end':'justify-start'}`}><div className={`max-w-[85%] p-2 rounded-xl text-sm ${m.role==='user'?'bg-cyan-500 text-white':'bg-slate-700 text-slate-200'}`}>{m.text}</div></div>)}
        {loading&&<div className="flex justify-start"><div className="bg-slate-700 p-2 rounded-xl"><div className="flex gap-1"><div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse"></div><div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse" style={{animationDelay:'0.2s'}}></div><div className="w-1.5 h-1.5 bg-slate-400 rounded-full animate-pulse" style={{animationDelay:'0.4s'}}></div></div></div></div>}
        <div ref={ref}/>
      </div>
      <div className="p-2 border-t border-slate-700/50 flex gap-2">
        <input value={input} onChange={e=>setInput(e.target.value)} onKeyPress={e=>e.key==='Enter'&&send()} placeholder="Ask anything..." className="flex-1 bg-slate-800 border border-slate-700 rounded-lg px-3 py-1.5 text-sm text-white focus:outline-none focus:border-cyan-500"/>
        <button onClick={send} disabled={!input.trim()||loading} className="p-1.5 bg-cyan-500 rounded-lg text-white disabled:opacity-50"><I.send/></button>
      </div>
    </div>
  );
}

// ============================================================
// MODULE COMPONENTS
// ============================================================

// M1 DASHBOARD
function M_Dashboard({opps,demo,scene,setScene,setActive}){
  const stats={val:opps.reduce((s,o)=>s+(parseFloat(o.ceiling)||0),0),cnt:opps.length};
  return(
    <div className="space-y-4 animate-fadeIn">
      {demo&&<DemoFlow scene={scene} setScene={setScene} setActive={setActive}/>}
      <div className="glass rounded-xl p-5 bg-gradient-to-r from-cyan-500/10 to-teal-500/10">
        <div className="flex items-center justify-between"><div><h2 className="text-xl font-bold text-white">Welcome to MissionPulse</h2><p className="text-slate-400 text-sm">AI-powered proposal management</p><p className="text-cyan-400 text-xs mt-1">Mission. Technology. Transformation.</p></div><div className="text-5xl">üéØ</div></div>
      </div>
      <div className="grid grid-cols-4 gap-3">
        {[{l:'Pipeline Value',v:fmt(stats.val),c:'emerald',s:'‚Üë12%'},{l:'Active Pursuits',v:stats.cnt,c:'cyan',s:`${Math.ceil(stats.cnt*0.4)} hot`},{l:'Avg pWin',v:'72%',c:'amber',s:'Above target'},{l:'Hours Saved',v:'340+',c:'purple',s:'Per proposal'}].map((k,i)=><div key={i} className="glass rounded-lg p-4"><div className="text-slate-400 text-xs mb-1">{k.l}</div><div className="text-xl font-bold text-white">{k.v}</div><div className={`text-${k.c}-400 text-xs`}>{k.s}</div></div>)}
      </div>
      <div className="glass rounded-xl overflow-hidden">
        <div className="p-3 border-b border-slate-700/50 flex justify-between items-center"><span className="font-medium text-white">Active Pipeline</span><span className="text-xs text-slate-400">{opps.length} opportunities</span></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Opportunity','Agency','Value','Phase','pWin'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{opps.map(o=><tr key={o.id} className="hover:bg-slate-800/30"><td className="p-3"><div className="font-medium text-white text-sm">{o.nickname}</div><div className="text-xs text-slate-500">{o.title}</div></td><td className="p-3 text-sm text-slate-300">{o.agency}</td><td className="p-3 text-sm text-emerald-400">{fmt(o.ceiling)}</td><td className="p-3"><span className="px-2 py-0.5 rounded text-xs bg-cyan-500/20 text-cyan-400">{o.phase}</span></td><td className="p-3"><div className="flex items-center gap-2"><div className="w-14 h-1.5 bg-slate-700 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-cyan-500 to-emerald-500" style={{width:`${o.pwin}%`}}/></div><span className="text-xs text-slate-300">{o.pwin}%</span></div></td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// M2 PIPELINE
function M_Pipeline({opps}){
  const[filter,setFilter]=useState('all');
  const phases=['Qualify','Capture','Proposal','Blue Team','Submitted'];
  const filtered=filter==='all'?opps:opps.filter(o=>o.phase===filter);
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-lg font-bold text-white">Pipeline Intelligence</h2><p className="text-slate-400 text-sm">Track opportunities through Shipley phases</p></div><button className="px-3 py-1.5 bg-cyan-500 text-white rounded-lg text-sm font-medium">+ Add Opportunity</button></div>
      <div className="flex gap-2 overflow-x-auto pb-1"><button onClick={()=>setFilter('all')} className={`px-3 py-1.5 rounded-lg text-sm ${filter==='all'?'bg-cyan-500 text-white':'bg-slate-800 text-slate-400'}`}>All ({opps.length})</button>{phases.map(p=><button key={p} onClick={()=>setFilter(p)} className={`px-3 py-1.5 rounded-lg text-sm whitespace-nowrap ${filter===p?'bg-cyan-500 text-white':'bg-slate-800 text-slate-400'}`}>{p} ({opps.filter(o=>o.phase===p).length})</button>)}</div>
      <div className="grid grid-cols-3 gap-3">{filtered.map(o=><div key={o.id} className="glass rounded-xl p-4 hover:border-cyan-500/30 cursor-pointer transition"><div className="flex justify-between mb-2"><span className="px-2 py-0.5 rounded text-xs bg-cyan-500/20 text-cyan-400">{o.phase}</span><span className="text-emerald-400 font-semibold text-sm">{fmt(o.ceiling)}</span></div><h4 className="font-medium text-white mb-1">{o.nickname}</h4><p className="text-xs text-slate-400 line-clamp-2 mb-2">{o.title}</p><div className="flex justify-between items-center"><span className="text-xs text-slate-500">{o.agency}</span><span className="text-xs text-slate-400">{o.pwin}% pWin</span></div></div>)}</div>
    </div>
  );
}

// M3 WAR ROOM
function M_WarRoom(){
  const phases=['Gate 1','Blue Team','Pink Team','Red Team','Gold Team','White Glove'];
  const[active,setActive]=useState(2);
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">War Room</h2><p className="text-slate-400 text-sm">Shipley workflow command center</p></div>
      <div className="glass rounded-xl p-4">
        <div className="flex justify-between items-center mb-4">{phases.map((p,i)=><div key={p} className="flex flex-col items-center"><div className={`w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold ${i<active?'bg-emerald-500 text-white':i===active?'bg-cyan-500 text-white animate-pulse':'bg-slate-700 text-slate-400'}`}>{i+1}</div><span className={`text-xs mt-1 ${i===active?'text-cyan-400':'text-slate-500'}`}>{p}</span></div>)}</div>
        <div className="glass rounded-lg p-4 bg-cyan-500/5 border-cyan-500/30"><h3 className="font-semibold text-white mb-2">Current Phase: {phases[active]}</h3><p className="text-sm text-slate-400">Review in progress. 3 action items pending.</p></div>
      </div>
      <div className="grid grid-cols-2 gap-3">
        <div className="glass rounded-xl p-4"><h4 className="font-medium text-white mb-3">‚ö†Ô∏è Action Items</h4><div className="space-y-2">{['Complete Section L.4 draft','Schedule Pink Team review','Update pricing model'].map((t,i)=><div key={i} className="flex items-center gap-2 text-sm"><input type="checkbox" className="rounded border-slate-600"/><span className="text-slate-300">{t}</span></div>)}</div></div>
        <div className="glass rounded-xl p-4"><h4 className="font-medium text-white mb-3">üìÖ Upcoming</h4><div className="space-y-2">{[{d:'Jan 28',e:'Pink Team Review'},{d:'Jan 30',e:'Pricing Lock'},{d:'Feb 1',e:'Red Team'}].map((x,i)=><div key={i} className="flex justify-between text-sm"><span className="text-slate-400">{x.d}</span><span className="text-white">{x.e}</span></div>)}</div></div>
      </div>
    </div>
  );
}

// M4 COMPLIANCE / RFP SHREDDER
function M_Compliance(){
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-lg font-bold text-white">RFP Shredder</h2><p className="text-slate-400 text-sm">AI-powered compliance matrix</p></div><button className="px-3 py-1.5 bg-cyan-500 text-white rounded-lg text-sm">üì§ Upload RFP</button></div>
      <div className="glass rounded-xl overflow-hidden">
        <div className="p-3 border-b border-slate-700/50 flex justify-between"><span className="font-medium text-white">Compliance Matrix</span><span className="text-xs text-emerald-400">3/5 Compliant</span></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Section','Requirement','Status','Owner','Risk'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{DEMO_COMPLIANCE.map(c=><tr key={c.id} className="hover:bg-slate-800/30"><td className="p-3 text-sm font-mono text-cyan-400">{c.section}</td><td className="p-3 text-sm text-white">{c.req}</td><td className="p-3"><span className={`px-2 py-0.5 rounded text-xs ${c.status==='Compliant'?'bg-emerald-500/20 text-emerald-400':c.status==='In Progress'?'bg-amber-500/20 text-amber-400':'bg-slate-600 text-slate-300'}`}>{c.status}</span></td><td className="p-3 text-sm text-slate-300">{c.owner}</td><td className="p-3"><span className={`w-3 h-3 rounded-full inline-block ${c.risk==='Green'?'bg-emerald-500':c.risk==='Yellow'?'bg-amber-500':'bg-red-500'}`}/></td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// M5 CONTRACTS
function M_Contracts(){
  const risks=[{item:'Liquidated Damages',level:'High',note:'$50K/day clause'},{item:'IP Rights',level:'Medium',note:'Gov retains unlimited rights'},{item:'Key Personnel',level:'Low',note:'Standard replacement clause'},{item:'Travel',level:'Low',note:'Reimbursable at GSA rates'}];
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">Contract Scanner</h2><p className="text-slate-400 text-sm">T&C risk analysis</p></div>
      <div className="glass rounded-xl p-4">
        <h3 className="font-medium text-white mb-3">Risk Assessment</h3>
        <div className="space-y-2">{risks.map((r,i)=><div key={i} className="flex items-center justify-between p-2 rounded-lg bg-slate-800/50"><div className="flex items-center gap-3"><span className={`w-2 h-8 rounded ${r.level==='High'?'bg-red-500':r.level==='Medium'?'bg-amber-500':'bg-emerald-500'}`}/><div><div className="text-sm font-medium text-white">{r.item}</div><div className="text-xs text-slate-400">{r.note}</div></div></div><span className={`px-2 py-0.5 rounded text-xs ${r.level==='High'?'bg-red-500/20 text-red-400':r.level==='Medium'?'bg-amber-500/20 text-amber-400':'bg-emerald-500/20 text-emerald-400'}`}>{r.level}</span></div>)}</div>
      </div>
    </div>
  );
}

// M6 WRITER / IRON DOME
function M_Writer(){
  const[section,setSection]=useState('');
  const[output,setOutput]=useState('');
  const[loading,setLoading]=useState(false);
  const generate=()=>{setLoading(true);setTimeout(()=>{setOutput(`## Executive Summary\n\nMission Meets Tech (MMT) proposes a comprehensive solution for the ${section||'Technical Approach'} requirement. Our team brings 15+ years of federal healthcare IT experience...\n\n**Key Differentiators:**\n- AI-powered analytics platform\n- HITRUST certified infrastructure\n- 98% customer satisfaction rate\n\n*AI GENERATED - REQUIRES HUMAN REVIEW*`);setLoading(false)},1500)};
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">Iron Dome Drafter</h2><p className="text-slate-400 text-sm">CUI-aware AI writing</p></div>
      <div className="grid grid-cols-2 gap-4">
        <div className="glass rounded-xl p-4">
          <h3 className="font-medium text-white mb-3">Section Input</h3>
          <select value={section} onChange={e=>setSection(e.target.value)} className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white mb-3"><option value="">Select section...</option><option>Executive Summary</option><option>Technical Approach</option><option>Management Plan</option><option>Past Performance</option></select>
          <textarea placeholder="Additional context or requirements..." className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white h-32 resize-none mb-3"/>
          <button onClick={generate} disabled={loading} className="w-full py-2 bg-cyan-500 text-white rounded-lg font-medium disabled:opacity-50">{loading?'Generating...':'‚ú® Generate Draft'}</button>
        </div>
        <div className="glass rounded-xl p-4">
          <h3 className="font-medium text-white mb-3">AI Output</h3>
          <div className="bg-slate-800/50 rounded-lg p-3 h-64 overflow-y-auto text-sm text-slate-300 whitespace-pre-wrap">{output||'Generated content will appear here...'}</div>
          {output&&<div className="mt-2 flex gap-2"><button className="px-3 py-1 bg-emerald-500/20 text-emerald-400 rounded text-sm">‚úì Accept</button><button className="px-3 py-1 bg-slate-700 text-slate-300 rounded text-sm">‚úé Edit</button></div>}
        </div>
      </div>
    </div>
  );
}

// M7 BLACK HAT
function M_BlackHat({role}){
  if(role!=='CAP'&&role!=='Admin')return<div className="glass rounded-xl p-8 text-center"><div className="text-5xl mb-4">üîí</div><h2 className="text-xl font-bold text-white mb-2">Access Restricted</h2><p className="text-slate-400">Black Hat intel requires Capture Manager or Admin access</p></div>;
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex items-center gap-2"><h2 className="text-lg font-bold text-white">Black Hat Review</h2><span className="px-2 py-0.5 bg-amber-500/20 text-amber-400 rounded text-xs font-bold">PRIVATE</span></div>
      <p className="text-slate-400 text-sm">Competitive intelligence analysis</p>
      <div className="space-y-3">{DEMO_COMPETITORS.map(c=><div key={c.id} className="glass rounded-xl p-4"><div className="flex justify-between items-start mb-3"><h3 className="font-semibold text-white">{c.name}</h3><span className={`px-2 py-0.5 rounded text-xs ${c.threat==='High'?'bg-red-500/20 text-red-400':'bg-amber-500/20 text-amber-400'}`}>{c.threat} Threat</span></div><div className="grid grid-cols-3 gap-3 text-sm"><div><div className="text-slate-500 text-xs mb-1">Strengths</div><div className="text-slate-300">{c.strengths}</div></div><div><div className="text-slate-500 text-xs mb-1">Weaknesses</div><div className="text-slate-300">{c.weaknesses}</div></div><div><div className="text-slate-500 text-xs mb-1">Counter Strategy</div><div className="text-cyan-400">{c.strategy}</div></div></div></div>)}</div>
    </div>
  );
}

// M8 PRICING
function M_Pricing(){
  const total=DEMO_LCATS.reduce((s,l)=>s+l.total,0);
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex items-center gap-2"><h2 className="text-lg font-bold text-white">Pricing Engine</h2><span className="px-2 py-0.5 bg-red-500/20 text-red-400 rounded text-xs font-bold">CUI</span></div>
      <div className="grid grid-cols-3 gap-3">
        <div className="glass rounded-lg p-4"><div className="text-slate-400 text-xs">Direct Labor</div><div className="text-xl font-bold text-white">{fmt(total)}</div></div>
        <div className="glass rounded-lg p-4"><div className="text-slate-400 text-xs">Wrap Rate</div><div className="text-xl font-bold text-white">1.85x</div></div>
        <div className="glass rounded-lg p-4"><div className="text-slate-400 text-xs">Total Price</div><div className="text-xl font-bold text-emerald-400">{fmt(total*1.85)}</div></div>
      </div>
      <div className="glass rounded-xl overflow-hidden">
        <div className="p-3 border-b border-slate-700/50"><span className="font-medium text-white">LCAT Pricing</span></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Labor Category','Rate/Hr','Hours','Total'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{DEMO_LCATS.map(l=><tr key={l.id}><td className="p-3 text-sm text-white">{l.title}</td><td className="p-3 text-sm text-slate-300">${l.rate}</td><td className="p-3 text-sm text-slate-300">{l.hours.toLocaleString()}</td><td className="p-3 text-sm text-emerald-400">{fmt(l.total)}</td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// M9 HITL
function M_HITL(){
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">HITL Review Queue</h2><p className="text-slate-400 text-sm">Human-in-the-Loop approvals</p></div>
      <div className="space-y-3">{DEMO_HITL.map(h=><div key={h.id} className="glass rounded-xl p-4"><div className="flex justify-between items-start mb-2"><div><h4 className="font-medium text-white">{h.section}</h4><p className="text-xs text-slate-400">Reviewer: {h.reviewer}</p></div><span className={`px-2 py-0.5 rounded text-xs ${h.status==='Approved'?'bg-emerald-500/20 text-emerald-400':h.status==='Pending'?'bg-amber-500/20 text-amber-400':h.status==='Needs Review'?'bg-cyan-500/20 text-cyan-400':'bg-red-500/20 text-red-400'}`}>{h.status}</span></div><div className="flex items-center gap-2"><span className="text-xs text-slate-500">AI Confidence:</span><div className="flex-1 h-2 bg-slate-700 rounded-full overflow-hidden"><div className={`h-full ${h.confidence>=85?'bg-emerald-500':h.confidence>=70?'bg-amber-500':'bg-red-500'}`} style={{width:`${h.confidence}%`}}/></div><span className="text-sm font-medium text-white">{h.confidence}%</span></div>{h.status==='Pending'&&<div className="flex gap-2 mt-3"><button className="px-3 py-1 bg-emerald-500 text-white rounded text-sm">‚úì Approve</button><button className="px-3 py-1 bg-red-500/20 text-red-400 rounded text-sm">‚úó Reject</button></div>}</div>)}</div>
    </div>
  );
}

// M10 ORALS
function M_Orals(){
  const slides=[{title:'Opening',time:'2 min'},{title:'Technical Approach',time:'10 min'},{title:'Management',time:'8 min'},{title:'Past Performance',time:'5 min'},{title:'Q&A Prep',time:'15 min'}];
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">Orals Studio</h2><p className="text-slate-400 text-sm">Presentation preparation</p></div>
      <div className="glass rounded-xl p-4">
        <h3 className="font-medium text-white mb-3">Presentation Outline</h3>
        <div className="space-y-2">{slides.map((s,i)=><div key={i} className="flex items-center justify-between p-3 rounded-lg bg-slate-800/50"><div className="flex items-center gap-3"><span className="w-8 h-8 rounded-lg bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-sm font-bold">{i+1}</span><span className="text-white">{s.title}</span></div><span className="text-sm text-slate-400">{s.time}</span></div>)}</div>
      </div>
      <button className="w-full py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl font-medium">üé¨ Generate Slides</button>
    </div>
  );
}

// M11 FRENEMY
function M_Frenemy(){
  const partners=[{name:'TechPartners Inc',access:'Read Only',expires:'Feb 15, 2026',sections:['Technical']},{name:'CloudSecure LLC',access:'Contributor',expires:'Feb 28, 2026',sections:['Security','Cloud']}];
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-lg font-bold text-white">Frenemy Protocol</h2><p className="text-slate-400 text-sm">Partner access control</p></div><button className="px-3 py-1.5 bg-cyan-500 text-white rounded-lg text-sm">+ Invite Partner</button></div>
      <div className="space-y-3">{partners.map((p,i)=><div key={i} className="glass rounded-xl p-4"><div className="flex justify-between items-start mb-3"><div><h4 className="font-medium text-white">{p.name}</h4><p className="text-xs text-slate-400">Expires: {p.expires}</p></div><span className="px-2 py-0.5 bg-cyan-500/20 text-cyan-400 rounded text-xs">{p.access}</span></div><div className="flex items-center gap-2"><span className="text-xs text-slate-500">Sections:</span>{p.sections.map(s=><span key={s} className="px-2 py-0.5 bg-slate-700 rounded text-xs text-slate-300">{s}</span>)}</div><div className="mt-3 p-2 rounded-lg bg-amber-500/10 border border-amber-500/20"><span className="text-xs text-amber-400">‚ö†Ô∏è Pricing & Black Hat data masked for this partner</span></div></div>)}</div>
    </div>
  );
}

// M12 LAUNCH
function M_Launch(){
  const checks=[{item:'All volumes complete',done:true},{item:'Compliance matrix 100%',done:true},{item:'Pricing locked',done:false},{item:'Final QA review',done:false},{item:'PDF generation',done:false}];
  const done=checks.filter(c=>c.done).length;
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">Launch Sequence</h2><p className="text-slate-400 text-sm">Final submission countdown</p></div>
      <div className="glass rounded-xl p-6 text-center bg-gradient-to-r from-purple-500/10 to-pink-500/10">
        <div className="text-5xl font-bold text-white mb-2">14d 6h 32m</div>
        <p className="text-slate-400">Until submission deadline</p>
      </div>
      <div className="glass rounded-xl p-4">
        <div className="flex justify-between items-center mb-3"><h3 className="font-medium text-white">Pre-Flight Checklist</h3><span className="text-sm text-cyan-400">{done}/{checks.length} Complete</span></div>
        <div className="space-y-2">{checks.map((c,i)=><div key={i} className="flex items-center gap-3 p-2 rounded-lg hover:bg-slate-800/50"><input type="checkbox" checked={c.done} readOnly className="rounded border-slate-600"/><span className={c.done?'text-slate-500 line-through':'text-white'}>{c.item}</span></div>)}</div>
      </div>
      <button className="w-full py-3 bg-gradient-to-r from-emerald-500 to-teal-500 text-white rounded-xl font-bold disabled:opacity-50" disabled={done<checks.length}>üöÄ SUBMIT PROPOSAL</button>
    </div>
  );
}

// M13 POST-AWARD
function M_PostAward(){
  const tasks=[{task:'Kickoff meeting',owner:'PM',due:'Day 1',status:'Pending'},{task:'Key personnel onboard',owner:'HR',due:'Day 7',status:'Pending'},{task:'Systems access',owner:'IT',due:'Day 3',status:'Pending'},{task:'Incumbent handoff',owner:'Delivery',due:'Day 14',status:'Pending'}];
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">Post-Award Transition</h2><p className="text-slate-400 text-sm">Contract startup planning</p></div>
      <div className="glass rounded-xl overflow-hidden">
        <div className="p-3 border-b border-slate-700/50"><span className="font-medium text-white">Transition Checklist</span></div>
        <table className="w-full"><thead className="bg-slate-800/50"><tr>{['Task','Owner','Due','Status'].map(h=><th key={h} className="text-left p-3 text-xs font-semibold text-slate-400 uppercase">{h}</th>)}</tr></thead>
        <tbody className="divide-y divide-slate-700/50">{tasks.map((t,i)=><tr key={i}><td className="p-3 text-sm text-white">{t.task}</td><td className="p-3 text-sm text-slate-300">{t.owner}</td><td className="p-3 text-sm text-slate-400">{t.due}</td><td className="p-3"><span className="px-2 py-0.5 bg-amber-500/20 text-amber-400 rounded text-xs">{t.status}</span></td></tr>)}</tbody></table>
      </div>
    </div>
  );
}

// M14 SWARM
function M_Swarm({setAgent}){
  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">AI Agent Swarm</h2><p className="text-slate-400 text-sm">Your proposal intelligence team</p></div>
      <div className="grid grid-cols-2 gap-3">{AGENTS.map(a=><button key={a.id} onClick={()=>!a.priv&&setAgent(a)} disabled={a.priv} className={`glass rounded-xl p-4 text-left hover:border-cyan-500/30 transition ${a.priv?'opacity-50 cursor-not-allowed':''}`}><div className="flex items-start gap-3"><div className="text-3xl">{a.icon}</div><div className="flex-1"><div className="flex items-center gap-2"><span className="font-medium text-white">{a.name}</span>{a.priv&&<span className="px-1.5 py-0.5 bg-amber-500/20 text-amber-400 rounded text-xs">PRIVATE</span>}</div><p className="text-sm text-slate-400">{a.desc}</p>{!a.priv&&<div className="text-xs text-cyan-400 mt-2">Launch Chat ‚Üí</div>}</div></div></button>)}</div>
    </div>
  );
}

// M15 PLAYBOOK
function M_Playbook(){
  const examples=[{title:'Executive Summary - DHA Win',score:95,cat:'Writing'},{title:'Pricing Strategy - VA',score:88,cat:'Pricing'},{title:'Win Theme - Innovation',score:92,cat:'Strategy'}];
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex justify-between items-center"><div><h2 className="text-lg font-bold text-white">Lessons Playbook</h2><p className="text-slate-400 text-sm">Golden examples library</p></div><button className="px-3 py-1.5 bg-cyan-500 text-white rounded-lg text-sm">+ Add Example</button></div>
      <div className="space-y-3">{examples.map((e,i)=><div key={i} className="glass rounded-xl p-4 flex justify-between items-center"><div><h4 className="font-medium text-white">{e.title}</h4><span className="text-xs text-slate-400">{e.cat}</span></div><div className="flex items-center gap-3"><span className="text-sm text-emerald-400">‚≠ê {e.score}</span><button className="text-xs text-cyan-400">View ‚Üí</button></div></div>)}</div>
    </div>
  );
}

// M16 ADMIN
function M_Admin(){
  return(
    <div className="space-y-4 animate-fadeIn">
      <div className="flex items-center gap-2"><h2 className="text-lg font-bold text-white">Admin Settings</h2><span className="px-2 py-0.5 bg-purple-500/20 text-purple-400 rounded text-xs font-bold">ADMIN</span></div>
      <div className="grid grid-cols-2 gap-3">
        {[{icon:'üë•',title:'User Management',desc:'Manage team access'},{icon:'üîó',title:'Integrations',desc:'Connect external tools'},{icon:'üé®',title:'Branding',desc:'Customize appearance'},{icon:'üìä',title:'Analytics',desc:'Usage metrics'}].map((s,i)=><div key={i} className="glass rounded-xl p-4 hover:border-cyan-500/30 cursor-pointer transition"><div className="text-2xl mb-2">{s.icon}</div><h4 className="font-medium text-white">{s.title}</h4><p className="text-sm text-slate-400">{s.desc}</p></div>)}
      </div>
    </div>
  );
}

// M17 TRAINING HUB - Company Onboarding & AI Training
function M_Training(){
  const[tab,setTab]=useState('company');
  const[uploads,setUploads]=useState([]);
  const[training,setTraining]=useState(false);
  const[progress,setProgress]=useState(0);
  
  const handleUpload=(type)=>{
    const newFile={id:Date.now(),name:`${type}_document_${uploads.length+1}.pdf`,type,status:'Ready',size:'2.4 MB'};
    setUploads(p=>[...p,newFile]);
  };
  
  const startTraining=()=>{
    setTraining(true);
    setProgress(0);
    const interval=setInterval(()=>{
      setProgress(p=>{
        if(p>=100){clearInterval(interval);setTraining(false);return 100}
        return p+10;
      });
    },500);
  };

  return(
    <div className="space-y-4 animate-fadeIn">
      <div><h2 className="text-lg font-bold text-white">üéì Training Hub</h2><p className="text-slate-400 text-sm">Onboard your company and train AI on your content</p></div>
      
      {/* Tabs */}
      <div className="flex gap-2 border-b border-slate-700 pb-2">
        {[{id:'company',label:'Company Profile',icon:'üè¢'},{id:'documents',label:'Upload Documents',icon:'üìÑ'},{id:'training',label:'AI Training',icon:'ü§ñ'},{id:'integrations',label:'Integrations',icon:'üîó'}].map(t=><button key={t.id} onClick={()=>setTab(t.id)} className={`px-4 py-2 rounded-lg text-sm font-medium transition ${tab===t.id?'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30':'text-slate-400 hover:text-white'}`}>{t.icon} {t.label}</button>)}
      </div>

      {/* Company Profile Tab */}
      {tab==='company'&&(
        <div className="glass rounded-xl p-6 space-y-4">
          <h3 className="font-semibold text-white">Company Information</h3>
          <div className="grid grid-cols-2 gap-4">
            <div><label className="text-sm text-slate-400 block mb-1">Company Name</label><input type="text" defaultValue="Mission Meets Tech" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white"/></div>
            <div><label className="text-sm text-slate-400 block mb-1">CAGE Code</label><input type="text" placeholder="XXXXX" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white"/></div>
            <div><label className="text-sm text-slate-400 block mb-1">DUNS/UEI</label><input type="text" placeholder="Enter UEI" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white"/></div>
            <div><label className="text-sm text-slate-400 block mb-1">Primary NAICS</label><input type="text" placeholder="541512" className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white"/></div>
          </div>
          <div><label className="text-sm text-slate-400 block mb-1">Company Description</label><textarea placeholder="Brief company overview for proposals..." className="w-full bg-slate-800 border border-slate-700 rounded-lg px-3 py-2 text-white h-24 resize-none"/></div>
          <div><label className="text-sm text-slate-400 block mb-1">Certifications</label>
            <div className="flex flex-wrap gap-2">{['SDVOSB','WOSB','8(a)','HUBZone','MBE'].map(c=><label key={c} className="flex items-center gap-2 px-3 py-2 bg-slate-800 rounded-lg cursor-pointer hover:bg-slate-700"><input type="checkbox" className="rounded border-slate-600"/><span className="text-sm text-white">{c}</span></label>)}</div>
          </div>
          <button className="px-4 py-2 bg-cyan-500 text-white rounded-lg font-medium">Save Company Profile</button>
        </div>
      )}

      {/* Documents Tab */}
      {tab==='documents'&&(
        <div className="space-y-4">
          <div className="grid grid-cols-3 gap-4">
            {[{type:'proposals',label:'Past Proposals',icon:'üìù',desc:'Upload winning proposals to train AI'},{type:'performance',label:'Past Performance',icon:'‚≠ê',desc:'CPARs, references, project summaries'},{type:'resumes',label:'Key Personnel',icon:'üë§',desc:'Resumes and certifications'},{type:'templates',label:'Templates',icon:'üìã',desc:'Boilerplate sections and templates'},{type:'win_themes',label:'Win Themes',icon:'üèÜ',desc:'Discriminators and value props'},{type:'pricing',label:'Pricing History',icon:'üí∞',desc:'Rate cards and historical pricing'}].map(d=><button key={d.type} onClick={()=>handleUpload(d.type)} className="glass rounded-xl p-4 text-left hover:border-cyan-500/30 transition"><div className="text-2xl mb-2">{d.icon}</div><h4 className="font-medium text-white">{d.label}</h4><p className="text-xs text-slate-400">{d.desc}</p><div className="mt-2 text-xs text-cyan-400">+ Upload Files</div></button>)}
          </div>
          {uploads.length>0&&(
            <div className="glass rounded-xl p-4">
              <h4 className="font-medium text-white mb-3">Uploaded Files ({uploads.length})</h4>
              <div className="space-y-2">{uploads.map(f=><div key={f.id} className="flex items-center justify-between p-2 bg-slate-800/50 rounded-lg"><div className="flex items-center gap-3"><span className="text-lg">üìÑ</span><div><div className="text-sm text-white">{f.name}</div><div className="text-xs text-slate-400">{f.type} ‚Ä¢ {f.size}</div></div></div><span className="px-2 py-0.5 bg-emerald-500/20 text-emerald-400 rounded text-xs">{f.status}</span></div>)}</div>
            </div>
          )}
        </div>
      )}

      {/* AI Training Tab */}
      {tab==='training'&&(
        <div className="glass rounded-xl p-6 space-y-4">
          <h3 className="font-semibold text-white">Train AI on Your Content</h3>
          <p className="text-sm text-slate-400">MissionPulse AI will learn from your uploaded documents to generate content in your company's voice and style.</p>
          
          <div className="grid grid-cols-3 gap-4">
            <div className="p-4 bg-slate-800/50 rounded-lg text-center"><div className="text-2xl font-bold text-white">{uploads.length}</div><div className="text-xs text-slate-400">Documents Ready</div></div>
            <div className="p-4 bg-slate-800/50 rounded-lg text-center"><div className="text-2xl font-bold text-white">0</div><div className="text-xs text-slate-400">Win Themes Extracted</div></div>
            <div className="p-4 bg-slate-800/50 rounded-lg text-center"><div className="text-2xl font-bold text-white">0</div><div className="text-xs text-slate-400">Past Perf. Entries</div></div>
          </div>

          {training?(
            <div className="space-y-2">
              <div className="flex justify-between text-sm"><span className="text-white">Training in progress...</span><span className="text-cyan-400">{progress}%</span></div>
              <div className="w-full h-3 bg-slate-700 rounded-full overflow-hidden"><div className="h-full bg-gradient-to-r from-cyan-500 to-teal-500 transition-all" style={{width:`${progress}%`}}/></div>
              <p className="text-xs text-slate-400">{progress<30?'Analyzing documents...':progress<60?'Extracting win themes...':progress<90?'Building knowledge base...':'Finalizing training...'}</p>
            </div>
          ):(
            <button onClick={startTraining} disabled={uploads.length===0} className="w-full py-3 bg-gradient-to-r from-cyan-500 to-teal-500 text-white rounded-xl font-semibold disabled:opacity-50 disabled:cursor-not-allowed">üöÄ Start AI Training</button>
          )}
          
          {progress===100&&(
            <div className="p-4 bg-emerald-500/10 border border-emerald-500/30 rounded-lg"><div className="flex items-center gap-2 text-emerald-400"><span>‚úÖ</span><span className="font-medium">Training Complete!</span></div><p className="text-sm text-slate-400 mt-1">AI is now customized with your company data.</p></div>
          )}
        </div>
      )}

      {/* Integrations Tab */}
      {tab==='integrations'&&(
        <div className="grid grid-cols-2 gap-4">
          {[{name:'Microsoft 365',icon:'üî∑',desc:'Teams, Outlook, Word, PowerPoint',status:'Connect'},{name:'Google Workspace',icon:'üî¥',desc:'Drive, Docs, Gmail',status:'Connect'},{name:'HubSpot CRM',icon:'üü†',desc:'Contact and deal sync',status:'Connect'},{name:'GovWin',icon:'üü¢',desc:'Opportunity intelligence',status:'Connect'},{name:'SAM.gov',icon:'üîµ',desc:'Federal registration',status:'Connect'},{name:'Deltek CostPoint',icon:'üü£',desc:'Pricing and timekeeping',status:'Connect'}].map((i,idx)=><div key={idx} className="glass rounded-xl p-4 flex items-center justify-between"><div className="flex items-center gap-3"><span className="text-2xl">{i.icon}</span><div><h4 className="font-medium text-white">{i.name}</h4><p className="text-xs text-slate-400">{i.desc}</p></div></div><button className="px-3 py-1.5 bg-cyan-500/20 text-cyan-400 rounded-lg text-sm hover:bg-cyan-500/30">{i.status}</button></div>)}
        </div>
      )}
    </div>
  );
}

// ============================================================
// MAIN APP
// ============================================================
function App(){
  const[user,setUser]=useState(null);
  const[role,setRole]=useState('CEO');
  const[active,setActive]=useState('dashboard');
  const[col,setCol]=useState(false);
  const[opps,setOpps]=useState([]);
  const[loading,setLoading]=useState(true);
  const[demo,setDemo]=useState(true);
  const[scene,setScene]=useState(0);
  const[agent,setAgent]=useState(null);

  useEffect(()=>{const u=checkAuth();if(u){setUser(u);setRole(u.role||'CEO')}},[]);
  
  useEffect(()=>{
    async function load(){
      setLoading(true);
      try{
        const{data,error}=await supabase.from('opportunities').select('*').order('created_at',{ascending:false});
        if(error)throw error;
        setOpps(data?.length?data:DEMO_OPPS);
      }catch{setOpps(DEMO_OPPS)}
      setLoading(false);
    }
    load();
  },[]);

  if(!user)return<div className="min-h-screen flex items-center justify-center bg-[#00050F]"><div className="w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"/></div>;

  const render=()=>{
    switch(active){
      case 'dashboard':return<M_Dashboard opps={opps} demo={demo} scene={scene} setScene={setScene} setActive={setActive}/>;
      case 'pipeline':return<M_Pipeline opps={opps}/>;
      case 'warroom':return<M_WarRoom/>;
      case 'swarm':return<M_Swarm setAgent={setAgent}/>;
      case 'compliance':return<M_Compliance/>;
      case 'contracts':return<M_Contracts/>;
      case 'writer':return<M_Writer/>;
      case 'blackhat':return<M_BlackHat role={role}/>;
      case 'pricing':return<M_Pricing/>;
      case 'hitl':return<M_HITL/>;
      case 'orals':return<M_Orals/>;
      case 'frenemy':return<M_Frenemy/>;
      case 'launch':return<M_Launch/>;
      case 'post_award':return<M_PostAward/>;
      case 'playbook':return<M_Playbook/>;
      case 'admin':return<M_Admin/>;
      case 'training':return<M_Training/>;
      default:return<M_Dashboard opps={opps} demo={demo} scene={scene} setScene={setScene} setActive={setActive}/>;
    }
  };

  return(
    <div className="min-h-screen bg-[#00050F]">
      <Sidebar col={col} setCol={setCol} active={active} setActive={setActive} role={role} demo={demo} setDemo={setDemo}/>
      <Header user={user} role={role} setRole={setRole} col={col} active={active}/>
      <main className={`pt-16 pb-12 px-4 min-h-screen transition-all ${col?'ml-16':'ml-64'}`}>{loading?<div className="flex items-center justify-center h-64"><div className="w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"/></div>:render()}</main>
      <footer className={`fixed bottom-0 right-0 p-2 text-xs bg-slate-900/90 border-t border-slate-800 transition-all flex justify-between ${col?'left-16':'left-64'}`}><span className="text-slate-600">¬© 2026 Mission Meets Tech</span><span className="text-amber-500 font-medium">AI GENERATED - REQUIRES HUMAN REVIEW</span><span className="text-slate-600">v12.0</span></footer>
      <Chat agent={agent} setAgent={setAgent}/>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
