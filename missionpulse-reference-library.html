<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse S133 - Reference Library</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Space Grotesk', sans-serif; background: #00050F; min-height: 100vh; }
    .font-mono { font-family: 'JetBrains Mono', monospace; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    .animate-slide-in { animation: slideIn 0.4s ease-out forwards; }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .glass-card { background: linear-gradient(135deg, rgba(15,23,42,0.9) 0%, rgba(15,23,42,0.7) 100%); backdrop-filter: blur(10px); border: 1px solid rgba(0,229,250,0.15); }
    .glass-card:hover { border-color: rgba(0,229,250,0.3); }
    ::-webkit-scrollbar { width: 6px; } ::-webkit-scrollbar-track { background: #0a1628; } ::-webkit-scrollbar-thumb { background: rgba(0,229,250,0.3); border-radius: 3px; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect } = React;

    const SUPABASE_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc4MjMwMTgsImV4cCI6MjA1MzM5OTAxOH0.gFHBoGjPMWjCGuJNdxMGPOBmGMHBp0jSTbxxcFKqkPQ';
    var sbClient;
    try { sbClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY); } catch(e) { sbClient = null; }

    const Icons = {
      search: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
      book: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" /></svg>,
      download: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>,
      bookmark: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg>,
      bookmarkFilled: () => <svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" /></svg>,
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      link: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" /></svg>,
      folder: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" /></svg>,
      document: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
    };
    const Icon = ({ name, className = "w-4 h-4" }) => { const C = Icons[name]; return C ? <span className={`inline-block ${className}`}><C /></span> : null; };

    const FAR_REFERENCES = [
      { id: 1, part: 'FAR Part 15', title: 'Contracting by Negotiation', desc: 'Source selection procedures, competitive proposals, best value continuum', category: 'FAR', critical: true, sections: ['15.101 Best Value', '15.304 Evaluation Factors', '15.305 Proposal Evaluation', '15.306 Exchanges'] },
      { id: 2, part: 'FAR Part 12', title: 'Acquisition of Commercial Products', desc: 'Streamlined procedures for commercial items, market research requirements', category: 'FAR', critical: true, sections: ['12.101 Policy', '12.202 Market Research', '12.301 Solicitation'] },
      { id: 3, part: 'FAR Part 16', title: 'Types of Contracts', desc: 'FFP, T&M, Cost-Reimbursement, IDIQ, BPA structures', category: 'FAR', critical: true, sections: ['16.103 Negotiating', '16.201 FFP', '16.601 T&M', '16.504 IDIQ'] },
      { id: 4, part: 'FAR Part 19', title: 'Small Business Programs', desc: 'Set-asides, SDVOSB, 8(a), HUBZone, WOSB programs', category: 'FAR', critical: true, sections: ['19.502 Setting Aside', '19.1305 SDVOSB', '19.805 8(a)'] },
      { id: 5, part: 'DFARS 252.204', title: 'CMMC Requirements', desc: 'Cybersecurity Maturity Model Certification for DoD contracts', category: 'DFARS', critical: true, sections: ['252.204-7012 Safeguarding CDI', '252.204-7021 CMMC'] },
      { id: 6, part: 'DFARS 215.101', title: 'Best Value (DoD)', desc: 'DoD-specific best value source selection procedures', category: 'DFARS', critical: false, sections: ['215.101-2 Lowest Price', '215.101-2-70 Limitations'] },
      { id: 7, part: 'FAR Part 52', title: 'Solicitation Provisions & Clauses', desc: 'Standard contract clauses and solicitation provisions', category: 'FAR', critical: false, sections: ['52.212 Commercial', '52.215 Negotiation', '52.219 Small Business'] },
    ];

    const AGENCY_GUIDES = [
      { id: 1, agency: 'DHA', name: 'DHA Acquisition Guide', desc: 'Defense Health Agency procurement standards, MHS-specific requirements', format: 'PDF', pages: 245, updated: '2025-10' },
      { id: 2, agency: 'VA', name: 'VA Acquisition Regulation (VAAR)', desc: 'VA-specific acquisition supplements, SDVOSB verification requirements', format: 'PDF', pages: 180, updated: '2025-11' },
      { id: 3, agency: 'CMS', name: 'CMS IT Acquisition Playbook', desc: 'Healthcare.gov lessons, CMS TechNav framework, ATO requirements', format: 'PDF', pages: 120, updated: '2025-09' },
      { id: 4, agency: 'DoD', name: 'DoD Source Selection Procedures', desc: 'Mandatory procedures for DoD competitive acquisitions', format: 'PDF', pages: 85, updated: '2025-12' },
      { id: 5, agency: 'GSA', name: 'GSA Schedule Guidelines', desc: 'MAS ordering procedures, BPA establishment under GSA schedules', format: 'PDF', pages: 95, updated: '2025-08' },
      { id: 6, agency: 'IHS', name: 'IHS Buy Indian Act Procedures', desc: 'Indian Economic Enterprise requirements, tribal sovereignty protocols', format: 'PDF', pages: 60, updated: '2025-07' },
    ];

    const TEMPLATES = [
      { id: 1, name: 'Technical Volume Template', category: 'Proposal', format: 'DOCX', downloads: 23, desc: 'Standard technical approach template with Shipley methodology sections' },
      { id: 2, name: 'Management Volume Template', category: 'Proposal', format: 'DOCX', downloads: 19, desc: 'PM plan, staffing, risk management, QA approach sections' },
      { id: 3, name: 'Past Performance Questionnaire', category: 'Proposal', format: 'DOCX', downloads: 15, desc: 'Standard PPQ for references, pre-formatted with evaluation criteria' },
      { id: 4, name: 'Basis of Estimate (BOE) Workbook', category: 'Pricing', format: 'XLSX', downloads: 21, desc: 'Labor hour estimating worksheet, rate build-up, WBS-aligned' },
      { id: 5, name: 'Go/No-Go Decision Matrix', category: 'Capture', format: 'XLSX', downloads: 18, desc: 'Weighted scoring template for bid/no-bid decisions, Shipley Phase 1' },
      { id: 6, name: 'Compliance Matrix Template', category: 'Proposal', format: 'XLSX', downloads: 25, desc: 'Section L/M cross-reference, requirement traceability matrix' },
      { id: 7, name: 'Transition-In Plan Template', category: 'Proposal', format: 'DOCX', downloads: 12, desc: 'Phase-in plan with 30/60/90 day milestones, knowledge transfer schedule' },
      { id: 8, name: 'CPARS Narrative Template', category: 'Past Performance', format: 'DOCX', downloads: 8, desc: 'Standardized CPARS narrative framework for contractor assessments' },
    ];

    const ConnectionIndicator = ({ connected }) => (
      <div className="flex items-center gap-2 px-3 py-1 rounded-full text-xs font-mono" style={{ background: connected ? 'rgba(0,255,136,0.1)' : 'rgba(255,184,0,0.1)', border: `1px solid ${connected ? 'rgba(0,255,136,0.3)' : 'rgba(255,184,0,0.3)'}` }}>
        <div className={`w-2 h-2 rounded-full ${connected ? 'bg-green-400' : 'bg-amber-400 animate-pulse'}`} />
        <span style={{ color: connected ? '#00ff88' : '#ffb800' }}>{connected ? 'LIVE' : 'DEMO'}</span>
      </div>
    );

    const ReferenceLibrary = () => {
      const [connected, setConnected] = useState(false);
      const [userRole, setUserRole] = useState('CEO');
      const [activeTab, setActiveTab] = useState('far');
      const [searchTerm, setSearchTerm] = useState('');
      const [bookmarks, setBookmarks] = useState([1, 5]);
      const [expandedRef, setExpandedRef] = useState(null);

      useEffect(() => {
        const allowed = ['CEO','COO','CAP','PM','SA','CON','QA','Admin'];
        if (!allowed.includes(userRole)) setUserRole(null);
      }, [userRole]);

      useEffect(() => {
        const tryConnect = async () => {
          if (!sbClient) return;
          try { const { data } = await sbClient.from('opportunities').select('id').limit(1); if (data) setConnected(true); } catch(e) {}
        };
        tryConnect();
      }, []);

      const toggleBookmark = (id) => setBookmarks(prev => prev.includes(id) ? prev.filter(b => b !== id) : [...prev, id]);

      const filteredFAR = FAR_REFERENCES.filter(r => {
        if (!searchTerm) return true;
        const t = searchTerm.toLowerCase();
        return r.part.toLowerCase().includes(t) || r.title.toLowerCase().includes(t) || r.desc.toLowerCase().includes(t);
      });

      const filteredGuides = AGENCY_GUIDES.filter(g => {
        if (!searchTerm) return true;
        const t = searchTerm.toLowerCase();
        return g.agency.toLowerCase().includes(t) || g.name.toLowerCase().includes(t) || g.desc.toLowerCase().includes(t);
      });

      const filteredTemplates = TEMPLATES.filter(t => {
        if (!searchTerm) return true;
        const term = searchTerm.toLowerCase();
        return t.name.toLowerCase().includes(term) || t.category.toLowerCase().includes(term);
      });

      const tabs = [
        { key: 'far', label: 'FAR / DFARS' },
        { key: 'agency', label: 'Agency Guides' },
        { key: 'templates', label: 'Templates' },
        { key: 'bookmarks', label: `Bookmarks (${bookmarks.length})` },
      ];

      return (
        <div className="min-h-screen" style={{ background: '#00050F' }}>
          <div className="max-w-7xl mx-auto p-6">
            <div className="flex items-center justify-between mb-6">
              <div>
                <div className="flex items-center gap-3 mb-1"><h1 className="text-2xl font-bold text-white">Reference Library</h1><ConnectionIndicator connected={connected} /></div>
                <p className="text-sm text-slate-400">FAR/DFARS reference, agency guides, templates & bookmarks</p>
              </div>
              <div className="relative">
                <Icon name="search" className="w-4 h-4 text-slate-500 absolute left-3 top-1/2 -translate-y-1/2" />
                <input type="text" placeholder="Search references..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} className="pl-9 pr-4 py-2 rounded-lg bg-slate-800/50 border border-slate-700/30 text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500/40 w-56" />
              </div>
            </div>

            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
              {[
                { label: 'FAR/DFARS', value: FAR_REFERENCES.length, color: '#00E5FA' },
                { label: 'Agency Guides', value: AGENCY_GUIDES.length, color: '#a78bfa' },
                { label: 'Templates', value: TEMPLATES.length, color: '#00ff88' },
                { label: 'Bookmarked', value: bookmarks.length, color: '#ffb800' },
              ].map((k,i) => (
                <div key={i} className="glass-card rounded-xl p-4 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                  <span className="text-xs text-slate-500 font-mono uppercase">{k.label}</span>
                  <div className="text-2xl font-mono font-bold mt-1" style={{ color: k.color }}>{k.value}</div>
                </div>
              ))}
            </div>

            <div className="flex items-center gap-1 bg-slate-800/30 rounded-lg p-1 mb-6">
              {tabs.map(t => (
                <button key={t.key} onClick={() => setActiveTab(t.key)} className={`px-4 py-2 rounded-md text-sm font-mono font-bold transition flex-1 ${activeTab === t.key ? 'bg-cyan-500/20 text-cyan-400' : 'text-slate-500 hover:text-slate-300'}`}>{t.label}</button>
              ))}
            </div>

            {/* FAR/DFARS */}
            {activeTab === 'far' && (
              <div className="space-y-3 animate-slide-in">
                {filteredFAR.map((r, i) => (
                  <div key={r.id} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                    <div className="flex items-center justify-between mb-2">
                      <div className="flex items-center gap-3">
                        <Icon name="book" className="w-5 h-5 text-cyan-400" />
                        <span className="text-white font-semibold">{r.part}</span>
                        <span className="text-sm text-slate-400">{r.title}</span>
                        <span className={`px-2 py-0.5 rounded text-xs font-mono font-bold ${r.category === 'DFARS' ? 'bg-purple-500/10 text-purple-400 border border-purple-500/20' : 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20'}`}>{r.category}</span>
                        {r.critical && <span className="px-2 py-0.5 rounded text-xs font-mono font-bold bg-red-500/10 text-red-400 border border-red-500/20">CRITICAL</span>}
                      </div>
                      <button onClick={(e) => { e.stopPropagation(); toggleBookmark(r.id); }} className="p-1.5 rounded hover:bg-slate-700/30 transition">
                        <Icon name={bookmarks.includes(r.id) ? 'bookmarkFilled' : 'bookmark'} className={`w-4 h-4 ${bookmarks.includes(r.id) ? 'text-amber-400' : 'text-slate-500'}`} />
                      </button>
                    </div>
                    <p className="text-sm text-slate-400 mb-3 ml-8">{r.desc}</p>
                    <div className="flex flex-wrap gap-1.5 ml-8">
                      {r.sections.map((s, j) => (
                        <span key={j} className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/30 text-slate-400 cursor-pointer hover:bg-cyan-500/10 hover:text-cyan-400 transition">{s}</span>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Agency Guides */}
            {activeTab === 'agency' && (
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4 animate-slide-in">
                {filteredGuides.map((g, i) => (
                  <div key={g.id} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                    <div className="flex items-center gap-3 mb-3">
                      <div className="w-10 h-10 rounded-lg bg-purple-500/10 flex items-center justify-center text-sm font-mono font-bold text-purple-400">{g.agency}</div>
                      <div>
                        <h3 className="text-white font-semibold text-sm">{g.name}</h3>
                        <span className="text-xs text-slate-500">{g.format} · {g.pages} pages · Updated {g.updated}</span>
                      </div>
                    </div>
                    <p className="text-xs text-slate-400 mb-3">{g.desc}</p>
                    <button className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-mono font-bold bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/20 transition">
                      <Icon name="download" className="w-3.5 h-3.5" /> Download
                    </button>
                  </div>
                ))}
              </div>
            )}

            {/* Templates */}
            {activeTab === 'templates' && (
              <div className="space-y-3 animate-slide-in">
                {filteredTemplates.map((t, i) => (
                  <div key={t.id} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Icon name="document" className="w-5 h-5 text-green-400" />
                        <div>
                          <div className="flex items-center gap-2">
                            <span className="text-white font-semibold">{t.name}</span>
                            <span className="px-2 py-0.5 rounded text-xs font-mono bg-slate-700/30 text-slate-400">{t.category}</span>
                            <span className="px-2 py-0.5 rounded text-xs font-mono bg-green-500/10 text-green-400 border border-green-500/20">{t.format}</span>
                          </div>
                          <p className="text-xs text-slate-500 mt-0.5">{t.desc}</p>
                        </div>
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="text-xs text-slate-500 font-mono">{t.downloads} downloads</span>
                        <button className="flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-mono font-bold bg-cyan-500/10 text-cyan-400 border border-cyan-500/20 hover:bg-cyan-500/20 transition">
                          <Icon name="download" className="w-3.5 h-3.5" /> Get
                        </button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            )}

            {/* Bookmarks */}
            {activeTab === 'bookmarks' && (
              <div className="space-y-3 animate-slide-in">
                {bookmarks.length === 0 ? (
                  <div className="glass-card rounded-xl p-12 text-center">
                    <Icon name="bookmark" className="w-12 h-12 text-slate-600 mx-auto mb-3" />
                    <h3 className="text-white font-semibold mb-1">No Bookmarks</h3>
                    <p className="text-sm text-slate-400">Bookmark FAR/DFARS sections for quick reference.</p>
                  </div>
                ) : FAR_REFERENCES.filter(r => bookmarks.includes(r.id)).map((r, i) => (
                  <div key={r.id} className="glass-card rounded-xl p-5 animate-slide-in" style={{ animationDelay: `${i*0.05}s` }}>
                    <div className="flex items-center justify-between">
                      <div className="flex items-center gap-3">
                        <Icon name="bookmarkFilled" className="w-5 h-5 text-amber-400" />
                        <span className="text-white font-semibold">{r.part}</span>
                        <span className="text-sm text-slate-400">{r.title}</span>
                      </div>
                      <button onClick={() => toggleBookmark(r.id)} className="text-xs text-slate-500 hover:text-red-400 transition font-mono">Remove</button>
                    </div>
                  </div>
                ))}
              </div>
            )}

            <div className="mt-8 text-center">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-amber-500/5 border border-amber-500/20">
                <Icon name="shield" className="w-3.5 h-3.5 text-amber-500" />
                <span className="text-xs text-amber-500/80 font-mono">AI GENERATED — REQUIRES HUMAN REVIEW</span>
              </div>
            </div>
          </div>
        </div>
      );
    };

    ReactDOM.render(<ReferenceLibrary />, document.getElementById('root'));
  </script>
</body>
</html>
