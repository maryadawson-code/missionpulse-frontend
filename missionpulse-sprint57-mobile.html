<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#00050F">
  <title>MissionPulse v12.0 - Mobile</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    html, body { font-family: 'Inter', sans-serif; background: #00050F; min-height: 100vh; overflow-x: hidden; }
    
    /* Animations */
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slideUp { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-slideUp { animation: slideUp 0.3s ease-out; }
    .animate-slideDown { animation: slideDown 0.3s ease-out; }
    .animate-fadeIn { animation: fadeIn 0.2s ease-out; }
    
    /* Touch-friendly scrolling */
    .scroll-smooth { scroll-behavior: smooth; -webkit-overflow-scrolling: touch; }
    
    /* Hide scrollbar but keep functionality */
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    
    /* Safe area for notched devices */
    .safe-top { padding-top: env(safe-area-inset-top); }
    .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
    
    /* Bottom sheet */
    .bottom-sheet { 
      border-radius: 1.5rem 1.5rem 0 0; 
      box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
    }
    
    /* Pull to refresh indicator */
    .pull-indicator { 
      transition: transform 0.2s ease;
    }
  </style>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#00E5FA',
            navy: '#00050F',
          }
        }
      }
    }
  </script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // ============================================
    // SUPABASE CLIENT
    // ============================================
    const SUPABASE_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc1NjcyNjUsImV4cCI6MjA1MzE0MzI2NX0.gVAHNpfDJjQdXy1E9AAKX_xJDJX8cKbKcsM6v0';
    
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ============================================
    // API METHODS
    // ============================================
    const API = {
      async getOpportunities() {
        const { data, error } = await supabase.from('opportunities').select('*').order('created_at', { ascending: false });
        return error ? [] : data;
      },
      async getCompetitors() {
        const { data, error } = await supabase.from('competitors').select('*');
        return error ? [] : data;
      },
      async getComplianceItems() {
        const { data, error } = await supabase.from('compliance_items').select('*');
        return error ? [] : data;
      },
      async getAuditLogs(limit = 20) {
        const { data, error } = await supabase.from('audit_logs').select('*').order('created_at', { ascending: false }).limit(limit);
        return error ? [] : data;
      },
    };

    // ============================================
    // ICONS (Touch-optimized sizes)
    // ============================================
    const Icons = {
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>,
      home: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
      target: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><circle cx="12" cy="12" r="6" strokeWidth={2}/><circle cx="12" cy="12" r="2" strokeWidth={2}/></svg>,
      cpu: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" /></svg>,
      fileText: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
      user: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
      bell: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" /></svg>,
      chevronRight: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>,
      chevronDown: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" /></svg>,
      loader: () => <svg className="w-full h-full animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
      refresh: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>,
      plus: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4" /></svg>,
      x: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
      check: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7" /></svg>,
      clock: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2}/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6v6l4 2" /></svg>,
      dollarSign: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
      trendingUp: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>,
      alertTriangle: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>,
      eye: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>,
      menu: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>,
      search: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>,
    };

    const Icon = ({ name, className = "w-6 h-6" }) => {
      const IconComponent = Icons[name];
      return IconComponent ? <span className={`inline-block ${className}`}><IconComponent /></span> : null;
    };

    // ============================================
    // UI COMPONENTS (Touch-Optimized)
    // ============================================
    const Card = ({ children, className = '', onClick }) => (
      <div 
        onClick={onClick} 
        className={`bg-slate-800/60 backdrop-blur border border-slate-700/50 rounded-2xl ${onClick ? 'active:scale-[0.98] transition-transform cursor-pointer' : ''} ${className}`}
      >
        {children}
      </div>
    );

    const Button = ({ children, onClick, variant = 'primary', size = 'md', icon, disabled, className = '', fullWidth = false }) => {
      const variants = {
        primary: 'bg-gradient-to-r from-cyan-500 to-teal-500 text-white active:from-cyan-600 active:to-teal-600',
        secondary: 'bg-slate-700 text-white active:bg-slate-600 border border-slate-600',
        ghost: 'text-slate-400 active:text-white active:bg-slate-700/50',
      };
      const sizes = { 
        sm: 'px-4 py-2 text-sm min-h-[40px]', 
        md: 'px-5 py-3 text-base min-h-[48px]', 
        lg: 'px-6 py-4 text-lg min-h-[56px]' 
      };
      return (
        <button 
          onClick={onClick} 
          disabled={disabled} 
          className={`inline-flex items-center justify-center gap-2 font-semibold rounded-xl transition-all ${variants[variant]} ${sizes[size]} ${disabled ? 'opacity-50' : ''} ${fullWidth ? 'w-full' : ''} ${className}`}
        >
          {icon && <Icon name={icon} className={size === 'sm' ? 'w-4 h-4' : 'w-5 h-5'} />}
          {children}
        </button>
      );
    };

    const Badge = ({ children, variant = 'default', size = 'sm' }) => {
      const variants = {
        default: 'bg-slate-700 text-slate-300',
        primary: 'bg-cyan-500/20 text-cyan-400',
        success: 'bg-emerald-500/20 text-emerald-400',
        warning: 'bg-amber-500/20 text-amber-400',
        danger: 'bg-red-500/20 text-red-400',
      };
      const sizes = { xs: 'px-2 py-0.5 text-xs', sm: 'px-2.5 py-1 text-xs', md: 'px-3 py-1.5 text-sm' };
      return <span className={`inline-flex items-center rounded-full font-medium ${variants[variant]} ${sizes[size]}`}>{children}</span>;
    };

    // Bottom Sheet Component
    const BottomSheet = ({ isOpen, onClose, title, children }) => {
      if (!isOpen) return null;
      return (
        <div className="fixed inset-0 z-50">
          <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose} />
          <div className="absolute bottom-0 left-0 right-0 bg-slate-900 bottom-sheet animate-slideUp safe-bottom max-h-[85vh] overflow-hidden flex flex-col">
            <div className="flex items-center justify-between p-4 border-b border-slate-700">
              <h3 className="text-lg font-semibold text-white">{title}</h3>
              <button onClick={onClose} className="p-2 rounded-full bg-slate-800 active:bg-slate-700">
                <Icon name="x" className="w-5 h-5 text-slate-400" />
              </button>
            </div>
            <div className="flex-1 overflow-auto p-4 scroll-smooth hide-scrollbar">
              {children}
            </div>
          </div>
        </div>
      );
    };

    // Toast System
    const ToastContext = React.createContext();
    const ToastProvider = ({ children }) => {
      const [toasts, setToasts] = useState([]);
      const addToast = useCallback((message, type = 'info') => {
        const id = Date.now();
        setToasts(prev => [...prev, { id, message, type }]);
        setTimeout(() => setToasts(prev => prev.filter(t => t.id !== id)), 3000);
      }, []);
      return (
        <ToastContext.Provider value={{ addToast }}>
          {children}
          <div className="fixed top-4 left-4 right-4 z-50 space-y-2 safe-top">
            {toasts.map(toast => (
              <div key={toast.id} className={`px-4 py-3 rounded-xl shadow-lg border backdrop-blur animate-slideDown ${
                toast.type === 'success' ? 'bg-emerald-500/20 border-emerald-500/50 text-emerald-400' :
                toast.type === 'error' ? 'bg-red-500/20 border-red-500/50 text-red-400' :
                'bg-cyan-500/20 border-cyan-500/50 text-cyan-400'
              }`}>
                {toast.message}
              </div>
            ))}
          </div>
        </ToastContext.Provider>
      );
    };
    const useToast = () => React.useContext(ToastContext);

    // ============================================
    // MOBILE DASHBOARD
    // ============================================
    const MobileDashboard = () => {
      const { addToast } = useToast();
      const [loading, setLoading] = useState(true);
      const [refreshing, setRefreshing] = useState(false);
      const [activeTab, setActiveTab] = useState('home');
      const [opportunities, setOpportunities] = useState([]);
      const [selectedOpp, setSelectedOpp] = useState(null);
      const [dbConnected, setDbConnected] = useState(false);

      // Load data
      const loadData = async (showRefresh = false) => {
        if (showRefresh) setRefreshing(true);
        try {
          const opps = await API.getOpportunities();
          setOpportunities(opps);
          setDbConnected(opps.length > 0);
          if (showRefresh) addToast('Data refreshed', 'success');
        } catch (err) {
          console.error(err);
          if (showRefresh) addToast('Refresh failed', 'error');
        } finally {
          setLoading(false);
          setRefreshing(false);
        }
      };

      useEffect(() => { loadData(); }, []);

      // Helpers
      const formatCurrency = (value) => {
        if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
        if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
        return `$${value?.toLocaleString() || 0}`;
      };

      const formatDate = (dateStr) => {
        if (!dateStr) return 'TBD';
        const date = new Date(dateStr);
        const now = new Date();
        const diff = Math.ceil((date - now) / (1000 * 60 * 60 * 24));
        if (diff < 0) return 'Overdue';
        if (diff === 0) return 'Today';
        if (diff === 1) return 'Tomorrow';
        if (diff <= 7) return `${diff} days`;
        return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      };

      const getStatusColor = (status) => {
        const colors = {
          'identification': 'primary',
          'qualification': 'primary',
          'capture': 'warning',
          'proposal': 'warning',
          'submitted': 'success',
          'won': 'success',
          'lost': 'danger',
        };
        return colors[status?.toLowerCase()] || 'default';
      };

      // Calculate metrics
      const totalPipeline = opportunities.reduce((sum, o) => sum + (o.value || 0), 0);
      const activeOpps = opportunities.filter(o => !['won', 'lost'].includes(o.status?.toLowerCase())).length;
      const avgPwin = opportunities.length > 0 
        ? Math.round(opportunities.reduce((sum, o) => sum + (o.pwin || o.win_probability || 0), 0) / opportunities.length) 
        : 0;
      const urgentOpps = opportunities.filter(o => {
        const due = new Date(o.due_date);
        const now = new Date();
        const diff = (due - now) / (1000 * 60 * 60 * 24);
        return diff > 0 && diff <= 7;
      }).length;

      if (loading) {
        return (
          <div className="min-h-screen bg-[#00050F] flex items-center justify-center">
            <div className="text-center">
              <div className="w-16 h-16 rounded-2xl bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center mx-auto mb-4">
                <Icon name="shield" className="w-9 h-9 text-white" />
              </div>
              <Icon name="loader" className="w-8 h-8 text-cyan-400 mx-auto mb-2" />
              <p className="text-slate-400">Loading MissionPulse...</p>
            </div>
          </div>
        );
      }

      // Home Tab Content
      const HomeTab = () => (
        <div className="p-4 pb-24 space-y-4 animate-fadeIn">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div>
              <h1 className="text-xl font-bold text-white">MissionPulse</h1>
              <p className="text-slate-400 text-sm">Pipeline Overview</p>
            </div>
            <button 
              onClick={() => loadData(true)}
              className={`p-3 rounded-xl bg-slate-800 active:bg-slate-700 ${refreshing ? 'animate-spin' : ''}`}
            >
              <Icon name="refresh" className="w-5 h-5 text-cyan-400" />
            </button>
          </div>

          {/* Quick Stats */}
          <div className="grid grid-cols-2 gap-3">
            <Card className="p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center">
                  <Icon name="dollarSign" className="w-5 h-5 text-cyan-400" />
                </div>
                <div>
                  <p className="text-lg font-bold text-white">{formatCurrency(totalPipeline)}</p>
                  <p className="text-xs text-slate-400">Pipeline</p>
                </div>
              </div>
            </Card>
            <Card className="p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                  <Icon name="target" className="w-5 h-5 text-purple-400" />
                </div>
                <div>
                  <p className="text-lg font-bold text-white">{activeOpps}</p>
                  <p className="text-xs text-slate-400">Active Opps</p>
                </div>
              </div>
            </Card>
            <Card className="p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center">
                  <Icon name="trendingUp" className="w-5 h-5 text-emerald-400" />
                </div>
                <div>
                  <p className="text-lg font-bold text-white">{avgPwin}%</p>
                  <p className="text-xs text-slate-400">Avg pWin</p>
                </div>
              </div>
            </Card>
            <Card className="p-4">
              <div className="flex items-center gap-3">
                <div className="w-10 h-10 rounded-xl bg-amber-500/20 flex items-center justify-center">
                  <Icon name="alertTriangle" className="w-5 h-5 text-amber-400" />
                </div>
                <div>
                  <p className="text-lg font-bold text-white">{urgentOpps}</p>
                  <p className="text-xs text-slate-400">Due Soon</p>
                </div>
              </div>
            </Card>
          </div>

          {/* Urgent Items */}
          {urgentOpps > 0 && (
            <Card className="p-4 border-amber-500/30 bg-amber-500/5">
              <div className="flex items-center gap-2 mb-3">
                <Icon name="clock" className="w-4 h-4 text-amber-400" />
                <span className="font-semibold text-amber-400 text-sm">Due This Week</span>
              </div>
              <div className="space-y-2">
                {opportunities.filter(o => {
                  const due = new Date(o.due_date);
                  const now = new Date();
                  const diff = (due - now) / (1000 * 60 * 60 * 24);
                  return diff > 0 && diff <= 7;
                }).slice(0, 3).map((opp, i) => (
                  <div 
                    key={opp.id || i} 
                    onClick={() => setSelectedOpp(opp)}
                    className="flex items-center justify-between p-2 rounded-lg bg-slate-800/50 active:bg-slate-700/50"
                  >
                    <div className="flex-1 min-w-0">
                      <p className="text-white text-sm font-medium truncate">{opp.title || opp.name}</p>
                      <p className="text-slate-400 text-xs">{opp.agency}</p>
                    </div>
                    <Badge variant="warning" size="xs">{formatDate(opp.due_date)}</Badge>
                  </div>
                ))}
              </div>
            </Card>
          )}

          {/* Recent Opportunities */}
          <div>
            <div className="flex items-center justify-between mb-3">
              <h2 className="font-semibold text-white">Recent Opportunities</h2>
              <span className="text-slate-400 text-sm">{opportunities.length} total</span>
            </div>
            <div className="space-y-2">
              {opportunities.slice(0, 5).map((opp, i) => (
                <Card 
                  key={opp.id || i} 
                  className="p-4"
                  onClick={() => setSelectedOpp(opp)}
                >
                  <div className="flex items-start justify-between gap-3">
                    <div className="flex-1 min-w-0">
                      <p className="text-white font-medium truncate">{opp.title || opp.name}</p>
                      <p className="text-slate-400 text-sm">{opp.agency}</p>
                      <div className="flex items-center gap-2 mt-2">
                        <Badge variant={getStatusColor(opp.status)} size="xs">{opp.status}</Badge>
                        <span className="text-cyan-400 text-sm font-semibold">{formatCurrency(opp.value)}</span>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className="text-2xl font-bold text-white">{opp.pwin || opp.win_probability || 0}%</div>
                      <p className="text-slate-500 text-xs">pWin</p>
                    </div>
                  </div>
                </Card>
              ))}
            </div>
          </div>
        </div>
      );

      // Pipeline Tab Content
      const PipelineTab = () => (
        <div className="p-4 pb-24 space-y-4 animate-fadeIn">
          <div className="flex items-center justify-between">
            <h1 className="text-xl font-bold text-white">Pipeline</h1>
            <Button variant="ghost" size="sm" icon="search">Filter</Button>
          </div>

          {/* Search */}
          <div className="relative">
            <input 
              type="text" 
              placeholder="Search opportunities..."
              className="w-full bg-slate-800 border border-slate-700 rounded-xl px-4 py-3 pl-11 text-white placeholder-slate-500 focus:outline-none focus:border-cyan-500"
            />
            <Icon name="search" className="w-5 h-5 text-slate-500 absolute left-4 top-1/2 -translate-y-1/2" />
          </div>

          {/* Opportunity List */}
          <div className="space-y-2">
            {opportunities.map((opp, i) => (
              <Card 
                key={opp.id || i} 
                className="p-4"
                onClick={() => setSelectedOpp(opp)}
              >
                <div className="flex items-center justify-between mb-2">
                  <Badge variant={getStatusColor(opp.status)} size="xs">{opp.status}</Badge>
                  <span className="text-slate-400 text-xs">{formatDate(opp.due_date)}</span>
                </div>
                <p className="text-white font-medium">{opp.title || opp.name}</p>
                <p className="text-slate-400 text-sm mb-2">{opp.agency}</p>
                <div className="flex items-center justify-between">
                  <span className="text-cyan-400 font-semibold">{formatCurrency(opp.value)}</span>
                  <div className="flex items-center gap-1">
                    <div className="w-20 h-2 bg-slate-700 rounded-full overflow-hidden">
                      <div 
                        className="h-full bg-gradient-to-r from-cyan-500 to-teal-500 rounded-full"
                        style={{ width: `${opp.pwin || opp.win_probability || 0}%` }}
                      />
                    </div>
                    <span className="text-white text-sm font-medium">{opp.pwin || opp.win_probability || 0}%</span>
                  </div>
                </div>
              </Card>
            ))}
            {opportunities.length === 0 && (
              <div className="text-center py-8">
                <Icon name="target" className="w-12 h-12 text-slate-600 mx-auto mb-3" />
                <p className="text-slate-500">No opportunities found</p>
              </div>
            )}
          </div>
        </div>
      );

      // Agents Tab Content
      const AgentsTab = () => {
        const agents = [
          { id: 'capture', name: 'Capture', icon: 'target', color: '#00E5FA' },
          { id: 'strategy', name: 'Strategy', icon: 'trendingUp', color: '#8B5CF6' },
          { id: 'blackhat', name: 'Black Hat', icon: 'eye', color: '#EF4444' },
          { id: 'pricing', name: 'Pricing', icon: 'dollarSign', color: '#10B981' },
        ];
        return (
          <div className="p-4 pb-24 space-y-4 animate-fadeIn">
            <h1 className="text-xl font-bold text-white">AI Agents</h1>
            <p className="text-slate-400 text-sm">Tap an agent to start a conversation</p>
            
            <div className="grid grid-cols-2 gap-3">
              {agents.map(agent => (
                <Card key={agent.id} className="p-5" onClick={() => addToast(`${agent.name} Agent coming soon`, 'info')}>
                  <div 
                    className="w-12 h-12 rounded-xl flex items-center justify-center mb-3"
                    style={{ backgroundColor: `${agent.color}20` }}
                  >
                    <div style={{ color: agent.color }}>
                      <Icon name={agent.icon} className="w-6 h-6" />
                    </div>
                  </div>
                  <p className="text-white font-semibold">{agent.name}</p>
                  <p className="text-slate-400 text-xs">Agent</p>
                </Card>
              ))}
            </div>

            <Card className="p-4 mt-6">
              <div className="flex items-center gap-3 mb-3">
                <Icon name="cpu" className="w-5 h-5 text-cyan-400" />
                <span className="text-white font-semibold">Quick Actions</span>
              </div>
              <div className="space-y-2">
                {['Analyze opportunity', 'Generate win strategy', 'Price this deal', 'Check compliance'].map((action, i) => (
                  <button 
                    key={i}
                    onClick={() => addToast('Agent Hub coming soon', 'info')}
                    className="w-full text-left p-3 rounded-xl bg-slate-800/50 active:bg-slate-700/50 text-slate-300 text-sm flex items-center justify-between"
                  >
                    {action}
                    <Icon name="chevronRight" className="w-4 h-4 text-slate-500" />
                  </button>
                ))}
              </div>
            </Card>
          </div>
        );
      };

      // Profile Tab Content
      const ProfileTab = () => (
        <div className="p-4 pb-24 space-y-4 animate-fadeIn">
          <div className="text-center pt-4">
            <div className="w-20 h-20 rounded-full bg-gradient-to-br from-cyan-500 to-teal-500 flex items-center justify-center mx-auto mb-3">
              <Icon name="user" className="w-10 h-10 text-white" />
            </div>
            <h2 className="text-xl font-bold text-white">Mary Womack</h2>
            <p className="text-slate-400">CEO, Mission Meets Tech</p>
            <Badge variant={dbConnected ? 'success' : 'danger'} size="sm">
              {dbConnected ? 'Connected' : 'Offline'}
            </Badge>
          </div>

          <Card className="p-4">
            <h3 className="font-semibold text-white mb-3">Quick Stats</h3>
            <div className="space-y-3">
              <div className="flex justify-between">
                <span className="text-slate-400">Total Pipeline</span>
                <span className="text-white font-medium">{formatCurrency(totalPipeline)}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-slate-400">Active Opportunities</span>
                <span className="text-white font-medium">{activeOpps}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-slate-400">Average pWin</span>
                <span className="text-white font-medium">{avgPwin}%</span>
              </div>
            </div>
          </Card>

          <Card className="p-4">
            <h3 className="font-semibold text-white mb-3">Settings</h3>
            <div className="space-y-2">
              {['Notifications', 'Account', 'Help & Support', 'About MissionPulse'].map((item, i) => (
                <button 
                  key={i}
                  className="w-full text-left p-3 rounded-xl bg-slate-800/50 active:bg-slate-700/50 text-slate-300 flex items-center justify-between"
                >
                  {item}
                  <Icon name="chevronRight" className="w-4 h-4 text-slate-500" />
                </button>
              ))}
            </div>
          </Card>

          <p className="text-center text-slate-600 text-xs">MissionPulse v12.0 â€¢ Sprint 57</p>
        </div>
      );

      // Render active tab content
      const renderTabContent = () => {
        switch (activeTab) {
          case 'home': return <HomeTab />;
          case 'pipeline': return <PipelineTab />;
          case 'agents': return <AgentsTab />;
          case 'profile': return <ProfileTab />;
          default: return <HomeTab />;
        }
      };

      return (
        <div className="min-h-screen bg-[#00050F] flex flex-col safe-top">
          {/* Main Content */}
          <main className="flex-1 overflow-auto scroll-smooth hide-scrollbar">
            {renderTabContent()}
          </main>

          {/* Bottom Navigation */}
          <nav className="fixed bottom-0 left-0 right-0 bg-slate-900/95 backdrop-blur border-t border-slate-800 safe-bottom">
            <div className="flex items-center justify-around py-2">
              {[
                { id: 'home', icon: 'home', label: 'Home' },
                { id: 'pipeline', icon: 'target', label: 'Pipeline' },
                { id: 'agents', icon: 'cpu', label: 'Agents' },
                { id: 'profile', icon: 'user', label: 'Profile' },
              ].map(tab => (
                <button
                  key={tab.id}
                  onClick={() => setActiveTab(tab.id)}
                  className={`flex flex-col items-center justify-center py-2 px-4 rounded-xl transition-colors ${
                    activeTab === tab.id ? 'text-cyan-400' : 'text-slate-500'
                  }`}
                >
                  <Icon name={tab.icon} className="w-6 h-6 mb-1" />
                  <span className="text-xs font-medium">{tab.label}</span>
                </button>
              ))}
            </div>
          </nav>

          {/* Opportunity Detail Sheet */}
          <BottomSheet 
            isOpen={!!selectedOpp} 
            onClose={() => setSelectedOpp(null)}
            title={selectedOpp?.title || selectedOpp?.name || 'Opportunity Details'}
          >
            {selectedOpp && (
              <div className="space-y-4">
                <div className="flex items-center justify-between">
                  <Badge variant={getStatusColor(selectedOpp.status)}>{selectedOpp.status}</Badge>
                  <span className="text-2xl font-bold text-cyan-400">{formatCurrency(selectedOpp.value)}</span>
                </div>

                <div>
                  <p className="text-slate-400 text-sm">Agency</p>
                  <p className="text-white font-medium">{selectedOpp.agency}</p>
                </div>

                <div className="grid grid-cols-2 gap-4">
                  <div>
                    <p className="text-slate-400 text-sm">Due Date</p>
                    <p className="text-white font-medium">{formatDate(selectedOpp.due_date)}</p>
                  </div>
                  <div>
                    <p className="text-slate-400 text-sm">Win Probability</p>
                    <p className="text-white font-medium">{selectedOpp.pwin || selectedOpp.win_probability || 0}%</p>
                  </div>
                </div>

                {selectedOpp.description && (
                  <div>
                    <p className="text-slate-400 text-sm">Description</p>
                    <p className="text-white">{selectedOpp.description}</p>
                  </div>
                )}

                <div className="pt-4 space-y-2">
                  <Button fullWidth icon="cpu" onClick={() => addToast('Agent Hub coming soon', 'info')}>
                    Analyze with AI
                  </Button>
                  <Button fullWidth variant="secondary" icon="fileText" onClick={() => addToast('Reports coming soon', 'info')}>
                    Generate Report
                  </Button>
                </div>
              </div>
            )}
          </BottomSheet>
        </div>
      );
    };

    // ============================================
    // MAIN APP
    // ============================================
    function App() {
      return (
        <ToastProvider>
          <MobileDashboard />
        </ToastProvider>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
