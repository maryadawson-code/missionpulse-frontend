<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Feature Suggestions | MissionPulse</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            'deep-navy': '#00050F',
            'cyber-cyan': '#00E5FA',
            'slate-dark': '#0a1628'
          }
        }
      }
    }
  </script>
  <style>
    body { background: linear-gradient(135deg, #00050F 0%, #0a1628 50%, #00050F 100%); }
    .glow-border { box-shadow: 0 0 20px rgba(0, 229, 250, 0.15); }
    .suggestion-card:hover { border-color: rgba(0, 229, 250, 0.3); }
    .vote-btn:hover { transform: scale(1.1); }
    .vote-btn.voted { color: #00E5FA; }
  </style>
  <script src="rbac-guard.js"></script>
</head>
<body class="min-h-screen text-white">
  <header class="border-b border-slate-800/50 bg-deep-navy/80 backdrop-blur-sm sticky top-0 z-40">
    <div class="max-w-5xl mx-auto px-6 py-4 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-cyber-cyan to-blue-500 flex items-center justify-center">
          <svg class="w-6 h-6 text-deep-navy" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
          </svg>
        </div>
        <div>
          <span class="text-lg font-bold text-white">Feature Suggestions</span>
          <span class="text-xs text-slate-500 block">Help shape MissionPulse</span>
        </div>
      </div>
      <a href="index.html" class="text-sm text-slate-400 hover:text-cyber-cyan transition-colors">‚Üê Dashboard</a>
    </div>
  </header>

  <main class="max-w-5xl mx-auto px-6 py-8">
    <!-- Auth Check -->
    <div id="authCheck" class="text-center py-12">
      <div class="w-8 h-8 border-2 border-cyber-cyan border-t-transparent rounded-full animate-spin mx-auto"></div>
      <p class="text-slate-400 mt-4">Loading...</p>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="hidden">
      <!-- Header -->
      <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8">
        <div>
          <h1 class="text-2xl font-bold">Feature Roadmap</h1>
          <p class="text-slate-400 text-sm mt-1">Vote on features or suggest new ideas</p>
        </div>
        <button onclick="openSubmitModal()" class="px-5 py-2.5 bg-gradient-to-r from-cyber-cyan to-blue-500 text-deep-navy font-bold rounded-lg hover:opacity-90 transition-all flex items-center gap-2">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
          </svg>
          Submit Idea
        </button>
      </div>

      <!-- Filters -->
      <div class="flex flex-wrap gap-3 mb-6">
        <div class="flex gap-2">
          <button class="filter-btn active px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="all">All</button>
          <button class="filter-btn px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="new">New</button>
          <button class="filter-btn px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="under_review">Under Review</button>
          <button class="filter-btn px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="planned">Planned</button>
          <button class="filter-btn px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="in_progress">In Progress</button>
          <button class="filter-btn px-3 py-1.5 rounded-lg text-sm transition-colors" data-filter="complete">Complete</button>
        </div>
        <select id="categoryFilter" onchange="loadSuggestions()" class="px-3 py-1.5 bg-slate-800 border border-slate-700 rounded-lg text-sm">
          <option value="all">All Categories</option>
          <option value="new_feature">üí° New Feature</option>
          <option value="enhancement">‚¨ÜÔ∏è Enhancement</option>
          <option value="integration">üîå Integration</option>
          <option value="ui_ux">üé® UI/UX</option>
          <option value="ai_agents">ü§ñ AI Agents</option>
          <option value="performance">‚ö° Performance</option>
          <option value="mobile">üì± Mobile</option>
          <option value="other">üìù Other</option>
        </select>
        <select id="sortBy" onchange="loadSuggestions()" class="px-3 py-1.5 bg-slate-800 border border-slate-700 rounded-lg text-sm">
          <option value="votes">Most Voted</option>
          <option value="newest">Newest</option>
          <option value="oldest">Oldest</option>
        </select>
      </div>

      <!-- Stats -->
      <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-8">
        <div class="bg-slate-900/60 border border-slate-700/50 rounded-xl p-4 text-center">
          <p class="text-2xl font-bold" id="statTotal">0</p>
          <p class="text-xs text-slate-500">Total Ideas</p>
        </div>
        <div class="bg-slate-900/60 border border-slate-700/50 rounded-xl p-4 text-center">
          <p class="text-2xl font-bold text-amber-400" id="statReview">0</p>
          <p class="text-xs text-slate-500">Under Review</p>
        </div>
        <div class="bg-slate-900/60 border border-slate-700/50 rounded-xl p-4 text-center">
          <p class="text-2xl font-bold text-blue-400" id="statPlanned">0</p>
          <p class="text-xs text-slate-500">Planned</p>
        </div>
        <div class="bg-slate-900/60 border border-slate-700/50 rounded-xl p-4 text-center">
          <p class="text-2xl font-bold text-purple-400" id="statProgress">0</p>
          <p class="text-xs text-slate-500">In Progress</p>
        </div>
        <div class="bg-slate-900/60 border border-slate-700/50 rounded-xl p-4 text-center">
          <p class="text-2xl font-bold text-emerald-400" id="statComplete">0</p>
          <p class="text-xs text-slate-500">Complete</p>
        </div>
      </div>

      <!-- Suggestions List -->
      <div id="suggestionsList" class="space-y-4"></div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden text-center py-12">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-800 flex items-center justify-center">
          <svg class="w-8 h-8 text-slate-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
        </div>
        <p class="text-slate-400">No suggestions found</p>
        <button onclick="openSubmitModal()" class="mt-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">Be the first to suggest!</button>
      </div>
    </div>

    <!-- Submit Modal -->
    <div id="submitModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-slate-900 border border-slate-700 rounded-2xl p-6 w-full max-w-lg mx-4">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-lg font-bold">Submit Feature Idea</h3>
          <button onclick="closeSubmitModal()" class="text-slate-400 hover:text-white">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <form id="submitForm" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-slate-300 mb-1.5">Title *</label>
            <input type="text" id="ideaTitle" required placeholder="Brief, descriptive title" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyber-cyan">
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-300 mb-1.5">Category *</label>
            <select id="ideaCategory" required class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-white focus:outline-none focus:border-cyber-cyan">
              <option value="new_feature">üí° New Feature</option>
              <option value="enhancement">‚¨ÜÔ∏è Enhancement</option>
              <option value="integration">üîå Integration</option>
              <option value="ui_ux">üé® UI/UX</option>
              <option value="ai_agents">ü§ñ AI Agents</option>
              <option value="performance">‚ö° Performance</option>
              <option value="mobile">üì± Mobile</option>
              <option value="other">üìù Other</option>
            </select>
          </div>

          <div>
            <label class="block text-sm font-medium text-slate-300 mb-1.5">Description *</label>
            <textarea id="ideaDescription" required rows="4" placeholder="Describe your idea in detail. What problem does it solve? How would it work?" class="w-full px-4 py-2.5 bg-slate-800/50 border border-slate-700 rounded-lg text-white placeholder-slate-500 focus:outline-none focus:border-cyber-cyan resize-none"></textarea>
          </div>

          <button type="submit" class="w-full py-3 bg-gradient-to-r from-cyber-cyan to-blue-500 text-deep-navy font-bold rounded-lg hover:opacity-90 transition-all">
            Submit Idea
          </button>
        </form>
      </div>
    </div>

    <!-- Detail Modal -->
    <div id="detailModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50">
      <div class="bg-slate-900 border border-slate-700 rounded-2xl p-6 w-full max-w-2xl mx-4 max-h-[80vh] overflow-y-auto">
        <div class="flex items-start justify-between mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              <span id="detailCategory" class="text-xs px-2 py-0.5 rounded bg-slate-700"></span>
              <span id="detailStatus" class="text-xs px-2 py-0.5 rounded"></span>
            </div>
            <h3 id="detailTitle" class="text-xl font-bold"></h3>
          </div>
          <button onclick="closeDetailModal()" class="text-slate-400 hover:text-white ml-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>

        <p id="detailDescription" class="text-slate-300 mb-6"></p>

        <div class="flex items-center gap-6 mb-6 pb-6 border-b border-slate-700">
          <div class="flex items-center gap-2">
            <button onclick="voteFromDetail('up')" id="detailUpvote" class="vote-btn p-2 rounded-lg bg-slate-800 hover:bg-slate-700 transition-all">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
              </svg>
            </button>
            <span id="detailVotes" class="text-lg font-bold">0</span>
          </div>
          <div class="text-sm text-slate-500">
            <span>Submitted </span>
            <span id="detailDate"></span>
          </div>
        </div>

        <!-- Admin Section -->
        <div id="adminSection" class="hidden">
          <h4 class="font-semibold mb-3">Admin Actions</h4>
          <div class="grid grid-cols-2 gap-3 mb-4">
            <select id="adminStatus" class="px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm">
              <option value="new">New</option>
              <option value="under_review">Under Review</option>
              <option value="planned">Planned</option>
              <option value="in_progress">In Progress</option>
              <option value="complete">Complete</option>
              <option value="declined">Declined</option>
            </select>
            <select id="adminPriority" class="px-3 py-2 bg-slate-800 border border-slate-700 rounded-lg text-sm">
              <option value="">No Priority</option>
              <option value="low">Low</option>
              <option value="medium">Medium</option>
              <option value="high">High</option>
              <option value="critical">Critical</option>
            </select>
          </div>
          <textarea id="adminNotes" rows="2" placeholder="Internal notes..." class="w-full px-3 py-2 bg-slate-800/50 border border-slate-700 rounded-lg text-sm text-white placeholder-slate-500 focus:outline-none focus:border-cyber-cyan resize-none mb-3"></textarea>
          <button onclick="updateSuggestion()" class="w-full py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm transition-colors">Update Status</button>
        </div>
      </div>
    </div>
  </main>

  <footer class="border-t border-slate-800/50 mt-12">
    <div class="max-w-5xl mx-auto px-6 py-4 text-center text-slate-500 text-xs">AI GENERATED - REQUIRES HUMAN REVIEW</div>
  </footer>

  <script>
    const SUPABASE_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc1NjcyNTAsImV4cCI6MjA1MzE0MzI1MH0.GRTFxRV7WV67P9sYaIVRwKxVEDALfkWjmUxs4ADB1zs';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let currentUser = null;
    let isAdmin = false;
    let suggestions = [];
    let userVotes = {};
    let currentFilter = 'all';
    let currentSuggestionId = null;

    const CATEGORIES = {
      new_feature: { name: 'New Feature', icon: 'üí°' },
      enhancement: { name: 'Enhancement', icon: '‚¨ÜÔ∏è' },
      integration: { name: 'Integration', icon: 'üîå' },
      ui_ux: { name: 'UI/UX', icon: 'üé®' },
      ai_agents: { name: 'AI Agents', icon: 'ü§ñ' },
      performance: { name: 'Performance', icon: '‚ö°' },
      mobile: { name: 'Mobile', icon: 'üì±' },
      other: { name: 'Other', icon: 'üìù' }
    };

    const STATUSES = {
      new: { name: 'New', color: 'bg-slate-500' },
      under_review: { name: 'Under Review', color: 'bg-amber-500' },
      planned: { name: 'Planned', color: 'bg-blue-500' },
      in_progress: { name: 'In Progress', color: 'bg-purple-500' },
      complete: { name: 'Complete', color: 'bg-emerald-500' },
      declined: { name: 'Declined', color: 'bg-red-500' }
    };

    async function checkAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      if (!session) { window.location.href = 'login.html'; return; }
      
      const { data: profile } = await supabase.from('profiles').select('*').eq('id', session.user.id).single();
      currentUser = { ...session.user, ...profile };
      isAdmin = ['CEO', 'COO', 'Admin'].includes(profile?.role);
      
      document.getElementById('authCheck').classList.add('hidden');
      document.getElementById('mainContent').classList.remove('hidden');
      
      await loadUserVotes();
      loadSuggestions();
      bindFilters();
    }

    function bindFilters() {
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'bg-cyber-cyan/20', 'text-cyber-cyan'));
          btn.classList.add('active', 'bg-cyber-cyan/20', 'text-cyber-cyan');
          currentFilter = btn.dataset.filter;
          loadSuggestions();
        });
      });
    }

    async function loadUserVotes() {
      const { data: votes } = await supabase
        .from('feature_votes')
        .select('suggestion_id, vote_type')
        .eq('user_id', currentUser.id);

      if (votes) {
        votes.forEach(v => { userVotes[v.suggestion_id] = v.vote_type; });
      }
    }

    async function loadSuggestions() {
      const categoryFilter = document.getElementById('categoryFilter').value;
      const sortBy = document.getElementById('sortBy').value;

      let query = supabase.from('feature_suggestions').select('*');

      if (currentFilter !== 'all') {
        query = query.eq('status', currentFilter);
      }

      if (categoryFilter !== 'all') {
        query = query.eq('category', categoryFilter);
      }

      if (sortBy === 'votes') {
        query = query.order('vote_count', { ascending: false });
      } else if (sortBy === 'newest') {
        query = query.order('created_at', { ascending: false });
      } else {
        query = query.order('created_at', { ascending: true });
      }

      const { data, error } = await query;
      
      if (error) { console.error(error); return; }
      suggestions = data || [];

      renderSuggestions();
      updateStats();
    }

    function renderSuggestions() {
      const container = document.getElementById('suggestionsList');
      const emptyState = document.getElementById('emptyState');

      if (suggestions.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        return;
      }

      emptyState.classList.add('hidden');
      container.innerHTML = suggestions.map(s => {
        const cat = CATEGORIES[s.category] || CATEGORIES.other;
        const status = STATUSES[s.status] || STATUSES.new;
        const hasVoted = userVotes[s.id] === 'up';

        return `
          <div class="suggestion-card bg-slate-900/60 border border-slate-700/50 rounded-xl p-5 transition-all">
            <div class="flex gap-4">
              <!-- Vote Column -->
              <div class="flex flex-col items-center gap-1">
                <button onclick="vote('${s.id}', 'up')" class="vote-btn p-2 rounded-lg ${hasVoted ? 'bg-cyber-cyan/20 text-cyber-cyan voted' : 'bg-slate-800 hover:bg-slate-700'} transition-all">
                  <svg class="w-5 h-5" fill="${hasVoted ? 'currentColor' : 'none'}" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"/>
                  </svg>
                </button>
                <span class="text-lg font-bold ${hasVoted ? 'text-cyber-cyan' : ''}">${s.vote_count || 0}</span>
              </div>

              <!-- Content Column -->
              <div class="flex-1 cursor-pointer" onclick="openDetail('${s.id}')">
                <div class="flex items-center gap-2 mb-2">
                  <span class="text-xs px-2 py-0.5 rounded bg-slate-700">${cat.icon} ${cat.name}</span>
                  <span class="text-xs px-2 py-0.5 rounded ${status.color}">${status.name}</span>
                  ${s.priority ? `<span class="text-xs px-2 py-0.5 rounded bg-amber-500/20 text-amber-400">${s.priority}</span>` : ''}
                </div>
                <h3 class="font-semibold mb-1">${s.title}</h3>
                <p class="text-sm text-slate-400 line-clamp-2">${s.description}</p>
                <p class="text-xs text-slate-500 mt-2">${new Date(s.created_at).toLocaleDateString()}</p>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    async function updateStats() {
      const { data: all } = await supabase.from('feature_suggestions').select('status');
      
      if (all) {
        document.getElementById('statTotal').textContent = all.length;
        document.getElementById('statReview').textContent = all.filter(s => s.status === 'under_review').length;
        document.getElementById('statPlanned').textContent = all.filter(s => s.status === 'planned').length;
        document.getElementById('statProgress').textContent = all.filter(s => s.status === 'in_progress').length;
        document.getElementById('statComplete').textContent = all.filter(s => s.status === 'complete').length;
      }
    }

    async function vote(suggestionId, type) {
      const existing = userVotes[suggestionId];
      
      if (existing === type) {
        // Remove vote
        await supabase.from('feature_votes').delete()
          .eq('suggestion_id', suggestionId)
          .eq('user_id', currentUser.id);
        
        delete userVotes[suggestionId];
        
        await supabase.rpc('decrement_vote_count', { suggestion_id: suggestionId }).catch(() => {
          // Fallback if RPC doesn't exist
          supabase.from('feature_suggestions')
            .update({ vote_count: suggestions.find(s => s.id === suggestionId)?.vote_count - 1 || 0 })
            .eq('id', suggestionId);
        });
      } else {
        // Add/change vote
        await supabase.from('feature_votes').upsert({
          suggestion_id: suggestionId,
          user_id: currentUser.id,
          vote_type: type
        });
        
        userVotes[suggestionId] = type;
        
        await supabase.from('feature_suggestions')
          .update({ vote_count: (suggestions.find(s => s.id === suggestionId)?.vote_count || 0) + 1 })
          .eq('id', suggestionId);
      }

      loadSuggestions();
    }

    function openSubmitModal() {
      document.getElementById('submitModal').classList.remove('hidden');
    }

    function closeSubmitModal() {
      document.getElementById('submitModal').classList.add('hidden');
      document.getElementById('submitForm').reset();
    }

    document.getElementById('submitForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const title = document.getElementById('ideaTitle').value.trim();
      const category = document.getElementById('ideaCategory').value;
      const description = document.getElementById('ideaDescription').value.trim();

      const { error } = await supabase.from('feature_suggestions').insert({
        company_id: currentUser.company_id,
        title: title,
        description: description,
        category: category,
        status: 'new',
        vote_count: 1,
        submitted_by: currentUser.id
      });

      if (error) {
        alert('Failed to submit. Please try again.');
        console.error(error);
        return;
      }

      closeSubmitModal();
      loadSuggestions();
    });

    function openDetail(id) {
      currentSuggestionId = id;
      const s = suggestions.find(x => x.id === id);
      if (!s) return;

      const cat = CATEGORIES[s.category] || CATEGORIES.other;
      const status = STATUSES[s.status] || STATUSES.new;
      const hasVoted = userVotes[id] === 'up';

      document.getElementById('detailCategory').textContent = `${cat.icon} ${cat.name}`;
      document.getElementById('detailStatus').textContent = status.name;
      document.getElementById('detailStatus').className = `text-xs px-2 py-0.5 rounded ${status.color}`;
      document.getElementById('detailTitle').textContent = s.title;
      document.getElementById('detailDescription').textContent = s.description;
      document.getElementById('detailVotes').textContent = s.vote_count || 0;
      document.getElementById('detailDate').textContent = new Date(s.created_at).toLocaleDateString();
      
      const upvoteBtn = document.getElementById('detailUpvote');
      upvoteBtn.className = `vote-btn p-2 rounded-lg ${hasVoted ? 'bg-cyber-cyan/20 text-cyber-cyan voted' : 'bg-slate-800 hover:bg-slate-700'} transition-all`;

      // Admin section
      if (isAdmin) {
        document.getElementById('adminSection').classList.remove('hidden');
        document.getElementById('adminStatus').value = s.status;
        document.getElementById('adminPriority').value = s.priority || '';
        document.getElementById('adminNotes').value = s.admin_notes || '';
      } else {
        document.getElementById('adminSection').classList.add('hidden');
      }

      document.getElementById('detailModal').classList.remove('hidden');
    }

    function closeDetailModal() {
      document.getElementById('detailModal').classList.add('hidden');
      currentSuggestionId = null;
    }

    function voteFromDetail(type) {
      if (currentSuggestionId) {
        vote(currentSuggestionId, type);
        closeDetailModal();
      }
    }

    async function updateSuggestion() {
      if (!currentSuggestionId || !isAdmin) return;

      const status = document.getElementById('adminStatus').value;
      const priority = document.getElementById('adminPriority').value || null;
      const notes = document.getElementById('adminNotes').value.trim() || null;

      const { error } = await supabase.from('feature_suggestions')
        .update({
          status: status,
          priority: priority,
          admin_notes: notes,
          reviewed_by: currentUser.id,
          reviewed_at: new Date().toISOString(),
          updated_at: new Date().toISOString()
        })
        .eq('id', currentSuggestionId);

      if (error) {
        alert('Failed to update');
        console.error(error);
        return;
      }

      closeDetailModal();
      loadSuggestions();
    }

    // Style filter buttons
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.add('bg-slate-800', 'hover:bg-slate-700', 'border', 'border-slate-700');
    });
    document.querySelector('.filter-btn.active')?.classList.add('bg-cyber-cyan/20', 'text-cyber-cyan');

    checkAuth();
  </script>
</body>
</html>
