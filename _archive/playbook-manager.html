<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse - Playbook Manager</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; background: #00050F; min-height: 100vh; color: #fff; }
    
    /* Animations */
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    
    .animate-pulse { animation: pulse 2s ease-in-out infinite; }
    .animate-spin { animation: spin 1s linear infinite; }
    .animate-slideUp { animation: slideUp 0.4s ease-out forwards; }
    .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
    .animate-scaleIn { animation: scaleIn 0.3s ease-out forwards; }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #111C2E; border-radius: 4px; }
    ::-webkit-scrollbar-thumb { background: #243656; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #00E5FA; }
    
    /* Glass effect */
    .glass-card {
      background: rgba(17, 28, 46, 0.85);
      backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    /* Quality Badge Colors */
    .badge-gold { background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: #000; }
    .badge-silver { background: linear-gradient(135deg, #9CA3AF 0%, #6B7280 100%); color: #000; }
    .badge-bronze { background: linear-gradient(135deg, #F97316 0%, #EA580C 100%); color: #fff; }
    .badge-review { background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); color: #fff; }
    
    /* Modal Backdrop */
    .modal-backdrop {
      background: rgba(0, 5, 15, 0.9);
      backdrop-filter: blur(4px);
    }
    
    /* Category Colors */
    .cat-capture { border-left-color: #EF4444; }
    .cat-strategy { border-left-color: #F59E0B; }
    .cat-compliance { border-left-color: #8B5CF6; }
    .cat-writing { border-left-color: #EC4899; }
    .cat-pricing { border-left-color: #10B981; }
    .cat-competitive { border-left-color: #06B6D4; }
    .cat-contracts { border-left-color: #3B82F6; }
    .cat-orals { border-left-color: #A855F7; }
    .cat-general { border-left-color: #6B7280; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef, useCallback } = React;

    // =====================================================
    // CONFIGURATION
    // =====================================================
    const API_BASE = 'https://missionpulse-api.onrender.com/api';
    
    // Allowed roles for Playbook Manager access
    const ALLOWED_ROLES = ['executive', 'operations', 'admin', 'qa'];
    
    const CATEGORIES = [
      { key: 'all', label: 'All Categories', icon: 'üìö', color: '#00E5FA' },
      { key: 'capture', label: 'Capture Intel', icon: 'üéØ', color: '#EF4444' },
      { key: 'strategy', label: 'Strategy', icon: 'üèÜ', color: '#F59E0B' },
      { key: 'compliance', label: 'Compliance', icon: '‚úì', color: '#8B5CF6' },
      { key: 'writing', label: 'Writer', icon: '‚úçÔ∏è', color: '#EC4899' },
      { key: 'pricing', label: 'Pricing', icon: 'üí∞', color: '#10B981' },
      { key: 'competitive', label: 'Black Hat', icon: 'üïµÔ∏è', color: '#06B6D4' },
      { key: 'contracts', label: 'Contracts', icon: 'üìã', color: '#3B82F6' },
      { key: 'orals', label: 'Orals Coach', icon: 'üé§', color: '#A855F7' },
      { key: 'general', label: 'General', icon: 'üìÅ', color: '#6B7280' },
    ];

    const QUALITY_RATINGS = [
      { key: 'all', label: 'All Ratings', color: '#00E5FA' },
      { key: 'gold', label: 'Gold', color: '#F59E0B', icon: 'üèÖ' },
      { key: 'silver', label: 'Silver', color: '#9CA3AF', icon: 'ü•à' },
      { key: 'bronze', label: 'Bronze', color: '#F97316', icon: 'ü•â' },
      { key: 'review', label: 'Needs Review', color: '#EF4444', icon: '‚ö†Ô∏è' },
    ];

    // =====================================================
    // ICONS
    // =====================================================
    const Icons = {
      search: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8" strokeWidth={2}/><path strokeLinecap="round" strokeWidth={2} d="M21 21l-4.35-4.35"/></svg>,
      plus: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4v16m8-8H4"/></svg>,
      trash: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>,
      edit: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>,
      eye: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>,
      x: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12"/></svg>,
      check: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M5 13l4 4L19 7"/></svg>,
      refresh: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>,
      download: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/></svg>,
      star: () => <svg className="w-full h-full" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>,
      book: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>,
      chart: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>,
      filter: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/></svg>,
      shield: () => <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>,
    };

    const Icon = ({ name, className = "w-4 h-4" }) => {
      const IconComponent = Icons[name];
      return IconComponent ? <span className={`inline-block ${className}`}><IconComponent /></span> : null;
    };

    // =====================================================
    // QUALITY BADGE COMPONENT
    // =====================================================
    const QualityBadge = ({ rating, size = 'sm', onClick }) => {
      const config = {
        gold: { bg: 'badge-gold', label: 'Gold', icon: 'üèÖ' },
        silver: { bg: 'badge-silver', label: 'Silver', icon: 'ü•à' },
        bronze: { bg: 'badge-bronze', label: 'Bronze', icon: 'ü•â' },
        review: { bg: 'badge-review', label: 'Review', icon: '‚ö†Ô∏è' },
      };
      
      const { bg, label, icon } = config[rating] || config.review;
      const sizeClasses = size === 'lg' ? 'px-3 py-1.5 text-sm' : 'px-2 py-0.5 text-xs';
      
      return (
        <span 
          className={`${bg} ${sizeClasses} rounded-full font-semibold inline-flex items-center gap-1 ${onClick ? 'cursor-pointer hover:opacity-80' : ''}`}
          onClick={onClick}
        >
          <span>{icon}</span>
          <span>{label}</span>
        </span>
      );
    };

    // =====================================================
    // STATS DASHBOARD COMPONENT
    // =====================================================
    const StatsDashboard = ({ stats, loading }) => {
      if (loading) {
        return (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
            {[1,2,3,4].map(i => (
              <div key={i} className="glass-card rounded-xl p-4 animate-pulse">
                <div className="h-4 bg-gray-700 rounded w-1/2 mb-2"></div>
                <div className="h-8 bg-gray-700 rounded w-3/4"></div>
              </div>
            ))}
          </div>
        );
      }
      
      const statCards = [
        { label: 'Total Entries', value: stats?.total_entries || 0, icon: 'book', color: '#00E5FA' },
        { label: 'Total Uses', value: stats?.total_uses || 0, icon: 'chart', color: '#10B981' },
        { label: 'Gold Examples', value: stats?.by_quality?.gold || 0, icon: 'star', color: '#F59E0B' },
        { label: 'Needs Review', value: stats?.by_quality?.review || 0, icon: 'shield', color: '#EF4444' },
      ];
      
      return (
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
          {statCards.map((stat, i) => (
            <div key={i} className="glass-card rounded-xl p-4 animate-slideUp" style={{ animationDelay: `${i * 0.1}s` }}>
              <div className="flex items-center justify-between mb-2">
                <span className="text-gray-400 text-sm">{stat.label}</span>
                <span className="w-8 h-8 rounded-lg flex items-center justify-center" style={{ background: `${stat.color}20` }}>
                  <Icon name={stat.icon} className="w-4 h-4" style={{ color: stat.color }} />
                </span>
              </div>
              <div className="text-2xl font-bold" style={{ color: stat.color }}>{stat.value.toLocaleString()}</div>
            </div>
          ))}
        </div>
      );
    };

    // =====================================================
    // ENTRY TABLE ROW COMPONENT
    // =====================================================
    const EntryRow = ({ entry, onView, onEdit, onDelete, onRatingChange }) => {
      const category = CATEGORIES.find(c => c.key === entry.category) || CATEGORIES[CATEGORIES.length - 1];
      
      return (
        <tr className={`border-b border-gray-800 hover:bg-gray-800/50 transition-colors cat-${entry.category}`} style={{ borderLeftWidth: '3px' }}>
          <td className="px-4 py-3">
            <div className="font-medium text-white">{entry.title}</div>
            <div className="text-xs text-gray-500 mt-1 flex items-center gap-2">
              <span>{category.icon} {category.label}</span>
              <span>‚Ä¢</span>
              <span>{entry.keywords?.slice(0, 3).join(', ') || 'No keywords'}</span>
            </div>
          </td>
          <td className="px-4 py-3">
            <QualityBadge rating={entry.quality_rating} />
          </td>
          <td className="px-4 py-3 text-center">
            <span className="text-cyan-400 font-semibold">{entry.use_count}</span>
          </td>
          <td className="px-4 py-3 text-center">
            <span className="text-gray-400">{entry.token_estimate?.toLocaleString() || '‚Äî'}</span>
          </td>
          <td className="px-4 py-3">
            <div className="flex items-center gap-1">
              {/* Quick Rating Buttons */}
              <div className="flex gap-0.5 mr-2 bg-gray-800 rounded-lg p-0.5">
                {['gold', 'silver', 'bronze'].map(rating => (
                  <button
                    key={rating}
                    onClick={() => onRatingChange(entry.id, rating)}
                    className={`w-6 h-6 rounded flex items-center justify-center text-xs transition-all ${
                      entry.quality_rating === rating ? 'bg-gray-600 scale-110' : 'hover:bg-gray-700'
                    }`}
                    title={`Set to ${rating}`}
                  >
                    {rating === 'gold' ? 'üèÖ' : rating === 'silver' ? 'ü•à' : 'ü•â'}
                  </button>
                ))}
              </div>
              
              {/* Action Buttons */}
              <button onClick={() => onView(entry)} className="p-2 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-cyan-400 transition-colors" title="View">
                <Icon name="eye" className="w-4 h-4" />
              </button>
              <button onClick={() => onEdit(entry)} className="p-2 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-yellow-400 transition-colors" title="Edit">
                <Icon name="edit" className="w-4 h-4" />
              </button>
              <button onClick={() => onDelete(entry.id)} className="p-2 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-red-400 transition-colors" title="Delete">
                <Icon name="trash" className="w-4 h-4" />
              </button>
            </div>
          </td>
        </tr>
      );
    };

    // =====================================================
    // MODAL COMPONENT
    // =====================================================
    const Modal = ({ isOpen, onClose, title, children, size = 'lg' }) => {
      if (!isOpen) return null;
      
      const sizeClass = size === 'xl' ? 'max-w-4xl' : size === 'lg' ? 'max-w-2xl' : 'max-w-md';
      
      return (
        <div className="fixed inset-0 z-50 modal-backdrop flex items-center justify-center p-4 animate-fadeIn" onClick={onClose}>
          <div 
            className={`glass-card rounded-2xl ${sizeClass} w-full max-h-[90vh] overflow-hidden animate-scaleIn`}
            onClick={e => e.stopPropagation()}
          >
            <div className="flex items-center justify-between p-4 border-b border-gray-700">
              <h2 className="text-xl font-bold text-white">{title}</h2>
              <button onClick={onClose} className="p-2 hover:bg-gray-700 rounded-lg text-gray-400 hover:text-white transition-colors">
                <Icon name="x" className="w-5 h-5" />
              </button>
            </div>
            <div className="p-4 overflow-y-auto max-h-[calc(90vh-80px)]">
              {children}
            </div>
          </div>
        </div>
      );
    };

    // =====================================================
    // ENTRY FORM COMPONENT
    // =====================================================
    const EntryForm = ({ entry, onSubmit, onCancel, isLoading }) => {
      const [formData, setFormData] = useState({
        title: entry?.title || '',
        category: entry?.category || 'general',
        quality_rating: entry?.quality_rating || 'review',
        user_prompt: entry?.user_prompt || '',
        assistant_response: entry?.assistant_response || '',
        keywords: entry?.keywords?.join(', ') || '',
      });
      
      const handleSubmit = (e) => {
        e.preventDefault();
        onSubmit({
          ...formData,
          keywords: formData.keywords.split(',').map(k => k.trim()).filter(Boolean)
        });
      };
      
      return (
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-300 mb-1">Title *</label>
            <input
              type="text"
              value={formData.title}
              onChange={e => setFormData({...formData, title: e.target.value})}
              className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-cyan-500 focus:outline-none"
              placeholder="e.g., DHA Executive Summary Template"
              required
              minLength={3}
            />
          </div>
          
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium text-gray-300 mb-1">Category *</label>
              <select
                value={formData.category}
                onChange={e => setFormData({...formData, category: e.target.value})}
                className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-cyan-500 focus:outline-none"
              >
                {CATEGORIES.filter(c => c.key !== 'all').map(cat => (
                  <option key={cat.key} value={cat.key}>{cat.icon} {cat.label}</option>
                ))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-gray-300 mb-1">Quality Rating</label>
              <select
                value={formData.quality_rating}
                onChange={e => setFormData({...formData, quality_rating: e.target.value})}
                className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-cyan-500 focus:outline-none"
              >
                {QUALITY_RATINGS.filter(q => q.key !== 'all').map(q => (
                  <option key={q.key} value={q.key}>{q.icon} {q.label}</option>
                ))}
              </select>
            </div>
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-300 mb-1">Keywords (comma-separated)</label>
            <input
              type="text"
              value={formData.keywords}
              onChange={e => setFormData({...formData, keywords: e.target.value})}
              className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-2 text-white focus:border-cyan-500 focus:outline-none"
              placeholder="e.g., dha, executive_summary, healthcare"
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-300 mb-1">User Prompt *</label>
            <textarea
              value={formData.user_prompt}
              onChange={e => setFormData({...formData, user_prompt: e.target.value})}
              className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none min-h-[100px] resize-y"
              placeholder="Enter the user's prompt that this example responds to..."
              required
              minLength={10}
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-300 mb-1">Assistant Response *</label>
            <textarea
              value={formData.assistant_response}
              onChange={e => setFormData({...formData, assistant_response: e.target.value})}
              className="w-full bg-gray-800 border border-gray-700 rounded-lg px-4 py-3 text-white focus:border-cyan-500 focus:outline-none min-h-[200px] resize-y"
              placeholder="Enter the ideal assistant response..."
              required
              minLength={10}
            />
          </div>
          
          <div className="flex justify-end gap-3 pt-4 border-t border-gray-700">
            <button
              type="button"
              onClick={onCancel}
              className="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors"
            >
              Cancel
            </button>
            <button
              type="submit"
              disabled={isLoading}
              className="px-6 py-2 bg-gradient-to-r from-cyan-500 to-cyan-600 hover:from-cyan-400 hover:to-cyan-500 text-white rounded-lg font-semibold transition-all disabled:opacity-50"
            >
              {isLoading ? (
                <span className="flex items-center gap-2">
                  <span className="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></span>
                  Saving...
                </span>
              ) : (
                entry ? 'Update Entry' : 'Create Entry'
              )}
            </button>
          </div>
        </form>
      );
    };

    // =====================================================
    // VIEW ENTRY MODAL COMPONENT
    // =====================================================
    const ViewEntryModal = ({ entry, onClose }) => {
      const category = CATEGORIES.find(c => c.key === entry.category) || CATEGORIES[CATEGORIES.length - 1];
      
      return (
        <div className="space-y-6">
          <div className="flex items-start justify-between">
            <div>
              <h3 className="text-lg font-bold text-white">{entry.title}</h3>
              <div className="flex items-center gap-3 mt-2">
                <span className="text-sm text-gray-400">{category.icon} {category.label}</span>
                <QualityBadge rating={entry.quality_rating} />
              </div>
            </div>
            <div className="text-right text-sm text-gray-500">
              <div>Uses: <span className="text-cyan-400 font-semibold">{entry.use_count}</span></div>
              <div>Tokens: ~{entry.token_estimate?.toLocaleString()}</div>
            </div>
          </div>
          
          {entry.keywords?.length > 0 && (
            <div className="flex flex-wrap gap-2">
              {entry.keywords.map((kw, i) => (
                <span key={i} className="px-2 py-1 bg-gray-800 rounded-md text-xs text-gray-400">#{kw}</span>
              ))}
            </div>
          )}
          
          <div className="space-y-4">
            <div>
              <label className="block text-sm font-medium text-cyan-400 mb-2">User Prompt</label>
              <div className="bg-gray-800 rounded-lg p-4 text-gray-300 whitespace-pre-wrap text-sm">
                {entry.user_prompt}
              </div>
            </div>
            
            <div>
              <label className="block text-sm font-medium text-green-400 mb-2">Assistant Response</label>
              <div className="bg-gray-800 rounded-lg p-4 text-gray-300 whitespace-pre-wrap text-sm max-h-[300px] overflow-y-auto">
                {entry.assistant_response}
              </div>
            </div>
          </div>
          
          <div className="text-xs text-gray-500 pt-4 border-t border-gray-700">
            <div>Created by: {entry.created_by || 'Unknown'}</div>
            <div>Created: {entry.created_at ? new Date(entry.created_at).toLocaleString() : '‚Äî'}</div>
          </div>
        </div>
      );
    };

    // =====================================================
    // MAIN APP COMPONENT
    // =====================================================
    const PlaybookManager = () => {
      // State
      const [entries, setEntries] = useState([]);
      const [stats, setStats] = useState(null);
      const [loading, setLoading] = useState(true);
      const [searchQuery, setSearchQuery] = useState('');
      const [categoryFilter, setCategoryFilter] = useState('all');
      const [qualityFilter, setQualityFilter] = useState('all');
      const [selectedEntry, setSelectedEntry] = useState(null);
      const [modalMode, setModalMode] = useState(null); // 'view', 'edit', 'create'
      const [isSubmitting, setIsSubmitting] = useState(false);
      const [toast, setToast] = useState(null);
      const [currentRole, setCurrentRole] = useState('executive'); // Simulated RBAC
      
      // Check RBAC access
      const hasAccess = ALLOWED_ROLES.includes(currentRole);
      
      // Show toast notification
      const showToast = (message, type = 'success') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };
      
      // Fetch data
      const fetchEntries = useCallback(async () => {
        try {
          setLoading(true);
          const params = new URLSearchParams();
          if (categoryFilter !== 'all') params.append('category', categoryFilter);
          if (qualityFilter !== 'all') params.append('quality', qualityFilter);
          
          const url = searchQuery 
            ? `${API_BASE}/playbook/search`
            : `${API_BASE}/playbook?${params}`;
          
          const options = searchQuery 
            ? {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                  query: searchQuery,
                  category: categoryFilter !== 'all' ? categoryFilter : null,
                  quality: qualityFilter !== 'all' ? qualityFilter : null
                })
              }
            : {};
          
          const response = await fetch(url, options);
          if (!response.ok) throw new Error('Failed to fetch entries');
          const data = await response.json();
          setEntries(data.entries || []);
        } catch (error) {
          console.error('Error fetching entries:', error);
          showToast('Failed to fetch entries', 'error');
        } finally {
          setLoading(false);
        }
      }, [searchQuery, categoryFilter, qualityFilter]);
      
      const fetchStats = async () => {
        try {
          const response = await fetch(`${API_BASE}/playbook/stats`);
          if (!response.ok) throw new Error('Failed to fetch stats');
          const data = await response.json();
          setStats(data);
        } catch (error) {
          console.error('Error fetching stats:', error);
        }
      };
      
      useEffect(() => {
        if (hasAccess) {
          fetchEntries();
          fetchStats();
        }
      }, [fetchEntries, hasAccess]);
      
      // Debounced search
      useEffect(() => {
        const timer = setTimeout(() => {
          if (hasAccess) fetchEntries();
        }, 300);
        return () => clearTimeout(timer);
      }, [searchQuery, categoryFilter, qualityFilter]);
      
      // Handlers
      const handleCreate = async (data) => {
        try {
          setIsSubmitting(true);
          const response = await fetch(`${API_BASE}/playbook`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (!response.ok) throw new Error('Failed to create entry');
          showToast('Entry created successfully');
          setModalMode(null);
          fetchEntries();
          fetchStats();
        } catch (error) {
          console.error('Error creating entry:', error);
          showToast('Failed to create entry', 'error');
        } finally {
          setIsSubmitting(false);
        }
      };
      
      const handleUpdate = async (data) => {
        try {
          setIsSubmitting(true);
          const response = await fetch(`${API_BASE}/playbook/${selectedEntry.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          if (!response.ok) throw new Error('Failed to update entry');
          showToast('Entry updated successfully');
          setModalMode(null);
          setSelectedEntry(null);
          fetchEntries();
          fetchStats();
        } catch (error) {
          console.error('Error updating entry:', error);
          showToast('Failed to update entry', 'error');
        } finally {
          setIsSubmitting(false);
        }
      };
      
      const handleDelete = async (id) => {
        if (!confirm('Are you sure you want to delete this entry?')) return;
        try {
          const response = await fetch(`${API_BASE}/playbook/${id}`, { method: 'DELETE' });
          if (!response.ok) throw new Error('Failed to delete entry');
          showToast('Entry deleted');
          fetchEntries();
          fetchStats();
        } catch (error) {
          console.error('Error deleting entry:', error);
          showToast('Failed to delete entry', 'error');
        }
      };
      
      const handleRatingChange = async (id, rating) => {
        try {
          const response = await fetch(`${API_BASE}/playbook/${id}/rating`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ quality_rating: rating })
          });
          if (!response.ok) throw new Error('Failed to update rating');
          showToast(`Rating updated to ${rating}`);
          fetchEntries();
          fetchStats();
        } catch (error) {
          console.error('Error updating rating:', error);
          showToast('Failed to update rating', 'error');
        }
      };
      
      const handleBulkDeleteReview = async () => {
        const reviewEntries = entries.filter(e => e.quality_rating === 'review');
        if (reviewEntries.length === 0) {
          showToast('No entries with "Review" status', 'error');
          return;
        }
        if (!confirm(`Delete ${reviewEntries.length} entries with "Review" status?`)) return;
        
        try {
          const response = await fetch(`${API_BASE}/playbook/bulk-delete`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ entry_ids: reviewEntries.map(e => e.id) })
          });
          if (!response.ok) throw new Error('Failed to bulk delete');
          const result = await response.json();
          showToast(`Deleted ${result.deleted_count} entries`);
          fetchEntries();
          fetchStats();
        } catch (error) {
          console.error('Error bulk deleting:', error);
          showToast('Failed to bulk delete', 'error');
        }
      };
      
      const handleExport = () => {
        window.open(`${API_BASE}/playbook/export/json?category=${categoryFilter !== 'all' ? categoryFilter : ''}&quality=${qualityFilter !== 'all' ? qualityFilter : ''}`, '_blank');
      };
      
      // Access denied view
      if (!hasAccess) {
        return (
          <div className="min-h-screen flex items-center justify-center p-8">
            <div className="glass-card rounded-2xl p-8 text-center max-w-md">
              <div className="w-16 h-16 mx-auto mb-4 rounded-full bg-red-500/20 flex items-center justify-center">
                <Icon name="shield" className="w-8 h-8 text-red-400" />
              </div>
              <h2 className="text-xl font-bold text-white mb-2">Access Restricted</h2>
              <p className="text-gray-400 mb-4">Playbook Manager requires CEO, COO, Admin, or QA role.</p>
              <div className="text-sm text-gray-500">Current role: <span className="text-cyan-400">{currentRole}</span></div>
            </div>
          </div>
        );
      }
      
      return (
        <div className="min-h-screen p-4 md:p-8">
          {/* Toast Notification */}
          {toast && (
            <div className={`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg animate-slideUp ${
              toast.type === 'error' ? 'bg-red-600' : 'bg-green-600'
            } text-white font-medium`}>
              {toast.message}
            </div>
          )}
          
          {/* Header */}
          <div className="mb-8">
            <div className="flex items-center gap-3 mb-2">
              <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-cyan-600 flex items-center justify-center">
                <Icon name="book" className="w-5 h-5 text-white" />
              </div>
              <div>
                <h1 className="text-2xl md:text-3xl font-bold text-white">Playbook Manager</h1>
                <p className="text-gray-400 text-sm">Curate Golden Examples to improve AI agent quality</p>
              </div>
            </div>
            
            {/* Role Selector (Demo) */}
            <div className="flex items-center gap-2 mt-4">
              <span className="text-xs text-gray-500">Demo Role:</span>
              <select 
                value={currentRole} 
                onChange={e => setCurrentRole(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded-lg px-2 py-1 text-xs text-gray-300"
              >
                <option value="executive">Executive (CEO)</option>
                <option value="operations">Operations (COO)</option>
                <option value="admin">Admin</option>
                <option value="qa">QA</option>
                <option value="author">Author (No Access)</option>
              </select>
            </div>
          </div>
          
          {/* Stats Dashboard */}
          <StatsDashboard stats={stats} loading={loading && !entries.length} />
          
          {/* Filters & Actions Bar */}
          <div className="glass-card rounded-xl p-4 mb-6">
            <div className="flex flex-col md:flex-row gap-4">
              {/* Search */}
              <div className="relative flex-1">
                <Icon name="search" className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500" />
                <input
                  type="text"
                  value={searchQuery}
                  onChange={e => setSearchQuery(e.target.value)}
                  placeholder="Search prompts, responses, keywords..."
                  className="w-full bg-gray-800 border border-gray-700 rounded-lg pl-10 pr-4 py-2.5 text-white placeholder-gray-500 focus:border-cyan-500 focus:outline-none"
                />
              </div>
              
              {/* Category Filter */}
              <select
                value={categoryFilter}
                onChange={e => setCategoryFilter(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:border-cyan-500 focus:outline-none min-w-[160px]"
              >
                {CATEGORIES.map(cat => (
                  <option key={cat.key} value={cat.key}>{cat.icon} {cat.label}</option>
                ))}
              </select>
              
              {/* Quality Filter */}
              <select
                value={qualityFilter}
                onChange={e => setQualityFilter(e.target.value)}
                className="bg-gray-800 border border-gray-700 rounded-lg px-4 py-2.5 text-white focus:border-cyan-500 focus:outline-none min-w-[150px]"
              >
                {QUALITY_RATINGS.map(q => (
                  <option key={q.key} value={q.key}>{q.icon || ''} {q.label}</option>
                ))}
              </select>
              
              {/* Action Buttons */}
              <div className="flex gap-2">
                <button
                  onClick={() => { fetchEntries(); fetchStats(); }}
                  className="p-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-300 hover:text-white transition-colors"
                  title="Refresh"
                >
                  <Icon name="refresh" className="w-5 h-5" />
                </button>
                <button
                  onClick={handleExport}
                  className="p-2.5 bg-gray-700 hover:bg-gray-600 rounded-lg text-gray-300 hover:text-white transition-colors"
                  title="Export JSON"
                >
                  <Icon name="download" className="w-5 h-5" />
                </button>
                <button
                  onClick={handleBulkDeleteReview}
                  className="p-2.5 bg-red-900/50 hover:bg-red-800 rounded-lg text-red-300 hover:text-white transition-colors"
                  title="Bulk Delete Review Items"
                >
                  <Icon name="trash" className="w-5 h-5" />
                </button>
                <button
                  onClick={() => { setSelectedEntry(null); setModalMode('create'); }}
                  className="flex items-center gap-2 px-4 py-2.5 bg-gradient-to-r from-cyan-500 to-cyan-600 hover:from-cyan-400 hover:to-cyan-500 rounded-lg text-white font-semibold transition-all"
                >
                  <Icon name="plus" className="w-5 h-5" />
                  <span className="hidden md:inline">Add Entry</span>
                </button>
              </div>
            </div>
          </div>
          
          {/* Entries Table */}
          <div className="glass-card rounded-xl overflow-hidden">
            <div className="overflow-x-auto">
              <table className="w-full">
                <thead className="bg-gray-800/50">
                  <tr>
                    <th className="text-left px-4 py-3 text-sm font-semibold text-gray-400">Title / Category</th>
                    <th className="text-left px-4 py-3 text-sm font-semibold text-gray-400">Quality</th>
                    <th className="text-center px-4 py-3 text-sm font-semibold text-gray-400">Uses</th>
                    <th className="text-center px-4 py-3 text-sm font-semibold text-gray-400">Tokens</th>
                    <th className="text-left px-4 py-3 text-sm font-semibold text-gray-400">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {loading ? (
                    <tr>
                      <td colSpan={5} className="px-4 py-12 text-center">
                        <div className="flex flex-col items-center gap-3">
                          <div className="w-8 h-8 border-2 border-cyan-500/30 border-t-cyan-500 rounded-full animate-spin"></div>
                          <span className="text-gray-500">Loading entries...</span>
                        </div>
                      </td>
                    </tr>
                  ) : entries.length === 0 ? (
                    <tr>
                      <td colSpan={5} className="px-4 py-12 text-center">
                        <div className="flex flex-col items-center gap-3">
                          <Icon name="book" className="w-12 h-12 text-gray-600" />
                          <span className="text-gray-500">No entries found</span>
                          <button
                            onClick={() => { setSelectedEntry(null); setModalMode('create'); }}
                            className="px-4 py-2 bg-cyan-600 hover:bg-cyan-500 rounded-lg text-white text-sm transition-colors"
                          >
                            Create First Entry
                          </button>
                        </div>
                      </td>
                    </tr>
                  ) : (
                    entries.map(entry => (
                      <EntryRow
                        key={entry.id}
                        entry={entry}
                        onView={e => { setSelectedEntry(e); setModalMode('view'); }}
                        onEdit={e => { setSelectedEntry(e); setModalMode('edit'); }}
                        onDelete={handleDelete}
                        onRatingChange={handleRatingChange}
                      />
                    ))
                  )}
                </tbody>
              </table>
            </div>
            
            {/* Table Footer */}
            <div className="px-4 py-3 bg-gray-800/30 border-t border-gray-800 flex items-center justify-between text-sm text-gray-500">
              <span>Showing {entries.length} entries</span>
              <span>Total tokens: ~{stats?.total_tokens?.toLocaleString() || 0}</span>
            </div>
          </div>
          
          {/* AI Generated Footer */}
          <div className="mt-6 text-center text-xs text-gray-600 border-t border-gray-800 pt-4">
            <span className="inline-flex items-center gap-2 px-3 py-1 bg-gray-800/50 rounded-full">
              <Icon name="shield" className="w-3 h-3" />
              AI GENERATED - REQUIRES HUMAN REVIEW
            </span>
            <div className="mt-2">Mission Meets Tech ‚Ä¢ Mission. Technology. Transformation.</div>
          </div>
          
          {/* View Modal */}
          <Modal
            isOpen={modalMode === 'view' && selectedEntry}
            onClose={() => { setModalMode(null); setSelectedEntry(null); }}
            title="View Entry"
            size="xl"
          >
            {selectedEntry && <ViewEntryModal entry={selectedEntry} onClose={() => setModalMode(null)} />}
          </Modal>
          
          {/* Create/Edit Modal */}
          <Modal
            isOpen={modalMode === 'create' || modalMode === 'edit'}
            onClose={() => { setModalMode(null); setSelectedEntry(null); }}
            title={modalMode === 'create' ? 'Create New Entry' : 'Edit Entry'}
            size="xl"
          >
            <EntryForm
              entry={modalMode === 'edit' ? selectedEntry : null}
              onSubmit={modalMode === 'create' ? handleCreate : handleUpdate}
              onCancel={() => { setModalMode(null); setSelectedEntry(null); }}
              isLoading={isSubmitting}
            />
          </Modal>
        </div>
      );
    };

    // =====================================================
    // RENDER
    // =====================================================
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PlaybookManager />);
  </script>
</body>
</html>
