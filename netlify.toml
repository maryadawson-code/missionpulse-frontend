# MissionPulse Netlify Configuration
# Updated for Phase 4 - Supabase Integration

[build]
  publish = "."
  command = "echo 'Static site - no build needed'"

# Custom headers for security
[[headers]]
  for = "/*"
  [headers.values]
    # Security headers
    X-Frame-Options = "DENY"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "strict-origin-when-cross-origin"
    
    # Allow Supabase connections
    Content-Security-Policy = """
      default-src 'self';
      script-src 'self' 'unsafe-inline' 'unsafe-eval' 
        https://cdn.jsdelivr.net 
        https://unpkg.com 
        https://cdn.tailwindcss.com
        https://djuviwarqdvlbgcfuupa.supabase.co;
      style-src 'self' 'unsafe-inline' 
        https://fonts.googleapis.com 
        https://cdn.tailwindcss.com;
      font-src 'self' https://fonts.gstatic.com;
      img-src 'self' data: https: blob:;
      connect-src 'self' 
        https://djuviwarqdvlbgcfuupa.supabase.co 
        wss://djuviwarqdvlbgcfuupa.supabase.co
        https://api.anthropic.com;
      frame-ancestors 'none';
    """

# JavaScript files
[[headers]]
  for = "/*.js"
  [headers.values]
    Content-Type = "application/javascript; charset=utf-8"
    Cache-Control = "public, max-age=31536000, immutable"

# CSS files
[[headers]]
  for = "/*.css"
  [headers.values]
    Content-Type = "text/css; charset=utf-8"
    Cache-Control = "public, max-age=31536000, immutable"

# HTML files - no cache for auth flow
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

# JSON files
[[headers]]
  for = "/*.json"
  [headers.values]
    Content-Type = "application/json; charset=utf-8"
    Cache-Control = "no-cache"

# Redirects

# Handle SPA routing - redirect 404s to index
[[redirects]]
  from = "/dashboard"
  to = "/index.html"
  status = 200

[[redirects]]
  from = "/dashboard/*"
  to = "/index.html"
  status = 200

# Auth routes
[[redirects]]
  from = "/login"
  to = "/login.html"
  status = 200

[[redirects]]
  from = "/signup"
  to = "/login.html"
  status = 200

[[redirects]]
  from = "/reset-password"
  to = "/reset-password.html"
  status = 200

# Admin routes
[[redirects]]
  from = "/admin"
  to = "/admin-users.html"
  status = 200

[[redirects]]
  from = "/admin/users"
  to = "/admin-users.html"
  status = 200

# Module routes (map clean URLs to HTML files)
[[redirects]]
  from = "/pipeline"
  to = "/missionpulse-m1-enhanced.html"
  status = 200

[[redirects]]
  from = "/warroom"
  to = "/missionpulse-m2-warroom-enhanced.html"
  status = 200

[[redirects]]
  from = "/swimlane"
  to = "/missionpulse-m3-swimlane-board.html"
  status = 200

[[redirects]]
  from = "/contracts"
  to = "/missionpulse-m5-contracts-enhanced.html"
  status = 200

[[redirects]]
  from = "/irondome"
  to = "/missionpulse-m6-iron-dome.html"
  status = 200

[[redirects]]
  from = "/blackhat"
  to = "/missionpulse-m7-blackhat-enhanced.html"
  status = 200

[[redirects]]
  from = "/pricing"
  to = "/missionpulse-m8-pricing.html"
  status = 200

[[redirects]]
  from = "/hitl"
  to = "/missionpulse-m9-hitl-enhanced.html"
  status = 200

[[redirects]]
  from = "/frenemy"
  to = "/missionpulse-m11-frenemy-protocol.html"
  status = 200

[[redirects]]
  from = "/launch"
  to = "/missionpulse-m13-launch-roi.html"
  status = 200

[[redirects]]
  from = "/postaward"
  to = "/missionpulse-m14-post-award.html"
  status = 200

[[redirects]]
  from = "/lessons"
  to = "/missionpulse-m15-lessons-playbook.html"
  status = 200

# API proxy to Render backend (optional - for same-origin API calls)
[[redirects]]
  from = "/api/*"
  to = "https://missionpulse-api.onrender.com/api/:splat"
  status = 200
  force = true
  headers = {X-Custom-Header = "MissionPulse-Netlify-Proxy"}

# Fallback 404
[[redirects]]
  from = "/*"
  to = "/404.html"
  status = 404
