<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Competitors Deep Dive</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}
    ::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}
  </style>
  <script src="rbac-guard.js"></script>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    const SB_URL = 'https://qdrtpnpnhkxvfmvfziop.supabase.co';
    const SB_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;
    try { sbClient = supabase.createClient(SB_URL, SB_KEY); } catch(e) { sbClient = null; }

    const ROLES_ALLOWED = ['CEO','COO','CAP','SA','PM'];

    const DEMO_COMPETITORS = [
      { id:1, name:'Leidos Health', size:'Large', setAside:'None', incumbent:true, threatLevel:'HIGH', strengths:['DHA incumbency','MHS GENESIS prime','$4B health portfolio'], weaknesses:['Slow to innovate','High rates','Subcontractor complaints'], winRate:68, losses:4, wins:9, contracts:['MHS GENESIS','DHA IT Services','PFM Support'] },
      { id:2, name:'Booz Allen Hamilton', size:'Large', setAside:'None', incumbent:false, threatLevel:'HIGH', strengths:['Analytics depth','Cleared workforce','DoD relationships'], weaknesses:['Premium pricing','Bureaucratic delivery','Staff turnover'], winRate:61, losses:7, wins:11, contracts:['VA Data Analytics','DHA Cyber','CMS Innovation'] },
      { id:3, name:'Accenture Federal', size:'Large', setAside:'None', incumbent:false, threatLevel:'MEDIUM', strengths:['Cloud expertise','Commercial best practices','Global bench'], weaknesses:['Federal culture gap','Compliance gaps','Overhead costs'], winRate:55, losses:5, wins:6, contracts:['VA EHR Support','CMS Cloud','IRS Modernization'] },
      { id:4, name:'GDIT', size:'Large', setAside:'None', incumbent:true, threatLevel:'MEDIUM', strengths:['Infrastructure depth','Clearance capacity','Agency relationships'], weaknesses:['Innovation laggard','High overhead','Legacy mindset'], winRate:58, losses:6, wins:8, contracts:['DHA Network Ops','VA Infrastructure','DoD Health IT'] },
      { id:5, name:'Cognosante', size:'Small', setAside:'SDVOSB', incumbent:false, threatLevel:'MEDIUM', strengths:['VA specialization','Agile delivery','Veteran-owned'], weaknesses:['Limited scale','Narrow portfolio','Key person risk'], winRate:72, losses:2, wins:5, contracts:['VA Health IT','VA Claims','VA Community Care'] },
      { id:6, name:'Ventera', size:'Small', setAside:'8(a)', incumbent:false, threatLevel:'LOW', strengths:['CMS expertise','DevSecOps','Competitive rates'], weaknesses:['No DHA presence','Limited past performance','Small bench'], winRate:45, losses:3, wins:2, contracts:['CMS Portal','HHS Data','OPM Systems'] },
    ];

    const CAPABILITY_AREAS = ['Cloud/DevSecOps','AI/ML','Data Analytics','Cybersecurity','EHR/Health IT','Agile Delivery','FedRAMP','CMMC','508 Compliance','Help Desk/ITSM'];

    const DEMO_MATRIX = {
      'Leidos Health':      [4,3,4,4,5,3,4,4,3,4],
      'Booz Allen Hamilton': [4,5,5,4,3,4,4,3,4,3],
      'Accenture Federal':  [5,4,4,3,3,4,5,2,4,3],
      'GDIT':               [4,2,3,5,4,3,4,4,3,5],
      'Cognosante':         [3,3,3,3,5,4,3,3,3,3],
      'Ventera':            [4,3,3,3,2,4,3,2,3,2],
      'Mission Meets Tech': [4,5,4,4,4,5,4,5,4,4],
    };

    const DEMO_WIN_LOSS = [
      { opp:'DHA EHR Mod Wave 2', competitor:'Leidos Health', result:'LOSS', value:180000000, reason:'Incumbency advantage', date:'2025-08' },
      { opp:'VA Claims AI Pilot', competitor:'Booz Allen Hamilton', result:'WIN', value:42000000, reason:'Superior AI approach + price', date:'2025-06' },
      { opp:'CMS Data Lake Phase 1', competitor:'Accenture Federal', result:'WIN', value:28000000, reason:'FedRAMP readiness + SDVOSB', date:'2025-03' },
      { opp:'DHA Cyber Assessment', competitor:'GDIT', result:'LOSS', value:95000000, reason:'Clearance volume gap', date:'2025-01' },
      { opp:'IHS Telehealth RFI', competitor:'Cognosante', result:'WIN', value:15000000, reason:'Innovation + veteran focus', date:'2024-11' },
      { opp:'VA Community Care IT', competitor:'Leidos Health', result:'LOSS', value:210000000, reason:'Past performance breadth', date:'2024-09' },
      { opp:'SSA Mod Wave 3 Proto', competitor:'Ventera', result:'WIN', value:8000000, reason:'Technical approach + price', date:'2024-07' },
      { opp:'DHA PFM Analytics', competitor:'Booz Allen Hamilton', result:'LOSS', value:88000000, reason:'Analytics depth + cleared staff', date:'2024-05' },
    ];

    const ConnectionDot = ({ c }) => (
      <div style={{ display:'flex', alignItems:'center', gap:'6px', fontSize:'11px', color:c?'#00ff88':'#f59e0b' }}>
        <div style={{ width:'8px', height:'8px', borderRadius:'50%', background:c?'#00ff88':'#f59e0b', boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}` }} />{c?'LIVE':'DEMO'}
      </div>
    );

    const ThreatBadge = ({ level }) => {
      const c = { HIGH:'#ef4444', MEDIUM:'#f59e0b', LOW:'#00ff88' };
      return <span style={{ fontSize:'10px', fontWeight:700, padding:'2px 8px', borderRadius:'4px', background:`${c[level]}12`, color:c[level] }}>{level}</span>;
    };

    const RatingBar = ({ value, max=5 }) => (
      <div style={{ display:'flex', gap:'2px', alignItems:'center' }}>
        {Array.from({length:max}).map((_,i) => (
          <div key={i} style={{ width:'14px', height:'6px', borderRadius:'2px', background: i < value ? (value >= 4 ? '#00ff88' : value >= 3 ? '#00E5FA' : value >= 2 ? '#f59e0b' : '#ef4444') : 'rgba(255,255,255,0.06)' }} />
        ))}
        <span style={{ fontSize:'10px', color:'#5a7a9a', marginLeft:'4px' }}>{value}/{max}</span>
      </div>
    );

    const App = () => {
      const [connected, setConnected] = useState(false);
      const [competitors, setCompetitors] = useState(DEMO_COMPETITORS);
      const [tab, setTab] = useState('profiles');
      const [selected, setSelected] = useState(null);

      useEffect(() => {
        if (!sbClient) return;
        (async () => {
          try {
            const { data, error } = await sbClient.from('competitors').select('*');
            if (!error && data && data.length > 0) setConnected(true);
          } catch {}
        })();
      }, []);

      const wins = DEMO_WIN_LOSS.filter(w => w.result === 'WIN').length;
      const losses = DEMO_WIN_LOSS.filter(w => w.result === 'LOSS').length;

      return (
        <div style={{ padding:'24px 32px', maxWidth:'1400px' }}>
          {/* Header */}
          <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:'24px' }}>
            <div>
              <div style={{ fontSize:'10px', fontWeight:700, color:'rgba(0,229,250,0.5)', letterSpacing:'2px', textTransform:'uppercase', marginBottom:'4px' }}>COMPETITIVE INTELLIGENCE</div>
              <h1 style={{ fontSize:'26px', fontWeight:800, color:'white', letterSpacing:'-0.5px', margin:0 }}>Competitors Deep Dive</h1>
              <div style={{ fontSize:'12px', color:'#5a7a9a', marginTop:'4px' }}>{competitors.length} tracked competitors • Capability matrix • Win/loss analysis</div>
            </div>
            <ConnectionDot c={connected} />
          </div>

          {/* Stats */}
          <div style={{ display:'flex', gap:'10px', flexWrap:'wrap', marginBottom:'20px' }}>
            {[
              { label:'Tracked Competitors', value:competitors.length, color:'#00E5FA' },
              { label:'High Threat', value:competitors.filter(c=>c.threatLevel==='HIGH').length, color:'#ef4444' },
              { label:'Incumbents', value:competitors.filter(c=>c.incumbent).length, color:'#f59e0b' },
              { label:'Our Win Rate', value:`${Math.round(wins/(wins+losses)*100)}%`, color:'#00ff88' },
              { label:'Wins', value:wins, color:'#00ff88' },
              { label:'Losses', value:losses, color:'#ef4444' },
            ].map(s => (
              <div key={s.label} style={{ background:'rgba(10,22,40,0.7)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'10px', padding:'10px 16px', minWidth:'130px' }}>
                <div style={{ fontSize:'9px', fontWeight:700, color:'#5a7a9a', letterSpacing:'0.5px', textTransform:'uppercase' }}>{s.label}</div>
                <div style={{ fontSize:'22px', fontWeight:800, color:s.color, letterSpacing:'-0.5px' }}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Tabs */}
          <div style={{ display:'flex', gap:'4px', marginBottom:'20px' }}>
            {[{k:'profiles',l:'Competitor Profiles'},{k:'matrix',l:'Capability Matrix'},{k:'winloss',l:'Win/Loss History'}].map(t => (
              <button key={t.k} onClick={() => setTab(t.k)} style={{ padding:'7px 16px', fontSize:'12px', fontWeight:600, borderRadius:'8px', border:'none', cursor:'pointer', background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)', color:tab===t.k?'#00E5FA':'#5a7a9a' }}>{t.l}</button>
            ))}
          </div>

          {/* PROFILES TAB */}
          {tab === 'profiles' && (
            <div style={{ display:'grid', gridTemplateColumns:'repeat(auto-fill, minmax(380px, 1fr))', gap:'12px' }}>
              {competitors.map(comp => (
                <div key={comp.id} style={{ background:'rgba(10,22,40,0.5)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'12px', padding:'18px', transition:'all 0.2s' }}
                  onMouseOver={e => e.currentTarget.style.borderColor='rgba(0,229,250,0.25)'} onMouseOut={e => e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                  <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:'12px' }}>
                    <div>
                      <div style={{ fontSize:'15px', fontWeight:700, color:'white' }}>{comp.name}</div>
                      <div style={{ display:'flex', gap:'6px', marginTop:'4px' }}>
                        <span style={{ fontSize:'10px', fontWeight:600, padding:'1px 6px', borderRadius:'4px', background:'rgba(0,229,250,0.08)', color:'#00E5FA' }}>{comp.size}</span>
                        {comp.setAside !== 'None' && <span style={{ fontSize:'10px', fontWeight:600, padding:'1px 6px', borderRadius:'4px', background:'rgba(167,139,250,0.1)', color:'#a78bfa' }}>{comp.setAside}</span>}
                        {comp.incumbent && <span style={{ fontSize:'10px', fontWeight:600, padding:'1px 6px', borderRadius:'4px', background:'rgba(245,158,11,0.1)', color:'#f59e0b' }}>INCUMBENT</span>}
                      </div>
                    </div>
                    <ThreatBadge level={comp.threatLevel} />
                  </div>
                  <div style={{ display:'flex', gap:'16px', marginBottom:'12px', fontSize:'11px' }}>
                    <div><span style={{ color:'#5a7a9a' }}>Win Rate:</span> <span style={{ color:comp.winRate>=60?'#00ff88':'#f59e0b', fontWeight:700 }}>{comp.winRate}%</span></div>
                    <div><span style={{ color:'#5a7a9a' }}>W/L:</span> <span style={{ color:'#00ff88', fontWeight:600 }}>{comp.wins}W</span> / <span style={{ color:'#ef4444', fontWeight:600 }}>{comp.losses}L</span></div>
                  </div>
                  <div style={{ marginBottom:'10px' }}>
                    <div style={{ fontSize:'10px', fontWeight:700, color:'#00ff88', marginBottom:'4px' }}>STRENGTHS</div>
                    <div style={{ display:'flex', gap:'4px', flexWrap:'wrap' }}>
                      {comp.strengths.map(s => <span key={s} style={{ fontSize:'10px', padding:'2px 6px', borderRadius:'4px', background:'rgba(0,255,136,0.06)', color:'#86efac' }}>{s}</span>)}
                    </div>
                  </div>
                  <div style={{ marginBottom:'10px' }}>
                    <div style={{ fontSize:'10px', fontWeight:700, color:'#ef4444', marginBottom:'4px' }}>WEAKNESSES</div>
                    <div style={{ display:'flex', gap:'4px', flexWrap:'wrap' }}>
                      {comp.weaknesses.map(w => <span key={w} style={{ fontSize:'10px', padding:'2px 6px', borderRadius:'4px', background:'rgba(239,68,68,0.06)', color:'#fca5a5' }}>{w}</span>)}
                    </div>
                  </div>
                  <div>
                    <div style={{ fontSize:'10px', fontWeight:700, color:'#5a7a9a', marginBottom:'4px' }}>KEY CONTRACTS</div>
                    <div style={{ fontSize:'11px', color:'#94a3b8' }}>{comp.contracts.join(' • ')}</div>
                  </div>
                </div>
              ))}
            </div>
          )}

          {/* MATRIX TAB */}
          {tab === 'matrix' && (
            <div style={{ background:'rgba(10,22,40,0.5)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'12px', overflow:'auto' }}>
              <table style={{ width:'100%', borderCollapse:'collapse', fontSize:'12px', minWidth:'900px' }}>
                <thead>
                  <tr style={{ borderBottom:'1px solid rgba(0,229,250,0.1)' }}>
                    <th style={{ padding:'10px 14px', textAlign:'left', color:'#5a7a9a', fontWeight:700, fontSize:'10px', letterSpacing:'0.5px', position:'sticky', left:0, background:'#0a1628', zIndex:1 }}>COMPANY</th>
                    {CAPABILITY_AREAS.map(a => <th key={a} style={{ padding:'10px 8px', textAlign:'center', color:'#5a7a9a', fontWeight:600, fontSize:'9px', letterSpacing:'0.3px', textTransform:'uppercase', whiteSpace:'nowrap' }}>{a}</th>)}
                    <th style={{ padding:'10px 8px', textAlign:'center', color:'#00E5FA', fontWeight:700, fontSize:'10px' }}>AVG</th>
                  </tr>
                </thead>
                <tbody>
                  {Object.entries(DEMO_MATRIX).map(([company, scores]) => {
                    const isUs = company === 'Mission Meets Tech';
                    const avg = (scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(1);
                    return (
                      <tr key={company} style={{ borderBottom:'1px solid rgba(0,229,250,0.04)', background:isUs?'rgba(0,229,250,0.04)':'transparent' }}>
                        <td style={{ padding:'10px 14px', fontWeight:isUs?800:500, color:isUs?'#00E5FA':'white', whiteSpace:'nowrap', position:'sticky', left:0, background:isUs?'rgba(0,229,250,0.04)':'#0a1020', zIndex:1 }}>{company}{isUs && ' ★'}</td>
                        {scores.map((s,i) => (
                          <td key={i} style={{ padding:'8px', textAlign:'center' }}><RatingBar value={s} /></td>
                        ))}
                        <td style={{ padding:'8px', textAlign:'center', fontWeight:700, color:avg>=4?'#00ff88':avg>=3?'#00E5FA':'#f59e0b' }}>{avg}</td>
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
          )}

          {/* WIN/LOSS TAB */}
          {tab === 'winloss' && (
            <div style={{ background:'rgba(10,22,40,0.5)', border:'1px solid rgba(0,229,250,0.08)', borderRadius:'12px', overflow:'hidden' }}>
              <table style={{ width:'100%', borderCollapse:'collapse', fontSize:'12px' }}>
                <thead>
                  <tr style={{ borderBottom:'1px solid rgba(0,229,250,0.1)' }}>
                    {['Date','Opportunity','Competitor','Value','Result','Key Factor'].map(h => (
                      <th key={h} style={{ padding:'10px 12px', textAlign:'left', color:'#5a7a9a', fontWeight:700, fontSize:'10px', letterSpacing:'0.5px', textTransform:'uppercase' }}>{h}</th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {DEMO_WIN_LOSS.map((r,i) => (
                    <tr key={i} style={{ borderBottom:'1px solid rgba(0,229,250,0.04)' }}
                      onMouseOver={e => e.currentTarget.style.background='rgba(0,229,250,0.03)'} onMouseOut={e => e.currentTarget.style.background='transparent'}>
                      <td style={{ padding:'9px 12px', color:'#5a7a9a', fontFamily:'monospace', fontSize:'11px' }}>{r.date}</td>
                      <td style={{ padding:'9px 12px', color:'white', fontWeight:500 }}>{r.opp}</td>
                      <td style={{ padding:'9px 12px', color:'#94a3b8' }}>{r.competitor}</td>
                      <td style={{ padding:'9px 12px', color:'#00E5FA', fontWeight:600 }}>${(r.value/1000000).toFixed(0)}M</td>
                      <td style={{ padding:'9px 12px' }}>
                        <span style={{ fontSize:'10px', fontWeight:700, padding:'2px 8px', borderRadius:'4px', background:r.result==='WIN'?'rgba(0,255,136,0.1)':'rgba(239,68,68,0.1)', color:r.result==='WIN'?'#00ff88':'#ef4444' }}>{r.result}</span>
                      </td>
                      <td style={{ padding:'9px 12px', color:'#94a3b8', fontSize:'11px' }}>{r.reason}</td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          )}

          {/* Footer */}
          <div style={{ textAlign:'center', padding:'20px 0', marginTop:'28px', borderTop:'1px solid rgba(0,229,250,0.06)', fontSize:'10px', color:'rgba(148,163,184,0.4)', lineHeight:'1.8' }}>
            ⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
