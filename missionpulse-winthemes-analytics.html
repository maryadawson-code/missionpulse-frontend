<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MissionPulse — Win Themes Analytics</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Inter',sans-serif;background:#00050F;min-height:100vh;color:#e2e8f0}::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(0,229,250,0.2);border-radius:3px}</style>
</head>
<body>
  <div id="missionpulse-sidebar"></div>
  <div class="main-content"><div id="root"></div></div>
  <script src="missionpulse-nav.js"></script>
  <script type="text/babel">
    const{useState,useEffect,useMemo}=React;
    const SB_URL='https://qdrtpnpnhkxvfmvfziop.supabase.co';const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFkcnRwbnBuaGt4dmZtdmZ6aW9wIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjMxNDMsImV4cCI6MjA1MzQ5OTE0M30.GFbjgRMgVhMMcnNaJMrLVnJI_u6yBGJOhO-LHKE8sZQ';
    var sbClient;try{sbClient=supabase.createClient(SB_URL,SB_KEY)}catch(e){sbClient=null}
    const ROLES_ALLOWED=['*'];

    const EVAL_FACTORS=[
      {id:'TF1',name:'Technical Approach',weight:30,section:'M.1'},
      {id:'TF2',name:'Innovation & AI',weight:15,section:'M.2'},
      {id:'TF3',name:'Security & Compliance',weight:15,section:'M.3'},
      {id:'MF1',name:'Management Approach',weight:20,section:'M.4'},
      {id:'MF2',name:'Staffing & Transition',weight:10,section:'M.5'},
      {id:'PF1',name:'Past Performance',weight:10,section:'M.6'},
    ];

    const DEMO_THEMES=[
      {id:1,opp:'DHA EHR Modernization',theme:'AI-First Modernization',tagline:'40% faster deployment through MissionPulse AI automation',strength:88,evalFactors:['TF1','TF2'],coverage:['Vol II §2.1','Vol II §2.5'],evidence:['AskSage FedRAMP High','CMS AI pilot results','Automated code review stats'],ghosting:'Unlike legacy integrators who bolt AI onto existing workflows, our AI-first architecture means automation is the foundation—not an afterthought.',gaps:[],status:'STRONG'},
      {id:2,opp:'DHA EHR Modernization',theme:'Day-1 FedRAMP High',tagline:'Pre-authorized cloud environment eliminates 180-day ATO delay',strength:92,evalFactors:['TF3','TF1'],coverage:['Vol II §2.3','Vol II §2.2'],evidence:['Azure Gov IL5 authorization','FedRAMP High inheritance docs','ConMon dashboard live demo'],ghosting:'Competitors starting from scratch face 6+ months of ATO paperwork. Our inherited authorization means secure operations from Day 1.',gaps:[],status:'STRONG'},
      {id:3,opp:'DHA EHR Modernization',theme:'Veteran-Led Mission Focus',tagline:'SDVOSB team with 150+ combined years of DHA/MHS experience',strength:75,evalFactors:['MF1','PF1'],coverage:['Vol III §3.1','Vol IV'],evidence:['Key personnel resumes','DHA past performance','CPARS ratings'],ghosting:'Large primes cycle staff across programs. Our key personnel have dedicated careers to military health—and they\'re staying.',gaps:['Need stronger PP narrative for AI-specific work'],status:'NEEDS WORK'},
      {id:4,opp:'DHA EHR Modernization',theme:'22% TCO Reduction',tagline:'Automation-driven cost savings proven across 3 federal programs',strength:70,evalFactors:['TF1','MF1'],coverage:['Vol V §5.1','Vol II §2.1'],evidence:['ROI calculator results','Historical cost comparisons','Automation metrics from VA pilot'],ghosting:'Our price premium is an investment: 15% more Year 1 delivers 22% less over the full period of performance.',gaps:['Need CFO sign-off on ROI methodology','Strengthen Year 1 vs lifecycle cost narrative'],status:'NEEDS WORK'},
      {id:5,opp:'DHA EHR Modernization',theme:'Zero-Disruption Transition',tagline:'90-day parallel-run transition with automated knowledge capture',strength:82,evalFactors:['MF2','MF1'],coverage:['Vol III §3.4','Vol III §3.1'],evidence:['Transition playbook','Automated KT tool demo','IHS transition success story'],ghosting:'Traditional transitions rely on incumbent cooperation. Our automated knowledge capture works independently—no handoff bottleneck.',gaps:[],status:'STRONG'},
      {id:6,opp:'VA Claims Processing AI',theme:'Responsible AI for Veterans',tagline:'Transparent, auditable AI that veterans and adjudicators can trust',strength:85,evalFactors:['TF2','TF3'],coverage:['Vol II §2.1','Vol II §2.3'],evidence:['NIST AI RMF alignment','Bias testing results','Explainability dashboard demo'],ghosting:'Black-box AI has no place in veteran benefits decisions. Every recommendation our system makes comes with a plain-English explanation.',gaps:[],status:'STRONG'},
      {id:7,opp:'VA Claims Processing AI',theme:'Claims Velocity Engine',tagline:'Reduce average claims processing time from 120 days to 45 days',strength:78,evalFactors:['TF1','TF2'],coverage:['Vol II §2.2','Vol II §2.4'],evidence:['Processing time benchmarks','ML model accuracy rates','Pilot program metrics'],ghosting:'Incremental improvements won\'t clear the backlog. Our ML pipeline pre-processes, classifies, and routes claims before a human ever touches them.',gaps:['Pilot metrics need independent validation statement'],status:'NEEDS WORK'},
    ];

    const ConnectionDot=({c})=>(<div style={{display:'flex',alignItems:'center',gap:'6px',fontSize:'11px',color:c?'#00ff88':'#f59e0b'}}><div style={{width:'8px',height:'8px',borderRadius:'50%',background:c?'#00ff88':'#f59e0b',boxShadow:`0 0 6px ${c?'#00ff88':'#f59e0b'}`}}/>{c?'LIVE':'DEMO'}</div>);

    const StrengthBar=({value})=>{
      const color=value>=85?'#00ff88':value>=70?'#00E5FA':value>=50?'#f59e0b':'#ef4444';
      return(
        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
          <div style={{flex:1,height:'8px',background:'rgba(255,255,255,0.04)',borderRadius:'4px',overflow:'hidden'}}>
            <div style={{width:`${value}%`,height:'100%',background:color,borderRadius:'4px',transition:'width 0.5s'}}/>
          </div>
          <span style={{fontSize:'12px',fontWeight:700,color,minWidth:'36px',textAlign:'right'}}>{value}</span>
        </div>
      );
    };

    const App=()=>{
      const[connected,setConnected]=useState(false);
      const[themes]=useState(DEMO_THEMES);
      const[oppFilter,setOppFilter]=useState('All');
      const[expanded,setExpanded]=useState(null);
      const[tab,setTab]=useState('themes');

      useEffect(()=>{if(!sbClient)return;(async()=>{try{const{data,error}=await sbClient.from('win_themes').select('id');if(!error&&data&&data.length>0)setConnected(true)}catch{}})()},[]);

      const opps=[...new Set(themes.map(t=>t.opp))];
      const filtered=useMemo(()=>oppFilter==='All'?themes:themes.filter(t=>t.opp===oppFilter),[themes,oppFilter]);

      const avgStrength=Math.round(filtered.reduce((s,t)=>s+t.strength,0)/filtered.length);
      const strong=filtered.filter(t=>t.status==='STRONG').length;
      const needsWork=filtered.filter(t=>t.status==='NEEDS WORK').length;
      const totalGaps=filtered.reduce((s,t)=>s+t.gaps.length,0);

      // Eval factor coverage analysis
      const factorCoverage=useMemo(()=>{
        return EVAL_FACTORS.map(f=>{
          const covering=filtered.filter(t=>t.evalFactors.includes(f.id));
          const avgStr=covering.length>0?Math.round(covering.reduce((s,t)=>s+t.strength,0)/covering.length):0;
          return{...f,themeCount:covering.length,avgStrength:avgStr,covered:covering.length>0};
        });
      },[filtered]);

      const statusColor={STRONG:'#00ff88','NEEDS WORK':'#f59e0b',WEAK:'#ef4444'};

      return(
        <div style={{padding:'24px 32px',maxWidth:'1400px'}}>
          <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'24px'}}>
            <div>
              <div style={{fontSize:'10px',fontWeight:700,color:'rgba(0,229,250,0.5)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'4px'}}>DISCRIMINATOR ANALYSIS</div>
              <h1 style={{fontSize:'26px',fontWeight:800,color:'white',letterSpacing:'-0.5px',margin:0}}>Win Themes Analytics</h1>
              <div style={{fontSize:'12px',color:'#5a7a9a',marginTop:'4px'}}>Strength scoring • Evaluator alignment • Gap analysis</div>
            </div>
            <ConnectionDot c={connected}/>
          </div>

          {/* Stats */}
          <div style={{display:'flex',gap:'10px',flexWrap:'wrap',marginBottom:'20px'}}>
            {[
              {label:'Total Themes',value:filtered.length,color:'#00E5FA'},
              {label:'Avg Strength',value:avgStrength,color:avgStrength>=80?'#00ff88':'#f59e0b'},
              {label:'Strong',value:strong,color:'#00ff88'},
              {label:'Needs Work',value:needsWork,color:'#f59e0b'},
              {label:'Open Gaps',value:totalGaps,color:totalGaps>0?'#ef4444':'#00ff88'},
              {label:'Eval Factors Covered',value:`${factorCoverage.filter(f=>f.covered).length}/${EVAL_FACTORS.length}`,color:factorCoverage.every(f=>f.covered)?'#00ff88':'#f59e0b'},
            ].map(s=>(
              <div key={s.label} style={{background:'rgba(10,22,40,0.7)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'10px',padding:'10px 16px',minWidth:'125px'}}>
                <div style={{fontSize:'9px',fontWeight:700,color:'#5a7a9a',letterSpacing:'0.5px',textTransform:'uppercase'}}>{s.label}</div>
                <div style={{fontSize:'22px',fontWeight:800,color:s.color,letterSpacing:'-0.5px'}}>{s.value}</div>
              </div>
            ))}
          </div>

          {/* Tabs + Filters */}
          <div style={{display:'flex',gap:'8px',flexWrap:'wrap',marginBottom:'16px',alignItems:'center'}}>
            {[{k:'themes',l:'Theme Cards'},{k:'alignment',l:'Evaluator Alignment'},{k:'gaps',l:'Gap Analysis'}].map(t=>(
              <button key={t.k} onClick={()=>setTab(t.k)} style={{padding:'7px 16px',fontSize:'12px',fontWeight:600,borderRadius:'8px',border:'none',cursor:'pointer',background:tab===t.k?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:tab===t.k?'#00E5FA':'#5a7a9a'}}>{t.l}</button>
            ))}
            <div style={{marginLeft:'auto',display:'flex',gap:'3px'}}>
              {['All',...opps].map(o=>(
                <button key={o} onClick={()=>setOppFilter(o)} style={{padding:'5px 10px',fontSize:'10px',fontWeight:600,borderRadius:'6px',border:'none',cursor:'pointer',whiteSpace:'nowrap',background:oppFilter===o?'rgba(0,229,250,0.15)':'rgba(10,22,40,0.5)',color:oppFilter===o?'#00E5FA':'#5a7a9a'}}>{o==='All'?'All':o.split(' ').slice(0,2).join(' ')}</button>
              ))}
            </div>
          </div>

          {/* THEME CARDS */}
          {tab==='themes'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
              {filtered.map(t=>(
                <div key={t.id} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',overflow:'hidden',transition:'all 0.15s'}} onMouseOver={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.2)'} onMouseOut={e=>e.currentTarget.style.borderColor='rgba(0,229,250,0.08)'}>
                  <div onClick={()=>setExpanded(expanded===t.id?null:t.id)} style={{padding:'16px 18px',cursor:'pointer'}}>
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'flex-start',marginBottom:'8px'}}>
                      <div>
                        <div style={{display:'flex',alignItems:'center',gap:'8px'}}>
                          <span style={{fontSize:'15px',fontWeight:700,color:'white'}}>{t.theme}</span>
                          <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:`${statusColor[t.status]}12`,color:statusColor[t.status]}}>{t.status}</span>
                        </div>
                        <div style={{fontSize:'12px',color:'#00E5FA',fontStyle:'italic',marginTop:'2px'}}>"{t.tagline}"</div>
                      </div>
                      <div style={{minWidth:'120px'}}><StrengthBar value={t.strength}/></div>
                    </div>
                    <div style={{display:'flex',gap:'8px',flexWrap:'wrap',fontSize:'10px'}}>
                      <span style={{color:'#5a7a9a'}}>{t.opp}</span>
                      {t.evalFactors.map(ef=>{const f=EVAL_FACTORS.find(x=>x.id===ef);return f?<span key={ef} style={{padding:'1px 5px',borderRadius:'3px',background:'rgba(167,139,250,0.08)',color:'#a78bfa'}}>{f.name} ({f.weight}%)</span>:null})}
                      {t.gaps.length>0&&<span style={{padding:'1px 5px',borderRadius:'3px',background:'rgba(239,68,68,0.08)',color:'#ef4444'}}>⚠ {t.gaps.length} gap{t.gaps.length>1?'s':''}</span>}
                    </div>
                  </div>
                  {expanded===t.id&&(
                    <div style={{padding:'0 18px 16px',borderTop:'1px solid rgba(0,229,250,0.06)'}}>
                      <div style={{padding:'12px 0',display:'grid',gridTemplateColumns:'1fr 1fr',gap:'16px'}}>
                        <div>
                          <div style={{fontSize:'10px',fontWeight:700,color:'#00E5FA',marginBottom:'4px'}}>GHOSTING STATEMENT</div>
                          <div style={{fontSize:'12px',color:'#e2e8f0',lineHeight:'1.6',background:'rgba(0,229,250,0.03)',padding:'10px 12px',borderRadius:'6px',borderLeft:'3px solid #00E5FA'}}>{t.ghosting}</div>
                        </div>
                        <div>
                          <div style={{fontSize:'10px',fontWeight:700,color:'#00ff88',marginBottom:'4px'}}>EVIDENCE</div>
                          <div style={{display:'flex',flexDirection:'column',gap:'3px'}}>
                            {t.evidence.map(e=><span key={e} style={{fontSize:'11px',color:'#86efac',padding:'2px 0'}}>✓ {e}</span>)}
                          </div>
                        </div>
                      </div>
                      <div style={{display:'flex',gap:'16px'}}>
                        <div>
                          <div style={{fontSize:'10px',fontWeight:700,color:'#5a7a9a',marginBottom:'4px'}}>PROPOSAL COVERAGE</div>
                          <div style={{display:'flex',gap:'4px',flexWrap:'wrap'}}>
                            {t.coverage.map(c=><span key={c} style={{fontSize:'10px',padding:'2px 6px',borderRadius:'3px',background:'rgba(0,229,250,0.06)',color:'#67e8f9',fontFamily:'monospace'}}>{c}</span>)}
                          </div>
                        </div>
                        {t.gaps.length>0&&(
                          <div>
                            <div style={{fontSize:'10px',fontWeight:700,color:'#ef4444',marginBottom:'4px'}}>GAPS TO CLOSE</div>
                            {t.gaps.map(g=><div key={g} style={{fontSize:'11px',color:'#fca5a5',padding:'2px 0'}}>⚠ {g}</div>)}
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>
          )}

          {/* EVALUATOR ALIGNMENT */}
          {tab==='alignment'&&(
            <div style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(0,229,250,0.08)',borderRadius:'12px',padding:'18px'}}>
              <div style={{fontSize:'13px',fontWeight:700,color:'white',marginBottom:'14px'}}>Section M Evaluation Factor Coverage</div>
              <div style={{display:'flex',flexDirection:'column',gap:'10px'}}>
                {factorCoverage.map(f=>(
                  <div key={f.id} style={{display:'flex',alignItems:'center',gap:'14px'}}>
                    <div style={{minWidth:'180px'}}>
                      <div style={{fontSize:'12px',fontWeight:600,color:'white'}}>{f.name}</div>
                      <div style={{fontSize:'10px',color:'#5a7a9a'}}>{f.section} • Weight: {f.weight}%</div>
                    </div>
                    <div style={{flex:1}}><StrengthBar value={f.avgStrength}/></div>
                    <div style={{minWidth:'80px',textAlign:'right'}}>
                      <span style={{fontSize:'10px',fontWeight:600,color:f.themeCount>0?'#00E5FA':'#ef4444'}}>{f.themeCount} theme{f.themeCount!==1?'s':''}</span>
                    </div>
                    {!f.covered&&<span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:'rgba(239,68,68,0.1)',color:'#ef4444'}}>NO COVERAGE</span>}
                  </div>
                ))}
              </div>
            </div>
          )}

          {/* GAP ANALYSIS */}
          {tab==='gaps'&&(
            <div style={{display:'flex',flexDirection:'column',gap:'8px'}}>
              {filtered.filter(t=>t.gaps.length>0).length===0?(
                <div style={{textAlign:'center',padding:'40px',color:'#00ff88',fontSize:'14px',fontWeight:600}}>✓ No open gaps — all themes are strong</div>
              ):(
                filtered.filter(t=>t.gaps.length>0).map(t=>(
                  <div key={t.id} style={{background:'rgba(10,22,40,0.5)',border:'1px solid rgba(239,68,68,0.15)',borderRadius:'10px',padding:'14px 18px'}}>
                    <div style={{display:'flex',alignItems:'center',gap:'8px',marginBottom:'8px'}}>
                      <span style={{fontSize:'14px',fontWeight:700,color:'white'}}>{t.theme}</span>
                      <span style={{fontSize:'10px',color:'#5a7a9a'}}>({t.opp})</span>
                      <span style={{fontSize:'9px',fontWeight:700,padding:'2px 6px',borderRadius:'3px',background:'rgba(239,68,68,0.1)',color:'#ef4444'}}>{t.gaps.length} GAP{t.gaps.length>1?'S':''}</span>
                    </div>
                    {t.gaps.map((g,i)=>(
                      <div key={i} style={{display:'flex',alignItems:'flex-start',gap:'8px',padding:'6px 0',borderBottom:i<t.gaps.length-1?'1px solid rgba(0,229,250,0.04)':'none'}}>
                        <span style={{color:'#ef4444',fontSize:'12px',marginTop:'1px'}}>⚠</span>
                        <div>
                          <div style={{fontSize:'12px',color:'#fca5a5'}}>{g}</div>
                          <div style={{fontSize:'10px',color:'#5a7a9a',marginTop:'2px'}}>Impact: Theme strength currently {t.strength}/100</div>
                        </div>
                      </div>
                    ))}
                  </div>
                ))
              )}
            </div>
          )}

          <div style={{textAlign:'center',padding:'20px 0',marginTop:'28px',borderTop:'1px solid rgba(0,229,250,0.06)',fontSize:'10px',color:'rgba(148,163,184,0.4)',lineHeight:'1.8'}}>⚠️ AI GENERATED — REQUIRES HUMAN REVIEW<br/>MissionPulse v12.0 — Mission Meets Tech | CMMC 2.0 L2 Compliant</div>
        </div>
      );
    };
    ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
  </script>
</body>
</html>
